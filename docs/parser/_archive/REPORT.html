<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>REPORT</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
    font-size: 16px;
    line-height: 1.5;
    word-wrap: break-word;
    color: #24292e;
    background-color: #fff;
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem;
}
h1, h2, h3, h4, h5, h6 {
    margin-top: 24px;
    margin-bottom: 16px;
    font-weight: 600;
    line-height: 1.25;
}
h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
h3 { font-size: 1.25em; }
code {
    padding: 0.2em 0.4em;
    margin: 0;
    font-size: 85%;
    background-color: #f6f8fa;
    border-radius: 6px;
    font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
}
pre {
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f6f8fa;
    border-radius: 6px;
}
pre code {
    display: inline;
    padding: 0;
    margin: 0;
    overflow: visible;
    line-height: inherit;
    word-wrap: normal;
    background-color: initial;
    border: 0;
}
blockquote {
    padding: 0 1em;
    color: #6a737d;
    border-left: 0.25em solid #dfe2e5;
    margin: 0;
}
table {
    display: block;
    width: 100%;
    margin-top: 0;
    margin-bottom: 16px;
    overflow: auto;
    border-spacing: 0;
    border-collapse: collapse;
}
table th, table td {
    padding: 6px 13px;
    border: 1px solid #dfe2e5;
}
table tr {
    background-color: #fff;
    border-top: 1px solid #c6cbd1;
}
table tr:nth-child(2n) {
    background-color: #f6f8fa;
}
a { color: #0366d6; text-decoration: none; }
a:hover { text-decoration: underline; }
hr {
    height: 0.25em;
    padding: 0;
    margin: 24px 0;
    background-color: #e1e4e8;
    border: 0;
}
</style>

</head>
<body>
<h1 id="hvac-report-parser">HVAC æ ¸å¿ƒåˆ†ææ¨¡çµ„ - å ±è¡¨è§£æå™¨ (Report Parser) è©•é‘‘å ±å‘Š</h1>
<p><strong>æ—¥æœŸ:</strong> 2026-02-12<br />
<strong>æ¨¡çµ„:</strong> <code>src/etl/parser.py</code> (ReportParser)<br />
<strong>ç‹€æ…‹:</strong> âš ï¸ éœ€é€²è¡Œå¼·å¥æ€§é‡æ§‹ (Robustness Refactoring)</p>
<hr />
<h2 id="1-executive-summary">1. åŸ·è¡Œæ‘˜è¦ (Executive Summary)</h2>
<p>ç›®å‰çš„ <code>ReportParser</code> é‡å°å…¶é–‹ç™¼çš„ç‰¹å®šæ¡ˆå ´ (é•·åºšæ¡ƒåœ’ CGMH-TY) é‹ä½œæ­£å¸¸ï¼Œä½†<strong>æŠ€è¡“æ¶æ§‹è„†å¼±</strong>ï¼Œå°šæœªé”åˆ°<strong>ç”Ÿç”¢ç’°å¢ƒå°±ç·’ (Production-Ready)</strong> çš„æ¨™æº–ï¼Œä¸é©åˆç›´æ¥éƒ¨ç½²æ–¼å¤šæ¨£åŒ–çš„ç’°å¢ƒã€‚</p>
<p>é›–ç„¶å®ƒèƒ½æ­£ç¢ºè™•ç†ä¸­ç¹¼è³‡æ–™ (Metadata) æå–èˆ‡æ„Ÿæ¸¬å™¨åç¨±å°æ˜ ï¼Œä½†ç¼ºä¹å·¥æ¥­ç´šçš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ã€‚å…·é«”è€Œè¨€ï¼Œå®ƒæ¥µæ˜“å—<strong>æª”æ¡ˆç·¨ç¢¼å•é¡Œ</strong>ï¼ˆå¸¸è¦‹æ–¼å°ç£æ¡ˆå ´ç³»çµ±ï¼‰èˆ‡<strong>æª”æ¡ˆçµæ§‹è®Šç•°</strong>çš„å½±éŸ¿ï¼Œè‹¥éƒ¨ç½²è‡³æ–°æ¡ˆå ´ï¼Œæ¥µé«˜æ©Ÿç‡æœƒå°è‡´è³‡æ–™è®€å–å¤±æ•—ã€‚</p>
<h2 id="2">2. è©•é‘‘æ–¹æ³•</h2>
<p>æˆ‘å€‘é€²è¡Œäº†å…©éšæ®µè©•ä¼°ï¼š<br />
1.  <strong>éœæ…‹ä»£ç¢¼åˆ†æ</strong>ï¼šæª¢è¦–åŸå§‹ç¢¼ä¸­çš„é‚è¼¯ç¼ºå¤±ã€ç¡¬ç·¨ç¢¼æ•¸å€¼ (Hardcoded Values) èˆ‡éŒ¯èª¤è™•ç†æ¨¡å¼ã€‚<br />
2.  <strong>æ·±åº¦å£“åŠ›æ¸¬è©¦</strong>ï¼šåŸ·è¡Œå®¢è£½åŒ–æ¸¬è©¦è…³æœ¬ (<code>tests/stress_test_parser.py</code>)ï¼Œé‡å° 5 ç¨®é‚Šç·£èˆ‡ç•°å¸¸è³‡æ–™æƒ…å¢ƒé€²è¡Œå¯¦æ¸¬ï¼Œé©—è­‰ç³»çµ±å´©æ½°æ¨¡å¼ã€‚</p>
<hr />
<h2 id="3">3. å£“åŠ›æ¸¬è©¦çµæœ</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">æ¸¬è©¦æ¡ˆä¾‹</th>
<th style="text-align: left;">æƒ…å¢ƒæè¿°</th>
<th style="text-align: left;">çµæœ</th>
<th style="text-align: left;">æŠ€è¡“è¡æ“Š</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>åŸºæº–æ¸¬è©¦ (Baseline)</strong></td>
<td style="text-align: left;">ç¬¦åˆé æœŸçš„æ¨™æº– UTF-8 CSV æª”æ¡ˆã€‚</td>
<td style="text-align: left;">âœ… <strong>é€šé</strong></td>
<td style="text-align: left;">è§£ææ­£ç¢ºã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Big5 ç·¨ç¢¼</strong></td>
<td style="text-align: left;">æ¨¡æ“¬å°ç£å¸¸è¦‹çš„èˆŠç‰ˆ Windows ç³»çµ±å ±è¡¨ (CP950)ã€‚</td>
<td style="text-align: left;">âŒ <strong>åš´é‡å¤±æ•—</strong></td>
<td style="text-align: left;"><strong>ç¨‹åºå´©æ½° (Crash)</strong>ã€‚è§£æå™¨å¼·è¡Œä½¿ç”¨ <code>utf-8</code>ï¼Œå°è‡´ <code>UnicodeDecodeError</code>ï¼Œç³»çµ±å®Œå…¨åœæ“ºã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>éºå¤±æ¨™é ­ (Missing Header)</strong></td>
<td style="text-align: left;">ç§»é™¤ <code>"&gt;&lt;&gt;Date"</code> æ¨™è¨˜è¡Œã€‚</td>
<td style="text-align: left;">âš ï¸ <strong>é«˜é¢¨éšª</strong></td>
<td style="text-align: left;">ç³»çµ±æœƒ Fallback åˆ°é è¨­ç¬¬ 211 è¡Œã€‚è‹¥æ¨™é ­ä½ç½®åç§»ï¼Œå°‡å°è‡´æ•¸æ“šéŒ¯ä½æˆ–è®€å…¥åƒåœ¾æ•¸æ“š (Silent Corruption)ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>åƒå·®æ•¸æ“š (Ragged Lines)</strong></td>
<td style="text-align: left;">è³‡æ–™åˆ—ä¸­æœ‰å¤šé¤˜æˆ–ç¼ºå°‘çš„æ¬„ä½åˆ†éš”ç¬¦ã€‚</td>
<td style="text-align: left;">âš ï¸ <strong>å‹‰å¼·é€šé</strong></td>
<td style="text-align: left;">Polars å‹‰å¼·è®€å…¥ï¼Œä½†æ•¸æ“šåˆ—ç™¼ç”Ÿä½ç§»ä¸”ç„¡ä»»ä½•è­¦å‘Šã€‚é€™æœƒå°è‡´æ•¸æ“šã€Œç„¡è²æå£ã€ã€‚</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ç©ºæ•¸æ“š</strong></td>
<td style="text-align: left;">åƒ…åŒ…å«ä¸­ç¹¼è³‡æ–™ä½†ç„¡æ™‚é–“åºåˆ—æ•¸æ“šçš„æª”æ¡ˆã€‚</td>
<td style="text-align: left;">âœ… <strong>é€šé</strong></td>
<td style="text-align: left;">æ­£ç¢ºå›å‚³ç©º DataFrame (ç¬¦åˆé æœŸè¡Œç‚º)ã€‚</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="4">4. é—œéµç™¼ç¾èˆ‡æŠ€è¡“é¢¨éšª</h2>
<h3 id="1">ğŸš¨ 1. ç·¨ç¢¼è„†å¼±æ€§ (æœ€é«˜é¢¨éšª)</h3>
<p>ç›®å‰å¯¦ä½œåœ¨ <code>parser.py</code> ä¸­ç¡¬ç·¨ç¢¼äº† <code>encoding='utf-8'</code>ï¼š</p>
<pre><code class="language-python">with open(file_path, 'r', encoding='utf-8', errors='replace') as f:
</code></pre>
<p><strong>æ¥­å‹™è¡æ“Šï¼š</strong> å°ç£å¤§å¤šæ•¸å»ºç¯‰è‡ªå‹•åŒ–ç³»çµ± (BAS) åŒ¯å‡ºçš„å ±è¡¨ç‚º <strong>Big5 (CP950)</strong> æˆ– <strong>UTF-16</strong>ã€‚ç›®å‰çš„ç³»çµ±åœ¨è®€å–é€™äº›æª”æ¡ˆæ™‚æœƒ<strong>ç«‹å³å´©æ½°</strong>ï¼Œå°è‡´æ¯ä¸€å€‹æ–°æ¡ˆå ´éƒ½éœ€è¦å·¥ç¨‹å¸«ä»‹å…¥ä¿®æ”¹ç¨‹å¼ç¢¼ã€‚</p>
<h3 id="2_1">2. æ¨™é ­åµæ¸¬éæ–¼è„†å¼±</h3>
<p>ç›®å‰çš„é‚è¼¯ä¾è³´ç²¾ç¢ºçš„å­—ä¸²æ¯”å°ï¼š</p>
<pre><code class="language-python">if line.startswith('&quot;&lt;&gt;Date&quot;') or line.startswith('&lt;&gt;Date'):
</code></pre>
<p><strong>æ¥­å‹™è¡æ“Šï¼š</strong> è‹¥å ±è¡¨æ¨¡æ¿ç¨æœ‰è®Šå‹•ï¼ˆä¾‹å¦‚è®Šæˆ <code>"Date"</code> è€Œé <code>"&lt;&gt;Date"</code>ï¼‰ï¼Œè§£æå™¨å°±æœƒç›´æ¥è·³åˆ°é è¨­çš„ç¬¬ 211 è¡Œã€‚å¦‚æœå¯¦éš›æ•¸æ“šå¾ç¬¬ 50 è¡Œå°±é–‹å§‹ï¼Œç³»çµ±å°‡æœƒ<strong>ç›´æ¥æ¨æ£„ 160 è¡Œçš„æœ‰æ•ˆæ•¸æ“š</strong>ï¼ˆç„¡è²æ•¸æ“šéºå¤±ï¼‰ã€‚</p>
<h3 id="3-schema-validation">3. ç¼ºä¹è³‡æ–™æ¶æ§‹é©—è­‰ (Schema Validation)</h3>
<p>è§£æéç¨‹å®Œå…¨æ²’æœ‰æª¢æŸ¥é—œéµæ¬„ä½ï¼ˆå¦‚ <code>kW</code> è€—é›»é‡æˆ– <code>RT</code> è² è¼‰ï¼‰æ˜¯å¦æˆåŠŸè®€å…¥ã€‚<br />
<strong>æ¥­å‹™è¡æ“Šï¼š</strong> ä¸€ä»½æå£çš„å ±è¡¨å¯èƒ½è¢«ã€ŒæˆåŠŸã€è§£æç‚ºä¸€å¼µç©ºè¡¨æˆ–åƒåœ¾è¡¨ï¼Œå°è‡´å¾ŒçºŒçš„ AI æ¨¡å‹è¨“ç·´éšæ®µå› ã€Œç„¡æ•ˆæ¨£æœ¬ã€è€Œå¤±æ•—ï¼ŒéŒ¯èª¤è¨Šæ¯æ™¦æ¾€é›£æ‡‚ï¼Œå¤§å¹…å¢åŠ é™¤éŒ¯æˆæœ¬ã€‚</p>
<hr />
<h2 id="5">5. æŠ€è¡“å„ªåŒ–å»ºè­°</h2>
<p>æˆ‘å€‘æå‡º<strong>ã€Œå¼·å¥æ€§é‡æ§‹è¨ˆç•«ã€</strong>ä¾†ç«‹å³è§£æ±ºä¸Šè¿°å•é¡Œï¼š</p>
<h3 id="_1">âœ… ç¬¬ä¸€éšæ®µï¼šè‡ªé©æ‡‰æª”æ¡ˆè®€å– (å„ªå…ˆç´šï¼šé«˜)</h3>
<ul>
<li><strong>è‡ªå‹•ç·¨ç¢¼åµæ¸¬</strong>ï¼šå¯¦ä½œã€Œé è®€æ©Ÿåˆ¶ã€ï¼Œå…ˆè®€å–æª”æ¡ˆå‰ 1KB å˜—è©¦ <code>utf-8</code>ï¼Œè‹¥å¤±æ•—å‰‡è‡ªå‹•åˆ‡æ›è‡³ <code>cp950</code> (Big5)ã€‚</li>
<li><strong>é€šç”¨æ›è¡Œæ”¯æ´</strong>ï¼šç¢ºä¿é‚è¼¯èƒ½æ­£ç¢ºè™•ç† Windows (<code>\r\n</code>) èˆ‡ Unix (<code>\n</code>) æ›è¡Œç¬¦è™Ÿã€‚</li>
</ul>
<h3 id="_2">âœ… ç¬¬äºŒéšæ®µï¼šæ™ºæ…§æ¨™é ­æœå°‹ (å„ªå…ˆç´šï¼šä¸­)</h3>
<ul>
<li><strong>å‹•æ…‹æƒæ</strong>ï¼šå»¢é™¤ç¡¬ç·¨ç¢¼çš„ 211 è¡Œé è¨­å€¼ã€‚æ”¹ç‚ºæƒæå‰ 500 è¡Œï¼Œå°‹æ‰¾æ¬Šé‡æœ€é«˜çš„é—œéµå­—çµ„åˆï¼ˆä¾‹å¦‚åŒæ™‚åŒ…å« <code>Date</code> èˆ‡ <code>Time</code> çš„è¡Œï¼‰ã€‚</li>
<li><strong>å¿«é€Ÿå¤±æ•— (Fail-Fast)</strong>ï¼šè‹¥æ‰¾ä¸åˆ°æ¨™é ­ï¼Œæ‡‰ç›´æ¥æ‹‹å‡ºæ˜ç¢ºçš„ <code>InvalidReportFormatException</code>ï¼Œè€Œä¸æ˜¯ã€ŒçŒœã€ä¸€å€‹è¡Œæ•¸ã€‚</li>
</ul>
<h3 id="_3">âœ… ç¬¬ä¸‰éšæ®µï¼šè³‡æ–™å“è³ªå®ˆé–€å“¡ (å„ªå…ˆç´šï¼šä¸­)</h3>
<ul>
<li><strong>æ¶æ§‹é©—è­‰</strong>ï¼šåœ¨è§£æå®Œæˆå¾ŒåŠ å…¥æª¢æŸ¥ï¼š<br />
<code>python
    required_cols = ['timestamp', 'Chiller_Power', 'Chiller_Load']
    if missing := set(required_cols) - set(df.columns):
        raise DataValidationError(f"ç¼ºå°‘é—œéµæ¬„ä½: {missing}")</code></li>
</ul>
<h2 id="6">6. çµè«–</h2>
<p>æ­¤æ¨¡çµ„å…·å‚™ç´®å¯¦çš„é‚è¼¯åŸºç¤ï¼Œä½†ç¼ºä¹å¯¦éš›éƒ¨ç½²æ‰€éœ€çš„ã€Œé˜²ç¦¦æ©Ÿåˆ¶ã€ã€‚å»ºè­°æŠ•å…¥ <strong>1-2 å€‹å·¥ç¨‹å¤©</strong> å¯¦ä½œä¸Šè¿°å»ºè­°ï¼Œé è¨ˆå¯é é˜²æœªä¾† <strong>90%</strong> çš„è³‡æ–™åŒ¯å…¥ç›¸é—œå®¢è¨´èˆ‡ç¶­è­·å·¥å–®ã€‚</p>
</body>
</html>