<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>review_restructuring_proposal</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
    font-size: 16px;
    line-height: 1.5;
    word-wrap: break-word;
    color: #24292e;
    background-color: #fff;
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem;
}
h1, h2, h3, h4, h5, h6 {
    margin-top: 24px;
    margin-bottom: 16px;
    font-weight: 600;
    line-height: 1.25;
}
h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
h3 { font-size: 1.25em; }
code {
    padding: 0.2em 0.4em;
    margin: 0;
    font-size: 85%;
    background-color: #f6f8fa;
    border-radius: 6px;
    font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
}
pre {
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f6f8fa;
    border-radius: 6px;
}
pre code {
    display: inline;
    padding: 0;
    margin: 0;
    overflow: visible;
    line-height: inherit;
    word-wrap: normal;
    background-color: initial;
    border: 0;
}
blockquote {
    padding: 0 1em;
    color: #6a737d;
    border-left: 0.25em solid #dfe2e5;
    margin: 0;
}
table {
    display: block;
    width: 100%;
    margin-top: 0;
    margin-bottom: 16px;
    overflow: auto;
    border-spacing: 0;
    border-collapse: collapse;
}
table th, table td {
    padding: 6px 13px;
    border: 1px solid #dfe2e5;
}
table tr {
    background-color: #fff;
    border-top: 1px solid #c6cbd1;
}
table tr:nth-child(2n) {
    background-color: #f6f8fa;
}
a { color: #0366d6; text-decoration: none; }
a:hover { text-decoration: underline; }
hr {
    height: 0.25em;
    padding: 0;
    margin: 24px 0;
    background-color: #e1e4e8;
    border: 0;
}
</style>

</head>
<body>
<h1 id="_1">åŒäº‹é‡æ§‹å»ºè­°å¯©é–±èˆ‡å„ªåŒ–åˆ†æ</h1>
<h2 id="_2">ğŸ“‹ ç¸½è©•</h2>
<p>ä½ åŒäº‹çš„å»ºè­°<strong>æ–¹å‘æ­£ç¢º</strong>ï¼Œæ ¸å¿ƒè§€é»ã€Œæä¾›ä¹¾æ·¨çš„é»‘ç›’å­çµ¦å¾Œç«¯å·¥ç¨‹å¸«ã€æ˜¯å°çš„ã€‚ä½†åŸºæ–¼ä½ ç›®å‰çš„<strong>å¯¦éš›ç¨‹å¼ç¢¼ç¾æ³</strong>ï¼Œæœ‰äº›å»ºè­°éœ€è¦èª¿æ•´ã€æœ‰äº›å·²ç¶“éƒ¨åˆ†å­˜åœ¨ä½†åŒäº‹å¯èƒ½æ²’çœ‹åˆ°ï¼Œé‚„æœ‰ä¸€äº›é‡è¦çš„é»è¢«éºæ¼äº†ã€‚</p>
<p>ä»¥ä¸‹é€æ¢åˆ†æï¼š</p>
<hr />
<h2 id="_3">âœ… å®Œå…¨åŒæ„çš„å»ºè­°</h2>
<h3 id="1-interfacepy">1. å»ºç«‹ <code>interface.py</code>ï¼ˆå°æ¥å±¤ï¼‰â€” æœ€é«˜å„ªå…ˆç´š</h3>
<blockquote>
<p>[!IMPORTANT]<br />
é€™æ˜¯æœ€é—œéµçš„ç¼ºå¤±ï¼Œä½ çš„ <code>main.py</code> ç›®å‰æ˜¯ 384 è¡Œçš„ CLI é¡åˆ¥ (<code>HVACAnalyticsCLI</code>)ï¼Œç”¨ Python Fire é©…å‹•ã€‚å¾Œç«¯å·¥ç¨‹å¸«ç„¡æ³•ç›´æ¥ <code>import</code> ä½¿ç”¨ã€‚</p>
</blockquote>
<p>ä½ çš„ç¨‹å¼ç¢¼å…¶å¯¦å·²ç¶“æœ‰å¾ˆå¥½çš„ class å°è£ï¼ˆ<code>ChillerEnergyModel</code>ã€<code>ChillerOptimizer</code>ï¼‰ï¼Œä½†ç¼ºå°‘ä¸€å€‹<strong>çµ±ä¸€çš„ Facade</strong>ã€‚å»ºè­°å»ºç«‹ <code>src/interface.py</code>ï¼Œå…§éƒ¨çµ„åˆé€™äº›é¡åˆ¥ï¼š</p>
<pre><code class="language-python"># src/interface.py
class HVACService:
    def load_model(self, path: str) -&gt; None: ...
    def predict_energy(self, sensor_data: dict) -&gt; float: ...
    def optimize(self, context: dict, constraints: dict = None) -&gt; dict: ...
    def parse_and_clean(self, file_path: str, options: dict = None) -&gt; dict: ...
</code></pre>
<h3 id="2">2. æ¸…ç†ç‰ˆæœ¬æª”æ¡ˆ â€” åŒæ„</h3>
<p>ä½ çš„ <code>src/config/</code> ç›®å‰æœ‰ï¼š<br />
- <code>feature_mapping.py</code> (17KB)<br />
- <code>feature_mapping_v1_backup.py</code> (13KB)<br />
- <code>feature_mapping_v2.py</code> (32KB)<br />
- <code>mapping_editor.py</code> (12KB)</p>
<p><strong>å…± 4 å€‹æª”æ¡ˆã€75KB</strong>ï¼Œè€Œä¸” <code>energy_model.py</code> è£¡é¢ import çš„æ˜¯ <code>feature_mapping_v2</code>ã€‚é€™ç¢ºå¯¦æ˜¯ç‰ˆæ§ç½é›£ã€‚</p>
<h3 id="3-schemaspypydantic">3. å®šç¾© <code>schemas.py</code>ï¼ˆPydanticï¼‰â€” åŒæ„</h3>
<p>ä½ çš„ <code>optimizer.py</code> å·²ç¶“ç”¨ <code>@dataclass</code> å®šç¾©äº† <code>OptimizationConstraints</code>ã€<code>OptimizationContext</code>ã€<code>OptimizationResult</code>ï¼Œé€™äº›éå¸¸é©åˆè½‰ç‚º Pydantic <code>BaseModel</code>ï¼Œä¸€æ–¹é¢çµ¦å¾Œç«¯ä½¿ç”¨ï¼Œä¸€æ–¹é¢è‡ªå¸¶è³‡æ–™é©—è­‰ã€‚</p>
<hr />
<h2 id="_4">âš ï¸ éœ€è¦èª¿æ•´çš„å»ºè­°</h2>
<h3 id="4-yaml">4. é…ç½®æŠ½ç‚º YAML â€” éœ€è¦æ›´ç´°ç·»çš„ç­–ç•¥</h3>
<p>åŒäº‹å»ºè­°æŠŠ <code>feature_mapping.py</code> æ”¹ç‚º YAMLï¼Œä½†ä½ çš„ feature mapping <strong>ä¸åªæ˜¯è¨­å®šå€¼</strong>ï¼Œå®ƒåŒ…å« Python é‚è¼¯ï¼ˆ<code>FeatureMapping</code> é¡åˆ¥æœ‰æ–¹æ³•ï¼‰ã€‚</p>
<p><strong>å»ºè­°åšæ³•ï¼š</strong><br />
- <strong>éœæ…‹å°æ‡‰è¡¨</strong>ï¼ˆæ¬„ä½ alias â†’ æ¨™æº–åç¨±ï¼‰â†’ æŠ½æˆ YAML/JSONï¼ˆæ”¾ <code>configs/sites/</code>ï¼‰<br />
- <strong>æ˜ å°„é‚è¼¯</strong>ï¼ˆé©—è­‰ã€è½‰æ›æ–¹æ³•ï¼‰â†’ ä¿ç•™ Python é¡åˆ¥ï¼Œä½†åªç•™ä¸€å€‹æª”æ¡ˆ</p>
<pre><code>configs/
â”œâ”€â”€ base.yaml              # ç³»çµ±é€šç”¨åƒæ•¸ï¼ˆå·²å­˜åœ¨æ–¼ config/settings.yamlï¼‰
â””â”€â”€ sites/
    â”œâ”€â”€ cgmh_ty.yaml        # é•·åºšæ¡ƒåœ’æ¡ˆå ´æ¬„ä½å°æ‡‰
    â””â”€â”€ farglory.yaml       # é é›„æ¡ˆå ´æ¬„ä½å°æ‡‰
</code></pre>
<h3 id="5-model-artifacts-models">5. Model Artifacts ç›®éŒ„ â€” ä½ å·²æœ‰ <code>models/</code></h3>
<p>åŒäº‹å»ºè­°æ–°å¢ <code>artifacts/</code>ï¼Œä½†ä½ çš„å°ˆæ¡ˆ<strong>å·²ç¶“æœ‰ <code>models/</code> ç›®éŒ„</strong>ï¼ˆé›–ç„¶ç›®å‰æ˜¯ç©ºçš„ï¼‰ï¼Œè€Œä¸” <code>.gitignore</code> å·²ç¶“è¨­å®š <code>models/*.pkl</code> å’Œ <code>models/*.joblib</code>ã€‚</p>
<p><strong>å»ºè­°ï¼š</strong> ä¸éœ€è¦å¦å»º <code>artifacts/</code>ï¼Œæ²¿ç”¨ <code>models/</code> å³å¯ï¼Œé¿å…é·ç§»æˆæœ¬ã€‚ä½†å¯ä»¥åŠ ä¸Šå­ç›®éŒ„å€åˆ†ï¼š</p>
<pre><code>models/
â”œâ”€â”€ trained/              # è¨“ç·´å¥½çš„æ¨¡å‹æª”
â”‚   â””â”€â”€ energy_model.joblib
â””â”€â”€ metadata/             # æ¨¡å‹å…ƒè³‡æ–™ï¼ˆç‰ˆæœ¬ã€metricsã€è¨“ç·´åƒæ•¸ï¼‰
    â””â”€â”€ energy_model_meta.json
</code></pre>
<h3 id="6-dockerfile-critical">6. Dockerfile â€” å„ªå…ˆç´šä¸­ç­‰ï¼Œéã€ŒCRITICALã€</h3>
<blockquote>
<p>[!NOTE]<br />
Dockerfile é‡è¦ï¼Œä½†ä¸æ˜¯ç¬¬ä¸€æ­¥ã€‚å¦‚æœå¾Œç«¯åœ˜éšŠæœ‰è‡ªå·±çš„å®¹å™¨åŒ–æµç¨‹ï¼Œä»–å€‘å¯èƒ½æ›´å¸Œæœ›ä½ æä¾›ä¹¾æ·¨çš„ <code>pyproject.toml</code> + é–å®šä¾è³´ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯ä½ å¯«ä¸€å€‹ä»–å€‘ç„¡æ³•å®¢è£½çš„ Dockerfileã€‚</p>
</blockquote>
<p><strong>å»ºè­°é †åºï¼š</strong><br />
1. å…ˆæŠŠ <code>requirements.txt</code> å‡ç´šç‚º <code>pyproject.toml</code>ï¼ˆæ¨™æº–åŒ–ï¼‰<br />
2. é–å®šç‰ˆæœ¬ï¼ˆ<code>pip freeze</code> æˆ– <code>uv lock</code>ï¼‰<br />
3. <em>å†</em> æä¾› Dockerfile ä½œç‚ºåƒè€ƒ</p>
<hr />
<h2 id="_5">ğŸ”´ åŒäº‹éºæ¼çš„é‡è¦å»ºè­°</h2>
<h3 id="7-__init__py">7. ç¼ºå°‘ <code>__init__.py</code> â€” æ¨¡çµ„åŒ¯å…¥æœƒçˆ†ç‚¸</h3>
<p>ä½ çš„ <code>src/etl/</code> å’Œ <code>src/config/</code> ç›®éŒ„<strong>æ²’æœ‰ <code>__init__.py</code></strong>ï¼ˆåªæœ‰ <code>src/models/</code> å’Œ <code>src/optimization/</code> æœ‰ï¼‰ã€‚é€™æœƒå°è‡´å¾Œç«¯åš <code>from src.etl import parser</code> æ™‚å¤±æ•—ã€‚</p>
<blockquote>
<p>[!CAUTION]<br />
é€™æ˜¯æœ€å®¹æ˜“è¢«å¿½ç•¥ä½†æœƒç›´æ¥å°è‡´æ•´åˆå¤±æ•—çš„å•é¡Œã€‚æ¯å€‹ <code>src/</code> çš„å­ç›®éŒ„éƒ½éœ€è¦ <code>__init__.py</code>ã€‚</p>
</blockquote>
<h3 id="8">8. ç¼ºå°‘éŒ¯èª¤è™•ç†å¥‘ç´„</h3>
<p><code>interface.py</code> ä¸åªè¦å®šç¾©ã€ŒæˆåŠŸå›ä»€éº¼ã€ï¼Œæ›´è¦å®šç¾©ã€Œå¤±æ•—æ™‚ä¸Ÿä»€éº¼ Exceptionã€ã€‚å»ºè­°æ–°å¢è‡ªå®šç¾©ä¾‹å¤–ï¼š</p>
<pre><code class="language-python"># src/exceptions.py
class HVACError(Exception): &quot;&quot;&quot;Base exception&quot;&quot;&quot;
class DataValidationError(HVACError): &quot;&quot;&quot;è¼¸å…¥è³‡æ–™æ ¼å¼éŒ¯èª¤&quot;&quot;&quot;
class ModelNotTrainedError(HVACError): &quot;&quot;&quot;æ¨¡å‹å°šæœªè¨“ç·´&quot;&quot;&quot;
class OptimizationFailedError(HVACError): &quot;&quot;&quot;æœ€ä½³åŒ–æœªæ”¶æ–‚&quot;&quot;&quot;
</code></pre>
<h3 id="9">9. æ—¥èªŒè¦ç¯„åŒ–</h3>
<p>åŒäº‹æåˆ° <code>logs/</code> ç›®éŒ„ä½†æ²’æ·±å…¥ã€‚ä½ ç›®å‰æ¯å€‹æ¨¡çµ„éƒ½ç”¨ <code>logging.basicConfig()</code> è‡ªå·±è¨­å®šï¼Œæœƒå°è‡´å¤šæ¬¡åˆå§‹åŒ–è¡çªã€‚å»ºè­°çµ±ä¸€æˆä¸€å€‹ <code>src/utils/logger.py</code>ï¼Œæ‰€æœ‰æ¨¡çµ„åªåš <code>logger = logging.getLogger(__name__)</code>ã€‚</p>
<h3 id="10">10. æ ¹ç›®éŒ„æœ‰é›œæ•£æª”æ¡ˆ</h3>
<ul>
<li><code>md_to_html.py</code> (3KB)ã€<code>md_to_pdf.py</code> (6KB) â€” é€™äº›æ˜¯å·¥å…·è…³æœ¬ï¼Œä¸æ˜¯æ ¸å¿ƒåŠŸèƒ½</li>
<li><code>hvac_feature_classification.json</code> (31KB) â€” æ‡‰è©²æ­¸å…¥ <code>configs/</code></li>
<li><code>_backup_20260203/</code> â€” æ‡‰è©²åˆªé™¤ï¼ˆå·²æœ‰ Gitï¼‰</li>
</ul>
<hr />
<h2 id="_6">ğŸ“ å»ºè­°çš„æœ€çµ‚çµæ§‹</h2>
<pre><code>HVAC_Analytics/
â”œâ”€â”€ configs/                    # [RESTRUCTURE] çµ±ä¸€é…ç½®
â”‚   â”œâ”€â”€ base.yaml               # é€šç”¨ç³»çµ±åƒæ•¸ (å¾ config/settings.yaml æ¬å…¥)
â”‚   â””â”€â”€ sites/                  # å„æ¡ˆå ´æ¬„ä½æ˜ å°„ (å¾ feature_mapping æŠ½å‡º)
â”‚       â””â”€â”€ cgmh_ty.yaml
â”œâ”€â”€ models/                     # [KEEP] æ¨¡å‹ç”¢ç‰©ï¼ˆå·²åœ¨ .gitignoreï¼‰
â”‚   â”œâ”€â”€ trained/
â”‚   â””â”€â”€ metadata/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py             # [NEW] å¿…è¦
â”‚   â”œâ”€â”€ interface.py            # [NEW] â˜… Facade â€” å¾Œç«¯å”¯ä¸€å…¥å£
â”‚   â”œâ”€â”€ schemas.py              # [NEW] Pydantic I/O å®šç¾©
â”‚   â”œâ”€â”€ exceptions.py           # [NEW] è‡ªå®šç¾©ä¾‹å¤–
â”‚   â”œâ”€â”€ etl/
â”‚   â”‚   â”œâ”€â”€ __init__.py         # [NEW] å¿…è¦
â”‚   â”‚   â”œâ”€â”€ parser.py
â”‚   â”‚   â”œâ”€â”€ cleaner.py
â”‚   â”‚   â””â”€â”€ batch_processor.py
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â”œâ”€â”€ __init__.py         # [KEEP]
â”‚   â”‚   â””â”€â”€ energy_model.py
â”‚   â”œâ”€â”€ optimization/
â”‚   â”‚   â”œâ”€â”€ __init__.py         # [KEEP]
â”‚   â”‚   â”œâ”€â”€ optimizer.py
â”‚   â”‚   â””â”€â”€ history_tracker.py
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ __init__.py         # [NEW] å¿…è¦
â”‚   â”‚   â”œâ”€â”€ feature_mapping.py  # [KEEP] åƒ…ä¿ç•™æœ€æ–°ç‰ˆï¼Œåˆªé™¤ v1/v2
â”‚   â”‚   â””â”€â”€ mapping_editor.py
â”‚   â””â”€â”€ utils/                  # [NEW]
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ config_loader.py    # è®€å– YAML
â”‚       â””â”€â”€ logger.py           # çµ±ä¸€æ—¥èªŒ
â”œâ”€â”€ tests/
â”œâ”€â”€ scripts/                    # [NEW] æ¬å…¥ md_to_html.pyã€md_to_pdf.py
â”œâ”€â”€ docs/
â”œâ”€â”€ main.py                     # CLI å…¥å£ï¼ˆä¿ç•™çµ¦ä½ è‡ªå·±æ¸¬è©¦ç”¨ï¼‰
â”œâ”€â”€ pyproject.toml              # [NEW] å–ä»£ requirements.txt
â”œâ”€â”€ Dockerfile                  # [LATER] è¦–å¾Œç«¯åœ˜éšŠéœ€æ±‚å†åŠ 
â””â”€â”€ .gitignore
</code></pre>
<hr />
<h2 id="_7">ğŸ¯ åŸ·è¡Œå„ªå…ˆç´š</h2>
<table>
<thead>
<tr>
<th style="text-align: center;">å„ªå…ˆç´š</th>
<th>é …ç›®</th>
<th>åŸå› </th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>P0</strong></td>
<td>æ–°å¢æ‰€æœ‰ <code>__init__.py</code></td>
<td>ä¸åšå°±ç„¡æ³• import</td>
</tr>
<tr>
<td style="text-align: center;"><strong>P0</strong></td>
<td>å»ºç«‹ <code>interface.py</code></td>
<td>å¾Œç«¯æ•´åˆçš„å”¯ä¸€å…¥å£</td>
</tr>
<tr>
<td style="text-align: center;"><strong>P1</strong></td>
<td>å»ºç«‹ <code>schemas.py</code></td>
<td>å®šç¾© I/O å¥‘ç´„</td>
</tr>
<tr>
<td style="text-align: center;"><strong>P1</strong></td>
<td>å»ºç«‹ <code>exceptions.py</code></td>
<td>éŒ¯èª¤è™•ç†æ¨™æº–åŒ–</td>
</tr>
<tr>
<td style="text-align: center;"><strong>P1</strong></td>
<td>æ¸…ç† feature_mapping ç‰ˆæœ¬æª”</td>
<td>æ¸›å°‘æ··äº‚</td>
</tr>
<tr>
<td style="text-align: center;"><strong>P2</strong></td>
<td>é…ç½®æª”é‡æ•´ï¼ˆYAML åŒ–éœæ…‹å°æ‡‰ï¼‰</td>
<td>æ”¯æ´å¤šæ¡ˆå ´</td>
</tr>
<tr>
<td style="text-align: center;"><strong>P2</strong></td>
<td>çµ±ä¸€æ—¥èªŒã€æ¸…ç†æ ¹ç›®éŒ„é›œæ•£æª”æ¡ˆ</td>
<td>ä¹¾æ·¨åº¦</td>
</tr>
<tr>
<td style="text-align: center;"><strong>P3</strong></td>
<td><code>pyproject.toml</code> + Dockerfile</td>
<td>ç’°å¢ƒå°è£</td>
</tr>
</tbody>
</table>
</body>
</html>