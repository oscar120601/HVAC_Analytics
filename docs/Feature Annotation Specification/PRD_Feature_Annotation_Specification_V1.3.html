<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRD_Feature_Annotation_Specification_V1.3</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
    font-size: 16px;
    line-height: 1.5;
    word-wrap: break-word;
    color: #24292e;
    background-color: #fff;
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem;
}
h1, h2, h3, h4, h5, h6 {
    margin-top: 24px;
    margin-bottom: 16px;
    font-weight: 600;
    line-height: 1.25;
}
h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
h3 { font-size: 1.25em; }
code {
    padding: 0.2em 0.4em;
    margin: 0;
    font-size: 85%;
    background-color: #f6f8fa;
    border-radius: 6px;
    font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
}
pre {
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f6f8fa;
    border-radius: 6px;
}
pre code {
    display: inline;
    padding: 0;
    margin: 0;
    overflow: visible;
    line-height: inherit;
    word-wrap: normal;
    background-color: initial;
    border: 0;
}
blockquote {
    padding: 0 1em;
    color: #6a737d;
    border-left: 0.25em solid #dfe2e5;
    margin: 0;
}
table {
    display: block;
    width: 100%;
    margin-top: 0;
    margin-bottom: 16px;
    overflow: auto;
    border-spacing: 0;
    border-collapse: collapse;
}
table th, table td {
    padding: 6px 13px;
    border: 1px solid #dfe2e5;
}
table tr {
    background-color: #fff;
    border-top: 1px solid #c6cbd1;
}
table tr:nth-child(2n) {
    background-color: #f6f8fa;
}
a { color: #0366d6; text-decoration: none; }
a:hover { text-decoration: underline; }
hr {
    height: 0.25em;
    padding: 0;
    margin: 24px 0;
    background-color: #e1e4e8;
    border: 0;
}
</style>

</head>
<body>
<h1 id="prd-v13-complete-hvac">PRD v1.3-Complete: ç‰¹å¾µæ¨™è¨»ç³»çµ±è¦ç¯„ (HVAC å®Œæ•´å¯¦ä½œç‰ˆ)</h1>
<p><strong>æ–‡ä»¶ç‰ˆæœ¬:</strong> v1.3-Complete (Aligned with Interface Contract v1.1)<br />
<strong>æ—¥æœŸ:</strong> 2026-02-14<br />
<strong>è² è²¬äºº:</strong> Oscar Chang / HVAC ç³»çµ±å·¥ç¨‹åœ˜éšŠ<br />
<strong>ç›®æ¨™:</strong> å»ºç«‹ HVAC å†°æ°´ä¸»æ©Ÿæˆ¿èˆ‡ç©ºèª¿ç³»çµ±çš„çµ±ä¸€ç‰¹å¾µæ¨™è¨»è¦ç¯„ï¼Œå¼·åŒ–å–®å‘æµç¨‹ç®¡æ§ã€è¨­å‚™é‚è¼¯ä¸€è‡´æ€§ã€æ™‚é–“åŸºæº–é˜²è­·èˆ‡ç‰¹å¾µå°é½Šæ©Ÿåˆ¶<br />
<strong>ç›¸ä¾æ–‡ä»¶:</strong> <br />
- Interface Contract v1.1 (PRD_Interface_Contract_v1.1.md)<br />
- Cleaner v2.2+, Feature Engineer v1.3+, Optimization v1.1+<br />
- Parser v2.1+ (å« Header Standardization)</p>
<hr />
<h2 id="1">1. åŸ·è¡Œç¸½ç¶±èˆ‡è¨­è¨ˆå“²å­¸</h2>
<h3 id="11">1.1 æ ¸å¿ƒç›®æ¨™è²æ˜</h3>
<p>æœ¬è¦ç¯„æ—¨åœ¨å»ºç«‹<strong>å·¥æ¥­ç´š HVAC è³‡æ–™æ²»ç†åŸºç¤è¨­æ–½</strong>ï¼Œè§£æ±ºä»¥ä¸‹é—œéµç—›é»ï¼š</p>
<ol>
<li><strong>è¨­å‚™èªæ„ä¸€è‡´æ€§</strong>: çµ±ä¸€å†°æ°´ä¸»æ©Ÿã€æ°´æ³µã€å†·å»æ°´å¡”ã€ç©ºèª¿ç®±ç­‰è¨­å‚™çš„å‘½åèˆ‡åˆ†é¡é‚è¼¯</li>
<li><strong>ç‰©ç†é‚è¼¯é˜²å‘†</strong>: é€éè¨­å‚™äº’é–æª¢æŸ¥ï¼ˆInterlock Validationï¼‰é˜²æ­¢ã€Œä¸»æ©Ÿé–‹å•Ÿä½†æ°´æ³µæœªé‹è½‰ã€ç­‰ç‰©ç†ä¸å¯èƒ½æƒ…å¢ƒ</li>
<li><strong>å–®å‘æµç¨‹ç®¡æ§</strong>: æœçµ•ã€ŒExcel â†” YAML é›™å‘ä¿®æ”¹ã€å°è‡´çš„ç«¶æ…‹æ¢ä»¶èˆ‡è¨­å®šéºå¤±</li>
<li><strong>æ™‚é–“ä¸€è‡´æ€§é˜²è­·</strong>: å»ºç«‹å…¨åŸŸæ™‚é–“åŸºæº–ï¼ˆTemporal Baselineï¼‰ï¼Œé˜²æ­¢é•·æ™‚é–“åŸ·è¡Œæµç¨‹ä¸­çš„æ™‚é–“æ¼‚ç§»å°è‡´æœªä¾†è³‡æ–™èª¤åˆ¤</li>
<li><strong>ç‰¹å¾µå°é½Šä¿è­‰</strong>: ç¢ºä¿ Training èˆ‡ Optimization éšæ®µçš„ç‰¹å¾µå‘é‡ã€ç¸®æ”¾åƒæ•¸ã€è¨­å‚™é™åˆ¶å®Œå…¨ä¸€è‡´ï¼Œé˜²æ­¢ Silent Failure</li>
</ol>
<h3 id="12">1.2 åš´æ ¼æµç¨‹æ¶æ§‹ï¼ˆå–®å‘åŒæ­¥åŸå‰‡ï¼‰</h3>
<pre><code class="language-mermaid">graph TD
    subgraph &quot;ç·¨è¼¯å±¤ - å”¯ä¸€å…¥å£&quot;
        A[Excel Template v1.3] --&gt;|æ‰‹å‹•ç·¨è¼¯| B[è¨­å‚™å·¥ç¨‹å¸«]
        C[Wizard CLI] --&gt;|åµæ¸¬ CSV æ–°æ¬„ä½| A
        D[migrate_excel.py] --&gt;|ç¯„æœ¬å‡ç´š| A
    end

    subgraph &quot;é©—è­‰èˆ‡è½‰æ›å±¤&quot;
        A --&gt;|æ‰‹å‹•è§¸ç™¼| E[excel_to_yaml.py]
        E --&gt;|Schema é©—è­‰| F{é©—è­‰é€šé?}
        F --&gt;|å¦| G[è¿”å› Excel ä¿®æ­£]
        F --&gt;|æ˜¯| H[ç”Ÿæˆ YAML]
        H --&gt;|è¨ˆç®— Checksum| I[åŒæ­¥æª¢æŸ¥æ¨™è¨˜]
    end

    subgraph &quot;çœŸç›¸æºå±¤ - SSOT&quot;
        H --&gt;|Git Commit| J[Git Repository]
        J --&gt;|CI/CD é©—è­‰| K[Schema + é‚è¼¯æª¢æŸ¥]
        K --&gt;|ç”¢å‡º| L[Config Server]
    end

    subgraph &quot;é‹è¡Œæ™‚å±¤ - å¥‘ç´„é©—è­‰&quot;
        L --&gt;|è¼‰å…¥| M[FeatureAnnotationManager]
        M --&gt;|æŸ¥è©¢èªæ„| N[Cleaner v2.2]
        M --&gt;|æŸ¥è©¢ç‰¹å¾µè¦å‰‡| O[Feature Engineer v1.3]
        M --&gt;|æŸ¥è©¢è¨­å‚™é™åˆ¶| P[Optimization v1.1]
        M --&gt;|HVAC å°ˆç”¨æª¢æŸ¥| Q[HVAC Validator]

        R[TemporalContext] --&gt;|æ™‚é–“åŸºæº–| N
        R --&gt;|æ™‚é–“åŸºæº–| O
        R --&gt;|æ™‚é–“åŸºæº–| P
    end

    subgraph &quot;ç‰¹å¾µå°é½Šå±¤&quot;
        O --&gt;|è¼¸å‡º| S[Feature Manifest v2.0]
        S --&gt;|é©—è­‰| P
        P --&gt;|E901-E903 æª¢æŸ¥| T[ç‰¹å¾µå°é½Šé©—è­‰å™¨]
    end

    subgraph &quot;ç½é›£æ¢å¾©å±¤&quot;
        U[yaml_to_excel.py] --&gt;|Git å›é€€å¾Œé‡å»º| A
        V[.backups/ ç›®éŒ„] --&gt;|æœ¬åœ°å‚™ä»½é‚„åŸ| A
        W[git checkout] --&gt;|æ­·å²é‚„åŸ| J
    end
</code></pre>
<p><strong>é—œéµç´„æŸï¼ˆå¼·åˆ¶åŸ·è¡Œï¼‰</strong>:<br />
- ğŸ”´ <strong>ç¦æ­¢ç›´æ¥ä¿®æ”¹ YAML</strong>: ä»»ä½•å° <code>config/features/sites/*.yaml</code> çš„æ‰‹å‹•ä¿®æ”¹å°‡è¢« Import Guard æ””æˆªï¼ˆE501 éŒ¯èª¤ï¼‰<br />
- ğŸ”´ <strong>Wizard åƒ…å¯« Excel</strong>: Wizard CLI ç¦æ­¢ç›´æ¥å¯«å…¥ YAMLï¼Œåƒ…å…è¨±æ›´æ–° <code>.xlsx</code> æª”æ¡ˆ<br />
- ğŸ”´ <strong>æ™‚é–“åŸºæº–å¼·åˆ¶</strong>: æ‰€æœ‰æ¨¡çµ„å¿…é ˆé€é <code>TemporalContext</code> å–å¾— <code>pipeline_origin_timestamp</code>ï¼Œç¦æ­¢ç›´æ¥ä½¿ç”¨ <code>datetime.now()</code><br />
- ğŸŸ¢ <strong>Git ç‚ºæœ€çµ‚ SSOT</strong>: æ‰€æœ‰ YAML å¿…é ˆé€² Gitï¼ŒExcel æª”æ¡ˆå¿…é ˆåœ¨ <code>.gitignore</code> ä¸­æ’é™¤<br />
- ğŸŸ¡ <strong>é€†å‘åŒæ­¥åƒ…é™ç½é›£æ¢å¾©</strong>: <code>yaml_to_excel --mode recovery</code> åƒ…åœ¨ Git å›é€€æˆ–æª”æ¡ˆææ¯€æ™‚ä½¿ç”¨</p>
<hr />
<h2 id="2">2. æ–‡ä»¶æ¶æ§‹èˆ‡ç‰ˆæœ¬æ§åˆ¶ï¼ˆè©³ç´°è¦æ ¼ï¼‰</h2>
<h3 id="21">2.1 ç›®éŒ„çµæ§‹ï¼ˆå®Œæ•´ç‰ˆï¼‰</h3>
<pre><code>config/features/                    # SSOT ç›®éŒ„ï¼ˆå”¯è®€ï¼ŒGit ç®¡æ§ï¼‰
â”œâ”€â”€ schema.json                     # JSON Schema v1.3ï¼ˆå« HVAC æ“´å……ï¼‰
â”œâ”€â”€ base.yaml                       # åŸºç¤ç¹¼æ‰¿å®šç¾©
â”œâ”€â”€ physical_types.yaml             # ç‰©ç†é¡å‹å®Œæ•´å®šç¾©ï¼ˆ18+ é¡å‹ï¼‰
â”œâ”€â”€ equipment_taxonomy.yaml         # è¨­å‚™åˆ†é¡æ³•ï¼ˆHVAC å°ˆç”¨ï¼‰
â”œâ”€â”€ header_standardization_rules.yaml # æ¨™é ­æ­£è¦åŒ–è¦å‰‡ï¼ˆå°é½Š Interface Contract ç¬¬10ç« ï¼‰
â””â”€â”€ sites/                          # æ¡ˆå ´å®šç¾©ï¼ˆåƒ…ç”± Excel ç”Ÿæˆï¼‰
    â”œâ”€â”€ cgmh_ty.yaml
    â”œâ”€â”€ kmuh.yaml
    â””â”€â”€ template_factory.yaml       # å·¥å» ç¯„æœ¬

tools/features/                     # ç·¨è¼¯å·¥å…·éˆ
â”œâ”€â”€ templates/                      
â”‚   â”œâ”€â”€ Feature_Template_v1.3.xlsx  # ç•¶å‰ç‰ˆæœ¬ï¼ˆå« HVAC æ¬„ä½ï¼‰
â”‚   â””â”€â”€ Feature_Template_v1.2.xlsx  # èˆŠç‰ˆï¼ˆä¾›é·ç§»ï¼‰
â”œâ”€â”€ wizard.py                       # Wizard CLIï¼ˆè‡ªå‹•å‚™ä»½æ©Ÿåˆ¶ï¼‰
â”œâ”€â”€ excel_to_yaml.py                # è½‰æ›å™¨ï¼ˆå« HVAC é‚è¼¯é©—è­‰ï¼‰
â”œâ”€â”€ yaml_to_excel.py                # é€†å‘è½‰æ›ï¼ˆinit/recovery æ¨¡å¼ï¼‰
â”œâ”€â”€ migrate_excel.py                # ç¯„æœ¬å‡ç´šå·¥å…·ï¼ˆv1.1â†’v1.2â†’v1.3ï¼‰
â””â”€â”€ validators/
    â”œâ”€â”€ hvac_validator.py           # HVAC å°ˆç”¨é©—è­‰å™¨
    â”œâ”€â”€ sync_checker.py             # Excel/YAML åŒæ­¥æª¢æŸ¥ï¼ˆå« Checksum è¨ˆç®—ï¼‰
    â””â”€â”€ header_standardizer.py      # æ¨™é ­æ­£è¦åŒ–å¯¦ä½œï¼ˆå°é½Š Interface Contractï¼‰

src/features/                       # Python APIï¼ˆRuntimeï¼‰
â”œâ”€â”€ __init__.py                     # å®‰è£ YAML Write Guard èˆ‡ TemporalContext
â”œâ”€â”€ annotation_manager.py           # FeatureAnnotationManagerï¼ˆå”¯è®€ï¼‰
â”œâ”€â”€ yaml_write_guard.py             # Import Hook é˜²è­·ï¼ˆE501ï¼‰
â”œâ”€â”€ backup_manager.py               # å‚™ä»½ç­–ç•¥ç®¡ç†
â”œâ”€â”€ models.py                       # Pydantic æ¨¡å‹ï¼ˆColumnAnnotation, EquipmentConstraintï¼‰
â”œâ”€â”€ temporal_context.py             # å…¨åŸŸæ™‚é–“åŸºæº–å–®ä¾‹ï¼ˆæ–°å¢ï¼‰
â””â”€â”€ feature_manifest.py             # Feature Manifest ç”Ÿæˆèˆ‡é©—è­‰ï¼ˆæ–°å¢ï¼‰

src/etl/                            # ETL æ•´åˆå±¤
â”œâ”€â”€ config_models.py                # SSOT å¸¸æ•¸å®šç¾©ï¼ˆVALID_QUALITY_FLAGS, HEADER_STANDARDIZATION_RULESï¼‰
â””â”€â”€ header_standardizer.py          # CSV æ¨™é ­æ­£è¦åŒ–å¯¦ä½œï¼ˆParser ä½¿ç”¨ï¼‰
</code></pre>
<h3 id="22-git">2.2 Git ç®¡ç†ç­–ç•¥ï¼ˆå¼·åˆ¶è¦ç¯„ï¼‰</h3>
<p><strong>.gitignore ç¯„ä¾‹</strong>ï¼ˆå¿…é ˆæ”¾ç½®æ–¼å°ˆæ¡ˆæ ¹ç›®éŒ„ï¼‰ï¼š</p>
<pre><code class="language-gitignore"># ç‰¹å¾µæ¨™è¨»å·¥ä½œæª”æ¡ˆï¼ˆç¦æ­¢é€² Gitï¼‰
data/features/**/*.xlsx
data/features/**/*.xlsx.backup.*
data/features/**/.backups/
*.xlsx~*.tmp

# è‡¨æ™‚ YAMLï¼ˆç”Ÿæˆéç¨‹ï¼‰
*.yaml.tmp
__pycache__/
</code></pre>
<p><strong>åˆ†æ”¯ç­–ç•¥</strong>:<br />
- <code>main</code>: åƒ…åŒ…å«é€šé HVAC é©—è­‰çš„ YAMLï¼Œä»£è¡¨ç”Ÿç”¢ç’°å¢ƒé…ç½®<br />
- <code>feature/hvac-{site_id}</code>: æ–°å¢æ¡ˆå ´æˆ–ä¿®æ”¹ HVAC é‚è¼¯æ™‚çš„å·¥ä½œåˆ†æ”¯<br />
- <strong>Pre-commit Hook æª¢æŸ¥</strong>: ç¦æ­¢æäº¤ <code>.xlsx</code> äºŒé€²ä½æª”æ¡ˆï¼Œé©—è­‰ YAML Schema ç‰ˆæœ¬</p>
<hr />
<h2 id="3-excel-v13">3. Excel ç¯„æœ¬çµæ§‹ï¼ˆv1.3 å®Œæ•´ç‰ˆï¼‰</h2>
<h3 id="31-sheet-1-columns">3.1 Sheet 1: Columnsï¼ˆä¸»è¦ç·¨è¼¯å€ï¼‰</h3>
<p><strong>æ¬„ä½å®šç¾©ï¼ˆå¼·åŒ–ç‰ˆï¼‰</strong>:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">æ¬„ä½åç¨± (A)</th>
<th style="text-align: center;">ç‰©ç†é¡å‹ (B)</th>
<th style="text-align: center;">å–®ä½ (C)</th>
<th style="text-align: center;">è¨­å‚™è§’è‰² (D)</th>
<th style="text-align: center;">æ˜¯å¦ç›®æ¨™ (E)</th>
<th style="text-align: center;">å•Ÿç”¨ Lag (F)</th>
<th style="text-align: center;">Lag é–“éš” (G)</th>
<th style="text-align: center;">å¿½ç•¥è­¦å‘Š (H)</th>
<th style="text-align: center;">è¨­å‚™ ID (I)</th>
<th style="text-align: center;">æè¿° (J)</th>
<th style="text-align: center;">ç‹€æ…‹ (K)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">chiller_01_chwst</td>
<td style="text-align: center;">temperature</td>
<td style="text-align: center;">Â°C</td>
<td style="text-align: center;">primary</td>
<td style="text-align: center;">FALSE</td>
<td style="text-align: center;">TRUE</td>
<td style="text-align: center;">1,4,96</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">CH-01</td>
<td style="text-align: center;">ä¸€è™Ÿæ©Ÿå†°æ°´å›æ°´æº«åº¦</td>
<td style="text-align: center;">confirmed</td>
</tr>
<tr>
<td style="text-align: center;">chiller_02_chwst</td>
<td style="text-align: center;">temperature</td>
<td style="text-align: center;">Â°C</td>
<td style="text-align: center;">backup</td>
<td style="text-align: center;">FALSE</td>
<td style="text-align: center;">TRUE</td>
<td style="text-align: center;">1,4</td>
<td style="text-align: center;">W403</td>
<td style="text-align: center;">CH-02</td>
<td style="text-align: center;">äºŒè™Ÿæ©Ÿå†°æ°´å›æ°´æº«åº¦(å‚™ç”¨)</td>
<td style="text-align: center;">confirmed</td>
</tr>
<tr>
<td style="text-align: center;">chiller_01_kw</td>
<td style="text-align: center;">power</td>
<td style="text-align: center;">kW</td>
<td style="text-align: center;">primary</td>
<td style="text-align: center;">TRUE</td>
<td style="text-align: center;">FALSE</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">CH-01</td>
<td style="text-align: center;">ä¸€è™Ÿæ©ŸåŠŸç‡ï¼ˆç›®æ¨™è®Šæ•¸ï¼‰</td>
<td style="text-align: center;">confirmed</td>
</tr>
<tr>
<td style="text-align: center;">chw_pri_pump_01_hz</td>
<td style="text-align: center;">frequency</td>
<td style="text-align: center;">Hz</td>
<td style="text-align: center;">primary</td>
<td style="text-align: center;">FALSE</td>
<td style="text-align: center;">TRUE</td>
<td style="text-align: center;">1,4</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">CHWP-01</td>
<td style="text-align: center;">å†°æ°´æ³µ 01 é »ç‡</td>
<td style="text-align: center;">confirmed</td>
</tr>
</tbody>
</table>
<p><strong>æ¬„ä½è¦æ ¼è©³ç´°èªªæ˜</strong>:</p>
<p><strong>A. æ¬„ä½åç¨± (Column Name)</strong><br />
- <strong>é©—è­‰è¦å‰‡</strong>: <br />
  - å¿…å¡«ï¼Œå¿…é ˆèˆ‡ CSV æ¬„ä½åç¨±å®Œå…¨åŒ¹é…ï¼ˆç¶“ Parser Header Standardization å¾Œçš„ snake_caseï¼‰<br />
  - å¿…é ˆç¬¦åˆ HVAC å‘½åè¦ç¯„ï¼ˆè¦‹ç¬¬4ç« ï¼‰<br />
  - ç¦æ­¢é‡è¤‡ï¼ˆExcel æ¢ä»¶æ ¼å¼æ¨™è¨˜ç´…è‰²ï¼‰<br />
- <strong>å‘½åè¦ç¯„</strong>: <code>{equipment_code}_{sequence:02d}_{component_code}</code><br />
  - ç¯„ä¾‹: <code>chiller_01_chwst</code>, <code>ahu_01_chwv</code><br />
- <strong>Header Standardization é—œè¯</strong>: è‹¥åŸå§‹ CSV æ¨™é ­ç‚º <code>Chiller 1 Temp</code>ï¼Œç¶“ Parser æ­£è¦åŒ–å¾Œç‚º <code>chiller_1_temp</code>ï¼ŒExcel ä¸­çš„ <code>column_name</code> å¿…é ˆè¨˜éŒ„æ­£è¦åŒ–å¾Œçš„å€¼</p>
<p><strong>B. ç‰©ç†é¡å‹ (Physical Type)</strong><br />
- <strong>è¼¸å…¥</strong>: éœæ…‹ä¸‹æ‹‰é¸å–®ï¼ˆ18 å€‹é¸é …ï¼‰<br />
- <strong>é¸é …æ¸…å–®</strong>: <br />
  - åŸºç¤é¡: <code>temperature</code>, <code>pressure</code>, <code>flow_rate</code>, <code>power</code>, <code>chiller_load</code>, <code>status</code>, <code>gauge</code><br />
  - HVAC æ“´å……: <code>cooling_capacity</code>, <code>efficiency</code>, <code>energy</code>, <code>valve_position</code>, <code>frequency</code>, <code>rotational_speed</code>, <code>current</code>, <code>voltage</code>, <code>power_factor</code>, <code>pressure_differential</code>, <code>operating_status</code></p>
<p><strong>C. å–®ä½ (Unit)</strong><br />
- <strong>è¼¸å…¥</strong>: éœæ…‹é•·é¸å–®ï¼ˆä¾ç‰©ç†é¡å‹åˆ†ç¾¤é¡¯ç¤ºï¼‰<br />
- <strong>HVAC å–®ä½å°ç…§</strong>:<br />
  | ç‰©ç†é¡å‹ | å¯é¸å–®ä½ |<br />
  |---------|---------|<br />
  | cooling_capacity | RT, kW |<br />
  | efficiency | COP, kW/RT |<br />
  | energy | kWh |<br />
  | valve_position | % |<br />
  | frequency | Hz |<br />
  | rotational_speed | RPM |<br />
  | current | A |<br />
  | voltage | V |<br />
  | power_factor | PF |<br />
  | pressure_differential | kPa, Pa, bar |</p>
<p><strong>D. è¨­å‚™è§’è‰² (Device Role)</strong><br />
- <strong>é¸é …</strong>: <code>primary</code>ï¼ˆä¸»è¨­å‚™ï¼‰ã€<code>backup</code>ï¼ˆå‚™ç”¨ï¼‰ã€<code>seasonal</code>ï¼ˆå­£ç¯€æ€§ï¼‰<br />
- <strong>é è¨­</strong>: <code>primary</code><br />
- <strong>å½±éŸ¿é‚è¼¯</strong>:<br />
  - <code>backup</code>: æŠ‘åˆ¶ W403ï¼ˆé«˜é›¶å€¼æ¯”ä¾‹ï¼‰è­¦å‘Šï¼Œå…è¨±é•·æœŸé›¢ç·š<br />
  - <code>seasonal</code>: æŠ‘åˆ¶ W401ï¼ˆå‡å€¼ç•°å¸¸ï¼‰èˆ‡ W403 è­¦å‘Š<br />
  - ä¾› Cleaner èª¿æ•´ç•°å¸¸åµæ¸¬é–¾å€¼ï¼ˆå‚™ç”¨è¨­å‚™é–¾å€¼æ”¾å¯¬ 50%ï¼‰</p>
<p><strong>E. æ˜¯å¦ç›®æ¨™ (Is Target)</strong><br />
- <strong>è¼¸å…¥</strong>: å‹¾é¸æ¡† (TRUE/FALSE)<br />
- <strong>é˜²å‘†æ©Ÿåˆ¶</strong>: ç•¶è¨­ç‚º TRUE æ™‚ï¼ŒF æ¬„ï¼ˆå•Ÿç”¨ Lagï¼‰è‡ªå‹•è¨­ç‚º FALSE ä¸¦é–å®šç·¨è¼¯ï¼ˆç°è‰²èƒŒæ™¯ä¿è­·ï¼‰<br />
- <strong>HVAC å»ºè­°</strong>: åŠŸç‡ï¼ˆkWï¼‰ã€æ•ˆç‡ï¼ˆCOPï¼‰é€šå¸¸è¨­ç‚ºç›®æ¨™è®Šæ•¸</p>
<p><strong>F. å•Ÿç”¨ Lag (Enable Lag)</strong><br />
- <strong>é©—è­‰</strong>: è‹¥ E æ¬„ç‚º TRUEï¼Œæ­¤æ¬„å¼·åˆ¶ç‚º FALSEï¼ˆPydantic å±¤é©—è­‰éŒ¯èª¤ E405ï¼‰</p>
<p><strong>G. Lag é–“éš” (Lag Intervals)</strong><br />
- <strong>æ ¼å¼</strong>: é€—è™Ÿåˆ†éš”æ­£æ•´æ•¸ï¼ˆå¦‚ <code>1,4,96</code>ï¼‰<br />
- <strong>é©—è­‰</strong>: <br />
  - Python å±¤æª¢æŸ¥å¿…é ˆç‚ºåš´æ ¼éå¢åºåˆ—<br />
  - æª¢æŸ¥æ•¸å€¼å¿…é ˆç‚ºæ­£æ•´æ•¸ï¼ˆæ™‚é–“é»é–“éš”ï¼‰<br />
  - HVAC å»ºè­°: æº«åº¦é¡ç”¨ <code>1,4,96</code>ï¼ˆ15åˆ†, 1å°æ™‚, 24å°æ™‚ï¼‰ï¼ŒåŠŸç‡é¡ç”¨ <code>1,4</code>ï¼ˆé«˜é »ï¼‰</p>
<p><strong>H. å¿½ç•¥è­¦å‘Š (Ignore Warnings)</strong><br />
- <strong>è¼¸å…¥</strong>: å¤šé¸ä¸‹æ‹‰ï¼ˆ<code>W401</code>, <code>W402</code>, <code>W403</code>, <code>W406</code>, <code>W407</code>, <code>-</code>ï¼‰<br />
- <strong>ç”¨é€”</strong>: å…è¨±é ˜åŸŸå°ˆå®¶é¡¯å¼æ¨™è¨˜ã€Œæ­¤æ¬„ä½å…è¨±ç‰¹å®šçµ±è¨ˆç•°å¸¸ã€</p>
<p><strong>I. è¨­å‚™ ID (Equipment ID)</strong>ï¼ˆv1.3 æ–°å¢ï¼‰<br />
- <strong>ç”¨é€”</strong>: å»ºç«‹æ¬„ä½èˆ‡å¯¦é«”è¨­å‚™çš„é—œè¯ï¼Œä¾› Equipment Constraints ä½¿ç”¨<br />
- <strong>æ ¼å¼</strong>: å¤§å¯«è¨­å‚™ä»£ç¢¼ï¼ˆå¦‚ CH-01, CHWP-01, AHU-North-01ï¼‰<br />
- <strong>é©—è­‰</strong>: åœ¨åŒä¸€æ¡ˆå ´ä¸­ï¼ŒEquipment ID èˆ‡ Column Name å¿…é ˆå”¯ä¸€å°æ‡‰</p>
<p><strong>J. æè¿° (Description)</strong><br />
- <strong>å»ºè­°å…§å®¹</strong>: è¨­å‚™ä½ç½®ã€è£½é€ å•†ã€å‹è™Ÿã€å®‰è£æ—¥æœŸç­‰</p>
<p><strong>K. ç‹€æ…‹ (Status)</strong><br />
- <strong>é¸é …</strong>: <code>pending_review</code>ï¼ˆå¾…ç¢ºèªï¼‰ã€<code>confirmed</code>ï¼ˆå·²ç¢ºèªï¼‰ã€<code>deprecated</code>ï¼ˆå·²æ£„ç”¨ï¼‰<br />
- <strong>Wizard ç”Ÿæˆ</strong>: æ–°æ¬„ä½é è¨­ç‚º <code>pending_review</code></p>
<h3 id="32-sheet-2-group-policies">3.2 Sheet 2: Group Policiesï¼ˆç¾¤çµ„ç­–ç•¥ï¼‰</h3>
<p>ç°¡åŒ–èªæ³•ï¼Œç„¡éœ€ Regexï¼Œæ”¯æ´ HVAC è¨­å‚™é¡å‹è‡ªå‹•åŒ¹é…ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align: center;">ç­–ç•¥åç¨±</th>
<th style="text-align: center;">åŒ¹é…é¡å‹</th>
<th style="text-align: center;">åŒ¹é…å€¼</th>
<th style="text-align: center;">ç‰©ç†é¡å‹</th>
<th style="text-align: center;">é è¨­æ¨£æ¿</th>
<th style="text-align: center;">è‡ªå®šç¾© Lag</th>
<th style="text-align: center;">è¨­å‚™é¡åˆ¥</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">chillers_temp</td>
<td style="text-align: center;">prefix</td>
<td style="text-align: center;">chiller_</td>
<td style="text-align: center;">temperature</td>
<td style="text-align: center;">Standard_Chiller</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">å†°æ°´ä¸»æ©Ÿ</td>
</tr>
<tr>
<td style="text-align: center;">chillers_power</td>
<td style="text-align: center;">prefix</td>
<td style="text-align: center;">chiller_</td>
<td style="text-align: center;">power</td>
<td style="text-align: center;">Power_High_Freq</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">å†°æ°´ä¸»æ©Ÿ</td>
</tr>
<tr>
<td style="text-align: center;">chillers_eff</td>
<td style="text-align: center;">prefix</td>
<td style="text-align: center;">chiller_</td>
<td style="text-align: center;">efficiency</td>
<td style="text-align: center;">Efficiency_Smooth</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">å†°æ°´ä¸»æ©Ÿ</td>
</tr>
<tr>
<td style="text-align: center;">pumps_vfd</td>
<td style="text-align: center;">prefix</td>
<td style="text-align: center;">pump_</td>
<td style="text-align: center;">frequency</td>
<td style="text-align: center;">VFD_Control</td>
<td style="text-align: center;">1,4</td>
<td style="text-align: center;">æ°´æ³µ</td>
</tr>
<tr>
<td style="text-align: center;">pumps_elec</td>
<td style="text-align: center;">prefix</td>
<td style="text-align: center;">pump_</td>
<td style="text-align: center;">current</td>
<td style="text-align: center;">Electrical_Monitor</td>
<td style="text-align: center;">1,4</td>
<td style="text-align: center;">æ°´æ³µ</td>
</tr>
<tr>
<td style="text-align: center;">cooling_towers</td>
<td style="text-align: center;">prefix</td>
<td style="text-align: center;">ct_</td>
<td style="text-align: center;">frequency</td>
<td style="text-align: center;">CT_Fan_Control</td>
<td style="text-align: center;">1,4</td>
<td style="text-align: center;">å†·å»æ°´å¡”</td>
</tr>
<tr>
<td style="text-align: center;">ahu_valves</td>
<td style="text-align: center;">prefix</td>
<td style="text-align: center;">ahu_</td>
<td style="text-align: center;">valve_position</td>
<td style="text-align: center;">Valve_Position</td>
<td style="text-align: center;">1,96</td>
<td style="text-align: center;">ç©ºèª¿ç®±</td>
</tr>
<tr>
<td style="text-align: center;">ahu_filters</td>
<td style="text-align: center;">prefix</td>
<td style="text-align: center;">ahu_</td>
<td style="text-align: center;">pressure_differential</td>
<td style="text-align: center;">Filter_DP</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">ç©ºèª¿ç®±</td>
</tr>
</tbody>
</table>
<h3 id="33-sheet-3-metadata">3.3 Sheet 3: Metadataï¼ˆæ–‡ä»¶å…ƒè³‡æ–™ï¼‰</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">å±¬æ€§</th>
<th style="text-align: left;">å€¼</th>
<th style="text-align: left;">èªªæ˜</th>
<th style="text-align: left;">é©—è­‰è¦å‰‡</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">schema_version</td>
<td style="text-align: left;">1.3</td>
<td style="text-align: left;">æ–‡ä»¶æ ¼å¼ç‰ˆæœ¬</td>
<td style="text-align: left;">å¿…é ˆç‚º "1.3"</td>
</tr>
<tr>
<td style="text-align: left;">template_version</td>
<td style="text-align: left;">1.3</td>
<td style="text-align: left;">Excel ç¯„æœ¬ç‰ˆæœ¬</td>
<td style="text-align: left;">System sheet äº¤å‰é©—è­‰</td>
</tr>
<tr>
<td style="text-align: left;">site_id</td>
<td style="text-align: left;">cgmh_ty</td>
<td style="text-align: left;">æ¡ˆå ´è­˜åˆ¥</td>
<td style="text-align: left;">å¿…é ˆåŒ¹é…æª”å</td>
</tr>
<tr>
<td style="text-align: left;">inherit</td>
<td style="text-align: left;">base</td>
<td style="text-align: left;">ç¹¼æ‰¿ä¾†æº</td>
<td style="text-align: left;">å¿…é ˆå­˜åœ¨æ–¼ config/features/</td>
</tr>
<tr>
<td style="text-align: left;">description</td>
<td style="text-align: left;">é•·åºšé†«é™¢å†°æ°´ä¸»æ©Ÿæˆ¿...</td>
<td style="text-align: left;">æ–‡ä»¶æè¿°</td>
<td style="text-align: left;">è‡ªç”±æ–‡å­—</td>
</tr>
<tr>
<td style="text-align: left;">editor</td>
<td style="text-align: left;">ç‹å·¥ç¨‹å¸«</td>
<td style="text-align: left;">ç·¨è¼¯è€…</td>
<td style="text-align: left;">å¿…å¡«</td>
</tr>
<tr>
<td style="text-align: left;">last_updated</td>
<td style="text-align: left;">2026-02-14T10:00:00</td>
<td style="text-align: left;">æœ€å¾Œæ›´æ–°</td>
<td style="text-align: left;">ISO 8601 æ ¼å¼</td>
</tr>
<tr>
<td style="text-align: left;">yaml_checksum</td>
<td style="text-align: left;">sha256:abc123...</td>
<td style="text-align: left;">å°æ‡‰ YAML é›œæ¹Š</td>
<td style="text-align: left;">åŒæ­¥æª¢æŸ¥ç”¨ï¼ˆè¦‹ç¬¬7ç« ï¼‰</td>
</tr>
<tr>
<td style="text-align: left;">equipment_schema</td>
<td style="text-align: left;">hvac_v1.3</td>
<td style="text-align: left;">è¨­å‚™åˆ†é¡æ¶æ§‹ç‰ˆæœ¬</td>
<td style="text-align: left;">HVAC å°ˆç”¨æ¨™è¨˜</td>
</tr>
<tr>
<td style="text-align: left;">temporal_baseline_version</td>
<td style="text-align: left;">1.0</td>
<td style="text-align: left;">æ™‚é–“åŸºæº–ç‰ˆæœ¬</td>
<td style="text-align: left;">å¿…é ˆç‚º "1.0"</td>
</tr>
</tbody>
</table>
<p><strong>Hidden Sheet: System</strong>ï¼ˆç³»çµ±å…§éƒ¨ä½¿ç”¨ï¼‰:<br />
- <code>B1</code>: template_version ("1.3")<br />
- <code>B2</code>: schema_hash (SHA256 of schema.json)<br />
- <code>B3</code>: last_generated_by ("wizard_v1.3" or "manual")<br />
- <code>B4</code>: yaml_last_sync_timestamp (ISO 8601)<br />
- <code>B5</code>: equipment_countï¼ˆè‡ªå‹•è¨ˆç®—è¨­å‚™æ•¸é‡ï¼‰<br />
- <code>B6</code>: excel_checksum_sha256ï¼ˆExcel æª”æ¡ˆå…§å®¹é›œæ¹Šï¼Œä¾› E406 é©—è­‰ï¼‰</p>
<hr />
<h2 id="4-hvac-taxonomy">4. è¨­å‚™åˆ†é¡èˆ‡å‘½åè¦ç¯„ï¼ˆHVAC Taxonomyï¼‰</h2>
<h3 id="41-equipment-category-mapping">4.1 è¨­å‚™é¡åˆ¥å°ç…§è¡¨ (Equipment Category Mapping)</h3>
<p>ç‚ºçµ±ä¸€æ¬„ä½å‘½åèˆ‡ Group Policy è‡ªå‹•åŒ¹é…ï¼Œå»ºç«‹ä»¥ä¸‹<strong>å¼·åˆ¶å‰ç¶´è¦ç¯„</strong>ï¼š</p>
<table>
<thead>
<tr>
<th>è¨­å‚™ä¸­æ–‡å</th>
<th>è‹±æ–‡ä»£ç¢¼</th>
<th>æ¬„ä½å‰ç¶´è¦ç¯„</th>
<th>Device Role å»ºè­°</th>
<th>Equipment ID ç¯„ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å†°æ°´ä¸»æ©Ÿ</strong></td>
<td>CH (Chiller)</td>
<td><code>chiller_{nn}_</code> æˆ– <code>ch_{n}_</code></td>
<td>primary/backup</td>
<td>CH-01, CH-02</td>
</tr>
<tr>
<td><strong>å†°æ°´ä¸€æ¬¡æ³µ</strong></td>
<td>CHW-P (Primary)</td>
<td><code>chw_pri_pump_{nn}_</code> æˆ– <code>chwp{n}_</code></td>
<td>primary</td>
<td>CHWP-01</td>
</tr>
<tr>
<td><strong>å†°æ°´å€åŸŸæ³µ</strong></td>
<td>CHW-S (Secondary)</td>
<td><code>chw_sec_pump_{nn}_</code> æˆ– <code>chws{n}_</code></td>
<td>primary</td>
<td>CHWS-01</td>
</tr>
<tr>
<td><strong>å†·å»æ°´ä¸€æ¬¡æ³µ</strong></td>
<td>CW-P (Pump)</td>
<td><code>cw_pump_{nn}_</code> æˆ– <code>cwp{n}_</code></td>
<td>primary</td>
<td>CWP-01</td>
</tr>
<tr>
<td><strong>å†·å»æ°´å¡”</strong></td>
<td>CT (Cooling Tower)</td>
<td><code>ct_{nn}_</code> æˆ– <code>cooling_tower_{nn}_</code></td>
<td>primary/backup</td>
<td>CT-01, CT-02</td>
</tr>
<tr>
<td><strong>ç©ºèª¿ç®±</strong></td>
<td>AHU</td>
<td><code>ahu_{nn}_</code> æˆ– <code>ahu_{zone}_</code></td>
<td>primary</td>
<td>AHU-North-01</td>
</tr>
</tbody>
</table>
<h3 id="42-component-type-mapping">4.2 å…ƒä»¶é¡å‹å°ç…§è¡¨ (Component Type Mapping)</h3>
<table>
<thead>
<tr>
<th>å…ƒä»¶ä¸­æ–‡å</th>
<th>è‹±æ–‡ä»£ç¢¼</th>
<th>æ¸¬é»é¡å‹</th>
<th>Physical Type å»ºè­°</th>
<th>å–®ä½</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>å†°æ°´å‡ºæ°´æº«åº¦</strong></td>
<td>CHWST</td>
<td>æº«åº¦è¨ˆ</td>
<td><code>temperature</code></td>
<td>Â°C</td>
</tr>
<tr>
<td><strong>å†°æ°´å›æ°´æº«åº¦</strong></td>
<td>CHWRT</td>
<td>æº«åº¦è¨ˆ</td>
<td><code>temperature</code></td>
<td>Â°C</td>
</tr>
<tr>
<td><strong>å†·å»æ°´å‡ºæ°´æº«åº¦</strong></td>
<td>CWST</td>
<td>æº«åº¦è¨ˆ</td>
<td><code>temperature</code></td>
<td>Â°C</td>
</tr>
<tr>
<td><strong>å†·å»æ°´å›æ°´æº«åº¦</strong></td>
<td>CWRT</td>
<td>æº«åº¦è¨ˆ</td>
<td><code>temperature</code></td>
<td>Â°C</td>
</tr>
<tr>
<td><strong>å†°æ°´é–¥é–‹åº¦</strong></td>
<td>CHWV</td>
<td>é–¥é–€</td>
<td><code>valve_position</code></td>
<td>%</td>
</tr>
<tr>
<td><strong>è®Šé »å™¨é »ç‡</strong></td>
<td>VFD</td>
<td>æ§åˆ¶å™¨</td>
<td><code>frequency</code></td>
<td>Hz</td>
</tr>
<tr>
<td><strong>ç´¯ç©ç”¨é›»é‡</strong></td>
<td>kWh</td>
<td>é›»è¡¨</td>
<td><code>energy</code></td>
<td>kWh</td>
</tr>
<tr>
<td><strong>éæ¿¾å™¨å£“å·®</strong></td>
<td>DP</td>
<td>å£“å·®</td>
<td><code>pressure_differential</code></td>
<td>kPa</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="5-hvac-equipment-constraints">5. HVAC å°ˆç”¨è¨­å‚™é™åˆ¶æ¢ä»¶ï¼ˆEquipment Constraintsï¼‰</h2>
<p>æ–¼ YAML æ–°å¢ <code>equipment_constraints</code> å€æ®µï¼Œå®šç¾©å†°æ°´ä¸»æ©Ÿæˆ¿å°ˆç”¨é‚è¼¯ï¼š</p>
<pre><code class="language-yaml">equipment_constraints:
  # ==========================================
  # å†°æ°´ä¸»æ©Ÿç³»çµ±äº’é– (Chiller Interlocks)
  # ==========================================

  chiller_pump_interlock:
    description: &quot;å†°æ°´ä¸»æ©Ÿé–‹å•Ÿæ™‚å¿…é ˆæœ‰å°æ‡‰å†°æ°´æ³µé‹è½‰&quot;
    check_type: &quot;requires&quot;
    check_phase: &quot;precheck&quot;              # Cleaner éšæ®µåŸ·è¡Œ
    trigger_status: [&quot;chiller_01_status&quot;, &quot;chiller_02_status&quot;]
    required_status: [&quot;chw_pri_pump_01_status&quot;, &quot;chw_pri_pump_02_status&quot;]
    severity: &quot;critical&quot;
    applicable_roles: [&quot;primary&quot;, &quot;backup&quot;]
    error_code: &quot;E350&quot;

  chiller_cw_pump_interlock:
    description: &quot;å†°æ°´ä¸»æ©Ÿé–‹å•Ÿæ™‚å¿…é ˆæœ‰å°æ‡‰å†·å»æ°´æ³µé‹è½‰&quot;
    check_type: &quot;requires&quot;
    check_phase: &quot;precheck&quot;
    trigger_status: [&quot;chiller_01_status&quot;]
    required_status: [&quot;cw_pump_01_status&quot;, &quot;cw_pump_02_status&quot;]
    severity: &quot;critical&quot;
    applicable_roles: [&quot;primary&quot;, &quot;backup&quot;]

  chiller_ct_interlock:
    description: &quot;å†°æ°´ä¸»æ©Ÿé–‹å•Ÿæ™‚å¿…é ˆæœ‰å°æ‡‰å†·å»æ°´å¡”é‹è½‰&quot;
    check_type: &quot;requires&quot;
    check_phase: &quot;precheck&quot;
    trigger_status: [&quot;chiller_01_status&quot;]
    required_status: [&quot;ct_01_status&quot;, &quot;ct_02_status&quot;]
    severity: &quot;critical&quot;

  chiller_temperature_protection:
    description: &quot;å†°æ°´å‡ºæ°´æº«åº¦éä½ä¿è­·ï¼ˆé˜²å‡ï¼‰&quot;
    check_type: &quot;range_check&quot;
    check_phase: &quot;precheck&quot;
    target_column: &quot;chiller_01_chwst&quot;
    min_value: 4.0                    # Â°Cï¼Œä½æ–¼ 4 åº¦è¦–ç‚ºç•°å¸¸
    max_value: 15.0
    severity: &quot;critical&quot;
    applicable_roles: [&quot;primary&quot;, &quot;backup&quot;]

  # ==========================================
  # é‹è½‰æ™‚é–“é™åˆ¶ (Runtime Constraints) - Optimization éšæ®µ
  # ==========================================

  chiller_min_runtime:
    description: &quot;ä¸»æ©Ÿé–‹å•Ÿå¾Œæœ€å°‘é‹è½‰ 15 åˆ†é˜ï¼ˆé˜²æ­¢é »ç¹å•Ÿåœï¼‰&quot;
    check_type: &quot;sequence&quot;
    check_phase: &quot;optimization&quot;
    applies_to: [&quot;chiller_01_status&quot;, &quot;chiller_02_status&quot;]
    min_duration_minutes: 15
    severity: &quot;warning&quot;
    error_code: &quot;E355&quot;                 # é€šç”¨ Sequence é•å

  chiller_min_downtime:
    description: &quot;ä¸»æ©Ÿé—œé–‰å¾Œæœ€å°‘åœæ©Ÿ 10 åˆ†é˜ï¼ˆå£“ç¸®æ©Ÿä¿è­·ï¼‰&quot;
    check_type: &quot;sequence&quot;
    check_phase: &quot;optimization&quot;
    applies_to: [&quot;chiller_01_status&quot;, &quot;chiller_02_status&quot;]
    min_duration_minutes: 10
    severity: &quot;warning&quot;
    error_code: &quot;E355&quot;

  # ==========================================
  # å®¹é‡èˆ‡è² è¼‰é™åˆ¶ (Capacity Constraints)
  # ==========================================

  chiller_load_min_limit:
    description: &quot;ä¸»æ©Ÿä½è¼‰ä¿è­·ï¼ˆä½æ–¼ 20% å»ºè­°åœæ©Ÿï¼‰&quot;
    check_type: &quot;threshold&quot;
    check_phase: &quot;optimization&quot;
    target_column: &quot;chiller_01_rt&quot;
    reference_column: &quot;chiller_01_rated_rt&quot;  # é¡å®šå®¹é‡
    min_ratio: 0.2                           # 20%
    severity: &quot;warning&quot;
    suggestion: &quot;å»ºè­°é—œé–‰æ­¤ä¸»æ©Ÿï¼Œæ”¹ç”±å…¶ä»–ä¸»æ©Ÿæ‰¿è¼‰&quot;

  # ==========================================
  # ç©ºèª¿ç®±äº’é– (AHU Interlocks)
  # ==========================================

  ahu_valve_flow_interlock:
    description: &quot;ç©ºèª¿ç®±é¢¨æ©Ÿé‹è½‰æ™‚æ‰å…è¨±é–‹å•Ÿå†°æ°´é–¥&quot;
    check_type: &quot;requires&quot;
    check_phase: &quot;precheck&quot;
    trigger_status: [&quot;ahu_01_chwv&quot;]
    trigger_threshold: 5                    # é–¥ä½ &gt; 5%
    required_status: [&quot;ahu_01_status&quot;]      # é¢¨æ©Ÿå¿…é ˆé‹è½‰
    severity: &quot;warning&quot;

  ahu_filter_dp_alarm:
    description: &quot;éæ¿¾å™¨å£“å·®éé«˜è­¦å‘Šï¼ˆéœ€æ›´æ›ï¼‰&quot;
    check_type: &quot;threshold&quot;
    check_phase: &quot;precheck&quot;
    target_column: &quot;ahu_01_dp&quot;
    max_value: 0.5                          # 0.5 kPa æˆ–ä¾è¨­è¨ˆ
    severity: &quot;warning&quot;
    maintenance_trigger: true               # è§¸ç™¼ç¶­è­·å·¥å–®æ¨™è¨˜

  # ==========================================
  # äº’æ–¥ç´„æŸ (Mutex Constraints) - é€šç”¨
  # ==========================================

  chiller_mutual_backup:
    description: &quot;ä¸»æ©Ÿèˆ‡å‚™ç”¨ä¸»æ©Ÿä¸å¯åŒæ™‚é–‹å•Ÿï¼ˆè¦–æ¡ˆå ´ç­–ç•¥ï¼‰&quot;
    check_type: &quot;mutex&quot;
    check_phase: &quot;optimization&quot;
    mutex_pairs: [[&quot;chiller_01_status&quot;, &quot;chiller_02_status&quot;]]
    condition: &quot;device_role == 'backup'&quot;    # åƒ…ç•¶è§’è‰²ç‚º backup æ™‚æª¢æŸ¥
    severity: &quot;warning&quot;
    error_code: &quot;E354&quot;                      # é€šç”¨ Mutex é•å
</code></pre>
<hr />
<h2 id="6-interface-contract-v11">6. éŒ¯èª¤èˆ‡è­¦å‘Šä»£ç¢¼å°ç…§è¡¨ï¼ˆå®Œæ•´å°é½Š Interface Contract v1.1ï¼‰</h2>
<h3 id="61-feature-annotation-e400-e499">6.1 Feature Annotation éŒ¯èª¤ (E400-E499)</h3>
<table>
<thead>
<tr>
<th style="text-align: center;">ä»£ç¢¼</th>
<th style="text-align: left;">åç¨±</th>
<th style="text-align: center;">å±¤ç´š</th>
<th style="text-align: left;">è§¸ç™¼æ¢ä»¶</th>
<th style="text-align: left;">è™•ç†æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>E400</strong></td>
<td style="text-align: left;"><code>ANNOTATION_VERSION_MISMATCH</code></td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">Schema ç‰ˆæœ¬ä¸ç¬¦ï¼ˆé 1.3ï¼‰</td>
<td style="text-align: left;">åŸ·è¡Œ migrate_excel.py å‡ç´š</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E401</strong></td>
<td style="text-align: left;"><code>ORPHAN_COLUMN</code></td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">æ¨™è¨»æ¬„ä½ä¸å­˜åœ¨æ–¼è³‡æ–™ï¼ˆExcel æœ‰ä½† CSV æ²’æœ‰ï¼‰</td>
<td style="text-align: left;">è¨˜éŒ„æ—¥èªŒï¼Œç¹¼çºŒåŸ·è¡Œ</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E402</strong></td>
<td style="text-align: left;"><code>UNANNOTATED_COLUMN</code></td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">è³‡æ–™æ¬„ä½æœªå®šç¾©æ–¼ Annotationï¼ˆCSV æœ‰ä½† Excel æ²’æœ‰ï¼‰</td>
<td style="text-align: left;">é˜»æ“‹æµç¨‹ï¼ŒåŸ·è¡Œ Wizard æ¨™è¨»</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E403</strong></td>
<td style="text-align: left;"><code>UNIT_INCOMPATIBLE</code></td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">å–®ä½èˆ‡ç‰©ç†é¡å‹ä¸åŒ¹é…ï¼ˆå¦‚æº«åº¦é¸ barï¼‰</td>
<td style="text-align: left;">é˜»æ“‹ç”Ÿæˆï¼Œè¿”å› Excel ä¿®æ­£</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E404</strong></td>
<td style="text-align: left;"><code>LAG_FORMAT_INVALID</code></td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">Lag é–“éš”æ ¼å¼éŒ¯èª¤ï¼ˆéé€—è™Ÿåˆ†éš”æ•´æ•¸ï¼‰</td>
<td style="text-align: left;">é˜»æ“‹ç”Ÿæˆ</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E405</strong></td>
<td style="text-align: left;"><code>TARGET_LEAKAGE_RISK</code></td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">is_target=True ä½† enable_lag=True</td>
<td style="text-align: left;">é˜»æ“‹ç”Ÿæˆï¼ˆPydantic è‡ªå‹•æ””æˆªï¼‰</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E406</strong></td>
<td style="text-align: left;"><code>EXCEL_YAML_OUT_OF_SYNC</code></td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">Excel ä¿®æ”¹æ™‚é–“æ™šæ–¼ YAMLï¼Œæˆ– checksum ä¸ç¬¦</td>
<td style="text-align: left;">æç¤ºé‡æ–°åŸ·è¡Œ excel_to_yaml.py</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E407</strong></td>
<td style="text-align: left;"><code>CIRCULAR_INHERITANCE</code></td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">YAML ç¹¼æ‰¿éˆå­˜åœ¨å¾ªç’°åƒç…§</td>
<td style="text-align: left;">é˜»æ“‹è¼‰å…¥ï¼Œæª¢æŸ¥ inherit æ¬„ä½</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E408</strong></td>
<td style="text-align: left;"><code>SSOT_QUALITY_FLAGS_MISMATCH</code></td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">YAML ä¸­çš„ <code>ssot_flags_version</code> èˆ‡ <code>config_models.VALID_QUALITY_FLAGS</code> ç‰ˆæœ¬ä¸ä¸€è‡´</td>
<td style="text-align: left;">é˜»æ“‹ Container å•Ÿå‹•ï¼Œè¦æ±‚åŒæ­¥ config_models.py</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E409</strong></td>
<td style="text-align: left;"><code>HEADER_ANNOTATION_MISMATCH</code></td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">CSV æ¨™é ­ï¼ˆç¶“ Parser æ­£è¦åŒ–å¾Œï¼‰èˆ‡ Annotation ä¸­çš„ <code>column_name</code> ç„¡æ³•åŒ¹é…</td>
<td style="text-align: left;">æç¤ºæª¢æŸ¥ Excel æ¨™è¨»æˆ–åŸ·è¡Œ Wizard</td>
</tr>
</tbody>
</table>
<h3 id="62-equipment-validation-e350-e399-">6.2 Equipment Validation éŒ¯èª¤ (E350-E399) - å°é½Šé€šç”¨å±¤ç´š</h3>
<table>
<thead>
<tr>
<th style="text-align: center;">ä»£ç¢¼</th>
<th style="text-align: left;">åç¨±</th>
<th style="text-align: center;">å±¤ç´š</th>
<th style="text-align: left;">è§¸ç™¼æ¢ä»¶</th>
<th style="text-align: left;">è™•ç†æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>E350</strong></td>
<td style="text-align: left;"><code>EQUIPMENT_LOGIC_PRECHECK_FAILED</code></td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">Cleaner éšæ®µåŸºç¤è¨­å‚™é‚è¼¯é æª¢å¤±æ•—ï¼ˆå¦‚ä¸»æ©Ÿé–‹ä½†æ°´æ³µé—œï¼‰</td>
<td style="text-align: left;">æ¨™è¨˜ Quality Flag ç‚º PHYSICAL_IMPOSSIBLEï¼Œè¨˜éŒ„ç¨½æ ¸è»Œè·¡</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E351</strong></td>
<td style="text-align: left;"><code>ENERGY_MONOTONICITY_VIOLATION</code></td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">kWh é›»è¡¨è®€æ•¸éæ¸›ï¼ˆå–®èª¿æ€§é•åï¼‰</td>
<td style="text-align: left;">æª¢æŸ¥é›»è¡¨é‡ç½®æˆ–æ•…éšœï¼Œåˆ†æ®µè™•ç†</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E352</strong></td>
<td style="text-align: left;"><code>EFFICIENCY_OUT_OF_RANGE</code></td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">COP &lt; 2 æˆ– &gt; 8ï¼ˆç‰©ç†ç•°å¸¸ï¼‰</td>
<td style="text-align: left;">æ¨™è¨˜ç•°å¸¸ï¼Œå»ºè­°æª¢æŸ¥æº«åº¦/æµé‡æ„Ÿæ¸¬å™¨</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E353</strong></td>
<td style="text-align: left;"><code>LOW_DELTA_T_SYNDROME</code></td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">å†°æ°´é€²å›æ°´æº«å·® &lt; 1Â°Cï¼ˆä½æº«å·®ç—‡å€™ç¾¤ï¼‰</td>
<td style="text-align: left;">å»ºè­°æ¸…æ´—ç†±äº¤æ›å™¨æˆ–æª¢æŸ¥æµé‡</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E354</strong></td>
<td style="text-align: left;"><code>MUTEX_VIOLATION</code></td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">é•åã€Œäº’æ–¥ã€ç´„æŸï¼ˆå¦‚ä¸»æ©Ÿèˆ‡å‚™ç”¨ä¸»æ©ŸåŒæ™‚é–‹ï¼‰</td>
<td style="text-align: left;">æ¨™è¨˜ EQUIPMENT_VIOLATION</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E355</strong></td>
<td style="text-align: left;"><code>SEQUENCE_VIOLATION</code></td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">é•åé–‹é—œæ©Ÿé †åºç´„æŸï¼ˆå¦‚æœªé”æœ€å°é‹è½‰æ™‚é–“ï¼‰</td>
<td style="text-align: left;">æ¨™è¨˜ EQUIPMENT_VIOLATION</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E356</strong></td>
<td style="text-align: left;"><code>MIN_RUNTIME_VIOLATION</code></td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">é•åæœ€å°é‹è½‰æ™‚é–“é™åˆ¶ï¼ˆåŒ E355ï¼Œä¾›çµ±è¨ˆç”¨ï¼‰</td>
<td style="text-align: left;">æ¨™è¨˜è­¦å‘Š</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E357</strong></td>
<td style="text-align: left;"><code>MIN_DOWNTIME_VIOLATION</code></td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">é•åæœ€å°åœæ©Ÿæ™‚é–“é™åˆ¶ï¼ˆåŒ E355ï¼Œä¾›çµ±è¨ˆç”¨ï¼‰</td>
<td style="text-align: left;">æ¨™è¨˜è­¦å‘Š</td>
</tr>
</tbody>
</table>
<h3 id="63-governance-e500-e599">6.3 Governance &amp; å®‰å…¨æ€§éŒ¯èª¤ (E500-E599)</h3>
<table>
<thead>
<tr>
<th style="text-align: center;">ä»£ç¢¼</th>
<th style="text-align: left;">åç¨±</th>
<th style="text-align: center;">å±¤ç´š</th>
<th style="text-align: left;">è§¸ç™¼æ¢ä»¶</th>
<th style="text-align: left;">è™•ç†æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>E500</strong></td>
<td style="text-align: left;"><code>DEVICE_ROLE_LEAKAGE</code></td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">DataFrame æˆ– Metadata åŒ…å« <code>device_role</code> æ¬„ä½ï¼ˆè·è²¬åˆ†é›¢é•åï¼‰</td>
<td style="text-align: left;">ç«‹å³çµ‚æ­¢æµç¨‹ï¼Œç¦æ­¢ä¸‹æ¸¸ä½¿ç”¨</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E501</strong></td>
<td style="text-align: left;"><code>DIRECT_WRITE_ATTEMPT</code></td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">Python ç¨‹å¼ç¢¼è©¦åœ–ç›´æ¥å¯«å…¥ YAML SSOT è·¯å¾‘</td>
<td style="text-align: left;">ç«‹å³çµ‚æ­¢æµç¨‹ï¼Œè¨˜éŒ„å®‰å…¨æ€§é•è¦</td>
</tr>
</tbody>
</table>
<h3 id="64-e000">6.4 å…¨åŸŸæ™‚é–“åŸºæº–éŒ¯èª¤ (E000)</h3>
<table>
<thead>
<tr>
<th style="text-align: center;">ä»£ç¢¼</th>
<th style="text-align: left;">åç¨±</th>
<th style="text-align: center;">å±¤ç´š</th>
<th style="text-align: left;">è§¸ç™¼æ¢ä»¶</th>
<th style="text-align: left;">è™•ç†æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>E000</strong></td>
<td style="text-align: left;"><code>TEMPORAL_BASELINE_MISSING</code></td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;"><code>pipeline_origin_timestamp</code> æœªå‚³éæˆ–éºå¤±</td>
<td style="text-align: left;">ç«‹å³çµ‚æ­¢ï¼Œè¨˜éŒ„ã€Œæ™‚é–“åŸºæº–æœªå»ºç«‹ã€</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E000-W</strong></td>
<td style="text-align: left;"><code>TEMPORAL_DRIFT_WARNING</code></td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">Pipeline åŸ·è¡Œæ™‚é–“è¶…é 1 å°æ™‚ï¼Œæ‡·ç–‘æ™‚é–“æ¼‚ç§»</td>
<td style="text-align: left;">è¨˜éŒ„è­¦å‘Šï¼Œæª¢æŸ¥æ™‚é–“åŸºæº–ä¸€è‡´æ€§</td>
</tr>
</tbody>
</table>
<h3 id="65-w401-w407">6.5 è­¦å‘Šä»£ç¢¼ (W401-W407)</h3>
<table>
<thead>
<tr>
<th style="text-align: center;">ä»£ç¢¼</th>
<th style="text-align: left;">åç¨±</th>
<th style="text-align: center;">å±¤ç´š</th>
<th style="text-align: left;">è§¸ç™¼æ¢ä»¶</th>
<th style="text-align: left;">è™•ç†æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>W401</strong></td>
<td style="text-align: left;"><code>MEAN_OUT_OF_RANGE</code></td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">å¹³å‡å€¼è¶…å‡ºé æœŸç¯„åœï¼ˆdistribution_checkï¼‰</td>
<td style="text-align: left;">æ¨™è¨˜ pending_reviewï¼Œå¯é€é ignore_warnings å¿½ç•¥</td>
</tr>
<tr>
<td style="text-align: center;"><strong>W402</strong></td>
<td style="text-align: left;"><code>LOW_VARIANCE</code></td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">æ¨™æº–å·®æ¥è¿‘é›¶ï¼ˆå¯èƒ½ç‚ºå‡çµè³‡æ–™ï¼‰</td>
<td style="text-align: left;">æª¢æŸ¥æ„Ÿæ¸¬å™¨ç‹€æ…‹</td>
</tr>
<tr>
<td style="text-align: center;"><strong>W403</strong></td>
<td style="text-align: left;"><code>HIGH_ZERO_RATIO</code></td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">é›¶å€¼æ¯”ä¾‹éé«˜ï¼ˆä¸»è¨­å‚™ &gt; 10%ï¼‰</td>
<td style="text-align: left;">å‚™ç”¨è¨­å‚™ï¼ˆbackup roleï¼‰è‡ªå‹•æŠ‘åˆ¶æ­¤è­¦å‘Š</td>
</tr>
<tr>
<td style="text-align: center;"><strong>W404</strong></td>
<td style="text-align: left;"><code>BACKUP_CLEANUP_FAILED</code></td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">æ¸…ç†èˆŠå‚™ä»½æ™‚æ¬Šé™ä¸è¶³</td>
<td style="text-align: left;">é€šçŸ¥ç³»çµ±ç®¡ç†å“¡ï¼Œä¸é˜»æ“‹æµç¨‹</td>
</tr>
<tr>
<td style="text-align: center;"><strong>W405</strong></td>
<td style="text-align: left;"><code>EQUIPMENT_CONSTRAINT_DEPRECATED</code></td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">ä½¿ç”¨äº†æ¨™è¨˜ç‚º deprecated çš„è¨­å‚™é™åˆ¶æ¢ä»¶</td>
<td style="text-align: left;">å»ºè­°æ›´æ–°è‡³æ–°ç‰ˆé™åˆ¶æ¢ä»¶å®šç¾©</td>
</tr>
<tr>
<td style="text-align: center;"><strong>W406</strong></td>
<td style="text-align: left;"><code>FREQUENCY_ZERO_WHILE_RUNNING</code></td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">é‹è½‰ç‹€æ…‹=1 ä½†é »ç‡=0ï¼ˆè®Šé »å™¨ç•°å¸¸ï¼‰</td>
<td style="text-align: left;">æª¢æŸ¥ VFD å›æˆä¿¡è™Ÿ</td>
</tr>
<tr>
<td style="text-align: center;"><strong>W407</strong></td>
<td style="text-align: left;"><code>POWER_FACTOR_LOW</code></td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">PF &lt; 0.8 æŒçºŒè¶…é 1 å°æ™‚</td>
<td style="text-align: left;">å»ºè­°æª¢æŸ¥é›»å®¹å™¨æˆ–é¦¬é”ç‹€æ…‹</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="7-wizard-cli">7. Wizard äº¤äº’å¼ CLIï¼ˆå–®å‘æµç¨‹å¼·åŒ–èˆ‡åŒæ­¥æª¢æŸ¥ï¼‰</h2>
<h3 id="71">7.1 æ¶æ§‹ä¿®æ­£ï¼ˆè§£æ±ºç«¶æ…‹æ¢ä»¶ï¼‰</h3>
<p><strong>v1.3 å¼·åˆ¶è¦ç¯„</strong>: Wizard <strong>åƒ…</strong>æ›´æ–° Excelï¼ŒYAML ç”±ä½¿ç”¨è€…æ‰‹å‹•è§¸ç™¼ç”Ÿæˆ</p>
<pre><code class="language-python">def wizard_update_excel(
    site_id: str,
    csv_path: Path,
    excel_path: Path,
    template_version: str = &quot;1.3&quot;
):
    &quot;&quot;&quot;
    Wizardï¼šåµæ¸¬æ–°æ¬„ä½ä¸¦è¿½åŠ è‡³ Excelï¼ˆä¸ç›´æ¥å¯« YAMLï¼‰
    åŒ…å«è‡ªå‹•å‚™ä»½æ©Ÿåˆ¶ï¼ˆUndo é˜²è­·ï¼‰èˆ‡ Header Standardization é è¦½
    &quot;&quot;&quot;
    # 0. è‡ªå‹•å‚™ä»½æ©Ÿåˆ¶ï¼ˆç½é›£æ¢å¾©é˜²è­·ï¼‰
    if excel_path.exists():
        backup_dir = excel_path.parent / &quot;.backups&quot;
        backup_dir.mkdir(exist_ok=True)

        timestamp = datetime.now().strftime(&quot;%Y%m%d_%H%M%S&quot;)
        backup_filename = f&quot;{excel_path.stem}.backup.{timestamp}{excel_path.suffix}&quot;
        backup_path = backup_dir / backup_filename

        import shutil
        shutil.copy2(excel_path, backup_path)

        # æ¸…ç†èˆŠå‚™ä»½ï¼ˆä¿ç•™æœ€è¿‘ 10 å€‹ç‰ˆæœ¬ï¼‰
        backup_pattern = f&quot;{excel_path.stem}.backup.*&quot;
        all_backups = sorted(
            backup_dir.glob(backup_pattern), 
            key=lambda x: x.stat().st_mtime,
            reverse=True
        )

        for old_backup in all_backups[10:]:
            try:
                old_backup.unlink()
            except Exception as e:
                print(f&quot;âš ï¸  ç„¡æ³•æ¸…ç†èˆŠå‚™ä»½ {old_backup.name}: {e}&quot;)

        print(f&quot;ğŸ’¾ å·²è‡ªå‹•å‚™ä»½: {backup_path.name}ï¼ˆä¿ç•™æœ€è¿‘ 10 å€‹ç‰ˆæœ¬ï¼‰&quot;)

    # 1. æª¢æŸ¥ Excel ç‰ˆæœ¬ç›¸å®¹æ€§
    if excel_path.exists():
        wb = load_workbook(excel_path)
        current_ver = wb['System']['B1'].value
        if current_ver != template_version:
            raise CompatibilityError(
                f&quot;E400: Excel ç¯„æœ¬éèˆŠ (v{current_ver})ï¼Œè«‹å…ˆåŸ·è¡Œï¼š\n&quot;
                f&quot;python migrate_excel.py --from {current_ver} --to {template_version}&quot;
            )
    else:
        wb = load_workbook(f&quot;tools/features/templates/Feature_Template_v{template_version}.xlsx&quot;)
        print(f&quot;ğŸ†• åˆå§‹åŒ–æ–° Excel æª”æ¡ˆ: {excel_path}&quot;)

    # 2. è®€å– CSV æ¬„ä½ä¸¦åŸ·è¡Œ Header Standardization
    from src.etl.header_standardizer import HeaderStandardizer

    df_csv = pl.read_csv(csv_path, n_rows=1000)
    original_headers = df_csv.columns
    standardizer = HeaderStandardizer()

    standardized_map = {}
    for header in original_headers:
        if header == 'timestamp':
            standardized_map[header] = header
        else:
            standardized = standardizer.standardize(header)
            standardized_map[header] = standardized

    # é¡¯ç¤ºæ¨™é ­è½‰æ›é è¦½
    print(&quot;\nğŸ“‹ Header Standardization é è¦½:&quot;)
    for orig, std in standardized_map.items():
        if orig != std:
            print(f&quot;   {orig} â†’ {std}&quot;)

    existing_cols = get_existing_columns(wb)
    new_cols = set(standardized_map.values()) - existing_cols - {'timestamp'}

    if not new_cols:
        print(&quot;âœ… ç„¡æ–°æ¬„ä½éœ€è¦æ¨™è¨»&quot;)
        return

    print(f&quot;ğŸ” ç™¼ç¾ {len(new_cols)} å€‹æ–°æ¬„ä½å¾…æ¨™è¨»&quot;)

    # === æ­¥é©Ÿ 3: HVAC èªæ„æ¨æ¸¬ ===
    for col in sorted(new_cols):
        # æ‰¾å›åŸå§‹æ¬„ä½åç¨±ï¼ˆç”¨æ–¼çµ±è¨ˆè¨ˆç®—ï¼‰
        original_col = [k for k, v in standardized_map.items() if v == col][0]
        stats = calculate_stats(df_csv[original_col])
        suggestion = hvac_semantic_guess(col, stats)  # HVAC å°ˆç”¨æ¨æ¸¬é‚è¼¯

        print(f&quot;\n{'='*60}&quot;)
        print(f&quot;ğŸ” æ–°æ¬„ä½: {col} (åŸå§‹: {original_col})&quot;)
        print(f&quot;   çµ±è¨ˆæ‘˜è¦: å‡å€¼={stats['mean']:.2f}, é›¶å€¼æ¯”ä¾‹={stats['zero_ratio']:.1%}&quot;)
        print(f&quot;   HVAC æ¨æ¸¬: {suggestion['equipment_type']} / {suggestion['physical_type']}&quot;)
        print(f&quot;   å»ºè­°è¨­å‚™ ID: {suggestion['equipment_id']}&quot;)

        # äº¤äº’å¼ç¢ºèªï¼ˆå«é˜²å‘†ï¼‰
        choice = input(&quot;[Y]ç¢ºèª [N]ä¿®æ”¹ [S]è·³é [D]æŸ¥çœ‹åˆ†ä½ˆ [Q]é€€å‡º &gt; &quot;).strip().upper()

        if choice == 'Q':
            print(&quot;ğŸ›‘ ä½¿ç”¨è€…ä¸­æ–·ï¼Œå·²è™•ç†çš„æ¬„ä½å·²å„²å­˜&quot;)
            break
        elif choice == 'S':
            continue
        elif choice == 'D':
            plot_distribution(df_csv[original_col])
            continue

        # å¯«å…¥ Excelï¼ˆå« HVAC é è¨­å€¼ï¼‰
        row_data = {
            'column_name': col,  # è¨˜éŒ„æ­£è¦åŒ–å¾Œçš„åç¨±
            'physical_type': suggestion['physical_type'],
            'unit': suggestion['unit'],
            'device_role': suggestion.get('device_role', 'primary'),
            'equipment_id': suggestion['equipment_id'],
            'is_target': suggestion.get('is_target', False),
            'enable_lag': not suggestion.get('is_target', False),
            'lag_intervals': suggestion.get('lag_intervals', '1,4'),
            'ignore_warnings': '',
            'description': suggestion['description'],
            'status': 'pending_review'
        }

        write_to_excel_row(wb['Columns'], row_data)
        print(f&quot;âœ… å·²å¯«å…¥ Excelï¼ˆç‹€æ…‹: pending_reviewï¼‰&quot;)

    # === æ­¥é©Ÿ 4: æ›´æ–° Metadata ===
    update_metadata(wb, source_csv=csv_path.name)

    # === æ­¥é©Ÿ 5: åŸå­å¯«å…¥ ===
    temp_excel = excel_path.with_suffix('.tmp.xlsx')
    wb.save(temp_excel)
    temp_excel.replace(excel_path)

    # === æ­¥é©Ÿ 6: è¨ˆç®—ä¸¦è¨˜éŒ„ Excel Checksum ===
    excel_checksum = compute_file_hash(excel_path, algorithm='sha256')
    wb = load_workbook(excel_path)  # é‡æ–°è¼‰å…¥ä»¥æ›´æ–° System sheet
    wb['System']['B6'] = excel_checksum
    wb.save(excel_path)

    print(f&quot;\n{'='*60}&quot;)
    print(f&quot;âœ… å·²æ›´æ–° Excel: {excel_path}&quot;)
    print(f&quot;ğŸ“Š Excel Checksum: {excel_checksum[:16]}...&quot;)
    print(f&quot;âš ï¸  è«‹é–‹å•Ÿ Excel ç¢ºèªè¨­å‚™è§’è‰²èˆ‡ Equipment IDï¼Œç„¶å¾ŒåŸ·è¡Œï¼š&quot;)
    print(f&quot;   python tools/features/excel_to_yaml.py --input {excel_path}&quot;)
</code></pre>
<h3 id="72-yaml">7.2 åŒæ­¥ç‹€æ…‹æª¢æŸ¥ï¼ˆé˜²æ­¢éºå¿˜ç”Ÿæˆ YAMLï¼‰</h3>
<pre><code class="language-python">def check_sync_status(excel_path: Path, yaml_path: Path) -&gt; dict:
    &quot;&quot;&quot;
    æª¢æŸ¥ Excel èˆ‡ YAML æ˜¯å¦åŒæ­¥ï¼ˆE406 å¯¦ä½œç´°ç¯€ï¼‰
    å›å‚³è©³ç´°å·®ç•°å ±å‘Šèˆ‡å»ºè­°æ“ä½œ
    &quot;&quot;&quot;
    wb = load_workbook(excel_path)
    excel_mtime = datetime.fromtimestamp(excel_path.stat().st_mtime)

    # è®€å– Excel ä¸­è¨˜éŒ„çš„ checksum
    stored_excel_checksum = wb['System']['B6'].value

    if not yaml_path.exists():
        return {
            &quot;synced&quot;: False,
            &quot;error_code&quot;: &quot;E406&quot;,
            &quot;reason&quot;: &quot;YAML ä¸å­˜åœ¨&quot;,
            &quot;action&quot;: f&quot;python tools/features/excel_to_yaml.py --input {excel_path} --output {yaml_path}&quot;,
            &quot;severity&quot;: &quot;High&quot;
        }

    yaml_mtime = datetime.fromtimestamp(yaml_path.stat().st_mtime)

    # æª¢æŸ¥æ™‚é–“æˆ³ï¼ˆExcel å¿…é ˆæ—©æ–¼æˆ–ç­‰æ–¼ YAMLï¼‰
    if excel_mtime &gt; yaml_mtime:
        time_diff = (excel_mtime - yaml_mtime).total_seconds() / 60
        return {
            &quot;synced&quot;: False,
            &quot;error_code&quot;: &quot;E406&quot;,
            &quot;reason&quot;: f&quot;Excel è¼ƒæ–°ï¼ˆå·®è· {time_diff:.1f} åˆ†é˜ï¼‰&quot;,
            &quot;excel_time&quot;: excel_mtime.isoformat(),
            &quot;yaml_time&quot;: yaml_mtime.isoformat(),
            &quot;action&quot;: &quot;è«‹é‡æ–°åŸ·è¡Œ excel_to_yaml.py&quot;,
            &quot;severity&quot;: &quot;High&quot;
        }

    # Checksum é©—è­‰ï¼ˆé˜²æ­¢æ‰‹å‹•ä¿®æ”¹ YAML æˆ– Excel è¢«å¤–éƒ¨ä¿®æ”¹ï¼‰
    if stored_excel_checksum and stored_excel_checksum != 'pending_sync':
        current_excel_checksum = compute_file_hash(excel_path, algorithm='sha256')
        if stored_excel_checksum != current_excel_checksum:
            return {
                &quot;synced&quot;: False,
                &quot;error_code&quot;: &quot;E406&quot;,
                &quot;reason&quot;: &quot;Excel æª”æ¡ˆå…§å®¹èˆ‡è¨˜éŒ„çš„ Checksum ä¸ç¬¦ï¼ˆå¯èƒ½è¢«å¤–éƒ¨ä¿®æ”¹ï¼‰&quot;,
                &quot;warning&quot;: &quot;å»ºè­°é‡æ–°åŸ·è¡Œ Wizard ç¢ºèªæ¬„ä½ä¸€è‡´æ€§&quot;,
                &quot;severity&quot;: &quot;Medium&quot;
            }

        # é©—è­‰ YAML å…§å®¹æ˜¯å¦å°æ‡‰æ­¤ Excel ç‰ˆæœ¬
        with open(yaml_path, 'r', encoding='utf-8') as f:
            yaml_content = yaml.safe_load(f)

        if yaml_content.get('metadata', {}).get('excel_checksum') != stored_excel_checksum:
            return {
                &quot;synced&quot;: False,
                &quot;error_code&quot;: &quot;E406&quot;,
                &quot;reason&quot;: &quot;YAML å°æ‡‰çš„ Excel Checksum èˆ‡ç•¶å‰ Excel ä¸ç¬¦&quot;,
                &quot;warning&quot;: &quot;YAML å¯èƒ½æ˜¯ç”±èˆŠç‰ˆ Excel ç”Ÿæˆï¼Œå»ºè­°é‡æ–°ç”Ÿæˆ&quot;,
                &quot;severity&quot;: &quot;High&quot;
            }

    return {
        &quot;synced&quot;: True, 
        &quot;last_sync&quot;: yaml_mtime.isoformat(),
        &quot;excel_checksum&quot;: stored_excel_checksum
    }
</code></pre>
<hr />
<h2 id="8-featureannotationmanager-api">8. FeatureAnnotationManager APIï¼ˆå®Œæ•´è¦ç¯„ï¼‰</h2>
<h3 id="81">8.1 é¡åˆ¥å®šç¾©èˆ‡åˆå§‹åŒ–</h3>
<pre><code class="language-python"># src/features/annotation_manager.py
from typing import Dict, List, Optional, Any, Set, Tuple
from pathlib import Path
import yaml
from pydantic import BaseModel, validator, root_validator

class ColumnAnnotation(BaseModel):
    &quot;&quot;&quot;æ¬„ä½æ¨™è¨»è³‡æ–™æ¨¡å‹ï¼ˆå°é½Š YAML Schema v1.3ï¼‰&quot;&quot;&quot;
    column_name: str
    physical_type: str
    unit: Optional[str]
    device_role: str = &quot;primary&quot;
    equipment_id: Optional[str] = None      # v1.3 æ–°å¢
    description: Optional[str]
    is_target: bool = False
    enable_lag: bool = True
    lag_intervals: List[int] = []
    rolling_windows: List[int] = []
    ignore_warnings: List[str] = []
    status: str = &quot;pending_review&quot;
    tags: List[str] = []

    @validator('device_role')
    def validate_role(cls, v):
        if v not in ['primary', 'backup', 'seasonal']:
            raise ValueError(f&quot;Invalid device_role: {v}&quot;)
        return v

    @root_validator
    def check_target_lag(cls, values):
        &quot;&quot;&quot;E405: ç›®æ¨™è®Šæ•¸ç¦æ­¢ Lag&quot;&quot;&quot;
        if values.get('is_target') and values.get('enable_lag'):
            raise ValueError(&quot;E405: ç›®æ¨™è®Šæ•¸ä¸å¯å•Ÿç”¨ Lag&quot;)
        return values

class EquipmentConstraint(BaseModel):
    &quot;&quot;&quot;è¨­å‚™é™åˆ¶æ¢ä»¶æ¨¡å‹ï¼ˆå°é½Š Interface Contract v1.1ï¼‰&quot;&quot;&quot;
    constraint_id: str
    description: str
    check_type: str                      # requires, mutex, sequence, range_check, threshold
    check_phase: str                     # precheck, optimization
    trigger_status: Optional[List[str]]
    required_status: Optional[List[str]]
    target_column: Optional[str]
    min_value: Optional[float]
    max_value: Optional[float]
    min_duration_minutes: Optional[int]
    severity: str                        # critical, warning
    applicable_roles: List[str] = [&quot;primary&quot;, &quot;backup&quot;]
    error_code: Optional[str]

class FeatureAnnotationManager:
    &quot;&quot;&quot;
    ç‰¹å¾µæ¨™è¨»ç®¡ç†å™¨ï¼ˆFeatureAnnotationManagerï¼‰

    è¨­è¨ˆåŸå‰‡ï¼š
    1. å”¯è®€ä»‹é¢ï¼šæä¾›æŸ¥è©¢æ–¹æ³•ï¼Œç¦æ­¢ä¿®æ”¹ YAML
    2. SSOT å­˜å–ï¼šæ‰€æœ‰è³‡æ–™ä¾†è‡ª config/features/sites/{site_id}.yaml
    3. å¿«å–æ©Ÿåˆ¶ï¼šYAML è¼‰å…¥å¾Œå¿«å–æ–¼è¨˜æ†¶é«”ï¼Œé¿å…é‡è¤‡ I/O
    4. HVAC æ„ŸçŸ¥ï¼šæ”¯æ´è¨­å‚™äº’é–æŸ¥è©¢èˆ‡é©—è­‰
    5. æ™‚é–“åŸºæº–æ„ŸçŸ¥ï¼šæ”¯æ´ TemporalContext å‚³é

    ä½¿ç”¨ç¯„ä¾‹ï¼š
        from src.features.temporal_context import TemporalContext

        context = TemporalContext()
        manager = FeatureAnnotationManager(&quot;cgmh_ty&quot;, temporal_context=context)

        # åŸºç¤æŸ¥è©¢
        annotation = manager.get_column_annotation(&quot;chiller_01_chwst&quot;)

        # HVAC å°ˆç”¨æŸ¥è©¢
        chillers = manager.get_columns_by_equipment_type(&quot;chiller&quot;)
        constraints = manager.get_equipment_constraints(phase=&quot;precheck&quot;)
    &quot;&quot;&quot;

    def __init__(
        self, 
        site_id: str, 
        config_root: Path = Path(&quot;config/features&quot;),
        temporal_context: Optional['TemporalContext'] = None
    ):
        self.site_id = site_id
        self.config_path = config_root / &quot;sites&quot; / f&quot;{site_id}.yaml&quot;
        self.temporal_context = temporal_context
        self._cache: Optional[Dict[str, Any]] = None
        self._annotations: Dict[str, ColumnAnnotation] = {}
        self._constraints: Dict[str, EquipmentConstraint] = {}
        self._equipment_map: Dict[str, List[str]] = {}  # equipment_id -&gt; columns

        self._load_and_validate()

    def _load_and_validate(self):
        &quot;&quot;&quot;è¼‰å…¥ YAML ä¸¦é©—è­‰ Schema ç‰ˆæœ¬èˆ‡ SSOT ä¸€è‡´æ€§&quot;&quot;&quot;
        if not self.config_path.exists():
            raise FileNotFoundError(
                f&quot;E402: æ‰¾ä¸åˆ°æ¡ˆå ´æ¨™è¨»æª”æ¡ˆ: {self.config_path}&quot;
            )

        with open(self.config_path, 'r', encoding='utf-8') as f:
            raw_data = yaml.safe_load(f)

        # é©—è­‰ Schema ç‰ˆæœ¬
        schema_version = raw_data.get('schema_version', 'unknown')
        if schema_version != &quot;1.3&quot;:
            raise CompatibilityError(
                f&quot;E400: ä¸æ”¯æ´çš„ Schema ç‰ˆæœ¬: {schema_version}ï¼Œé æœŸ: 1.3&quot;
            )

        # é©—è­‰ SSOT Quality Flags ç‰ˆæœ¬ï¼ˆE408ï¼‰
        ssot_flags_version = raw_data.get('metadata', {}).get('ssot_flags_version')
        from src.etl.config_models import VALID_QUALITY_FLAGS_VERSION
        if ssot_flags_version != VALID_QUALITY_FLAGS_VERSION:
            raise SSOTMismatchError(
                f&quot;E408: SSOT Quality Flags ç‰ˆæœ¬ä¸åŒ¹é…: &quot;
                f&quot;YAML ç‚º {ssot_flags_version}ï¼Œç³»çµ±è¦æ±‚ {VALID_QUALITY_FLAGS_VERSION}&quot;
            )

        # è§£æ Columns
        for col_name, col_data in raw_data.get('columns', {}).items():
            self._annotations[col_name] = ColumnAnnotation(**col_data)

            # å»ºç«‹ Equipment ID æ˜ å°„
            eq_id = col_data.get('equipment_id')
            if eq_id:
                if eq_id not in self._equipment_map:
                    self._equipment_map[eq_id] = []
                self._equipment_map[eq_id].append(col_name)

        # è§£æ Equipment Constraints
        for const_id, const_data in raw_data.get('equipment_constraints', {}).items():
            const_data['constraint_id'] = const_id
            self._constraints[const_id] = EquipmentConstraint(**const_data)

        self._cache = raw_data

    # ==================== æ ¸å¿ƒæŸ¥è©¢ API ====================

    def get_column_annotation(self, column_name: str) -&gt; Optional[ColumnAnnotation]:
        &quot;&quot;&quot;å–å¾—æ¬„ä½å®Œæ•´æ¨™è¨»&quot;&quot;&quot;
        return self._annotations.get(column_name)

    def is_column_annotated(self, column_name: str) -&gt; bool:
        &quot;&quot;&quot;æª¢æŸ¥æ¬„ä½æ˜¯å¦å·²å®šç¾©ï¼ˆE402 æª¢æŸ¥ï¼‰&quot;&quot;&quot;
        return column_name in self._annotations

    def get_device_role(self, column_name: str) -&gt; Optional[str]:
        &quot;&quot;&quot;
        å–å¾—è¨­å‚™è§’è‰²ï¼ˆprimary/backup/seasonalï¼‰
        ä¾› Cleaner v2.2 é€²è¡Œèªæ„æ„ŸçŸ¥æ¸…æ´—
        &quot;&quot;&quot;
        anno = self._annotations.get(column_name)
        return anno.device_role if anno else None

    def get_equipment_id(self, column_name: str) -&gt; Optional[str]:
        &quot;&quot;&quot;å–å¾—è¨­å‚™ IDï¼ˆv1.3 æ–°å¢ï¼‰&quot;&quot;&quot;
        anno = self._annotations.get(column_name)
        return anno.equipment_id if anno else None

    def get_columns_by_equipment_id(self, equipment_id: str) -&gt; List[str]:
        &quot;&quot;&quot;ä¾è¨­å‚™ ID å–å¾—æ‰€æœ‰ç›¸é—œæ¬„ä½&quot;&quot;&quot;
        return self._equipment_map.get(equipment_id, [])

    def get_columns_by_equipment_type(self, equipment_type: str) -&gt; List[str]:
        &quot;&quot;&quot;
        ä¾è¨­å‚™é¡å‹å–å¾—æ¬„ä½ï¼ˆåŸºæ–¼å‘½åå‰ç¶´åˆ†æï¼‰

        Args:
            equipment_type: &quot;chiller&quot;, &quot;pump&quot;, &quot;cooling_tower&quot;, &quot;ahu&quot;
        &quot;&quot;&quot;
        prefix_map = {
            &quot;chiller&quot;: [&quot;chiller_&quot;, &quot;ch_&quot;],
            &quot;pump&quot;: [&quot;pump_&quot;, &quot;chw_pri_pump_&quot;, &quot;chw_sec_pump_&quot;, &quot;cw_pump_&quot;],
            &quot;cooling_tower&quot;: [&quot;ct_&quot;, &quot;cooling_tower_&quot;],
            &quot;ahu&quot;: [&quot;ahu_&quot;]
        }

        prefixes = prefix_map.get(equipment_type, [])
        return [
            name for name in self._annotations.keys()
            if any(name.startswith(p) for p in prefixes)
        ]

    def get_target_columns(self) -&gt; List[str]:
        &quot;&quot;&quot;å–å¾—æ‰€æœ‰ç›®æ¨™è®Šæ•¸æ¬„ä½ï¼ˆis_target=Trueï¼‰&quot;&quot;&quot;
        return [
            name for name, anno in self._annotations.items() 
            if anno.is_target
        ]

    def get_columns_by_role(self, role: str) -&gt; List[str]:
        &quot;&quot;&quot;
        ä¾è¨­å‚™è§’è‰²å–å¾—æ¬„ä½æ¸…å–®

        Args:
            role: &quot;primary&quot;, &quot;backup&quot;, æˆ– &quot;seasonal&quot;
        &quot;&quot;&quot;
        return [
            name for name, anno in self._annotations.items()
            if anno.device_role == role
        ]

    def get_electrical_columns(self) -&gt; Dict[str, List[str]]:
        &quot;&quot;&quot;
        å–å¾—æ‰€æœ‰é›»åŠ›ç›¸é—œæ¬„ä½åˆ†é¡ï¼ˆé›»æµã€é›»å£“ã€åŠŸç‡ã€åŠŸç‡å› æ•¸ï¼‰

        Returns:
            {
                &quot;power&quot;: [&quot;chiller_01_kw&quot;, ...],
                &quot;current&quot;: [&quot;chiller_01_a&quot;, ...],
                &quot;voltage&quot;: [&quot;chiller_01_v&quot;, ...],
                &quot;pf&quot;: [&quot;chiller_01_pf&quot;, ...],
                &quot;energy&quot;: [&quot;chiller_01_kwh&quot;, ...]
            }
        &quot;&quot;&quot;
        electrical_types = [&quot;power&quot;, &quot;current&quot;, &quot;voltage&quot;, &quot;power_factor&quot;, &quot;energy&quot;]
        return {
            ptype: [
                name for name, anno in self._annotations.items()
                if anno.physical_type == ptype
            ]
            for ptype in electrical_types
        }

    # ==================== Equipment Validation API ====================

    def get_equipment_constraints(self, phase: Optional[str] = None) -&gt; List[EquipmentConstraint]:
        &quot;&quot;&quot;
        å–å¾—è¨­å‚™é‚è¼¯é™åˆ¶æ¢ä»¶ï¼ˆå°é½Š Interface Contract v1.1 ç¬¬ 11 ç« ï¼‰

        Args:
            phase: ç¯©é¸æª¢æŸ¥éšæ®µ (&quot;precheck&quot; æˆ– &quot;optimization&quot;)ï¼ŒNone å‰‡å›å‚³å…¨éƒ¨

        Returns:
            EquipmentConstraint ç‰©ä»¶åˆ—è¡¨
        &quot;&quot;&quot;
        constraints = list(self._constraints.values())
        if phase:
            constraints = [c for c in constraints if c.check_phase == phase]
        return constraints

    def get_constraints_for_column(self, column_name: str) -&gt; List[EquipmentConstraint]:
        &quot;&quot;&quot;
        å–å¾—é©ç”¨æ–¼ç‰¹å®šæ¬„ä½çš„é™åˆ¶æ¢ä»¶

        é‚è¼¯ï¼š
        - æª¢æŸ¥æ¬„ä½æ˜¯å¦ç‚º trigger_status æˆ– required_status çš„æˆå“¡
        - æª¢æŸ¥æ¬„ä½çš„ device_role æ˜¯å¦åœ¨ applicable_roles ä¸­
        &quot;&quot;&quot;
        anno = self._annotations.get(column_name)
        if not anno:
            return []

        applicable = []
        for const in self._constraints.values():
            involved = False
            if const.trigger_status and column_name in const.trigger_status:
                involved = True
            if const.required_status and column_name in const.required_status:
                involved = True

            if involved and anno.device_role in const.applicable_roles:
                applicable.append(const)

        return applicable

    def get_interlock_constraints_for_equipment(self, equipment_id: str) -&gt; List[EquipmentConstraint]:
        &quot;&quot;&quot;
        å–å¾—ç‰¹å®šè¨­å‚™çš„äº’é–é™åˆ¶ï¼ˆHVAC å°ˆç”¨ï¼‰

        Args:
            equipment_id: è¨­å‚™ IDï¼ˆå¦‚ &quot;CH-01&quot;ï¼‰
        &quot;&quot;&quot;
        columns = self._equipment_map.get(equipment_id, [])
        constraints = []

        for col in columns:
            col_constraints = self.get_constraints_for_column(col)
            # ç¯©é¸äº’é–é¡å‹ï¼ˆrequires, mutexï¼‰
            interlocks = [c for c in col_constraints if c.check_type in ['requires', 'mutex']]
            constraints.extend(interlocks)

        return constraints

    def validate_monotonic_energy(self, df: pl.DataFrame) -&gt; List[dict]:
        &quot;&quot;&quot;
        é©—è­‰ç´¯ç©ç”¨é›»é‡ï¼ˆkWhï¼‰æ˜¯å¦å–®èª¿éå¢ï¼ˆE351 éŒ¯èª¤ç¢¼ï¼‰

        Returns:
            é•åå–®èª¿æ€§çš„æ¬„ä½åˆ—è¡¨ï¼ˆå«è©³ç´°è³‡è¨Šï¼‰
        &quot;&quot;&quot;
        violations = []
        energy_cols = [
            name for name, anno in self._annotations.items()
            if anno.physical_type == &quot;energy&quot;
        ]

        for col in energy_cols:
            if col in df.columns:
                diff = df[col].diff()
                significant_drop = (diff &lt; -0.01).sum()

                if significant_drop &gt; 0:
                    violations.append({
                        &quot;column&quot;: col,
                        &quot;drops_count&quot;: int(significant_drop),
                        &quot;error_code&quot;: &quot;E351&quot;,
                        &quot;message&quot;: f&quot;ç´¯ç©ç”¨é›»é‡ {col} ç™¼ç”Ÿéé æœŸéæ¸›ï¼Œå¯èƒ½é›»è¡¨æ•…éšœæˆ–é‡ç½®&quot;
                    })

        return violations

    def get_efficiency_baseline(self, chiller_id: str) -&gt; Dict[str, float]:
        &quot;&quot;&quot;
        å–å¾—ç‰¹å®šä¸»æ©Ÿçš„æ•ˆç‡åŸºæº–ç¯„åœï¼ˆä¾› Cleaner ç•°å¸¸æª¢æ¸¬ä½¿ç”¨ï¼‰

        Returns:
            {&quot;cop_min&quot;: 3.0, &quot;cop_max&quot;: 6.0, &quot;kw_per_rt_max&quot;: 1.2}
        &quot;&quot;&quot;
        ptype_config = self._cache.get(&quot;physical_types&quot;, {}).get(&quot;efficiency&quot;, {})
        mean_range = ptype_config.get(&quot;distribution_check&quot;, {}).get(&quot;expected_mean_range&quot;, [3.0, 6.0])

        return {
            &quot;cop_min&quot;: mean_range[0],
            &quot;cop_max&quot;: mean_range[1],
            &quot;kw_per_rt_max&quot;: 3.517 / mean_range[0]
        }

    # ==================== æ™‚é–“åŸºæº–æ•´åˆ ====================

    def get_temporal_baseline(self) -&gt; Optional[datetime]:
        &quot;&quot;&quot;
        å–å¾— Pipeline æ™‚é–“åŸºæº–ï¼ˆå°é½Š Interface Contract ç¬¬8ç« ï¼‰

        Returns:
            pipeline_origin_timestamp (datetime)
        &quot;&quot;&quot;
        if self.temporal_context:
            return self.temporal_context.get_baseline()
        return None

    def is_future_data(self, timestamp: datetime, tolerance_minutes: int = 5) -&gt; bool:
        &quot;&quot;&quot;
        åˆ¤æ–·æ™‚é–“æˆ³æ˜¯å¦ç‚ºæœªä¾†è³‡æ–™ï¼ˆä½¿ç”¨ TemporalContextï¼‰

        Args:
            timestamp: å¾…æª¢æŸ¥æ™‚é–“æˆ³
            tolerance_minutes: å®¹è¨±èª¤å·®ï¼ˆé è¨­5åˆ†é˜ï¼‰

        Returns:
            bool: æ˜¯å¦ç‚ºæœªä¾†è³‡æ–™
        &quot;&quot;&quot;
        if not self.temporal_context:
            raise RuntimeError(&quot;E000: TemporalContext æœªåˆå§‹åŒ–&quot;)

        return self.temporal_context.is_future(timestamp, tolerance_minutes)

    # ==================== ç¦æ­¢å¯«å…¥é˜²è­· ====================

    def __setattr__(self, name, value):
        &quot;&quot;&quot;ç¦æ­¢å‹•æ…‹ä¿®æ”¹å±¬æ€§ï¼ˆE500 é˜²è­·ï¼‰&quot;&quot;&quot;
        if name.startswith('_') or name in ['site_id', 'config_path', 'temporal_context']:
            super().__setattr__(name, value)
        else:
            raise PermissionError(
                f&quot;E500: FeatureAnnotationManager ç‚ºå”¯è®€ä»‹é¢ï¼Œ&quot;
                f&quot;ç¦æ­¢ä¿®æ”¹å±¬æ€§ '{name}'ã€‚è«‹ä½¿ç”¨ Excel ç·¨è¼¯å¾Œé‡æ–°ç”Ÿæˆ YAMLã€‚&quot;
            )

    def save(self, *args, **kwargs):
        &quot;&quot;&quot;æ˜ç¢ºç¦æ­¢å„²å­˜æ“ä½œï¼ˆE501 é˜²è­·ï¼‰&quot;&quot;&quot;
        raise NotImplementedError(
            &quot;E501: ç¦æ­¢é€é FeatureAnnotationManager å„²å­˜è®Šæ›´ã€‚&quot;
            &quot;æ­£ç¢ºæµç¨‹: Excel â†’ excel_to_yaml.py â†’ Git Commit&quot;
        )
</code></pre>
<hr />
<h2 id="9-header-standardization-csv">9. Header Standardization è¦ç¯„ï¼ˆCSV æ¨™é ­æ­£è¦åŒ–ï¼‰</h2>
<h3 id="91">9.1 å•é¡Œå®šç¾©èˆ‡å¯¦ä½œ</h3>
<p>CSV æª”æ¡ˆçš„æ¨™é ­ï¼ˆæ¬„ä½åç¨±ï¼‰å¸¸åŒ…å«ä¸ä¸€è‡´çš„å‘½åï¼ˆå¦‚ <code>Chiller 1 Temp</code>ã€<code>power(kW)</code>ã€<code>sensor-A</code>ï¼‰ï¼Œå°è‡´èˆ‡ Feature Annotation ä¸­å®šç¾©çš„ <code>column_name</code> ç„¡æ³•åŒ¹é…ã€‚ç‚ºè§£æ±ºæ­¤å•é¡Œï¼Œå»ºç«‹è‡ªå‹•æ­£è¦åŒ–æ©Ÿåˆ¶ã€‚</p>
<h3 id="92-regex-based">9.2 æ­£è¦åŒ–è¦å‰‡ (Regex-based)</h3>
<p><strong>æ¨™æº–å‘½åè¦ç¯„</strong>: <code>snake_case</code>ï¼Œåƒ…å…è¨±å°å¯«è‹±æ–‡å­—æ¯ã€æ•¸å­—ã€åº•ç·šã€‚</p>
<p><strong>æ­£è¦åŒ–æµç¨‹</strong>ï¼ˆå°é½Š Interface Contract ç¬¬10ç« ï¼‰:</p>
<pre><code class="language-python"># src/etl/header_standardizer.py
import re
from typing import List, Tuple

class HeaderStandardizer:
    &quot;&quot;&quot;
    CSV æ¨™é ­æ­£è¦åŒ–å™¨ï¼ˆå°é½Š Interface Contract v1.1 ç¬¬10ç« ï¼‰

    å¯¦ä½œ HEADER_STANDARDIZATION_RULES çš„å…·é«”æ­£è¦åŒ–é‚è¼¯
    &quot;&quot;&quot;

    RULES: List[Tuple[str, str]] = [
        # æ­¥é©Ÿ 1: ç§»é™¤å‰å¾Œç©ºç™½
        (r'^\s+|\s+$', ''),

        # æ­¥é©Ÿ 2: å°‡ camelCase/PascalCase è½‰æ›ç‚º snake_case
        # æ’å…¥åº•ç·šåœ¨å¤§å¯«å­—æ¯å‰ï¼Œç„¶å¾Œè½‰å°å¯«
        (r'(?&lt;=[a-z0-9])(?=[A-Z])', '_'),      # åœ¨å°å¯«/æ•¸å­—å¾Œçš„å¤§å¯«å‰æ’å…¥åº•ç·š
        (r'(?&lt;=[A-Z])(?=[A-Z][a-z])', '_'),    # åœ¨é€£çºŒå¤§å¯«ä¸­çš„ç¬¬äºŒå€‹å¤§å¯«å‰æ’å…¥åº•ç·š

        # æ­¥é©Ÿ 3: æ›¿æ›éæ³•å­—å…ƒç‚ºåº•ç·š
        (r'[^a-zA-Z0-9_]', '_'),               # éå­—æ¯æ•¸å­—åº•ç·šçš„å­—å…ƒæ›¿æ›ç‚ºåº•ç·š

        # æ­¥é©Ÿ 4: åˆä½µé€£çºŒåº•ç·š
        (r'_+', '_'),

        # æ­¥é©Ÿ 5: ç§»é™¤é–‹é ­æ•¸å­—ï¼ˆPython è®Šæ•¸é™åˆ¶ï¼‰
        (r'^[0-9]+', 'col_'),

        # æ­¥é©Ÿ 6: è½‰æ›ç‚ºå°å¯«ï¼ˆé€éæ¨™èªŒè™•ç†ï¼‰
    ]

    def standardize(self, header: str) -&gt; str:
        &quot;&quot;&quot;
        å°‡ CSV æ¨™é ­æ­£è¦åŒ–ç‚º snake_case

        Args:
            header: åŸå§‹æ¨™é ­å­—ä¸²

        Returns:
            æ­£è¦åŒ–å¾Œçš„æ¨™é ­ï¼ˆsnake_caseï¼‰

        Raises:
            HeaderStandardizationError: è‹¥æ­£è¦åŒ–å¾Œä»ä¸ç¬¦åˆè¦å‰‡ï¼ˆE105ï¼‰
        &quot;&quot;&quot;
        result = header

        # å¥—ç”¨ Regex è¦å‰‡
        for pattern, replacement in self.RULES:
            result = re.sub(pattern, replacement, result)

        # è½‰æ›ç‚ºå°å¯«
        result = result.lower()

        # æœ€çµ‚é©—è­‰
        if not result or result == '_' or not re.match(r'^[a-z][a-z0-9_]*$', result):
            raise HeaderStandardizationError(
                f&quot;E105: æ¨™é ­ '{header}' ç„¡æ³•æ­£è¦åŒ–ç‚ºæœ‰æ•ˆè­˜åˆ¥ç¬¦ï¼Œçµæœ: '{result}'&quot;
            )

        # æª¢æŸ¥ä¿ç•™é—œéµå­—ï¼ˆé¿å…èˆ‡ Python å…§å»ºè¡çªï¼‰
        if result in ['class', 'def', 'if', 'else', 'for', 'while', 'timestamp']:
            result = f&quot;{result}_col&quot;

        return result

    def standardize_headers(self, headers: List[str]) -&gt; dict:
        &quot;&quot;&quot;
        æ‰¹æ¬¡æ­£è¦åŒ–æ¨™é ­ä¸¦å›å‚³æ˜ å°„è¡¨

        Returns:
            Dict[åŸå§‹æ¨™é ­, æ­£è¦åŒ–å¾Œæ¨™é ­]
        &quot;&quot;&quot;
        mapping = {}
        standardized_set = set()

        for header in headers:
            if header == 'timestamp':
                mapping[header] = header
                standardized_set.add(header)
                continue

            standardized = self.standardize(header)

            # æª¢æŸ¥æ­£è¦åŒ–å¾Œé‡è¤‡ï¼ˆE105 é¢¨éšªï¼‰
            if standardized in standardized_set:
                raise HeaderStandardizationError(
                    f&quot;E105: æ­£è¦åŒ–å¾Œç”¢ç”Ÿé‡è¤‡æ¨™é ­: '{standardized}' &quot;
                    f&quot;ï¼ˆåŸå§‹: '{header}' èˆ‡ '{[k for k, v in mapping.items() if v == standardized][0]}'ï¼‰&quot;
                )

            mapping[header] = standardized
            standardized_set.add(standardized)

        return mapping
</code></pre>
<h3 id="93">9.3 å¸¸è¦‹æ¨™é ­è½‰æ›ç¯„ä¾‹</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">åŸå§‹æ¨™é ­</th>
<th style="text-align: left;">æ­£è¦åŒ–çµæœ</th>
<th style="text-align: left;">èªªæ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>Chiller 1 Temp</code></td>
<td style="text-align: left;"><code>chiller_1_temp</code></td>
<td style="text-align: left;">ç©ºæ ¼è½‰åº•ç·šï¼Œå¤§å¯«è½‰å°å¯«</td>
</tr>
<tr>
<td style="text-align: left;"><code>power(kW)</code></td>
<td style="text-align: left;"><code>power_kw</code></td>
<td style="text-align: left;">ç§»é™¤æ‹¬è™Ÿï¼Œä¿ç•™å­—æ¯æ•¸å­—</td>
</tr>
<tr>
<td style="text-align: left;"><code>sensor-A</code></td>
<td style="text-align: left;"><code>sensor_a</code></td>
<td style="text-align: left;">é€£å­—è™Ÿè½‰åº•ç·š</td>
</tr>
<tr>
<td style="text-align: left;"><code>HTTPRequest</code></td>
<td style="text-align: left;"><code>http_request</code></td>
<td style="text-align: left;">PascalCase è½‰ snake_case</td>
</tr>
<tr>
<td style="text-align: left;"><code>Total_Power</code></td>
<td style="text-align: left;"><code>total_power</code></td>
<td style="text-align: left;">å¤§å¯«è½‰å°å¯«</td>
</tr>
<tr>
<td style="text-align: left;"><code>123_sensor</code></td>
<td style="text-align: left;"><code>col_123_sensor</code></td>
<td style="text-align: left;">é–‹é ­æ•¸å­—å‰ç¶´ <code>col_</code></td>
</tr>
<tr>
<td style="text-align: left;"><code>Temp..Value</code></td>
<td style="text-align: left;"><code>temp_value</code></td>
<td style="text-align: left;">åˆä½µé€£çºŒåº•ç·š</td>
</tr>
</tbody>
</table>
<h3 id="94-parser">9.4 Parser æ•´åˆè¦ç¯„</h3>
<p><strong>åŸ·è¡Œæ™‚æ©Ÿ</strong>: Parser è®€å– CSV å¾Œã€å»ºç«‹ DataFrame å‰ï¼Œå¿…é ˆåŸ·è¡Œæ¨™é ­æ­£è¦åŒ–ã€‚</p>
<pre><code class="language-python">class ReportParser:
    def __init__(self, temporal_context: TemporalContext):
        self.temporal_context = temporal_context
        self.header_standardizer = HeaderStandardizer()
        self.logger = logging.getLogger(__name__)

    def parse_csv(self, filepath: Path) -&gt; pl.DataFrame:
        # è®€å–åŸå§‹ CSVï¼ˆä¸æŒ‡å®šæ¬„ä½åç¨±ï¼‰
        raw_df = pl.read_csv(filepath, n_rows=5)
        original_headers = raw_df.columns

        # åŸ·è¡Œæ¨™é ­æ­£è¦åŒ–
        try:
            header_mapping = self.header_standardizer.standardize_headers(original_headers)
        except HeaderStandardizationError as e:
            self.logger.error(f&quot;E105: {e}&quot;)
            raise

        # è¨˜éŒ„æ­£è¦åŒ–æ˜ å°„ä¾›é™¤éŒ¯
        for orig, std in header_mapping.items():
            if orig != std:
                self.logger.info(f&quot;E105-Warning: æ¨™é ­æ­£è¦åŒ–: '{orig}' â†’ '{std}'&quot;)

        # é‡æ–°è®€å–ä¸¦å¥—ç”¨æ­£è¦åŒ–æ¨™é ­
        df = pl.read_csv(filepath)
        df = df.rename(header_mapping)

        # é©—è­‰ timestamp æ¬„ä½å­˜åœ¨
        if 'timestamp' not in df.columns:
            raise ValueError(&quot;E003: ç¼ºå°‘å¿…è¦æ¬„ä½ 'timestamp'&quot;)

        # è½‰æ›æ™‚é–“æˆ³æ ¼å¼ï¼ˆå°é½Š Interface Contract ç¬¬4ç« ï¼‰
        df = df.with_columns(
            pl.col('timestamp').str.to_datetime().dt.cast_time_unit('ns').dt.replace_time_zone('UTC')
        )

        return df
</code></pre>
<h3 id="95-feature-annotation">9.5 èˆ‡ Feature Annotation çš„å°æ¥</h3>
<p>æ­£è¦åŒ–å¾Œçš„æ¨™é ­å¿…é ˆèˆ‡ Annotation YAML ä¸­çš„ <code>column_name</code> å®Œå…¨åŒ¹é…ï¼š</p>
<pre><code class="language-python">def validate_header_annotation_match(
    standardized_headers: List[str], 
    annotation_manager: FeatureAnnotationManager
) -&gt; None:
    &quot;&quot;&quot;
    é©—è­‰æ­£è¦åŒ–å¾Œçš„æ¨™é ­èˆ‡ Annotation å®šç¾©åŒ¹é…ï¼ˆæª¢æŸ¥é» #6 å»¶ä¼¸ï¼‰

    Raises:
        E409: è‹¥å­˜åœ¨ç„¡æ³•åŒ¹é…çš„æ¨™é ­
    &quot;&quot;&quot;
    unannotated = []
    for header in standardized_headers:
        if not annotation_manager.is_column_annotated(header):
            unannotated.append(header)

    if unannotated:
        raise AnnotationSyncError(
            f&quot;E409: CSV æ¨™é ­ï¼ˆæ­£è¦åŒ–å¾Œï¼‰ç„¡æ³•å°æ‡‰è‡³ Annotation: {unannotated}ã€‚ &quot;
            f&quot;è«‹ç¢ºèª Excel æ¨™è¨»ä¸­çš„ column_name æ˜¯å¦èˆ‡æ­£è¦åŒ–çµæœä¸€è‡´ï¼Œ&quot;
            f&quot;æˆ–åŸ·è¡Œ features wizard é€²è¡Œæ¨™è¨»ã€‚&quot;
        )
</code></pre>
<hr />
<h2 id="10-temporal-baseline">10. Temporal Baseline å‚³éè¦ç¯„ï¼ˆæ™‚é–“åŸºæº–é˜²è­·ï¼‰</h2>
<h3 id="101">10.1 æ ¸å¿ƒæ©Ÿåˆ¶</h3>
<p>ç‚ºè§£æ±ºã€ŒPipeline åŸ·è¡ŒæœŸé–“æ™‚é–“æ¼‚ç§»å°è‡´æœªä¾†è³‡æ–™èª¤åˆ¤ã€å•é¡Œï¼ˆåŸ E102/E205 é¢¨éšªï¼‰ï¼Œå»ºç«‹ä»¥ä¸‹æ©Ÿåˆ¶ï¼š</p>
<p><strong>æ™‚é–“åŸºæº–ç”¢ç”Ÿ</strong>ï¼š<br />
- <strong>æ™‚æ©Ÿ</strong>: <code>Container.__init__</code> åˆå§‹åŒ–æ™‚ï¼ˆç¬¬ä¸€å€‹å‹•ä½œï¼Œæ—©æ–¼ä»»ä½•æ¨¡çµ„åˆå§‹åŒ–ï¼‰<br />
- <strong>æ ¼å¼</strong>: ISO 8601 UTC (e.g., <code>2026-02-13T10:00:00.000000000Z</code>)<br />
- <strong>å„²å­˜</strong>: <code>TemporalContext</code> ç‰©ä»¶ï¼ˆThread-safe Singletonï¼‰</p>
<pre><code class="language-python"># src/features/temporal_context.py
import threading
from datetime import datetime, timedelta, timezone
from typing import Optional

class TemporalContext:
    &quot;&quot;&quot;
    å…¨åŸŸæ™‚é–“åŸºæº–å®¹å™¨ï¼ˆå–®ä¾‹æ¨¡å¼ï¼‰ï¼ˆå°é½Š Interface Contract v1.1 ç¬¬8ç« ï¼‰

    æ‰€æœ‰ã€Œæœªä¾†è³‡æ–™æª¢æŸ¥ã€èˆ‡ã€Œæ™‚é–“ç›¸é—œé©—è­‰ã€å¿…é ˆä½¿ç”¨æ­¤åŸºæº–ï¼Œ
    è€Œéæ¨¡çµ„åŸ·è¡Œæ™‚çš„å‹•æ…‹ datetime.now()ï¼Œä»¥é˜²æ­¢é•·æ™‚é–“åŸ·è¡Œæµç¨‹ä¸­çš„æ™‚é–“æ¼‚ç§»ã€‚
    &quot;&quot;&quot;

    _instance = None
    _lock = threading.Lock()

    def __new__(cls):
        if cls._instance is None:
            with cls._lock:
                if cls._instance is None:
                    cls._instance = super().__new__(cls)
                    cls._instance.origin_timestamp = datetime.now(timezone.utc)
                    cls._instance.baseline_version = &quot;1.0&quot;
                    cls._instance._initialized = True
        return cls._instance

    @classmethod
    def reset_for_testing(cls):
        &quot;&quot;&quot;åƒ…ä¾›å–®å…ƒæ¸¬è©¦ä½¿ç”¨ï¼Œé‡ç½®æ™‚é–“åŸºæº–&quot;&quot;&quot;
        with cls._lock:
            cls._instance = None

    def get_baseline(self) -&gt; datetime:
        &quot;&quot;&quot;å–å¾— Pipeline å•Ÿå‹•æ™‚é–“æˆ³ï¼ˆUTCï¼‰&quot;&quot;&quot;
        return self.origin_timestamp

    def get_baseline_iso(self) -&gt; str:
        &quot;&quot;&quot;å–å¾— ISO 8601 æ ¼å¼çš„æ™‚é–“åŸºæº–&quot;&quot;&quot;
        return self.origin_timestamp.isoformat()

    def is_future(self, timestamp: datetime, tolerance_minutes: int = 5) -&gt; bool:
        &quot;&quot;&quot;
        åˆ¤æ–·æ™‚é–“æˆ³æ˜¯å¦ç‚ºã€Œæœªä¾†è³‡æ–™ã€

        æ¨™æº–ï¼štimestamp &gt; origin_timestamp + tolerance_minutes

        Args:
            timestamp: å¾…æª¢æŸ¥æ™‚é–“æˆ³ï¼ˆå¿…é ˆå«æ™‚å€è³‡è¨Šï¼‰
            tolerance_minutes: å®¹è¨±èª¤å·®ï¼ˆé è¨­5åˆ†é˜ï¼Œè€ƒé‡è³‡æ–™å‚³è¼¸å»¶é²ï¼‰

        Returns:
            bool: True è‹¥ç‚ºæœªä¾†è³‡æ–™
        &quot;&quot;&quot;
        if timestamp.tzinfo is None:
            raise ValueError(&quot;æ™‚é–“æˆ³å¿…é ˆå«æ™‚å€è³‡è¨Š&quot;)

        threshold = self.origin_timestamp + timedelta(minutes=tolerance_minutes)
        return timestamp &gt; threshold

    def get_elapsed_minutes(self) -&gt; float:
        &quot;&quot;&quot;å–å¾— Pipeline å·²åŸ·è¡Œæ™‚é–“ï¼ˆç”¨æ–¼æ¼‚ç§»æª¢æ¸¬ï¼‰&quot;&quot;&quot;
        return (datetime.now(timezone.utc) - self.origin_timestamp).total_seconds() / 60

    def check_drift_warning(self) -&gt; Optional[str]:
        &quot;&quot;&quot;
        æª¢æŸ¥æ™‚é–“æ¼‚ç§»è­¦å‘Šï¼ˆE000-Wï¼‰

        Returns:
            è­¦å‘Šè¨Šæ¯è‹¥åŸ·è¡Œè¶…é 1 å°æ™‚ï¼Œå¦å‰‡ None
        &quot;&quot;&quot;
        elapsed = self.get_elapsed_minutes()
        if elapsed &gt; 60:
            return f&quot;E000-W: Pipeline åŸ·è¡Œæ™‚é–“éé•· ({elapsed:.1f} åˆ†é˜)ï¼Œè«‹æª¢æŸ¥æ™‚é–“åŸºæº–ä¸€è‡´æ€§&quot;
        return None

    def to_metadata(self) -&gt; dict:
        &quot;&quot;&quot;è½‰æ›ç‚ºå„²å­˜ç”¨çš„ metadata æ ¼å¼&quot;&quot;&quot;
        return {
            &quot;pipeline_origin_timestamp&quot;: self.get_baseline_iso(),
            &quot;baseline_version&quot;: self.baseline_version,
            &quot;timezone&quot;: &quot;UTC&quot;,
            &quot;time_unit&quot;: &quot;nanoseconds&quot;
        }
</code></pre>
<h3 id="102">10.2 å„æ¨¡çµ„å¯¦ä½œè¦ç¯„</h3>
<p><strong>Parser</strong>:<br />
- æ¥æ”¶ <code>TemporalContext</code>ï¼Œåœ¨è¼¸å‡º metadata ä¸­è¨˜éŒ„ <code>pipeline_origin_timestamp</code><br />
- é©—è­‰é‚è¼¯ï¼šè‹¥è¼¸å…¥è³‡æ–™æ™‚é–“ &gt; <code>context.get_baseline() + 5min</code>ï¼Œæ‹‹å‡º E102<br />
- <strong>å¼·åŒ–</strong>: è‹¥ <code>context.get_elapsed_minutes() &gt; 60</code>ï¼Œè¨˜éŒ„ E000-W è­¦å‘Š</p>
<p><strong>Cleaner</strong>:<br />
- å¾è¼¸å…¥ metadata è®€å– <code>pipeline_origin_timestamp</code>ï¼Œå‚³éè‡³è¼¸å‡º<br />
- é©—è­‰é‚è¼¯ï¼šæ¸…æ´—å¾Œè³‡æ–™æ™‚é–“ä¸å¯è¶…éåŸºæº–+5åˆ†é˜ï¼ˆE102ï¼‰<br />
- <strong>å¼·åŒ–</strong>: è‹¥å•Ÿç”¨ <code>enforce_equipment_validation_sync</code>ï¼Œåœ¨æ™‚é–“æª¢æŸ¥å¾ŒåŸ·è¡Œè¨­å‚™é‚è¼¯é æª¢</p>
<p><strong>BatchProcessor</strong>:<br />
- å°‡ <code>temporal_baseline</code> å¯«å…¥ Manifestï¼ˆè¦‹ç¬¬2.3ç¯€ Manifest å¥‘ç´„ï¼‰<br />
- æ‰¹æ¬¡é©—è­‰ï¼šæ•´å€‹æ‰¹æ¬¡æ™‚é–“ç¯„åœä¸å¯è¶…éåŸºæº–+5åˆ†é˜ï¼ˆE205ï¼‰<br />
- <strong>å¼·åŒ–</strong>: è¨˜éŒ„ <code>baseline_version</code> è‡³ Manifestï¼Œä¾›ä¸‹æ¸¸ç›¸å®¹æ€§æª¢æŸ¥</p>
<p><strong>FeatureAnnotationManager</strong>:<br />
- åˆå§‹åŒ–æ™‚æ¥æ”¶ <code>TemporalContext</code>ï¼ˆè¦‹ç¬¬8.1ç¯€ï¼‰<br />
- æä¾› <code>is_future_data()</code> æ–¹æ³•ä¾› Cleaner å‘¼å«ï¼ˆè¦‹ç¬¬8.2ç¯€ï¼‰<br />
- <strong>ç¦æ­¢</strong>: ä½¿ç”¨ <code>datetime.now()</code> é€²è¡Œæœªä¾†è³‡æ–™æª¢æŸ¥</p>
<p><strong>FeatureEngineer â†’ Model Training</strong>:<br />
- ç‰¹å¾µçŸ©é™£ metadata å¿…é ˆåŒ…å« <code>pipeline_origin_timestamp</code>ï¼ˆç”¨æ–¼è¿½æº¯ï¼‰<br />
- <strong>æ³¨æ„</strong>: Training éšæ®µä¸ç›´æ¥ä½¿ç”¨æ­¤æ™‚é–“æˆ³é€²è¡Œã€Œæœªä¾†æª¢æŸ¥ã€ï¼Œä½†å¿…é ˆå‚³éè‡³æ¨¡å‹ç”¢ç‰©<br />
- <strong>å¼·åŒ–</strong>: è¨˜éŒ„ç‰¹å¾µå·¥ç¨‹åŸ·è¡Œæ™‚é–“èˆ‡åŸºæº–æ™‚é–“çš„å·®ç•°ï¼ˆç”¨æ–¼æ•ˆèƒ½åˆ†æï¼‰</p>
<p><strong>Optimization</strong>:<br />
- <strong>ç”¢ç”Ÿæ–°åŸºæº–</strong>: Optimization éšæ®µå¿…é ˆç”¢ç”Ÿæ–°çš„ <code>pipeline_origin_timestamp</code>ï¼ˆæ¨è«–ç•¶ä¸‹æ™‚é–“ï¼‰<br />
- <strong>ä¸å¯æ²¿ç”¨ Training æ™‚é–“</strong>: é˜²æ­¢ã€Œè¨“ç·´æ™‚çš„æœªä¾†è³‡æ–™ã€åœ¨æ¨è«–æ™‚è®Šæˆã€Œéå»è³‡æ–™ã€çš„é‚è¼¯éŒ¯èª¤<br />
- <strong>å¼·åŒ–</strong>: é©—è­‰è¼¸å…¥è³‡æ–™æ™‚é–“ç¯„åœèˆ‡æ–°åŸºæº–çš„åˆç†æ€§</p>
<h3 id="103">10.3 è·¨æ—¥åŸ·è¡Œé˜²è­·</h3>
<p>é‡å°è·¨æ—¥ï¼ˆ00:00 å‰å¾Œï¼‰åŸ·è¡Œçš„ç‰¹æ®Šè™•ç†ï¼š</p>
<pre><code class="language-python">def validate_cross_day_consistency(timestamps: List[datetime], baseline: datetime) -&gt; None:
    &quot;&quot;&quot;
    é©—è­‰è·¨æ—¥åŸ·è¡Œæ™‚çš„æ™‚é–“ä¸€è‡´æ€§

    æª¢æŸ¥é …ç›®ï¼š
    1. æ™‚é–“æˆ³æ˜¯å¦åŒ…å«æ­£ç¢ºæ—¥æœŸï¼ˆé 1970-01-01 ç­‰é è¨­å€¼ï¼‰
    2. æ™‚é–“æˆ³èˆ‡åŸºæº–çš„æ—¥æœŸå·®è·æ˜¯å¦åˆç†ï¼ˆ&lt; 1 å¤©ï¼‰
    &quot;&quot;&quot;
    for ts in timestamps:
        # æª¢æŸ¥æ˜¯å¦ç‚ºç„¡æ•ˆæ—¥æœŸ
        if ts.year &lt; 2020:
            raise ValueError(f&quot;E000: ç„¡æ•ˆæ™‚é–“æˆ³å¹´ä»½: {ts}&quot;)

        # æª¢æŸ¥èˆ‡åŸºæº–å·®è·
        date_diff = abs((ts.date() - baseline.date()).days)
        if date_diff &gt; 1:
            raise ValueError(
                f&quot;E000: æ™‚é–“æˆ³æ—¥æœŸ {ts.date()} èˆ‡åŸºæº– {baseline.date()} å·®è·éå¤§&quot;
            )
</code></pre>
<hr />
<h2 id="11-feature-alignment-scaler-parameters">11. Feature Alignment &amp; Scaler Parameters å‚³éè¦ç¯„</h2>
<h3 id="111">11.1 å•é¡Œå®šç¾©</h3>
<p>ç‚ºè§£æ±ºã€ŒTraining èˆ‡ Optimization ç‰¹å¾µå‘é‡ä¸ä¸€è‡´å°è‡´ Silent Failureã€é¢¨éšªï¼ˆåŸç¬¬3é»å»ºè­°ï¼‰ï¼Œå»ºç«‹ä»¥ä¸‹åš´æ ¼å¥‘ç´„ï¼š</p>
<p><strong>é¢¨éšªå ´æ™¯</strong>ï¼š<br />
- Training: ç‰¹å¾µé †åº <code>[chiller_1_load, chiller_2_load, wb_temp, ...]</code><br />
- Optimization: ç‰¹å¾µé †åº <code>[wb_temp, chiller_1_load, chiller_2_load, ...]</code><br />
- çµæœï¼šæ¨¡å‹å°‡ <code>wb_temp</code> èª¤èªç‚º <code>chiller_2_load</code>ï¼Œå°è‡´é æ¸¬å®Œå…¨éŒ¯èª¤ä½†ç„¡è­¦å‘Š</p>
<h3 id="112-feature-manifest-interface-contract-9">11.2 Feature Manifest è¦æ ¼ï¼ˆå°é½Š Interface Contract ç¬¬9ç« ï¼‰</h3>
<p><strong>è¼¸å‡ºä½ç½®</strong>: <code>ModelTrainer</code> è¼¸å‡ºç›®éŒ„ä¸­çš„ <code>feature_manifest.json</code></p>
<pre><code class="language-json">{
  &quot;manifest_version&quot;: &quot;2.0-ALIGN&quot;,
  &quot;created_at&quot;: &quot;2026-02-13T10:30:00Z&quot;,
  &quot;pipeline_origin_timestamp&quot;: &quot;2026-02-13T10:00:00Z&quot;,

  &quot;feature_specification&quot;: {
    &quot;feature_names&quot;: [&quot;chiller_1_load&quot;, &quot;chiller_2_load&quot;, &quot;wb_temp&quot;, &quot;chwst_temp&quot;],
    &quot;feature_count&quot;: 4,
    &quot;feature_hash&quot;: &quot;sha256:a1b2c3d4...&quot;,
    &quot;hash_algorithm&quot;: &quot;SHA256&quot;,
    &quot;hash_computation&quot;: &quot;sha256(','.join(feature_names).encode())&quot;
  },

  &quot;scaling_specification&quot;: {
    &quot;scaler_type&quot;: &quot;StandardScaler&quot;,
    &quot;scaler_params&quot;: {
      &quot;mean_&quot;: [450.5, 420.3, 28.5, 7.2],
      &quot;scale_&quot;: [120.2, 115.8, 2.1, 0.5],
      &quot;var_&quot;: [14448.04, 13401.64, 4.41, 0.25]
    },
    &quot;scaler_feature_names&quot;: [&quot;chiller_1_load&quot;, &quot;chiller_2_load&quot;, &quot;wb_temp&quot;, &quot;chwst_temp&quot;],
    &quot;scaler_hash&quot;: &quot;sha256:e5f6g7h8...&quot;
  },

  &quot;equipment_constraints&quot;: {
    &quot;constraints_applied&quot;: [&quot;chiller_pump_mutex&quot;, &quot;min_runtime_15min&quot;],
    &quot;validation_enabled&quot;: true,
    &quot;constraint_hash&quot;: &quot;sha256:i9j0k1l2...&quot;
  },

  &quot;validation_rules&quot;: {
    &quot;allow_subset&quot;: false,
    &quot;allow_superset&quot;: false,
    &quot;strict_order&quot;: true,
    &quot;case_sensitive&quot;: true,
    &quot;validate_equipment_constraints&quot;: true
  }
}
</code></pre>
<h3 id="113-python-feature-manifest">11.3 Python å¯¦ä½œï¼ˆFeature Manifest ç”Ÿæˆå™¨ï¼‰</h3>
<pre><code class="language-python"># src/features/feature_manifest.py
import json
import hashlib
from typing import List, Dict, Any, Optional
from pathlib import Path
import numpy as np

class FeatureManifest:
    &quot;&quot;&quot;
    Feature Manifest ç”Ÿæˆèˆ‡é©—è­‰å™¨ï¼ˆå°é½Š Interface Contract v1.1 ç¬¬9ç« ï¼‰

    ç¢ºä¿ Training èˆ‡ Optimization éšæ®µçš„ç‰¹å¾µä¸€è‡´æ€§
    &quot;&quot;&quot;

    def __init__(
        self,
        feature_names: List[str],
        scaler_params: Optional[Dict[str, Any]] = None,
        equipment_constraints: Optional[List[str]] = None,
        pipeline_origin_timestamp: str = &quot;&quot;,
        temporal_context: Optional['TemporalContext'] = None
    ):
        self.feature_names = feature_names
        self.scaler_params = scaler_params or {}
        self.equipment_constraints = equipment_constraints or []
        self.pipeline_origin_timestamp = pipeline_origin_timestamp or (
            temporal_context.get_baseline_iso() if temporal_context else &quot;&quot;
        )

        # è¨ˆç®—é›œæ¹Š
        self.feature_hash = self._compute_hash(','.join(feature_names))
        self.scaler_hash = self._compute_hash(str(scaler_params)) if scaler_params else &quot;&quot;
        self.constraint_hash = self._compute_hash(str(equipment_constraints)) if equipment_constraints else &quot;&quot;

    def _compute_hash(self, content: str) -&gt; str:
        &quot;&quot;&quot;è¨ˆç®— SHA256 é›œæ¹Š&quot;&quot;&quot;
        return f&quot;sha256:{hashlib.sha256(content.encode()).hexdigest()}&quot;

    def to_dict(self) -&gt; dict:
        &quot;&quot;&quot;è½‰æ›ç‚ºå­—å…¸æ ¼å¼&quot;&quot;&quot;
        return {
            &quot;manifest_version&quot;: &quot;2.0-ALIGN&quot;,
            &quot;created_at&quot;: datetime.now(timezone.utc).isoformat(),
            &quot;pipeline_origin_timestamp&quot;: self.pipeline_origin_timestamp,
            &quot;feature_specification&quot;: {
                &quot;feature_names&quot;: self.feature_names,
                &quot;feature_count&quot;: len(self.feature_names),
                &quot;feature_hash&quot;: self.feature_hash,
                &quot;hash_algorithm&quot;: &quot;SHA256&quot;,
                &quot;hash_computation&quot;: &quot;sha256(','.join(feature_names).encode())&quot;
            },
            &quot;scaling_specification&quot;: {
                &quot;scaler_type&quot;: self.scaler_params.get(&quot;type&quot;, &quot;StandardScaler&quot;),
                &quot;scaler_params&quot;: {
                    &quot;mean_&quot;: self.scaler_params.get(&quot;mean_&quot;, []),
                    &quot;scale_&quot;: self.scaler_params.get(&quot;scale_&quot;, []),
                    &quot;var_&quot;: self.scaler_params.get(&quot;var_&quot;, [])
                },
                &quot;scaler_feature_names&quot;: self.scaler_params.get(&quot;feature_names&quot;, []),
                &quot;scaler_hash&quot;: self.scaler_hash
            } if self.scaler_params else None,
            &quot;equipment_constraints&quot;: {
                &quot;constraints_applied&quot;: self.equipment_constraints,
                &quot;validation_enabled&quot;: len(self.equipment_constraints) &gt; 0,
                &quot;constraint_hash&quot;: self.constraint_hash
            },
            &quot;validation_rules&quot;: {
                &quot;allow_subset&quot;: false,
                &quot;allow_superset&quot;: false,
                &quot;strict_order&quot;: true,
                &quot;case_sensitive&quot;: true,
                &quot;validate_equipment_constraints&quot;: true
            }
        }

    def save(self, filepath: Path):
        &quot;&quot;&quot;å„²å­˜è‡³ JSON æª”æ¡ˆ&quot;&quot;&quot;
        with open(filepath, 'w', encoding='utf-8') as f:
            json.dump(self.to_dict(), f, indent=2, ensure_ascii=False)

    @classmethod
    def load(cls, filepath: Path) -&gt; 'FeatureManifest':
        &quot;&quot;&quot;å¾ JSON æª”æ¡ˆè¼‰å…¥&quot;&quot;&quot;
        with open(filepath, 'r', encoding='utf-8') as f:
            data = json.load(f)

        spec = data.get(&quot;feature_specification&quot;, {})
        scaling = data.get(&quot;scaling_specification&quot;, {})

        return cls(
            feature_names=spec.get(&quot;feature_names&quot;, []),
            scaler_params={
                &quot;type&quot;: scaling.get(&quot;scaler_type&quot;),
                &quot;mean_&quot;: scaling.get(&quot;scaler_params&quot;, {}).get(&quot;mean_&quot;),
                &quot;scale_&quot;: scaling.get(&quot;scaler_params&quot;, {}).get(&quot;scale_&quot;),
                &quot;feature_names&quot;: scaling.get(&quot;scaler_feature_names&quot;)
            } if scaling else None,
            equipment_constraints=data.get(&quot;equipment_constraints&quot;, {}).get(&quot;constraints_applied&quot;),
            pipeline_origin_timestamp=data.get(&quot;pipeline_origin_timestamp&quot;)
        )

class FeatureAlignmentValidator:
    &quot;&quot;&quot;
    ç‰¹å¾µå°é½Šé©—è­‰å™¨ï¼ˆæª¢æŸ¥é» #7 å¯¦ä½œï¼‰

    åœ¨ Optimization éšæ®µé©—è­‰è¼¸å…¥ç‰¹å¾µèˆ‡ Training æ™‚çš„ä¸€è‡´æ€§
    &quot;&quot;&quot;

    def __init__(self, manifest: FeatureManifest):
        self.manifest = manifest

    def validate(self, input_features: List[str], input_scaler_params: Optional[dict] = None) -&gt; None:
        &quot;&quot;&quot;
        é©—è­‰è¼¸å…¥ç‰¹å¾µèˆ‡ Manifest çš„ä¸€è‡´æ€§

        Raises:
            FeatureAlignmentError: E901, E902, E903, E904
        &quot;&quot;&quot;
        # E901: ç‰¹å¾µé †åºæ¯”å°
        self._validate_feature_order(input_features)

        # E902: ç‰¹å¾µæ•¸é‡ä¸€è‡´æ€§
        self._validate_feature_count(input_features)

        # E903: ç¸®æ”¾åƒæ•¸å°é½Šï¼ˆè‹¥å­˜åœ¨ï¼‰
        if self.manifest.scaler_params and input_scaler_params:
            self._validate_scaler_params(input_scaler_params)

        # E904: è¨­å‚™é™åˆ¶ä¸€è‡´æ€§
        self._validate_equipment_constraints()

    def _validate_feature_order(self, input_features: List[str]):
        &quot;&quot;&quot;E901: é©—è­‰ç‰¹å¾µé †åºèˆ‡åç¨±å®Œå…¨ä¸€è‡´&quot;&quot;&quot;
        expected = self.manifest.feature_names

        if len(input_features) != len(expected):
            raise FeatureAlignmentError(
                f&quot;E902: ç‰¹å¾µç¶­åº¦ä¸åŒ¹é…: è¨“ç·´æ™‚ {len(expected)} ç¶­ï¼Œè¼¸å…¥ {len(input_features)} ç¶­&quot;
            )

        for i, (exp, inp) in enumerate(zip(expected, input_features)):
            if exp != inp:
                raise FeatureAlignmentError(
                    f&quot;E901: ç‰¹å¾µéŒ¯ä½æ–¼ç´¢å¼• {i}: è¨“ç·´æ™‚ç‚º '{exp}'ï¼Œè¼¸å…¥ç‚º '{inp}'&quot;
                )

        # é›œæ¹Šé©—è­‰ï¼ˆå¯é¸ä½†å»ºè­°ï¼‰
        input_hash = self.manifest._compute_hash(','.join(input_features))
        if input_hash != self.manifest.feature_hash:
            raise FeatureAlignmentError(
                f&quot;E901: ç‰¹å¾µé›œæ¹Šé©—è­‰å¤±æ•—ï¼Œç‰¹å¾µåˆ—è¡¨å¯èƒ½é­ä¿®æ”¹&quot;
            )

    def _validate_feature_count(self, input_features: List[str]):
        &quot;&quot;&quot;E902: é©—è­‰ç‰¹å¾µæ•¸é‡ï¼ˆå†—é¤˜æª¢æŸ¥ï¼‰&quot;&quot;&quot;
        if len(input_features) != self.manifest.feature_count:
            raise FeatureAlignmentError(
                f&quot;E902: ç‰¹å¾µæ•¸é‡ä¸ä¸€è‡´: é æœŸ {self.manifest.feature_count}ï¼Œå¯¦éš› {len(input_features)}&quot;
            )

    def _validate_scaler_params(self, input_params: dict):
        &quot;&quot;&quot;E903: é©—è­‰ç¸®æ”¾åƒæ•¸èˆ‡ç‰¹å¾µé †åºä¸€è‡´&quot;&quot;&quot;
        scaler_features = input_params.get(&quot;feature_names&quot;, [])

        if scaler_features != self.manifest.feature_names:
            raise FeatureAlignmentError(
                &quot;E903: ç¸®æ”¾åƒæ•¸ç‰¹å¾µé †åºèˆ‡è¨“ç·´ç‰¹å¾µé †åºä¸ä¸€è‡´ï¼Œå¯èƒ½å°è‡´ç¸®æ”¾éŒ¯ä½&quot;
            )

        # é©—è­‰æ•¸å€¼é•·åº¦
        mean_len = len(input_params.get(&quot;mean_&quot;, []))
        if mean_len != len(self.manifest.feature_names):
            raise FeatureAlignmentError(
                f&quot;E903: ç¸®æ”¾åƒæ•¸é•·åº¦ {mean_len} èˆ‡ç‰¹å¾µæ•¸ {len(self.manifest.feature_names)} ä¸åŒ¹é…&quot;
            )

    def _validate_equipment_constraints(self):
        &quot;&quot;&quot;E904: é©—è­‰è¨­å‚™é™åˆ¶ä¸€è‡´æ€§&quot;&quot;&quot;
        from src.etl.config_models import EQUIPMENT_VALIDATION_CONSTRAINTS

        current_constraints = set(EQUIPMENT_VALIDATION_CONSTRAINTS.keys())
        train_constraints = set(self.manifest.equipment_constraints)

        if train_constraints != current_constraints:
            raise FeatureAlignmentError(
                f&quot;E904: è¨­å‚™é™åˆ¶ä¸ä¸€è‡´: è¨“ç·´æ™‚ä½¿ç”¨ {train_constraints}ï¼Œ&quot;
                f&quot;ç•¶å‰ä½¿ç”¨ {current_constraints}ã€‚é€™å¯èƒ½å°è‡´å„ªåŒ–çµæœèˆ‡æ¨¡å‹è¨“ç·´æ™‚çš„ç‰©ç†å‡è¨­è¡çªã€‚&quot;
            )
</code></pre>
<h3 id="114-optimization">11.4 å°é½Šé©—è­‰æµç¨‹ï¼ˆOptimization éšæ®µï¼‰</h3>
<pre><code class="language-python"># src/optimization/input_validator.py
def validate_feature_alignment(model_artifact_path: Path, input_features: List[str]):
    &quot;&quot;&quot;
    Optimization éšæ®µç‰¹å¾µå°é½Šé©—è­‰ï¼ˆæª¢æŸ¥é» #7ï¼‰

    Args:
        model_artifact_path: æ¨¡å‹ç”¢ç‰©ç›®éŒ„ï¼ˆå« feature_manifest.jsonï¼‰
        input_features: ç•¶å‰è¼¸å…¥ç‰¹å¾µåç¨±åˆ—è¡¨ï¼ˆä¾é †åºï¼‰

    Raises:
        FeatureAlignmentError: E901-E904
    &quot;&quot;&quot;
    manifest_path = model_artifact_path / &quot;feature_manifest.json&quot;

    if not manifest_path.exists():
        raise FeatureAlignmentError(
            &quot;E901: ç¼ºå°‘ feature_manifest.jsonï¼Œç„¡æ³•é©—è­‰ç‰¹å¾µå°é½Š&quot;
        )

    # è¼‰å…¥ Training æ™‚çš„ Feature Manifest
    manifest = FeatureManifest.load(manifest_path)

    # åŸ·è¡Œé©—è­‰
    validator = FeatureAlignmentValidator(manifest)
    validator.validate(input_features)

    print(&quot;âœ… ç‰¹å¾µå°é½Šé©—è­‰é€šéï¼ˆE901-E904ï¼‰&quot;)
</code></pre>
<hr />
<h2 id="12-interface-contract-5">12. ç‰ˆæœ¬ç›¸å®¹æ€§åˆ¤å®šæ¨™æº–ï¼ˆå°é½Š Interface Contract ç¬¬5ç« ï¼‰</h2>
<h3 id="121">12.1 ç›¸å®¹æ€§ç­‰ç´šå®šç¾©</h3>
<table>
<thead>
<tr>
<th style="text-align: center;">ç­‰ç´š</th>
<th style="text-align: left;">å®šç¾©</th>
<th style="text-align: left;">è¡Œç‚º</th>
<th style="text-align: center;">æ¨™ç¤º</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>å®Œå…¨ç›¸å®¹</strong> (Full Compatible)</td>
<td style="text-align: left;">ä¸Šä¸‹æ¸¸æ¨¡çµ„ç‰ˆæœ¬çµ„åˆé€šéæ‰€æœ‰æª¢æŸ¥é»ï¼Œç„¡éœ€è½‰æ›æˆ–é™ç´š</td>
<td style="text-align: left;">æ­£å¸¸åŸ·è¡Œï¼Œç„¡è­¦å‘Š</td>
<td style="text-align: center;">ğŸŸ¢</td>
</tr>
<tr>
<td style="text-align: center;"><strong>éƒ¨åˆ†ç›¸å®¹</strong> (Partial Compatible)</td>
<td style="text-align: left;">ä¸Šæ¸¸è¼¸å‡ºå¯è¢«ä¸‹æ¸¸è®€å–ï¼Œä½†éƒ¨åˆ†åŠŸèƒ½é™ç´šï¼ˆå¦‚ç¼ºå°‘ audit_trailï¼‰</td>
<td style="text-align: left;">åŸ·è¡Œï¼Œä½†è¨˜éŒ„ Warning</td>
<td style="text-align: center;">ğŸŸ¡</td>
</tr>
<tr>
<td style="text-align: center;"><strong>ä¸ç›¸å®¹</strong> (Incompatible)</td>
<td style="text-align: left;">ä¸Šæ¸¸è¼¸å‡ºç„¡æ³•é€šéä¸‹æ¸¸æª¢æŸ¥é»ï¼Œæˆ–è³‡æ–™èªæ„ä¸ä¸€è‡´</td>
<td style="text-align: left;">æ‹’çµ•åŸ·è¡Œï¼Œæ‹‹å‡ºéŒ¯èª¤</td>
<td style="text-align: center;">ğŸ”´</td>
</tr>
</tbody>
</table>
<h3 id="122">12.2 æ¨¡çµ„ç‰ˆæœ¬ç›¸å®¹æ€§çŸ©é™£</h3>
<table>
<thead>
<tr>
<th style="text-align: center;">Feature Annotation</th>
<th style="text-align: center;">Parser</th>
<th style="text-align: center;">Cleaner</th>
<th style="text-align: center;">BatchProcessor</th>
<th style="text-align: center;">Feature Engineer</th>
<th style="text-align: center;">Model Training</th>
<th style="text-align: center;">Optimization</th>
<th style="text-align: center;">ç›¸å®¹æ€§</th>
<th style="text-align: left;">èªªæ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">v1.3</td>
<td style="text-align: center;">v2.1+</td>
<td style="text-align: center;">v2.2+</td>
<td style="text-align: center;">v1.3+</td>
<td style="text-align: center;">v1.3+</td>
<td style="text-align: center;">v1.2+</td>
<td style="text-align: center;">v1.1+</td>
<td style="text-align: center;">ğŸŸ¢ <strong>å®Œå…¨ç›¸å®¹</strong></td>
<td style="text-align: left;">æ¨è–¦é…ç½®ï¼Œæ”¯æ´ E901-E904ï¼ŒTemporal Baselineï¼ŒEquipment Validation Sync</td>
</tr>
<tr>
<td style="text-align: center;">v1.3</td>
<td style="text-align: center;">v2.1+</td>
<td style="text-align: center;">v2.1</td>
<td style="text-align: center;">v1.3+</td>
<td style="text-align: center;">v1.3+</td>
<td style="text-align: center;">v1.2+</td>
<td style="text-align: center;">v1.1+</td>
<td style="text-align: center;">ğŸ”´ <strong>ä¸ç›¸å®¹</strong></td>
<td style="text-align: left;">Cleaner v2.1 ç¼ºå°‘ Equipment Validation Syncï¼ˆE350 é¢¨éšªï¼‰</td>
</tr>
<tr>
<td style="text-align: center;">v1.3</td>
<td style="text-align: center;">v2.1+</td>
<td style="text-align: center;">v2.2+</td>
<td style="text-align: center;">v1.2</td>
<td style="text-align: center;">v1.3+</td>
<td style="text-align: center;">v1.2+</td>
<td style="text-align: center;">v1.1+</td>
<td style="text-align: center;">ğŸŸ¡ <strong>éƒ¨åˆ†ç›¸å®¹</strong></td>
<td style="text-align: left;">BatchProcessor v1.2 ç¼ºå°‘ temporal_baseline å‚³éï¼ˆE000 é¢¨éšªï¼‰</td>
</tr>
<tr>
<td style="text-align: center;">v1.3</td>
<td style="text-align: center;">v2.1+</td>
<td style="text-align: center;">v2.2+</td>
<td style="text-align: center;">v1.3+</td>
<td style="text-align: center;">v1.2</td>
<td style="text-align: center;">v1.2+</td>
<td style="text-align: center;">v1.1+</td>
<td style="text-align: center;">ğŸŸ¡ <strong>éƒ¨åˆ†ç›¸å®¹</strong></td>
<td style="text-align: left;">Feature Engineer v1.2 ç„¡æ³•è¼¸å‡º Feature Manifestï¼ˆE601 é¢¨éšªï¼‰</td>
</tr>
<tr>
<td style="text-align: center;">v1.2</td>
<td style="text-align: center;">v2.1+</td>
<td style="text-align: center;">v2.2+</td>
<td style="text-align: center;">v1.3+</td>
<td style="text-align: center;">v1.3+</td>
<td style="text-align: center;">v1.2+</td>
<td style="text-align: center;">v1.1+</td>
<td style="text-align: center;">ğŸ”´ <strong>ä¸ç›¸å®¹</strong></td>
<td style="text-align: left;">Feature Annotation v1.2 ç¼ºå°‘ Equipment ID èˆ‡ Constraintsï¼ˆE904 é¢¨éšªï¼‰</td>
</tr>
<tr>
<td style="text-align: center;">v1.3</td>
<td style="text-align: center;">v2.0</td>
<td style="text-align: center;">v2.2+</td>
<td style="text-align: center;">v1.3+</td>
<td style="text-align: center;">v1.3+</td>
<td style="text-align: center;">v1.2+</td>
<td style="text-align: center;">v1.1+</td>
<td style="text-align: center;">ğŸ”´ <strong>ä¸ç›¸å®¹</strong></td>
<td style="text-align: left;">Parser v2.0 ç¼ºå°‘ Header Standardizationï¼ˆE105/E409 é¢¨éšªï¼‰</td>
</tr>
</tbody>
</table>
<h3 id="123">12.3 å¼·åˆ¶å‡ç´šè·¯å¾‘</h3>
<p><strong>ä¸å…è¨±çš„çµ„åˆ</strong>ï¼ˆç³»çµ±å¿…é ˆæ‹’çµ•å•Ÿå‹•ï¼‰ï¼š<br />
1. <strong>Feature Annotation v1.3 + Cleaner v2.1</strong>: ç¼ºå°‘ <code>equipment_id</code> æ”¯æ´èˆ‡ E350 æª¢æŸ¥<br />
2. <strong>Feature Engineer v1.2 + Optimization v1.1</strong>: ç¼ºå°‘ Feature Manifest è¼¸å‡ºï¼Œç„¡æ³•é€šé E901-E903<br />
3. <strong>ä»»æ„çµ„åˆç¼ºå°‘ TemporalContext</strong>: è§¸ç™¼ E000 éŒ¯èª¤</p>
<p><strong>å»ºè­°å‡ç´šé †åº</strong>ï¼š</p>
<pre><code>Feature Annotation v1.3 (åŸºç¤è¨­æ–½ - æœ¬æ–‡ä»¶)
    â†“
Parser v2.1 (ä¸Šæ¸¸è¼¸å‡ºæ¨™æº–åŒ– + Header Standardization)
    â†“
Cleaner v2.2 (è·è²¬åˆ†é›¢å¯¦ä½œ + Equipment Validation Sync + Temporal Baseline æ¥æ”¶)
    â†“
BatchProcessor v1.3 (æ™‚é–“åŸºæº–å‚³é + Audit Trail)
    â†“
FeatureEngineer v1.3 (ç‰¹å¾µé †åºä¿è­‰ E601 + Scaler Parameters E602 + Feature Manifest è¼¸å‡º)
    â†“
Model Training v1.2 (ç¸®æ”¾åƒæ•¸è¼¸å‡º E602 + Model Artifact æ ¼å¼)
    â†“
Optimization v1.1 (ç‰¹å¾µå°é½Šé©—è­‰ E901-E903 + Equipment Constraint Consistency E904 + æ–° Temporal Baseline)
</code></pre>
<hr />
<h2 id="13-equipment-validation-sync-cleaner">13. Equipment Validation Sync å¯¦æ–½ç´°ç¯€ï¼ˆCleaner æ•´åˆï¼‰</h2>
<h3 id="131-cleaner-e350">13.1 Cleaner æ•´åˆè¦ç¯„ï¼ˆE350 å¯¦ä½œï¼‰</h3>
<p>DataCleaner åœ¨æ¸…æ´—éšæ®µåŸ·è¡ŒåŸºç¤è¨­å‚™é‚è¼¯é æª¢ï¼š</p>
<pre><code class="language-python"># src/etl/cleaner.py
class DataCleaner:
    def __init__(
        self, 
        config, 
        annotation_manager: FeatureAnnotationManager,
        temporal_context: TemporalContext,
        equipment_validator: Optional['EquipmentValidator'] = None
    ):
        self.config = config
        self.annotation_manager = annotation_manager
        self.temporal_context = temporal_context
        self.equipment_validator = equipment_validator

        # æª¢æŸ¥æ˜¯å¦å•Ÿç”¨è¨­å‚™é©—è­‰åŒæ­¥
        self.enable_equipment_sync = config.get('enforce_equipment_validation_sync', False)

        # å„²å­˜ç¨½æ ¸è»Œè·¡
        self._equipment_validation_audit = {
            'validation_enabled': False,
            'constraints_applied': [],
            'violations_detected': 0,
            'violation_details': []
        }

    def clean(self, df: pl.DataFrame) -&gt; pl.DataFrame:
        &quot;&quot;&quot;
        ä¸»è¦æ¸…æ´—æµç¨‹ï¼ˆå« Equipment Validation Syncï¼‰
        &quot;&quot;&quot;
        # 1. æ™‚é–“åŸºæº–é©—è­‰ï¼ˆE102ï¼‰
        df = self._validate_temporal_baseline(df)

        # 2. è¨­å‚™é‚è¼¯é æª¢ï¼ˆE350ï¼‰
        if self.enable_equipment_sync:
            df = self._apply_equipment_validation_precheck(df)

        # 3. æ¨™æº–æ¸…æ´—æµç¨‹...
        df = self._apply_standard_cleaning(df)

        # 4. è¨˜éŒ„ç¨½æ ¸è»Œè·¡è‡³ metadata
        self._equipment_validation_audit['validation_enabled'] = self.enable_equipment_sync

        return df

    def _validate_temporal_baseline(self, df: pl.DataFrame) -&gt; pl.DataFrame:
        &quot;&quot;&quot;
        é©—è­‰æ™‚é–“åŸºæº–ï¼ˆE102ï¼‰
        &quot;&quot;&quot;
        if not self.temporal_context:
            raise ValueError(&quot;E000: TemporalContext æœªæä¾›&quot;)

        # æª¢æŸ¥æ™‚é–“æ¼‚ç§»è­¦å‘Š
        drift_warning = self.temporal_context.check_drift_warning()
        if drift_warning:
            self.logger.warning(drift_warning)

        # æª¢æŸ¥æœªä¾†è³‡æ–™
        max_timestamp = df['timestamp'].max()
        if self.temporal_context.is_future(max_timestamp):
            raise ValueError(
                f&quot;E102: è³‡æ–™åŒ…å«æœªä¾†æ™‚é–“æˆ³ {max_timestamp}ï¼Œ&quot;
                f&quot;è¶…éåŸºæº– {self.temporal_context.get_baseline_iso()}&quot;
            )

        return df

    def _apply_equipment_validation_precheck(self, df: pl.DataFrame) -&gt; pl.DataFrame:
        &quot;&quot;&quot;
        è¨­å‚™é‚è¼¯é æª¢ï¼ˆæª¢æŸ¥é» #2 å»¶ä¼¸ - E350ï¼‰

        é‚è¼¯ï¼š
        1. å¾ AnnotationManager è®€å– equipment_constraints (phase=&quot;precheck&quot;)
        2. æª¢æŸ¥æ¯ä¸€æ™‚é–“é»çš„è¨­å‚™ç‹€æ…‹é‚è¼¯
        3. é•åæ™‚æ¨™è¨˜ quality_flagsï¼Œä¸¦è¨˜éŒ„è‡³ metadata
        &quot;&quot;&quot;
        if not self.equipment_validator:
            self.equipment_validator = EquipmentValidator(self.annotation_manager)

        constraints = self.annotation_manager.get_equipment_constraints(phase=&quot;precheck&quot;)
        violations = []

        for constraint in constraints:
            # åŸ·è¡Œæª¢æŸ¥é‚è¼¯
            violated_mask = self.equipment_validator.check_constraint(df, constraint)

            if violated_mask.any():
                violation_count = violated_mask.sum()
                violations.append({
                    'constraint_id': constraint.constraint_id,
                    'count': int(violation_count),
                    'severity': constraint.severity
                })

                # æ ¹æ“šåš´é‡ç¨‹åº¦æ¨™è¨˜ Quality Flag
                if constraint.severity == 'critical':
                    flag = 'PHYSICAL_IMPOSSIBLE'
                    # å¯é¸ï¼šå°‡ç•°å¸¸å€¼è¨­ç‚º nullï¼ˆä¾ config æ±ºå®šï¼‰
                    df = df.with_columns(
                        pl.when(violated_mask)
                        .then(pl.lit(None))
                        .otherwise(pl.col(constraint.target_column))
                        .alias(constraint.target_column)
                    )
                else:
                    flag = 'EQUIPMENT_VIOLATION'

                # æ¨™è¨˜é•è¦æ™‚é–“é»çš„ quality_flags
                current_flags = df['quality_flags'].to_list()
                for i, is_violated in enumerate(violated_mask.to_list()):
                    if is_violated:
                        if isinstance(current_flags[i], list):
                            current_flags[i].append(flag)
                        else:
                            current_flags[i] = [flag]

                df = df.with_columns(pl.Series('quality_flags', current_flags))

        # æ›´æ–°ç¨½æ ¸è»Œè·¡
        self._equipment_validation_audit['constraints_applied'] = [c.constraint_id for c in constraints]
        self._equipment_validation_audit['violations_detected'] = len(violations)
        self._equipment_validation_audit['violation_details'] = violations

        if violations:
            self.logger.warning(f&quot;E350: è¨­å‚™é‚è¼¯é æª¢ç™¼ç¾ {len(violations)} é …é•è¦&quot;)

        return df

    def get_equipment_validation_audit(self) -&gt; dict:
        &quot;&quot;&quot;
        å–å¾—è¨­å‚™é©—è­‰ç¨½æ ¸è»Œè·¡ï¼ˆä¾› BatchProcessor å¯«å…¥ Manifestï¼‰
        &quot;&quot;&quot;
        return self._equipment_validation_audit
</code></pre>
<h3 id="132-equipmentvalidator">13.2 EquipmentValidator å¯¦ä½œ</h3>
<pre><code class="language-python"># src/equipment/equipment_validator.py
class EquipmentValidator:
    &quot;&quot;&quot;
    è¨­å‚™é‚è¼¯é©—è­‰å™¨ï¼ˆHVAC å°ˆç”¨ï¼‰
    &quot;&quot;&quot;

    def __init__(self, annotation_manager: FeatureAnnotationManager):
        self.annotation_manager = annotation_manager

    def check_constraint(
        self, 
        df: pl.DataFrame, 
        constraint: EquipmentConstraint
    ) -&gt; pl.Series:
        &quot;&quot;&quot;
        æª¢æŸ¥å–®ä¸€ç´„æŸæ¢ä»¶

        Returns:
            pl.Series[bool]: é•åç´„æŸçš„é®ç½©ï¼ˆTrue è¡¨ç¤ºé•åï¼‰
        &quot;&quot;&quot;
        if constraint.check_type == 'requires':
            return self._check_requires(df, constraint)
        elif constraint.check_type == 'mutex':
            return self._check_mutex(df, constraint)
        elif constraint.check_type == 'range_check':
            return self._check_range(df, constraint)
        elif constraint.check_type == 'sequence':
            # Sequence æª¢æŸ¥é€šå¸¸åœ¨ Optimization éšæ®µï¼Œæ­¤è™•ç•¥éæˆ–åšç°¡å–®æª¢æŸ¥
            return pl.Series([False] * len(df))
        else:
            return pl.Series([False] * len(df))

    def _check_requires(self, df: pl.DataFrame, constraint: EquipmentConstraint) -&gt; pl.Series:
        &quot;&quot;&quot;
        æª¢æŸ¥ Requires ç´„æŸï¼ˆå¦‚ä¸»æ©Ÿé–‹å•Ÿæ™‚å¿…é ˆæœ‰æ°´æ³µé‹è½‰ï¼‰
        &quot;&quot;&quot;
        # å–å¾—è§¸ç™¼æ¢ä»¶æ¬„ä½ï¼ˆå¦‚ chiller_01_statusï¼‰
        trigger_cols = constraint.trigger_status

        # æª¢æŸ¥è§¸ç™¼æ¢ä»¶ï¼ˆä»»ä¸€è§¸ç™¼æ¬„ä½ç‚º 1 æˆ– Trueï¼‰
        trigger_condition = pl.lit(False)
        for col in trigger_cols:
            if col in df.columns:
                trigger_condition = trigger_condition | (pl.col(col) == 1)

        # æª¢æŸ¥éœ€æ±‚æ¢ä»¶ï¼ˆè‡³å°‘ä¸€éœ€æ±‚æ¬„ä½ç‚º 1ï¼‰
        required_cols = constraint.required_status or []
        required_condition = pl.lit(False)
        for col in required_cols:
            if col in df.columns:
                required_condition = required_condition | (pl.col(col) == 1)

        # é•åæ¢ä»¶ï¼šè§¸ç™¼ç‚ºçœŸä½†éœ€æ±‚ç‚ºå‡
        violated = trigger_condition &amp; ~required_condition

        return df.select(violated.alias('violated'))['violated']

    def _check_mutex(self, df: pl.DataFrame, constraint: EquipmentConstraint) -&gt; pl.Series:
        &quot;&quot;&quot;
        æª¢æŸ¥äº’æ–¥ç´„æŸï¼ˆå¦‚ä¸»æ©Ÿèˆ‡å‚™ç”¨ä¸»æ©Ÿä¸å¯åŒæ™‚é–‹å•Ÿï¼‰
        &quot;&quot;&quot;
        mutex_pairs = constraint.mutex_pairs or []
        violated = pl.lit(False)

        for pair in mutex_pairs:
            col1, col2 = pair
            if col1 in df.columns and col2 in df.columns:
                # å…©è€…åŒæ™‚ç‚º 1 å³é•å
                both_on = (pl.col(col1) == 1) &amp; (pl.col(col2) == 1)
                violated = violated | both_on

        return df.select(violated.alias('violated'))['violated']

    def _check_range(self, df: pl.DataFrame, constraint: EquipmentConstraint) -&gt; pl.Series:
        &quot;&quot;&quot;
        æª¢æŸ¥ç¯„åœç´„æŸï¼ˆå¦‚æº«åº¦å¿…é ˆåœ¨ 4-15Â°C ä¹‹é–“ï¼‰
        &quot;&quot;&quot;
        target_col = constraint.target_column

        if target_col not in df.columns:
            return pl.Series([False] * len(df))

        violated = pl.lit(False)

        if constraint.min_value is not None:
            violated = violated | (pl.col(target_col) &lt; constraint.min_value)

        if constraint.max_value is not None:
            violated = violated | (pl.col(target_col) &gt; constraint.max_value)

        return df.select(violated.alias('violated'))['violated']
</code></pre>
<hr />
<h2 id="14-v13-complete">14. äº¤ä»˜ç‰©æ¸…å–®ï¼ˆv1.3-Completeï¼‰</h2>
<h3 id="141">14.1 é…ç½®æ–‡ä»¶æ›´æ–°</h3>
<ol>
<li><code>config/features/schema.json</code> - JSON Schema v1.3ï¼ˆå« HVAC æ“´å……èˆ‡ Equipment IDï¼‰</li>
<li><code>config/features/physical_types.yaml</code> - 18 å€‹ç‰©ç†é¡å‹å®Œæ•´å®šç¾©</li>
<li><code>config/features/equipment_taxonomy.yaml</code> - è¨­å‚™åˆ†é¡æ³•ï¼ˆHVAC å°ˆç”¨ï¼‰</li>
<li><code>config/features/header_standardization_rules.yaml</code> - æ¨™é ­æ­£è¦åŒ–è¦å‰‡ï¼ˆRegex å®šç¾©ï¼‰</li>
<li><code>config/features/sites/*.yaml</code> - æ¡ˆå ´æ¨™è¨»ï¼ˆå« equipment_constraints å€æ®µï¼‰</li>
</ol>
<h3 id="142-excel">14.2 Excel å·¥å…·éˆæ›´æ–°</h3>
<ol start="6">
<li><code>tools/features/templates/Feature_Template_v1.3.xlsx</code> - ç•¶å‰ç‰ˆæœ¬ï¼ˆå« 11 æ¬„ä½çµæ§‹èˆ‡ System Sheetï¼‰</li>
<li><code>tools/features/wizard.py</code> - Wizard CLIï¼ˆå« Header Standardization é è¦½èˆ‡è‡ªå‹•å‚™ä»½ï¼‰</li>
<li><code>tools/features/excel_to_yaml.py</code> - è½‰æ›å™¨ï¼ˆå« Checksum è¨ˆç®—èˆ‡ HVAC é‚è¼¯é©—è­‰ï¼‰</li>
<li><code>tools/features/yaml_to_excel.py</code> - é€†å‘è½‰æ›ï¼ˆinit/recovery æ¨¡å¼ï¼‰</li>
<li><code>tools/features/migrate_excel.py</code> - ç¯„æœ¬å‡ç´šå·¥å…·ï¼ˆv1.2â†’v1.3ï¼‰</li>
<li><code>tools/features/validators/sync_checker.py</code> - Excel/YAML åŒæ­¥æª¢æŸ¥ï¼ˆE406 å¯¦ä½œï¼‰</li>
</ol>
<h3 id="143-python-api">14.3 Python API èˆ‡é©—è­‰å™¨</h3>
<ol start="12">
<li><code>src/features/annotation_manager.py</code> - FeatureAnnotationManagerï¼ˆå« TemporalContext æ•´åˆï¼‰</li>
<li><code>src/features/temporal_context.py</code> - å…¨åŸŸæ™‚é–“åŸºæº–å–®ä¾‹ï¼ˆE000 é˜²è­·ï¼‰</li>
<li><code>src/features/feature_manifest.py</code> - Feature Manifest ç”Ÿæˆèˆ‡é©—è­‰ï¼ˆE901-E904ï¼‰</li>
<li><code>src/features/hvac_validator.py</code> - HVAC å°ˆç”¨é©—è­‰å™¨ï¼ˆE350-E357ï¼‰</li>
<li><code>src/features/yaml_write_guard.py</code> - Import Hook é˜²è­·ï¼ˆE501ï¼‰</li>
<li><code>src/features/models.py</code> - Pydantic æ¨¡å‹ï¼ˆColumnAnnotation, EquipmentConstraintï¼‰</li>
<li><code>src/etl/header_standardizer.py</code> - CSV æ¨™é ­æ­£è¦åŒ–å¯¦ä½œï¼ˆE105ï¼‰</li>
<li><code>src/equipment/equipment_validator.py</code> - è¨­å‚™é‚è¼¯é©—è­‰å™¨ï¼ˆE350 å¯¦ä½œï¼‰</li>
</ol>
<h3 id="144-ssot">14.4 SSOT å¸¸æ•¸å®šç¾©</h3>
<ol start="20">
<li><code>src/etl/config_models.py</code> - æ›´æ–°åŒ…å«ï¼š<ul>
<li><code>VALID_QUALITY_FLAGS</code> èˆ‡ç‰ˆæœ¬è™Ÿ</li>
<li><code>HEADER_STANDARDIZATION_RULES</code>ï¼ˆRegex åˆ—è¡¨ï¼‰</li>
<li><code>EQUIPMENT_VALIDATION_CONSTRAINTS</code>ï¼ˆè¨­å‚™é™åˆ¶ SSOTï¼‰</li>
<li><code>TEMPORAL_BASELINE_CONFIG</code>ï¼ˆæ™‚é–“åŸºæº–è¨­å®šï¼‰</li>
</ul>
</li>
</ol>
<h3 id="145">14.5 æ¸¬è©¦èˆ‡æ–‡ä»¶</h3>
<ol start="21">
<li><code>tests/features/test_temporal_baseline.py</code> - æ™‚é–“åŸºæº–æ¸¬è©¦ï¼ˆE000, E000-Wï¼‰</li>
<li><code>tests/features/test_header_standardization.py</code> - æ¨™é ­æ­£è¦åŒ–æ¸¬è©¦ï¼ˆE105, E409ï¼‰</li>
<li><code>tests/features/test_feature_alignment.py</code> - ç‰¹å¾µå°é½Šæ¸¬è©¦ï¼ˆE901-E904ï¼‰</li>
<li><code>tests/features/test_hvac_constraints.py</code> - HVAC äº’é–é‚è¼¯æ¸¬è©¦ï¼ˆE350-E357ï¼‰</li>
<li><code>tests/features/test_equipment_sync.py</code> - Cleaner èˆ‡ Optimization åŒæ­¥æ¸¬è©¦</li>
<li><code>docs/features/PRD_Feature_Annotation_v1.3_Complete.md</code> - æœ¬æ–‡ä»¶</li>
</ol>
<hr />
<h2 id="15-v13-complete">15. é©—æ”¶ç°½æ ¸ï¼ˆv1.3-Completeï¼‰</h2>
<h3 id="151">15.1 åŸºç¤æµç¨‹é©—æ”¶</h3>
<ul>
<li>[ ] <strong>å–®å‘æµç¨‹</strong>: Wizard åƒ…æ›´æ–° Excelï¼Œç„¡æ³•ç›´æ¥å¯«å…¥ YAMLï¼ˆæŠ€è¡“é˜»æ“‹ E501ï¼‰</li>
<li>[ ] <strong>ç‰ˆæœ¬æ§åˆ¶</strong>: Excel ä¿®æ”¹å¾Œæœªé‡æ–°ç”Ÿæˆ YAMLï¼ŒåŸ·è¡Œ Pipeline æ™‚æ­£ç¢ºå ±éŒ¯ E406</li>
<li>[ ] <strong>å‚™ä»½æ©Ÿåˆ¶</strong>: Wizard åŸ·è¡Œæ™‚æ­£ç¢ºç”Ÿæˆ <code>.backups/</code> æª”æ¡ˆï¼Œä¿ç•™æœ€è¿‘ 10 å€‹ç‰ˆæœ¬</li>
<li>[ ] <strong>ç½é›£æ¢å¾©</strong>: å¯é€é <code>yaml_to_excel --mode recovery</code> å¾ Git æ­·å²ç‰ˆæœ¬é‡å»º Excel</li>
</ul>
<h3 id="152-header-standardization">15.2 Header Standardization é©—æ”¶</h3>
<ul>
<li>[ ] <strong>Regex è¦å‰‡</strong>: <code>Chiller 1 Temp</code> æ­£ç¢ºè½‰æ›ç‚º <code>chiller_1_temp</code></li>
<li>[ ] <strong>é‡è¤‡æª¢æ¸¬</strong>: æ­£è¦åŒ–å¾Œç”¢ç”Ÿé‡è¤‡æ¨™é ­æ™‚æ­£ç¢ºæ‹‹å‡º E105</li>
<li>[ ] <strong>E409 é©—è­‰</strong>: CSV æ¨™é ­æ­£è¦åŒ–å¾Œèˆ‡ Annotation ä¸åŒ¹é…æ™‚æ­£ç¢ºå ±éŒ¯</li>
<li>[ ] <strong>Wizard é è¦½</strong>: Wizard é¡¯ç¤ºæ¨™é ­è½‰æ›é è¦½ï¼Œä¾›ä½¿ç”¨è€…ç¢ºèª</li>
</ul>
<h3 id="153-temporal-baseline">15.3 Temporal Baseline é©—æ”¶</h3>
<ul>
<li>[ ] <strong>E000 é˜²è­·</strong>: Pipeline å•Ÿå‹•æ™‚æ­£ç¢ºå»ºç«‹ TemporalContextï¼Œæœªå»ºç«‹æ™‚å ±éŒ¯</li>
<li>[ ] <strong>E102 é˜²è­·</strong>: è³‡æ–™æ™‚é–“è¶…éåŸºæº–+5åˆ†é˜æ™‚æ­£ç¢ºæ‹’çµ•</li>
<li>[ ] <strong>E000-W è­¦å‘Š</strong>: Pipeline åŸ·è¡Œè¶…é 1 å°æ™‚æ™‚æ­£ç¢ºç™¼å‡ºæ™‚é–“æ¼‚ç§»è­¦å‘Š</li>
<li>[ ] <strong>è·¨æ—¥åŸ·è¡Œ</strong>: 00:00 å‰å¾ŒåŸ·è¡Œæ™‚æ™‚é–“è¨ˆç®—æ­£ç¢ºï¼Œç„¡é‚è¼¯éŒ¯èª¤</li>
</ul>
<h3 id="154-feature-alignment">15.4 Feature Alignment é©—æ”¶</h3>
<ul>
<li>[ ] <strong>E901</strong>: ç‰¹å¾µé †åºéŒ¯èª¤æ™‚æ­£ç¢ºæ‹’çµ•ï¼ˆå«è©³ç´°å·®ç•°è³‡è¨Šï¼‰</li>
<li>[ ] <strong>E902</strong>: ç‰¹å¾µç¶­åº¦ä¸åŒ¹é…æ™‚æ­£ç¢ºæ‹’çµ•</li>
<li>[ ] <strong>E903</strong>: Scaler Parameters é †åºä¸ä¸€è‡´æ™‚æ­£ç¢ºæ‹’çµ•</li>
<li>[ ] <strong>Feature Manifest</strong>: Training éšæ®µæ­£ç¢ºè¼¸å‡º feature_manifest.json</li>
<li>[ ] <strong>é›œæ¹Šé©—è­‰</strong>: ç‰¹å¾µåˆ—è¡¨é›œæ¹Šå€¼è¨ˆç®—èˆ‡é©—è­‰æ­£ç¢º</li>
</ul>
<h3 id="155-hvac">15.5 HVAC å°ˆç”¨é©—æ”¶</h3>
<ul>
<li>[ ] <strong>è¨­å‚™äº’é–</strong>: ä¸»æ©Ÿé–‹å•Ÿä½†æ°´æ³µé—œé–‰æ™‚ï¼Œæ­£ç¢ºè§¸ç™¼ E350 ä¸¦æ¨™è¨˜ PHYSICAL_IMPOSSIBLE</li>
<li>[ ] <strong>å–®èª¿æ€§æª¢æŸ¥</strong>: é›»è¡¨è®€æ•¸éæ¸›æ™‚æ­£ç¢ºè§¸ç™¼ E351ï¼Œå…è¨± 1% ç²¾åº¦èª¤å·®</li>
<li>[ ] <strong>æ•ˆç‡ç¯„åœ</strong>: COP &lt; 2 æˆ– &gt; 8 æ™‚æ­£ç¢ºè§¸ç™¼ E352ï¼ˆWarningï¼‰</li>
<li>[ ] <strong>ä½æº«å·®ç—‡å€™ç¾¤</strong>: å†°æ°´é€²å›æ°´æº«å·® &lt; 1Â°C æ™‚æ­£ç¢ºè§¸ç™¼ E353ï¼ˆWarningï¼‰</li>
<li>[ ] <strong>Equipment ID</strong>: æ¬„ä½èˆ‡è¨­å‚™ ID æ˜ å°„æ­£ç¢ºï¼Œæ”¯æ´äº’é–æŸ¥è©¢</li>
<li>[ ] <strong>E904</strong>: è¨­å‚™é™åˆ¶ä¸ä¸€è‡´æ™‚æ­£ç¢ºæ‹’çµ•ï¼ˆTraining vs Optimizationï¼‰</li>
</ul>
<h3 id="156-interface-contract-v11">15.6 éŒ¯èª¤ä»£ç¢¼æ”¶æ–‚é©—æ”¶ï¼ˆå°é½Š Interface Contract v1.1ï¼‰</h3>
<ul>
<li>[ ] <strong>E000-E000-W</strong>: æ™‚é–“åŸºæº–éŒ¯èª¤æ­£ç¢ºå°æ‡‰</li>
<li>[ ] <strong>E105</strong>: Header Standardization å¤±æ•—æ­£ç¢ºå°æ‡‰</li>
<li>[ ] <strong>E350-E357</strong>: Equipment Validation éŒ¯èª¤æ­£ç¢ºå°æ‡‰ï¼ˆE354/E355 ç‚ºé€šç”¨ç´„æŸï¼‰</li>
<li>[ ] <strong>E400-E409</strong>: Feature Annotation éŒ¯èª¤æ­£ç¢ºå°æ‡‰</li>
<li>[ ] <strong>E500-E501</strong>: Governance éŒ¯èª¤æ­£ç¢ºå°æ‡‰</li>
<li>[ ] <strong>E901-E904</strong>: è·¨éšæ®µæ•´åˆéŒ¯èª¤æ­£ç¢ºå°æ‡‰</li>
</ul>
<hr />
<p><strong>ç°½æ ¸æ¬„</strong>ï¼š<br />
- [ ] æ¶æ§‹å¸«ç¢ºèªï¼šæª¢æŸ¥é»å®šç¾©æ¶µè“‹æ‰€æœ‰æ¨¡çµ„é–“ä»‹é¢ï¼ˆå« Training-Optimization èˆ‡ Equipment Validation Syncï¼‰<br />
- [ ] æŠ€è¡“è² è²¬äººç¢ºèªï¼šéŒ¯èª¤ä»£ç¢¼åˆ†å±¤ E000-E999 ç„¡è¡çªï¼Œèˆ‡ Interface Contract v1.1 å®Œå…¨ä¸€è‡´<br />
- [ ] HVAC é ˜åŸŸå°ˆå®¶ç¢ºèªï¼šè¨­å‚™äº’é–é‚è¼¯ç¬¦åˆç‰©ç†å¯¦å‹™ï¼Œå‘½åè¦ç¯„ç¬¦åˆæ¥­ç•Œæ…£ä¾‹<br />
- [ ] ç¶­é‹è² è²¬äººç¢ºèªï¼šç‰ˆæœ¬ç›¸å®¹æ€§çŸ©é™£å¯æŒ‡å°éƒ¨ç½²æ±ºç­–ï¼Œæ™‚é–“ä¸€è‡´æ€§æ©Ÿåˆ¶å¯é˜²æ­¢è·¨æ—¥åŸ·è¡ŒéŒ¯èª¤<br />
- [ ] Product Manager ç¢ºèªï¼šå–®å‘æµç¨‹ç®¡æ§ï¼ˆExcelâ†’YAMLï¼‰ç¢ºä¿è³‡æ–™ä¸€è‡´æ€§ï¼Œç½é›£æ¢å¾©æ©Ÿåˆ¶å®Œæ•´</p>
<hr />
</body>
</html>