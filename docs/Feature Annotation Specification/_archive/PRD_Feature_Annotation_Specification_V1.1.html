<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRD_Feature_Annotation_Specification_V1.1</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
    font-size: 16px;
    line-height: 1.5;
    word-wrap: break-word;
    color: #24292e;
    background-color: #fff;
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem;
}
h1, h2, h3, h4, h5, h6 {
    margin-top: 24px;
    margin-bottom: 16px;
    font-weight: 600;
    line-height: 1.25;
}
h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
h3 { font-size: 1.25em; }
code {
    padding: 0.2em 0.4em;
    margin: 0;
    font-size: 85%;
    background-color: #f6f8fa;
    border-radius: 6px;
    font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
}
pre {
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f6f8fa;
    border-radius: 6px;
}
pre code {
    display: inline;
    padding: 0;
    margin: 0;
    overflow: visible;
    line-height: inherit;
    word-wrap: normal;
    background-color: initial;
    border: 0;
}
blockquote {
    padding: 0 1em;
    color: #6a737d;
    border-left: 0.25em solid #dfe2e5;
    margin: 0;
}
table {
    display: block;
    width: 100%;
    margin-top: 0;
    margin-bottom: 16px;
    overflow: auto;
    border-spacing: 0;
    border-collapse: collapse;
}
table th, table td {
    padding: 6px 13px;
    border: 1px solid #dfe2e5;
}
table tr {
    background-color: #fff;
    border-top: 1px solid #c6cbd1;
}
table tr:nth-child(2n) {
    background-color: #f6f8fa;
}
a { color: #0366d6; text-decoration: none; }
a:hover { text-decoration: underline; }
hr {
    height: 0.25em;
    padding: 0;
    margin: 24px 0;
    background-color: #e1e4e8;
    border: 0;
}
</style>

</head>
<body>
<h1 id="prd-v11-feature-annotation-specification">PRD v1.1: ç‰¹å¾µæ¨™è¨»ç³»çµ±è¦ç¯„ (Feature Annotation Specification)</h1>
<p><strong>æ–‡ä»¶ç‰ˆæœ¬:</strong> v1.1 (Human-Configurable Feature Metadata with Excel Interface)<br />
<strong>æ—¥æœŸ:</strong> 2026-02-13<br />
<strong>è² è²¬äºº:</strong> Oscar Chang<br />
<strong>ç›®æ¨™:</strong> å»ºç«‹éå·¥ç¨‹å¸«å¯ç¶­è­·çš„ç‰¹å¾µå®šç¾©ç³»çµ±ï¼Œé€é Excel/YAML é›™è»Œåˆ¶å¹³è¡¡æ˜“ç”¨æ€§èˆ‡åš´è¬¹æ€§<br />
<strong>ç›¸ä¾æ¨¡çµ„:</strong> Cleaner v2.2+, BatchProcessor v1.3+, Feature Engineer v1.3+<br />
<strong>é ä¼°å·¥æ™‚:</strong> 5 ~ 6 å€‹å·¥ç¨‹å¤©ï¼ˆå« Excel è½‰æ›å™¨ã€Wizard CLIã€çµ±è¨ˆé©—è­‰ï¼‰</p>
<hr />
<h2 id="1">1. åŸ·è¡Œç¸½ç¶±èˆ‡è¨­è¨ˆå“²å­¸</h2>
<h3 id="11">1.1 æ ¸å¿ƒç›®æ¨™</h3>
<ol>
<li><strong>äººæ©Ÿåˆ†é›¢</strong>: è¨­å‚™å·¥ç¨‹å¸«é€é <strong>Excel ä»‹é¢</strong> å®šç¾©ç‰¹å¾µï¼Œç„¡éœ€ç†è§£ YAML èªæ³•æˆ– Regex</li>
<li><strong>é›™è»Œåˆ¶ç·¨è¼¯</strong>: Excel ç‚ºã€Œç·¨è¼¯å™¨ã€ï¼ŒYAML ç‚ºã€Œå”¯ä¸€çœŸç›¸æº (SSOT)ã€ï¼Œé€éè½‰æ›è…³æœ¬æ©‹æ¥</li>
<li><strong>å¤šæ¡ˆå ´ç®¡ç†</strong>: æ”¯æ´ã€ŒåŸºç¤å®šç¾© + æ¡ˆå ´è¦†è“‹ã€çš„ç¹¼æ‰¿æ¶æ§‹ï¼Œé¿å…é‡è¤‡ç¶­è­·</li>
<li><strong>ä¸‰å±¤é˜²è­·</strong>: Excel å³æ™‚é˜²å‘† â†’ è½‰æ›èªæ„é©—è­‰ â†’ CI/CD å¥‘ç´„é©—è­‰</li>
<li><strong>çµ±è¨ˆé©—è­‰</strong>: é€éæ•¸æ“šåˆ†ä½ˆæª¢æŸ¥æŠ“å‡ºã€Œç‰©ç†æ„ç¾©èª¤æ¤ã€ï¼ˆå¦‚å£“åŠ›èª¤æ¨™ç‚ºæº«åº¦ï¼‰</li>
</ol>
<h3 id="12">1.2 è¨­è¨ˆåŸå‰‡èˆ‡é›™è»Œåˆ¶æ¶æ§‹</h3>
<pre><code class="language-mermaid">graph TB
    subgraph &quot;ç·¨è¼¯å±¤ (Human-Friendly)&quot;
        A[Excel Template&lt;br/&gt;.xlsx] --&gt;|ç·¨è¼¯| B[è¨­å‚™å·¥ç¨‹å¸«&lt;br/&gt;ç©ºèª¿æŠ€å¸«]
        C[Wizard CLI&lt;br/&gt;äº¤äº’å¼] --&gt;|å¼•å°| B
    end

    subgraph &quot;è½‰æ›å±¤ (Validation)&quot;
        B --&gt;|åŒ¯å‡º| D[excel_to_yaml.py&lt;br/&gt;è½‰æ›è…³æœ¬]
        D --&gt;|èªæ„é©—è­‰| E[è­¦å‘Š/éŒ¯èª¤æç¤º&lt;br/&gt;W401, E402]
        E --&gt;|ä¿®æ­£| A
    end

    subgraph &quot;çœŸç›¸æºå±¤ (Machine-Readable)&quot;
        E --&gt;|ç”Ÿæˆ| F[YAML æª”æ¡ˆ&lt;br/&gt;config/features/]
        F --&gt;|Git PR| G[Git Repo&lt;br/&gt;SSOT]
        G --&gt;|CI/CD| H[éƒ¨ç½²è‡³&lt;br/&gt;Config Server]
    end

    style F fill:#f9f,stroke:#333,stroke-width:4px
    style G fill:#bbf,stroke:#333,stroke-width:2px
</code></pre>
<table>
<thead>
<tr>
<th style="text-align: left;">åŸå‰‡</th>
<th style="text-align: left;">èªªæ˜</th>
<th style="text-align: left;">å¯¦ç¾æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>SSOT å”¯ä¸€æ€§</strong></td>
<td style="text-align: left;">YAML æ˜¯å”¯ä¸€éƒ¨ç½²çœŸç›¸æºï¼ŒExcel åƒ…ç‚ºè¼¸å…¥æ³•</td>
<td style="text-align: left;">ç¦æ­¢ç›´æ¥ä¿®æ”¹ YAMLï¼Œæ‰€æœ‰è®Šæ›´é€é Excel â†’ PR â†’ Merge</td>
</tr>
<tr>
<td style="text-align: left;"><strong>é¡¯å¼å„ªæ–¼éš±å¼</strong></td>
<td style="text-align: left;">ç¦æ­¢è‡ªå‹•æ¨æ–·ï¼Œæ‰€æœ‰æ¬„ä½é¡¯å¼å®šç¾©</td>
<td style="text-align: left;">åš´æ ¼æ¨¡å¼ä¸‹æœªå®šç¾©æ¬„ä½è§¸ç™¼ <code>E402_UNANNOTATED_COLUMN</code></td>
</tr>
<tr>
<td style="text-align: left;"><strong>é˜²å‘†è¨­è¨ˆ</strong></td>
<td style="text-align: left;">ä¸‰å±¤é˜²è­·æ©Ÿåˆ¶é˜²æ­¢äººç‚ºéŒ¯èª¤</td>
<td style="text-align: left;">Excel Data Validation â†’ è½‰æ›èªæ„æª¢æŸ¥ â†’ CI/CD Schema é©—è­‰</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ç¹¼æ‰¿å¯è¦–åŒ–</strong></td>
<td style="text-align: left;">æä¾›å·¥å…·æŸ¥çœ‹ç¹¼æ‰¿å¾Œçš„æœ€çµ‚è¨­å®š</td>
<td style="text-align: left;"><code>features inspect</code> å‘½ä»¤é¡¯ç¤ºè¦†è“‹éˆ</td>
</tr>
<tr>
<td style="text-align: left;"><strong>çµ±è¨ˆé©—è­‰</strong></td>
<td style="text-align: left;">ç”¨æ•¸æ“šåˆ†ä½ˆé©—è­‰æ¨™è¨»æ­£ç¢ºæ€§</td>
<td style="text-align: left;">æ¯”å° <code>valid_range</code> èˆ‡å¯¦éš›æ•¸æ“šåˆ†ä½ˆ (W401)</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="2">2. æ–‡ä»¶æ¶æ§‹èˆ‡é›™è»Œåˆ¶æ ¼å¼</h2>
<h3 id="21">2.1 ç›®éŒ„çµæ§‹</h3>
<pre><code>config/features/                    # ç‰¹å¾µæ¨™è¨»æ ¹ç›®éŒ„ (SSOT)
â”œâ”€â”€ schema.json                     # JSON Schema é©—è­‰è¦å‰‡
â”œâ”€â”€ base.yaml                       # åŸºç¤å®šç¾©ï¼ˆæ‰€æœ‰æ¡ˆå ´å…±ç”¨ï¼‰
â”œâ”€â”€ physical_types.yaml             # ç‰©ç†é¡å‹è¦ç¯„
â””â”€â”€ sites/                          # æ¡ˆå ´ç‰¹å®šå®šç¾©ï¼ˆåƒ… YAMLï¼‰
    â”œâ”€â”€ cgmh_ty.yaml
    â””â”€â”€ kmuh.yaml

tools/features/                     # ç·¨è¼¯å·¥å…·ï¼ˆè½‰æ›å™¨ï¼‰
â”œâ”€â”€ Feature_Definition_Template.xlsx # Excel ç¯„æœ¬
â”œâ”€â”€ excel_to_yaml.py                # è½‰æ›è…³æœ¬
â””â”€â”€ validation_rules.json           # Excel Data Validation è¦å‰‡

docs/features/examples/             # ç¯„ä¾‹èˆ‡æ•™å­¸
â””â”€â”€ cgmh_ty_example.xlsx            # é•·åºšé†«é™¢å¡«å¯«ç¯„ä¾‹
</code></pre>
<h3 id="22-excel-feature_definition_templatexlsx">2.2 Excel ç¯„æœ¬çµæ§‹ (Feature_Definition_Template.xlsx)</h3>
<p><strong>è¨­è¨ˆåŸå‰‡</strong>ï¼šåˆ©ç”¨ Excel çš„ã€Œè³‡æ–™é©—è­‰ (Data Validation)ã€èˆ‡ã€Œä¸‹æ‹‰é¸å–®ã€é˜²å‘†ï¼ŒåŒæ™‚é€éå›ºå®šæ¬„ä½åç¨±å°æ‡‰ YAML çµæ§‹ã€‚</p>
<h4 id="sheet-1-columns">Sheet 1: Columnsï¼ˆä¸»è¦ç·¨è¼¯å€ï¼‰</h4>
<table>
<thead>
<tr>
<th style="text-align: center;">æ¬„ä½åç¨± (A)</th>
<th style="text-align: center;">ç‰©ç†é¡å‹ (B)</th>
<th style="text-align: center;">å–®ä½ (C)</th>
<th style="text-align: center;">æ˜¯å¦ç›®æ¨™ (D)</th>
<th style="text-align: center;">å•Ÿç”¨ Lag (E)</th>
<th style="text-align: center;">Lag é–“éš” (F)</th>
<th style="text-align: center;">æè¿° (G)</th>
<th style="text-align: center;">æ¨™ç±¤ (H)</th>
<th style="text-align: center;">ç‹€æ…‹ (I)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">chiller_1_temp</td>
<td style="text-align: center;">temperature</td>
<td style="text-align: center;">Â°C</td>
<td style="text-align: center;">FALSE</td>
<td style="text-align: center;">TRUE</td>
<td style="text-align: center;">1,4,96</td>
<td style="text-align: center;">ä¸€è™Ÿå†°æ©Ÿæº«åº¦</td>
<td style="text-align: center;">critical,chiller1</td>
<td style="text-align: center;">confirmed</td>
</tr>
<tr>
<td style="text-align: center;">total_power_kw</td>
<td style="text-align: center;">power</td>
<td style="text-align: center;">kW</td>
<td style="text-align: center;">TRUE</td>
<td style="text-align: center;">FALSE</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">ç¸½è€—é›»</td>
<td style="text-align: center;">target</td>
<td style="text-align: center;">confirmed</td>
</tr>
<tr>
<td style="text-align: center;">chiller_1_status</td>
<td style="text-align: center;">status</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">FALSE</td>
<td style="text-align: center;">FALSE</td>
<td style="text-align: center;">-</td>
<td style="text-align: center;">ç‹€æ…‹æŒ‡ç¤º</td>
<td style="text-align: center;">status</td>
<td style="text-align: center;">pending_review</td>
</tr>
</tbody>
</table>
<p><strong>é˜²å‘†æ©Ÿåˆ¶ (Data Validation)</strong>ï¼š<br />
- <strong>æ¬„ä½ B (ç‰©ç†é¡å‹)</strong>: ä¸‹æ‹‰é¸å–®ï¼Œå€¼ä¾†è‡ª <code>physical_types.yaml</code> çš„ keys<br />
- <strong>æ¬„ä½ C (å–®ä½)</strong>: å‹•æ…‹ä¸‹æ‹‰ï¼Œæ ¹æ“š B æ¬„é¸æ“‡é™åˆ¶ï¼ˆå¦‚é¸ temperature åªèƒ½é¸ Â°C/Â°F/Kï¼‰<br />
- <strong>æ¬„ä½ D (æ˜¯å¦ç›®æ¨™)</strong>: å‹¾é¸æ¡† (TRUE/FALSE)<br />
- <strong>æ¬„ä½ E (å•Ÿç”¨ Lag)</strong>: è‹¥ D=TRUEï¼Œè‡ªå‹•ç°åŒ–ä¸¦è¨­ç‚º FALSEï¼ˆé˜²æ­¢ Data Leakageï¼‰<br />
- <strong>æ¬„ä½ F (Lag é–“éš”)</strong>: åƒ…åœ¨ E=TRUE æ™‚å•Ÿç”¨ï¼Œæ ¼å¼é©—è­‰ç‚ºã€Œæ•¸å­—,æ•¸å­—ã€ï¼ˆå¦‚ <code>1,4,96</code>ï¼‰<br />
- <strong>æ¬„ä½ I (ç‹€æ…‹)</strong>: ä¸‹æ‹‰é¸å–® (pending_review, confirmed, deprecated)</p>
<h4 id="sheet-2-group-policies">Sheet 2: Group Policiesï¼ˆç¾¤çµ„ç­–ç•¥ï¼‰</h4>
<p>ç°¡åŒ–èªæ³•ï¼Œç„¡éœ€ Regexï¼š</p>
<table>
<thead>
<tr>
<th style="text-align: center;">ç­–ç•¥åç¨±</th>
<th style="text-align: center;">åŒ¹é…é¡å‹</th>
<th style="text-align: center;">åŒ¹é…å€¼</th>
<th style="text-align: center;">ç‰©ç†é¡å‹</th>
<th style="text-align: center;">Lag é–“éš”</th>
<th style="text-align: center;">Rolling çª—å£</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">chillers</td>
<td style="text-align: center;">prefix</td>
<td style="text-align: center;">chiller_</td>
<td style="text-align: center;">chiller_load</td>
<td style="text-align: center;">1,4</td>
<td style="text-align: center;">4,96</td>
</tr>
<tr>
<td style="text-align: center;">towers</td>
<td style="text-align: center;">prefix</td>
<td style="text-align: center;">ct_</td>
<td style="text-align: center;">temperature</td>
<td style="text-align: center;">1,4</td>
<td style="text-align: center;">4,96</td>
</tr>
<tr>
<td style="text-align: center;">pumps</td>
<td style="text-align: center;">contains</td>
<td style="text-align: center;">pump</td>
<td style="text-align: center;">flow_rate</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">4</td>
</tr>
</tbody>
</table>
<p><strong>åŒ¹é…é¡å‹é¸é …</strong>ï¼š<code>prefix</code> | <code>suffix</code> | <code>contains</code> | <code>regex</code>ï¼ˆé è¨­ prefixï¼Œé™ä½é–€æª»ï¼‰</p>
<h4 id="sheet-3-metadata">Sheet 3: Metadataï¼ˆæ–‡ä»¶è³‡è¨Šï¼‰</h4>
<table>
<thead>
<tr>
<th style="text-align: left;">æ¬„ä½</th>
<th style="text-align: left;">å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">schema_version</td>
<td style="text-align: left;">1.0</td>
</tr>
<tr>
<td style="text-align: left;">site_id</td>
<td style="text-align: left;">cgmh_ty</td>
</tr>
<tr>
<td style="text-align: left;">inherit</td>
<td style="text-align: left;">base</td>
</tr>
<tr>
<td style="text-align: left;">description</td>
<td style="text-align: left;">é•·åºšé†«é™¢æ¡ƒåœ’é™¢å€</td>
</tr>
<tr>
<td style="text-align: left;">editor</td>
<td style="text-align: left;">ç‹å·¥ç¨‹å¸«</td>
</tr>
<tr>
<td style="text-align: left;">last_updated</td>
<td style="text-align: left;">2026-02-13</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="3-yaml-schema-ssot">3. YAML Schema è©³ç´°è¦ç¯„ï¼ˆSSOT å±¤ï¼‰</h2>
<h3 id="31-root-schema">3.1 é ‚å±¤çµæ§‹ (Root Schema)</h3>
<pre><code class="language-yaml">schema_version: &quot;1.0&quot;              # å¿…é ˆï¼Œç”¨æ–¼ç‰ˆæœ¬ç›¸å®¹æ€§æª¢æŸ¥
description: &quot;é•·åºšé†«é™¢ç‰¹å¾µå®šç¾©&quot;     # é¸å¡«
inherit: &quot;base&quot;                    # é¸å¡«ï¼Œç¹¼æ‰¿ç›®æ¨™
meta:                              # ã€æ–°å¢ã€‘æ–‡ä»¶å…ƒè³‡æ–™
  editor: &quot;ç‹å·¥ç¨‹å¸«&quot;
  last_updated: &quot;2026-02-13&quot;
  source_excel: &quot;cgmh_ty_v2.xlsx&quot;  # è¿½æº¯ä¾†æº Excel

physical_types:                    # å¯è¦†è“‹æˆ–æ“´å…… SSOT
  [physical_type_id]: PhysicalTypeDefinition

columns:
  [column_name]: ColumnAnnotation

group_policies:
  [policy_name]: GroupPolicyRule   # æ”¯æ´ç°¡åŒ–èªæ³•

validation:
  strict_mode: true
  allow_unannotated: false
  enable_distribution_check: true  # ã€æ–°å¢ã€‘å•Ÿç”¨çµ±è¨ˆåˆ†ä½ˆé©—è­‰
</code></pre>
<h3 id="32-physical-type">3.2 Physical Type å®šç¾©ï¼ˆå«çµ±è¨ˆé©—è­‰åƒæ•¸ï¼‰</h3>
<pre><code class="language-yaml">physical_types:
  temperature:
    description: &quot;æº«åº¦æ„Ÿæ¸¬å™¨&quot;
    unit: &quot;Â°C&quot;
    si_unit: &quot;celsius&quot;
    valid_range: [-40.0, 100.0]
    agg_method: &quot;mean&quot;
    default_tags: [&quot;sensor&quot;, &quot;hvac&quot;]
    # ã€æ–°å¢ã€‘çµ±è¨ˆé©—è­‰åƒæ•¸
    distribution_check:
      expected_mean_range: [10, 35]      # æœŸæœ›å€¼ç¯„åœï¼ˆæŠ“å–®ä½éŒ¯èª¤ï¼‰
      max_std_threshold: 50              # æ¨™æº–å·®ä¸Šé™ï¼ˆæŠ“å‡çµè³‡æ–™ï¼‰
      zero_ratio_warning: 0.1            # é›¶å€¼æ¯”ä¾‹è­¦å‘Šï¼ˆæŠ“é›¢ç·šæ„Ÿæ¸¬å™¨ï¼‰

  chiller_load:
    description: &quot;å†°æ©Ÿè² è¼‰&quot;
    unit: &quot;RT&quot;
    si_unit: &quot;kw&quot;
    valid_range: [0.0, 2000.0]
    distribution_check:
      expected_mean_range: [100, 800]
      zero_ratio_warning: 0.05           # è² è¼‰ä¸æ‡‰é•·æœŸç‚ºé›¶
</code></pre>
<h3 id="33-column-annotation">3.3 Column Annotation å®šç¾©</h3>
<pre><code class="language-yaml">columns:
  chiller_1_temp:
    column_name: &quot;chiller_1_temp&quot;
    physical_type: &quot;temperature&quot;
    description: &quot;ä¸€è™Ÿå†°æ©Ÿå‡ºæ°´æº«åº¦&quot;
    is_target: false
    enable_lag: true
    enable_rolling: true
    lag_intervals: [1, 4, 96]
    rolling_windows: [4, 96]
    tags: [&quot;critical&quot;, &quot;chiller_1&quot;]
    status: &quot;confirmed&quot;                 # ã€æ–°å¢ã€‘è¿½è¹¤ç‹€æ…‹

  total_power_kw:
    column_name: &quot;total_power_kw&quot;
    physical_type: &quot;power&quot;
    is_target: true
    # enable_lag/rolling å¼·åˆ¶ç‚º falseï¼ˆPydantic è‡ªå‹•è¨­å®šï¼‰
</code></pre>
<h3 id="34-group-policy-excel">3.4 Group Policy ç°¡åŒ–èªæ³•ï¼ˆæ”¯æ´ Excel è½‰æ›ï¼‰</h3>
<pre><code class="language-yaml">group_policies:
  chillers:
    description: &quot;æ‰€æœ‰å†°æ©Ÿç›¸é—œæ¬„ä½&quot;
    # ã€ç°¡åŒ–èªæ³•ã€‘ç„¡éœ€å¯« Regexï¼Œæ”¯æ´å››ç¨®åŒ¹é…æ¨¡å¼
    match_rule:
      type: &quot;prefix&quot;           # prefix | suffix | contains | regex
      value: &quot;chiller_&quot;        # ç°¡å–®å­—ä¸²ï¼Œç„¡éœ€ ^...$
    physical_type: &quot;chiller_load&quot;
    rules:
      lag_intervals: [1, 4]
      rolling_windows: [4, 96, 288]
      aggregations: [&quot;mean&quot;, &quot;std&quot;]

  cooling_tower_assets:
    match_rule:
      type: &quot;regex&quot;            # é€²éšä½¿ç”¨è€…ä»å¯ç”¨ Regex
      value: &quot;^ct_[0-9]+_(temp|flow)$&quot;
</code></pre>
<hr />
<h2 id="4">4. ä¸‰å±¤é˜²è­·èˆ‡é©—è­‰æ©Ÿåˆ¶</h2>
<h3 id="41-excel-data-validation">4.1 ç¬¬ä¸€å±¤ï¼šExcel å³æ™‚é˜²å‘† (Data Validation)</h3>
<p><strong>å¯¦ä½œæ–¹å¼</strong>ï¼šé€é <code>validation_rules.json</code> ç”Ÿæˆ Excel çš„ Data Validation è¦å‰‡ã€‚</p>
<pre><code class="language-python"># tools/features/generate_excel_template.py
def generate_excel_validation(physical_types: dict):
    &quot;&quot;&quot;
    ç”Ÿæˆ Excel çš„è³‡æ–™é©—è­‰è¦å‰‡
    &quot;&quot;&quot;
    rules = {
        &quot;physical_type&quot;: {
            &quot;type&quot;: &quot;list&quot;,
            &quot;source&quot;: list(physical_types.keys()),
            &quot;error_msg&quot;: &quot;è«‹é¸æ“‡æœ‰æ•ˆçš„ç‰©ç†é¡å‹&quot;
        },
        &quot;unit&quot;: {
            &quot;type&quot;: &quot;dynamic_list&quot;,  # æ ¹æ“š physical_type å‹•æ…‹è®Šæ›´
            &quot;mapping&quot;: {
                &quot;temperature&quot;: [&quot;Â°C&quot;, &quot;Â°F&quot;, &quot;K&quot;],
                &quot;pressure&quot;: [&quot;bar&quot;, &quot;psi&quot;, &quot;kPa&quot;],
                &quot;power&quot;: [&quot;kW&quot;, &quot;W&quot;, &quot;RT&quot;]
            }
        },
        &quot;is_target&quot;: {
            &quot;type&quot;: &quot;checkbox&quot;,
            &quot;trigger&quot;: {
                &quot;if_true&quot;: {
                    &quot;enable_lag&quot;: {&quot;value&quot;: False, &quot;locked&quot;: True},
                    &quot;enable_rolling&quot;: {&quot;value&quot;: False, &quot;locked&quot;: True}
                }
            }
        }
    }
    return rules
</code></pre>
<p><strong>é˜²å‘†æ•ˆæœ</strong>ï¼š<br />
- [x] ç„¡æ³•è¼¸å…¥éŒ¯èª¤çš„ physical_typeï¼ˆä¸‹æ‹‰é¸å–®ï¼‰<br />
- [x] æ¨™è¨˜ç‚ºç›®æ¨™è®Šæ•¸å¾Œï¼ŒLag é¸é …è‡ªå‹•é–å®šç‚º FALSE<br />
- [x] å–®ä½é¸æ“‡èˆ‡ç‰©ç†é¡å‹ç¶å®šï¼ˆé¿å…æº«åº¦é¸äº† Barï¼‰</p>
<h3 id="42-excel_to_yamlpy">4.2 ç¬¬äºŒå±¤ï¼šè½‰æ›æ™‚èªæ„é©—è­‰ (excel_to_yaml.py)</h3>
<p><strong>é©—è­‰é‚è¼¯</strong>ï¼š</p>
<pre><code class="language-python">def validate_semantics(excel_df: pd.DataFrame, sample_csv: Optional[Path]) -&gt; List[Warning]:
    &quot;&quot;&quot;
    Excel è½‰ YAML æ™‚çš„èªæ„é©—è­‰
    &quot;&quot;&quot;
    warnings = []

    # æª¢æŸ¥ 1: å–®ä½ä¸€è‡´æ€§ï¼ˆTemperature æ¬„ä½å‡ºç¾ Bar å–®ä½ï¼‰
    for _, row in excel_df.iterrows():
        ptype = row['physical_type']
        unit = row['unit']
        valid_units = PHYSICAL_TYPES[ptype].get('units', [])

        if unit not in valid_units:
            warnings.append(
                f&quot;âš ï¸  {row['column_name']}: {ptype} ä¸æ‡‰ä½¿ç”¨å–®ä½ {unit}ï¼Œ&quot;
                f&quot;å»ºè­°: {valid_units}&quot;
            )

    # æª¢æŸ¥ 2: çµ±è¨ˆåˆ†ä½ˆé©—è­‰ï¼ˆW401-W404ï¼‰
    if sample_csv:
        df = pl.read_csv(sample_csv, n_rows=5000)

        for _, row in excel_df.iterrows():
            col = row['column_name']
            if col not in df.columns:
                continue

            ptype = row['physical_type']
            dist_config = PHYSICAL_TYPES[ptype].get('distribution_check', {})

            stats = df[col].describe()

            # W401: å¹³å‡å€¼è¶…å‡ºæœŸæœ›å€¼ç¯„åœï¼ˆå¯èƒ½å–®ä½éŒ¯èª¤ï¼Œå¦‚è¯æ°èª¤ç‚ºæ”æ°ï¼‰
            if 'expected_mean_range' in dist_config:
                mean_val = stats['mean']
                min_exp, max_exp = dist_config['expected_mean_range']
                if not (min_exp &lt;= mean_val &lt;= max_exp):
                    warnings.append(
                        f&quot;âš ï¸  W401: {col} å¹³å‡å€¼ç‚º {mean_val:.1f}ï¼Œ&quot;
                        f&quot;è¶…å‡ºæœŸæœ›å€¼ç¯„åœ [{min_exp}, {max_exp}]ï¼Œ&quot;
                        f&quot;è«‹ç¢ºèªå–®ä½æˆ–æ¨™è¨»æ­£ç¢ºæ€§&quot;
                    )

            # W402: æ¨™æº–å·®ç‚ºé›¶æˆ–éå°ï¼ˆå‡çµè³‡æ–™ï¼‰
            if stats['std'] &lt; 0.01:
                warnings.append(
                    f&quot;âš ï¸  W402: {col} æ¨™æº–å·®æ¥è¿‘é›¶ ({stats['std']:.4f})ï¼Œ&quot;
                    f&quot;å¯èƒ½æ˜¯å‡çµè³‡æ–™ï¼Œä½†æ¨™è¨»æœªå•Ÿç”¨ FROZEN æª¢æ¸¬&quot;
                )

            # W403: é›¶å€¼æ¯”ä¾‹éé«˜ï¼ˆæ„Ÿæ¸¬å™¨é›¢ç·šï¼‰
            zero_ratio = (df[col] == 0).mean()
            if zero_ratio &gt; dist_config.get('zero_ratio_warning', 0.1):
                warnings.append(
                    f&quot;âš ï¸  W403: {col} é›¶å€¼æ¯”ä¾‹ {zero_ratio:.1%} éé«˜ï¼Œ&quot;
                    f&quot;å¯èƒ½æ˜¯æ„Ÿæ¸¬å™¨é›¢ç·šæˆ–æ¨™è¨»éŒ¯èª¤&quot;
                )

    return warnings
</code></pre>
<p><strong>éŒ¯èª¤è™•ç†ç­–ç•¥</strong>ï¼š<br />
- <strong>Error (é˜»æ“‹)</strong>ï¼šèªæ³•éŒ¯èª¤ã€å¿…å¡«æ¬„ä½ç¼ºå¤±ã€å‹åˆ¥ä¸åŒ¹é… â†’ ç¦æ­¢ç”Ÿæˆ YAML<br />
- <strong>Warning (æé†’)</strong>ï¼šçµ±è¨ˆç•°å¸¸ (W401-W403)ã€å–®ä½ä¸å»ºè­° â†’ ç”Ÿæˆ YAML ä½†æ¨™è¨˜ <code>status: pending_review</code></p>
<h3 id="43-cicd">4.3 ç¬¬ä¸‰å±¤ï¼šCI/CD å¥‘ç´„é©—è­‰</h3>
<p><strong>GitHub Actions Workflow</strong>ï¼š</p>
<pre><code class="language-yaml"># .github/workflows/feature-annotation.yml
name: Feature Annotation Validation

on:
  push:
    paths:
      - 'config/features/**'
      - 'tools/features/**'

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Schema Validation
        run: |
          python -m src.features.validate \
            --schema config/features/schema.json \
            --files config/features/sites/*.yaml

      - name: Sample Data Consistency Check
        run: |
          # ä¸‹è¼‰æœ€æ–°çš„ sample CSVï¼ˆå¾ S3 æˆ–æ¸¬è©¦è³‡æ–™å¤¾ï¼‰
          python -m src.features.validate_distribution \
            --annotation config/features/sites/cgmh_ty.yaml \
            --sample data/samples/cgmh_ty_latest.csv \
            --strict  # å°‡ Warning è¦–ç‚º Error

      - name: Inheritance Check
        run: |
          python -m src.features.inspect cgmh_ty --validate-only
</code></pre>
<h3 id="44">4.4 ç¹¼æ‰¿è¦–è¦ºåŒ–èˆ‡é™¤éŒ¯å·¥å…·</h3>
<p><strong>æ–°å¢ CLI å‘½ä»¤</strong>ï¼š<code>features inspect</code></p>
<pre><code class="language-bash"># æŸ¥çœ‹ç‰¹å®šæ¬„ä½çš„ç¹¼æ‰¿éˆ
python main.py features inspect cgmh_ty --column chiller_1_temp
</code></pre>
<p><strong>è¼¸å‡ºç¯„ä¾‹</strong>ï¼š</p>
<pre><code>Column: chiller_1_temp
================================
æœ€çµ‚é…ç½® (Effective Config):
  physical_type: temperature
  enable_lag: false              [OVERRIDDEN]
  unit: Â°C
  description: &quot;ä¸€è™Ÿæ©Ÿæº«åº¦ï¼ˆå®¢è£½ï¼‰&quot; [OVERRIDDEN]

ç¹¼æ‰¿éˆ (Inheritance Chain):
1. base.yaml
   â”œâ”€ physical_type: temperature
   â”œâ”€ enable_lag: true           [è¢«è¦†è“‹]
   â””â”€ unit: Â°C

2. sites/cgmh_ty.yaml
   â”œâ”€ enable_lag: false         [è¦†è“‹ä¾†æº]
   â””â”€ description: &quot;ä¸€è™Ÿæ©Ÿæº«åº¦ï¼ˆå®¢è£½ï¼‰&quot; [æ–°å¢]

é©—è­‰ç‹€æ…‹: âœ… é€šé
ä¾†æº Excel: cgmh_ty_v2.xlsx (SHA256: abc123...)
</code></pre>
<hr />
<h2 id="5-wizard-cli">5. Wizard äº¤äº’å¼ CLI æ¨¡å¼</h2>
<h3 id="51">5.1 å‘½ä»¤è¦æ ¼</h3>
<pre><code class="language-bash"># å•Ÿå‹•äº¤äº’å¼ç²¾éˆï¼ˆæ¨è–¦çµ¦åˆæ¬¡ä½¿ç”¨è€…ï¼‰
python main.py features wizard --site cgmh_ty --from-csv data.csv

# å¢é‡æ›´æ–°ï¼ˆåƒ…è™•ç†æ–°æ¬„ä½ï¼‰
python main.py features wizard --site cgmh_ty --from-csv data.csv --incremental
</code></pre>
<h3 id="52">5.2 äº¤äº’æµç¨‹è¨­è¨ˆ</h3>
<p><strong>è¨­è¨ˆåŸå‰‡</strong>ï¼šé˜²å‘†è¨­è¨ˆï¼Œé¿å…ã€Œç¢ºèªåèª¤ã€(Confirmation Bias) ç›´æ¥æŒ‰ Y</p>
<pre><code>$ python main.py features wizard --site cgmh_ty --from-csv data.csv

ğŸ” ç™¼ç¾ 3 å€‹æœªå®šç¾©æ¬„ä½ï¼š

[1/3] æ¬„ä½: chiller_1_kwh
  ç³»çµ±æ¨æ¸¬: physical_type=power, unit=kW (åŸºæ–¼æ¬„ä½åç¨± 'kwh')
  æ­·å²ç›¸ä¼¼: chiller_2_kwh (å·²ç¢ºèªç‚º power)
  æ•¸æ“šé è¦½:
    å¹³å‡å€¼: 245.3
    ç¯„åœ: [0, 520]
    åˆ†å¸ƒ: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ æ­£å¸¸

  è«‹é¸æ“‡:
    [Y] ç¢ºèª (ç¢ºèªç‚º power/kW)
    [N] ä¿®æ”¹ (é€²å…¥è©³ç´°è¨­å®š)
    [S] è·³é (æš«ä¸æ¨™è¨»ï¼Œæ¨™è¨˜ç‚º pending)
    [?] æŸ¥çœ‹æ•¸æ“šåˆ†ä½ˆåœ– (é–‹å•Ÿ matplotlib)
    [Q] é€€å‡º
  &gt; 

[2/3] æ¬„ä½: unusual_sensor_01
  âš ï¸  ç³»çµ±ç„¡æ³•æ¨æ¸¬é¡å‹
  æ•¸æ“šé è¦½:
    å¹³å‡å€¼: 1500.0  â— ç•°å¸¸é«˜å€¼
    ç¯„åœ: [0, 9999]

  è«‹é¸æ“‡:
    [1] temperature (Â°C) - å¯èƒ½æ˜¯ Â°F èª¤æ¨™ï¼Ÿ
    [2] pressure (bar) - å¯èƒ½æ˜¯ kPaï¼Ÿ
    [3] custom_type (æ‰‹å‹•è¼¸å…¥)
    [S] è·³é
  &gt; 1

  âš ï¸  è­¦å‘Š: è‹¥ç‚º temperatureï¼Œå¹³å‡å€¼ 1500 è¶…å‡ºæ­£å¸¸ç¯„åœ (-40~100)
  æ˜¯å¦ç¢ºèªï¼Ÿ (å»ºè­°æª¢æŸ¥å–®ä½)
    [Y] ç¢ºèª (æ¨™è¨˜ç‚º temperatureï¼Œä½†åŠ å…¥ pending_review)
    [N] é‡æ–°é¸æ“‡
  &gt; 

âœ… å®Œæˆï¼å·²æ›´æ–° config/features/sites/cgmh_ty.yaml
   æ–°å¢æ¬„ä½: 2 å€‹ (1 confirmed, 1 pending_review)
   è«‹åŸ·è¡Œ `git diff` æŸ¥çœ‹è®Šæ›´ä¸¦æäº¤ PR
</code></pre>
<h3 id="53">5.3 é˜²å‘†è¨­è¨ˆç´°ç¯€</h3>
<ul>
<li><strong>æ•¸æ“šåˆ†ä½ˆé è¦½</strong>ï¼šé¡¯ç¤ºç›´æ–¹åœ– ASCII  art æˆ–é–‹å•Ÿåœ–å½¢ä»‹é¢ï¼Œè®“ä½¿ç”¨è€…ç›´è§€åˆ¤æ–·</li>
<li><strong>ç•°å¸¸å€¼æé†’</strong>ï¼šç•¶æ•¸å€¼è¶…å‡º physical_type å®šç¾©çš„ <code>expected_mean_range</code> æ™‚ï¼Œå¼·åˆ¶äºŒæ¬¡ç¢ºèª</li>
<li><strong>ç›¸ä¼¼æ¬„ä½æ¨è–¦</strong>ï¼šè‹¥ <code>chiller_1_temp</code> å·²å®šç¾©ï¼Œè‡ªå‹•æ¨è–¦ <code>chiller_2_temp</code> ä½¿ç”¨ç›¸åŒè¨­å®š</li>
<li><strong>æ‰¹æ¬¡ç¢ºèªæ¨¡å¼</strong>ï¼šå°æ–¼å¤§é‡ç›¸ä¼¼æ¬„ä½ï¼ˆå¦‚ 10 å°å†°æ©Ÿï¼‰ï¼Œæ”¯æ´ã€Œå¥—ç”¨è‡³æ‰€æœ‰ç›¸ä¼¼æ¬„ä½ã€</li>
</ul>
<hr />
<h2 id="6-excel-to-yaml">6. Excel-to-YAML è½‰æ›è¦æ ¼</h2>
<h3 id="61-excel_to_yamlpy">6.1 è½‰æ›è…³æœ¬ (excel_to_yaml.py)</h3>
<p><strong>è™•ç†ã€Œé˜»æŠ—ä¸åŒ¹é…ã€å•é¡Œ</strong>ï¼š</p>
<pre><code class="language-python">import pandas as pd
import yaml
from pathlib import Path

def convert_excel_to_yaml(excel_path: Path, output_path: Path) -&gt; dict:
    &quot;&quot;&quot;
    å°‡ Excel ç¯„æœ¬è½‰æ›ç‚º YAMLï¼Œè™•ç†åµŒå¥—çµæ§‹å•é¡Œ
    &quot;&quot;&quot;
    # è®€å–å„ Sheet
    df_cols = pd.read_excel(excel_path, sheet_name=&quot;Columns&quot;)
    df_policies = pd.read_excel(excel_path, sheet_name=&quot;Group Policies&quot;)
    df_meta = pd.read_excel(excel_path, sheet_name=&quot;Metadata&quot;, header=None, index_col=0)

    # æ§‹å»º YAML çµæ§‹
    yaml_data = {
        &quot;schema_version&quot;: str(df_meta.loc[&quot;schema_version&quot;, 1]),
        &quot;description&quot;: str(df_meta.loc[&quot;description&quot;, 1]),
        &quot;inherit&quot;: str(df_meta.loc[&quot;inherit&quot;, 1]) if pd.notna(df_meta.loc[&quot;inherit&quot;, 1]) else None,
        &quot;meta&quot;: {
            &quot;editor&quot;: str(df_meta.loc[&quot;editor&quot;, 1]),
            &quot;last_updated&quot;: str(df_meta.loc[&quot;last_updated&quot;, 1]),
            &quot;source_excel&quot;: excel_path.name
        },
        &quot;columns&quot;: {},
        &quot;group_policies&quot;: {}
    }

    # è½‰æ› Columnsï¼ˆè™•ç†åˆ—è¡¨å­—ä¸²ï¼‰
    for _, row in df_cols.iterrows():
        if row[&quot;ç‹€æ…‹&quot;] == &quot;deprecated&quot;:
            continue

        col_def = {
            &quot;column_name&quot;: row[&quot;æ¬„ä½åç¨±&quot;],
            &quot;physical_type&quot;: row[&quot;ç‰©ç†é¡å‹&quot;],
            &quot;description&quot;: row[&quot;æè¿°&quot;] if pd.notna(row[&quot;æè¿°&quot;]) else None,
            &quot;is_target&quot;: row[&quot;æ˜¯å¦ç›®æ¨™&quot;],
            &quot;enable_lag&quot;: row[&quot;å•Ÿç”¨ Lag&quot;],
            &quot;enable_rolling&quot;: row[&quot;å•Ÿç”¨ Rolling&quot;] if pd.notna(row[&quot;å•Ÿç”¨ Rolling&quot;]) else True,
        }

        # è™•ç†åˆ—è¡¨å­—ä¸²ï¼ˆå¦‚ &quot;1,4,96&quot; â†’ [1,4,96]ï¼‰
        if pd.notna(row[&quot;Lag é–“éš”&quot;]):
            lag_str = str(row[&quot;Lag é–“éš”&quot;])
            col_def[&quot;lag_intervals&quot;] = [int(x.strip()) for x in lag_str.split(&quot;,&quot;)]

        # è™•ç†æ¨™ç±¤ï¼ˆé€—è™Ÿåˆ†éš”ï¼‰
        if pd.notna(row[&quot;æ¨™ç±¤&quot;]):
            col_def[&quot;tags&quot;] = [t.strip() for t in str(row[&quot;æ¨™ç±¤&quot;]).split(&quot;,&quot;)]

        yaml_data[&quot;columns&quot;][row[&quot;æ¬„ä½åç¨±&quot;]] = col_def

    # è½‰æ› Group Policies
    for _, row in df_policies.iterrows():
        policy_def = {
            &quot;match_rule&quot;: {
                &quot;type&quot;: row[&quot;åŒ¹é…é¡å‹&quot;],
                &quot;value&quot;: row[&quot;åŒ¹é…å€¼&quot;]
            },
            &quot;physical_type&quot;: row[&quot;ç‰©ç†é¡å‹&quot;],
            &quot;rules&quot;: {
                &quot;lag_intervals&quot;: [int(x) for x in str(row[&quot;Lag é–“éš”&quot;]).split(&quot;,&quot;)],
                &quot;rolling_windows&quot;: [int(x) for x in str(row[&quot;Rolling çª—å£&quot;]).split(&quot;,&quot;)]
            }
        }
        yaml_data[&quot;group_policies&quot;][row[&quot;ç­–ç•¥åç¨±&quot;]] = policy_def

    # é©—è­‰èˆ‡å¯«å…¥
    validate_yaml_structure(yaml_data)  # ä½¿ç”¨ Pydantic
    output_path.write_text(
        yaml.dump(yaml_data, sort_keys=False, allow_unicode=True, default_flow_style=False),
        encoding='utf-8'
    )

    return {&quot;status&quot;: &quot;success&quot;, &quot;warnings&quot;: []}
</code></pre>
<h3 id="62-yaml-to-excel">6.2 é€†å‘è½‰æ›ï¼ˆYAML to Excelï¼‰</h3>
<p>æ”¯æ´å·¥ç¨‹å¸«å°‡ç¾æœ‰ YAML è½‰ç‚º Excel ä¾›é ˜åŸŸå°ˆå®¶ä¿®æ”¹ï¼š</p>
<pre><code class="language-bash">python tools/features/yaml_to_excel.py \
  --yaml config/features/sites/cgmh_ty.yaml \
  --output cgmh_ty_editable.xlsx
</code></pre>
<hr />
<h2 id="7-etl-pipeline">7. èˆ‡ ETL Pipeline çš„æ•´åˆé»ï¼ˆæ›´æ–°ï¼‰</h2>
<h3 id="71-cleaner-v22">7.1 Cleaner v2.2 æ•´åˆï¼ˆé—œéµä¿®æ”¹ï¼‰</h3>
<pre><code class="language-python">def _build_column_metadata(self, df: pl.DataFrame) -&gt; Dict[str, FeatureMetadata]:
    &quot;&quot;&quot;
    ã€æ›´æ–°ã€‘å¾ Feature Annotation è®€å–ï¼Œå–ä»£è‡ªå‹•æ¨æ–·
    &quot;&quot;&quot;
    # ç”± Container æ³¨å…¥ï¼Œä¾†æºå¯èƒ½æ˜¯ YAML æˆ– Excel è½‰æ›å¾Œçš„ YAML
    annotation = self.config.feature_annotation

    metadata = {}
    for col_name in df.columns:
        if col_name == &quot;timestamp&quot;:
            continue

        if col_name not in annotation.columns:
            if annotation.validation.get('strict_mode', True):
                raise ConfigurationError(
                    f&quot;E402: æ¬„ä½ '{col_name}' æœªåœ¨ Feature Annotation ä¸­å®šç¾©ã€‚&quot;
                    f&quot;è«‹åœ¨ Excel ç¯„æœ¬ä¸­å®šç¾©ä¸¦é‡æ–°åŒ¯å‡ºï¼Œæˆ–è¨­å®š allow_unannotated: true&quot;
                )
            # éåš´æ ¼æ¨¡å¼ï¼šä½¿ç”¨ä¿å®ˆé è¨­ï¼Œä½†æ¨™è¨˜è­¦å‘Š
            metadata[col_name] = FeatureMetadata(
                column_name=col_name,
                physical_type=&quot;gauge&quot;,
                status=&quot;auto_inferred&quot;
            )
            self.logger.warning(f&quot;W404: æ¬„ä½ {col_name} ä½¿ç”¨è‡ªå‹•æ¨æ–·ï¼Œå»ºè­°è£œä¸Šæ¨™è¨»&quot;)
            continue

        col_ann = annotation.columns[col_name]

        # ã€æ–°å¢ã€‘çµ±è¨ˆåˆ†ä½ˆé©—è­‰ï¼ˆW401-W403ï¼‰
        if hasattr(col_ann, 'distribution_check'):
            self._validate_distribution(df[col_name], col_ann, col_name)

        metadata[col_name] = FeatureMetadata(
            column_name=col_name,
            physical_type=col_ann.physical_type,
            unit=col_ann.unit,
            is_target=col_ann.is_target,
            enable_lag=col_ann.enable_lag,
            enable_rolling=col_ann.enable_rolling
        )

    return metadata
</code></pre>
<hr />
<h2 id="8">8. éŒ¯èª¤èˆ‡è­¦å‘Šä»£ç¢¼å°ç…§è¡¨ï¼ˆæ›´æ–°ï¼‰</h2>
<table>
<thead>
<tr>
<th style="text-align: center;">ä»£ç¢¼</th>
<th style="text-align: left;">åç¨±</th>
<th style="text-align: center;">å±¤ç´š</th>
<th style="text-align: left;">èªªæ˜</th>
<th style="text-align: left;">è™•ç†æ–¹å¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>E400</strong></td>
<td style="text-align: left;">SCHEMA_VALIDATION_FAILED</td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">YAML èªæ³•éŒ¯èª¤</td>
<td style="text-align: left;">é˜»æ“‹åˆä½µï¼Œä¿®æ­£å¾Œé‡æ–° PR</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E401</strong></td>
<td style="text-align: left;">ORPHAN_COLUMN</td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">æ¨™è¨»æª”æ¡ˆä¸­æœ‰æ¬„ä½ä¸å­˜åœ¨æ–¼è³‡æ–™</td>
<td style="text-align: left;">å…è¨±åŸ·è¡Œï¼Œä½†è¨˜éŒ„æ—¥èªŒ</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E402</strong></td>
<td style="text-align: left;">UNANNOTATED_COLUMN</td>
<td style="text-align: center;">Error/Warning</td>
<td style="text-align: left;">è³‡æ–™ä¸­æœ‰æ¬„ä½æœªå®šç¾©ï¼ˆåš´æ ¼æ¨¡å¼ï¼‰</td>
<td style="text-align: left;">Error: é˜»æ“‹åŸ·è¡Œï¼›Warning: ä½¿ç”¨ä¿å®ˆé è¨­</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E403</strong></td>
<td style="text-align: left;">TYPE_MISMATCH</td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">æ¬„ä½å‹åˆ¥èˆ‡ physical_type é æœŸä¸ç¬¦</td>
<td style="text-align: left;">é˜»æ“‹åŸ·è¡Œ</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E405</strong></td>
<td style="text-align: left;">TARGET_LEAKAGE_RISK</td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">is_target=true ä½† enable_lag=true</td>
<td style="text-align: left;">é˜»æ“‹è½‰æ›ï¼ˆPydantic è‡ªå‹•æ””æˆªï¼‰</td>
</tr>
<tr>
<td style="text-align: center;"><strong>E406</strong></td>
<td style="text-align: left;">INHERITANCE_ERROR</td>
<td style="text-align: center;">Error</td>
<td style="text-align: left;">ç¹¼æ‰¿éˆéŒ¯èª¤æˆ–å¾ªç’°ä¾è³´</td>
<td style="text-align: left;">é˜»æ“‹è¼‰å…¥</td>
</tr>
<tr>
<td style="text-align: center;"><strong>W401</strong></td>
<td style="text-align: left;">MEAN_OUT_OF_RANGE</td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">å¹³å‡å€¼è¶…å‡ºç‰©ç†é¡å‹é æœŸç¯„åœ</td>
<td style="text-align: left;">æ¨™è¨˜ pending_reviewï¼Œç™¼é€å‘Šè­¦</td>
</tr>
<tr>
<td style="text-align: center;"><strong>W402</strong></td>
<td style="text-align: left;">LOW_VARIANCE_WARNING</td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">æ¨™æº–å·®æ¥è¿‘é›¶ï¼ˆå¯èƒ½å‡çµï¼‰</td>
<td style="text-align: left;">å»ºè­°æª¢æŸ¥æ„Ÿæ¸¬å™¨ç‹€æ…‹</td>
</tr>
<tr>
<td style="text-align: center;"><strong>W403</strong></td>
<td style="text-align: left;">HIGH_ZERO_RATIO</td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">é›¶å€¼æ¯”ä¾‹éé«˜</td>
<td style="text-align: left;">å»ºè­°æª¢æŸ¥æ„Ÿæ¸¬å™¨é›¢ç·šæˆ–å–®ä½éŒ¯èª¤</td>
</tr>
<tr>
<td style="text-align: center;"><strong>W404</strong></td>
<td style="text-align: left;">AUTO_INFERRED_WARNING</td>
<td style="text-align: center;">Warning</td>
<td style="text-align: left;">ä½¿ç”¨è‡ªå‹•æ¨æ–·è€Œéæ˜ç¢ºæ¨™è¨»</td>
<td style="text-align: left;">å»ºè­°è£œä¸Šæ¨™è¨»</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="9">9. äº¤ä»˜ç‰©æ¸…å–®ï¼ˆæ›´æ–°ï¼‰</h2>
<h3 id="91">9.1 é…ç½®æ–‡ä»¶</h3>
<ol>
<li><code>config/features/schema.json</code> - JSON Schema é©—è­‰</li>
<li><code>config/features/base.yaml</code> - åŸºç¤å®šç¾©</li>
<li><code>config/features/sites/*.yaml</code> - æ¡ˆå ´å®šç¾©ï¼ˆåƒ…ä¾›éƒ¨ç½²ï¼‰</li>
</ol>
<h3 id="92-excel">9.2 Excel å·¥å…·éˆ</h3>
<ol start="4">
<li><code>tools/features/Feature_Definition_Template.xlsx</code> - Excel ç¯„æœ¬ï¼ˆå« Data Validationï¼‰</li>
<li><code>tools/features/excel_to_yaml.py</code> - è½‰æ›è…³æœ¬ï¼ˆå«çµ±è¨ˆé©—è­‰ï¼‰</li>
<li><code>tools/features/yaml_to_excel.py</code> - é€†å‘è½‰æ›è…³æœ¬</li>
<li><code>tools/features/validation_rules.json</code> - Excel é©—è­‰è¦å‰‡ç”Ÿæˆå™¨</li>
</ol>
<h3 id="93-cli">9.3 CLI å·¥å…·ï¼ˆæ›´æ–°ï¼‰</h3>
<ol start="8">
<li><code>src/cli/features_cli.py</code> - æ–°å¢ <code>wizard</code>, <code>inspect</code>, <code>validate-distribution</code> å‘½ä»¤</li>
</ol>
<h3 id="94">9.4 æ–‡ä»¶ï¼ˆæ›´æ–°ï¼‰</h3>
<ol start="9">
<li><code>docs/features/FEATURE_ANNOTATION_v1.1.md</code> - æœ¬æ–‡ä»¶</li>
<li><code>docs/features/EXCEL_TUTORIAL.md</code> - Excel å¡«å¯«æ•™å­¸ï¼ˆçµ¦ç©ºèª¿æŠ€å¸«ï¼‰</li>
<li><code>docs/features/TROUBLESHOOTING.md</code> - å¸¸è¦‹éŒ¯èª¤æ’è§£ï¼ˆW401-W404 è™•ç†æŒ‡å—ï¼‰</li>
</ol>
<hr />
<h2 id="10">10. é©—æ”¶ç°½æ ¸ï¼ˆæ›´æ–°ï¼‰</h2>
<ul>
<li>[ ] <strong>Excel ç¯„æœ¬</strong>ï¼šData Validation æ­£å¸¸é‹ä½œï¼ˆä¸‹æ‹‰é¸å–®ã€è‡ªå‹•é–å®š Lagï¼‰</li>
<li>[ ] <strong>è½‰æ›è…³æœ¬</strong>ï¼š<code>excel_to_yaml.py</code> æ­£ç¢ºè™•ç†åµŒå¥—çµæ§‹èˆ‡åˆ—è¡¨å­—ä¸²</li>
<li>[ ] <strong>çµ±è¨ˆé©—è­‰</strong>ï¼šW401 èƒ½æ­£ç¢ºæŠ“å‡ºå–®ä½éŒ¯èª¤ï¼ˆå¦‚å¹³å‡å€¼ 1500 çš„æº«åº¦æ¬„ä½ï¼‰</li>
<li>[ ] <strong>Wizard æ¨¡å¼</strong>ï¼šäº¤äº’å¼æµç¨‹èƒ½å¼•å°å®Œæˆæ–°æ¬„ä½æ¨™è¨»</li>
<li>[ ] <strong>ç¹¼æ‰¿å¯è¦–åŒ–</strong>ï¼š<code>features inspect</code> æ­£ç¢ºé¡¯ç¤ºè¦†è“‹éˆ</li>
<li>[ ] <strong>ä¸‰å±¤é˜²è­·</strong>ï¼šExcel é˜²å‘† â†’ è½‰æ›é©—è­‰ â†’ CI/CD é©—è­‰çš†é‹ä½œæ­£å¸¸</li>
<li>[ ] <strong>æ•´åˆæ¸¬è©¦</strong>ï¼šExcel ä¿®æ”¹ â†’ YAML ç”Ÿæˆ â†’ Cleaner è®€å– â†’ Group Policy å¥—ç”¨ å…¨éˆè·¯æš¢é€š</li>
</ul>
<hr />
</body>
</html>