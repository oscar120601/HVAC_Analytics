# 📅 2026-02-13 工作計畫：系統整合與 V2 啟動

**目標：** 完成 ETL 架構的最後一哩路（系統整合與配置），並產出模型訓練與最佳化引擎的規格書，下午正式啟動程式碼實作。

---

## 1. 上午：架構補完與規格定義 (09:00 - 12:00)

重點在於將分散的 ETL 模組串聯起來，並定義「後 ETL 時代」的應用場景。

### ✅ 任務 1：撰寫 `PRD_SYSTEM_INTEGRATION_v1.0.md` (系統整合架構)
*   **核心目標**：定義模組如何組裝，以及如何管理全域配置 (SSOT)。
*   **關鍵內容**：
    *   **配置系統 (Configuration System)**：
        *   定義 `config_models.py` 的完整結構（含 `feature_mapping` 的 Pydantic Schema）。
        *   確立 `settings.yaml` 的階層結構。
    *   **依賴注入 (Dependency Injection)**：
        *   設計 `Container` 類別，負責初始化 Cleaner, BatchProcessor, FeatureEngineer。
    *   **Entry Point**：
        *   設計 `main.py` 的 CLI 介面 (e.g., `python main.py run-etl --date 2026-02-12`)。

### ✅ 任務 2：撰寫 `PRD_MODEL_TRAINING_v1.0.md` (模型訓練管線)
*   **核心目標**：定義從「特徵工程輸出」到「模型產出」的標準流程。
*   **關鍵內容**：
    *   **Input Contract**：如何讀取 Feature Engineer 的 Parquet 輸出。
    *   **Model Registry**：模型檔案 (`.model`, `.json`) 的命名與版控規則。
    *   **Evaluation**：定義驗收指標 (CVRMSE < 10%, R2 > 0.9)。

### ✅ 任務 3：撰寫 `PRD_OPTIMIZATION_ENGINE_v1.0.md` (最佳化引擎)
*   **核心目標**：定義如何利用訓練好的模型進行參數建議。
*   **關鍵內容**：
    *   **Objective Function**：最小化 `KW/RT` 或 `Total KW`。
    *   **Constraints**：定義物理限制 (e.g., 冰水出水溫不可低於 6.5°C)。
    *   **Output Format**：建議值的 JSON 結構 (供與控制系統對接)。

---

## 2. 下午：V2 實作啟動 (13:00 - 18:00)

結束純文件工作，開始寫 Code，驗證架構設計的可行性。

### 🚀 任務 4：建立 SSOT 核心 (Stage 0-1)
*   **檔案**：`src/etl/config_models.py`
*   **實作細節**：
    *   定義 `VALID_QUALITY_FLAGS` (Cleaner/Batch/Feature 共用)。
    *   實作 `ParquetOutputConfig` (強制 INT64/UTC)。
    *   實作 `FeatureMapping` 的 Pydantic 模型 (取代舊的 pure dict)。

### 🚀 任務 5：建立專案骨架 (Stage 0-2)
*   **檔案**：`src/main.py`, `src/container.py`
*   **實作細節**：
    *   建立空的 `ETLConfig` 載入邏輯。
    *   設定全域 Logger。
    *   建立一個 "Hello World" 等級的 Pipeline 串接測試。

---

## 3. 預期交付產物 (Deliverables)

1.  📄 `docs/integration/PRD_SYSTEM_INTEGRATION_v1.0.md`
2.  📄 `docs/modeling/PRD_MODEL_TRAINING_v1.0.md`
3.  📄 `docs/optimization/PRD_OPTIMIZATION_ENGINE_v1.0.md`
4.  💻 `src/etl/config_models.py` (Source Code)

---

## 4. 風險預警

*   **Feature Mapping 遷移風險**：舊的 `feature_mapping.py` 結構雜亂，轉移到 Pydantic 時可能會發現缺少 metadata (如 unit, physical_type)。下午實作時需優先盤點缺漏。
