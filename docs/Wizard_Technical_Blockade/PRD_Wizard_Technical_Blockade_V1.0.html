<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRD_Wizard_Technical_Blockade_V1.0</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
    font-size: 16px;
    line-height: 1.5;
    word-wrap: break-word;
    color: #24292e;
    background-color: #fff;
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem;
}
h1, h2, h3, h4, h5, h6 {
    margin-top: 24px;
    margin-bottom: 16px;
    font-weight: 600;
    line-height: 1.25;
}
h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
h3 { font-size: 1.25em; }
code {
    padding: 0.2em 0.4em;
    margin: 0;
    font-size: 85%;
    background-color: #f6f8fa;
    border-radius: 6px;
    font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
}
pre {
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f6f8fa;
    border-radius: 6px;
}
pre code {
    display: inline;
    padding: 0;
    margin: 0;
    overflow: visible;
    line-height: inherit;
    word-wrap: normal;
    background-color: initial;
    border: 0;
}
blockquote {
    padding: 0 1em;
    color: #6a737d;
    border-left: 0.25em solid #dfe2e5;
    margin: 0;
}
table {
    display: block;
    width: 100%;
    margin-top: 0;
    margin-bottom: 16px;
    overflow: auto;
    border-spacing: 0;
    border-collapse: collapse;
}
table th, table td {
    padding: 6px 13px;
    border: 1px solid #dfe2e5;
}
table tr {
    background-color: #fff;
    border-top: 1px solid #c6cbd1;
}
table tr:nth-child(2n) {
    background-color: #f6f8fa;
}
a { color: #0366d6; text-decoration: none; }
a:hover { text-decoration: underline; }
hr {
    height: 0.25em;
    padding: 0;
    margin: 24px 0;
    background-color: #e1e4e8;
    border: 0;
}
</style>

</head>
<body>
<h1 id="prd-v10-wizard-wizard-technical-blockade">PRD v1.0: Wizard æŠ€è¡“é˜»æ“‹æ©Ÿåˆ¶ (Wizard Technical Blockade)</h1>
<h1 id="excel-yaml">é˜²æ­¢ç¹é Excel ç›´æ¥å¯«å…¥ YAML çš„ä¸‰å±¤é˜²è­·æ¶æ§‹</h1>
<p><strong>æ–‡ä»¶ç‰ˆæœ¬:</strong> v1.0 (Technical Enforcement of SSOT)<br />
<strong>æ—¥æœŸ:</strong> 2026-02-13<br />
<strong>è² è²¬äºº:</strong> Oscar Chang<br />
<strong>ç›®æ¨™æ¨¡çµ„:</strong> <code>src/features/wizard.py</code>, <code>tools/features/excel_to_yaml.py</code>, <code>src/security/</code>, CI/CD Pipeline<br />
<strong>ç›¸ä¾æ–‡ä»¶:</strong> <br />
- PRD_System_Integration_v1.2.md (æª”æ¡ˆé–èˆ‡åˆå§‹åŒ–é †åº)<br />
- PRD_Feature_Annotation_Specification_V1.2.md (Excel-Centric SSOT)<br />
- PRD_Interface_Contract_v1.1.md (éŒ¯èª¤ä»£ç¢¼ E501)</p>
<p><strong>é ä¼°å·¥æ™‚:</strong> 3 ~ 4 å€‹å·¥ç¨‹å¤©ï¼ˆå« CI/CD æ•´åˆèˆ‡æ¬Šé™æ¸¬è©¦ï¼‰</p>
<hr />
<h2 id="1">1. åŸ·è¡Œç¸½ç¶±èˆ‡è¨­è¨ˆå“²å­¸</h2>
<h3 id="11">1.1 æ ¸å¿ƒç›®æ¨™</h3>
<p>å»ºç«‹<strong>ä¸å¯ç¹éçš„æŠ€è¡“å±éšœ</strong>ï¼Œç¢ºä¿ Feature Annotation çš„ã€ŒExcel å”¯ä¸€ç·¨è¼¯ã€æ”¿ç­–ä¸åƒ…æ˜¯è¦ç¯„ï¼Œæ›´æ˜¯<strong>ç‰©ç†ä¸Šç„¡æ³•é•å</strong>çš„æŠ€è¡“é™åˆ¶ï¼š</p>
<ol>
<li><strong>Runtime å±¤ç´šé˜»æ“‹</strong>: Wizard é€²ç¨‹åœ¨æŠ€è¡“ä¸Šç„¡æ³•åŸ·è¡Œ YAML å¯«å…¥æ“ä½œï¼ˆAPI éš”é›¢ï¼‰</li>
<li><strong>Filesystem å±¤ç´šé˜»æ“‹</strong>: YAML æª”æ¡ˆåœ¨ä½œæ¥­ç³»çµ±å±¤ç´šè¨­ç‚ºå”¯è®€ï¼ˆimmutable æˆ– 444 æ¬Šé™ï¼‰</li>
<li><strong>CI/CD å±¤ç´šé˜»æ“‹</strong>: ä»»ä½•ç›´æ¥ä¿®æ”¹ YAML çš„ç¨‹å¼ç¢¼è®Šæ›´éƒ½æœƒåœ¨ Pre-commit èˆ‡ PR éšæ®µè¢«é˜»æ“‹</li>
<li><strong>è·è²¬åˆ†é›¢å¼·åˆ¶åŸ·è¡Œ</strong>: Wizard åƒ…èƒ½é€é <code>ExcelWriteContract</code> ä»‹é¢è¼¸å‡ºï¼Œç„¡æ³•å–å¾— YAML æª”æ¡ˆè·¯å¾‘</li>
</ol>
<h3 id="12">1.2 æ¶æ§‹æ¦‚è¦½ï¼ˆä¸‰å±¤é˜²è­·ï¼‰</h3>
<pre><code class="language-mermaid">graph TB
    subgraph &quot;Layer 1: Runtime API Isolation&quot;
        W[Wizard æ¨¡çµ„] --&gt;|åƒ…å…è¨±| EW[ExcelWriteContract&lt;br/&gt;å¯«å…¥ .xlsx]
        W --&gt;|ç¦æ­¢å°å…¥| Y[yaml åº«&lt;br/&gt;ImportError]
        W --&gt;|ç¦æ­¢å­˜å–| YP[YAML Path&lt;br/&gt;AttributeError]
    end

    subgraph &quot;Layer 2: Filesystem Protection&quot;
        YF[config/features/sites/*.yaml] --&gt;|chmod 444&lt;br/&gt;æˆ– chattr +i| RO[å”¯è®€ç‹€æ…‹]
        ET[excel_to_yaml.py&lt;br/&gt;ç‰¹æ¬Šé€²ç¨‹] --&gt;|sudo æˆ–ç‰¹æ®Šæ¬Šé™| RW[çŸ­æš«å¯å¯«&lt;br/&gt;è½‰æ›æ™‚]
        W -.-&gt;|å¯«å…¥å˜—è©¦| EP[E501 éŒ¯èª¤&lt;br/&gt;Permission Denied]
    end

    subgraph &quot;Layer 3: CI/CD Enforcement&quot;
        GIT[Git Commit] --&gt;|Pre-commit Hook| HC[æª¢æŸ¥ YAML è®Šæ›´]
        HC --&gt;|æª¢æ¸¬åˆ°| YC[YAML ç›´æ¥ä¿®æ”¹] --&gt;|é˜»æ“‹| BL[Blocked&lt;br/&gt;E501 Security Error]
        PR[Pull Request] --&gt;|GitHub Action| GA[é©—è­‰ YAML ä¾†æº]
        GA --&gt;|é excel_to_yaml ç”Ÿæˆ| BL
    end

    subgraph &quot;Emergency Override&quot;
        ADMIN[ç³»çµ±ç®¡ç†å“¡] --&gt;|ç‰¹æ®Šæ†‘è­‰| EA[EmergencyAccess&lt;br/&gt;é›™äººé©—è­‰]
        EA --&gt;|é™æ™‚ 30 åˆ†é˜| TEMP[æš«æ™‚è§£é™¤é–å®š&lt;br/&gt;å®Œæ•´ç¨½æ ¸æ—¥èªŒ]
    end

    style W fill:#f9f,stroke:#333,stroke-width:2px
    style Y fill:#faa,stroke:#f00,stroke-width:2px
    style RO fill:#afa,stroke:#0f0,stroke-width:2px
    style BL fill:#faa,stroke:#f00,stroke-width:2px
</code></pre>
<hr />
<h2 id="2-layer-1-runtime-api">2. Layer 1: Runtime API éš”é›¢ï¼ˆç¨‹å¼ç¢¼å±¤ç´šé˜»æ“‹ï¼‰</h2>
<h3 id="21-wizard-yaml">2.1 Wizard ä¾è³´é™åˆ¶ï¼ˆç¦æ­¢å°å…¥ yamlï¼‰</h3>
<p><strong>æª”æ¡ˆ</strong>: <code>src/security/import_guard.py</code> (æ–°å¢)</p>
<p><strong>æ©Ÿåˆ¶</strong>: åœ¨ Python Import System å±¤ç´šæ””æˆªï¼Œç¢ºä¿ Wizard åŠå…¶å­æ¨¡çµ„ç„¡æ³•è¼‰å…¥ yaml ç›¸é—œåº«ã€‚</p>
<pre><code class="language-python">import sys
import importlib
from typing import Set

# Wizard æ¨¡çµ„è·¯å¾‘å‰ç¶´
WIZARD_MODULES: Set[str] = {
    'src.features.wizard',
    'src.features.wizard_cli',
    'tools.features.wizard_utils',
}

# ç¦æ­¢å°å…¥çš„åº«ï¼ˆYAML å¯«å…¥ç›¸é—œï¼‰
BLOCKED_YAML_MODULES: Set[str] = {
    'yaml',
    'ruamel.yaml',
    'pyyaml',
    'oyaml',
}

class WizardImportGuard:
    &quot;&quot;&quot;
    ç›£æ§ Wizard æ¨¡çµ„çš„å°å…¥è¡Œç‚ºï¼Œç¦æ­¢è¼‰å…¥ YAML è™•ç†åº«ã€‚
    æ­¤æ©Ÿåˆ¶åœ¨ Runtime å±¤ç´šå¼·åˆ¶åŸ·è¡Œã€ŒWizard ä¸å¯« YAMLã€æ”¿ç­–ã€‚
    &quot;&quot;&quot;

    def __init__(self):
        self._original_import = builtins.__import__
        self._active = False

    def install(self):
        &quot;&quot;&quot;å®‰è£å°å…¥æ””æˆªå™¨&quot;&quot;&quot;
        builtins.__import__ = self._guarded_import
        self._active = True

    def uninstall(self):
        &quot;&quot;&quot;ç§»é™¤å°å…¥æ””æˆªå™¨ï¼ˆåƒ…é™æ¸¬è©¦ä½¿ç”¨ï¼‰&quot;&quot;&quot;
        builtins.__import__ = self._original_import
        self._active = False

    def _guarded_import(self, name, *args, **kwargs):
        &quot;&quot;&quot;æ””æˆªå°å…¥è«‹æ±‚&quot;&quot;&quot;
        if not self._active:
            return self._original_import(name, *args, **kwargs)

        # æª¢æŸ¥å‘¼å«å †ç–Šæ˜¯å¦ä¾†è‡ª Wizard æ¨¡çµ„
        frame = sys._getframe(1)
        caller_module = frame.f_globals.get('__name__', '')

        is_wizard_context = any(
            caller_module.startswith(wm) for wm in WIZARD_MODULES
        )

        if is_wizard_context:
            # æª¢æŸ¥æ˜¯å¦å˜—è©¦å°å…¥ YAML åº«
            base_module = name.split('.')[0]
            if base_module in BLOCKED_YAML_MODULES:
                raise ImportError(
                    f&quot;E501: Wizard æ¨¡çµ„ç¦æ­¢å°å…¥ '{name}'ã€‚ &quot;
                    f&quot;Wizard åƒ…å…è¨±å¯«å…¥ Excelï¼Œç¦æ­¢ç›´æ¥æ“ä½œ YAMLã€‚ &quot;
                    f&quot;è«‹ä½¿ç”¨ tools/features/excel_to_yaml.py é€²è¡Œè½‰æ›ã€‚&quot;
                )

        return self._original_import(name, *args, **kwargs)

# å…¨åŸŸå®‰è£ï¼ˆåœ¨ src/features/wizard.py å°å…¥æ™‚è‡ªå‹•è§¸ç™¼ï¼‰
_import_guard = WizardImportGuard()
_import_guard.install()
</code></pre>
<h3 id="22-wizard">2.2 Wizard é¡åˆ¥å®‰å…¨è¨­è¨ˆï¼ˆä¾è³´æ³¨å…¥é™åˆ¶ï¼‰</h3>
<p><strong>æª”æ¡ˆ</strong>: <code>src/features/wizard.py</code> (å®‰å…¨å¼·åŒ–ç‰ˆ)</p>
<p><strong>é—œéµè¨­è¨ˆ</strong>:<br />
- <strong>è·¯å¾‘éš”é›¢</strong>: Wizard åƒ…çŸ¥é“ <code>excel_base_dir</code>ï¼Œå®Œå…¨ç„¡æ³•å–å¾— <code>yaml_base_dir</code><br />
- <strong>ä»‹é¢é™åˆ¶</strong>: åƒ…é€é <code>ExcelWriteContract</code> å¯«å…¥ï¼Œç„¡æª”æ¡ˆç³»çµ±ç›´æ¥æ“ä½œæ¬Šé™<br />
- <strong>å±¬æ€§ä¿è­·</strong>: ä½¿ç”¨ <code>__slots__</code> é˜²æ­¢å‹•æ…‹æ–°å¢å±¬æ€§ç¹éé™åˆ¶</p>
<pre><code class="language-python">from pathlib import Path
from typing import Optional, Dict, Any
from dataclasses import dataclass
from datetime import datetime

# å®‰å…¨åŒ¯å…¥ï¼šç¢ºä¿ yaml åº«ç„¡æ³•è¢«å°å…¥ï¼ˆå— import_guard ä¿è­·ï¼‰
try:
    import yaml
    # è‹¥æˆåŠŸå°å…¥è¡¨ç¤ºæœªæ­£ç¢ºå®‰è£ guardï¼ˆé–‹ç™¼ç’°å¢ƒè­¦å‘Šï¼‰
    import warnings
    warnings.warn(&quot;Wizard ä¸æ‡‰åœ¨å®‰è£ ImportGuard çš„ç’°å¢ƒä¸­å°å…¥ yaml&quot;, RuntimeWarning)
except ImportError:
    pass  # é æœŸè¡Œç‚ºï¼šyaml è¢«é˜»æ“‹

@dataclass(frozen=True)
class ExcelWriteContract:
    &quot;&quot;&quot;
    Wizard å”¯ä¸€å…è¨±çš„è¼¸å‡ºä»‹é¢ã€‚
    frozen=True ç¢ºä¿åˆç´„ä¸å¯è®Šï¼Œé˜²æ­¢å‹•æ…‹ä¿®æ”¹è·¯å¾‘ã€‚
    &quot;&quot;&quot;
    site_id: str
    excel_path: Path
    template_version: str = &quot;1.2&quot;
    # æ˜ç¢ºç¦æ­¢ yaml è·¯å¾‘
    yaml_path: None = None  # å‹åˆ¥æç¤ºç‚º Noneï¼Œé˜²æ­¢èª¤ç”¨

    def __post_init__(self):
        # é©—è­‰è·¯å¾‘å¿…é ˆæ˜¯ .xlsx
        if self.excel_path.suffix != '.xlsx':
            raise ValueError(f&quot;E501: Wizard åƒ…å…è¨±å¯«å…¥ .xlsx æª”æ¡ˆï¼Œæ”¶åˆ°: {self.excel_path}&quot;)

class SecureFeatureWizard:
    &quot;&quot;&quot;
    å®‰å…¨å¼·åŒ–ç‰ˆ Feature Wizardã€‚

    å®‰å…¨ç‰¹æ€§:
    1. __slots__ é˜²æ­¢å‹•æ…‹å±¬æ€§ï¼ˆç„¡æ³•å‹•æ…‹æ·»åŠ  _yaml_pathï¼‰
    2. å»ºæ§‹å­åƒ…æ¥å— excel_base_dirï¼Œç„¡æ³•å–å¾— yaml è·¯å¾‘
    3. æ‰€æœ‰å¯«å…¥æ“ä½œé€é ExcelWriteContractï¼Œå—å¯©æ ¸æ—¥èªŒè¨˜éŒ„
    4. å˜—è©¦å¯«å…¥é .xlsx è·¯å¾‘æœƒè§¸ç™¼ E501 éŒ¯èª¤
    &quot;&quot;&quot;

    __slots__ = ('_site_id', '_excel_dir', '_template_version', '_audit_log')

    def __init__(
        self, 
        site_id: str, 
        excel_base_dir: str,
        template_version: str = &quot;1.2&quot;,
        # åˆ»æ„ä¸æä¾› yaml_base_dir åƒæ•¸
    ):
        self._site_id = site_id
        self._excel_dir = Path(excel_base_dir)
        self._template_version = template_version
        self._audit_log = []

        # é©—è­‰ç›®éŒ„å­˜åœ¨
        if not self._excel_dir.exists():
            raise FileNotFoundError(f&quot;Excel ç›®éŒ„ä¸å­˜åœ¨: {excel_base_dir}&quot;)

    @property
    def excel_path(self) -&gt; Path:
        &quot;&quot;&quot;å”¯è®€å±¬æ€§ï¼šExcel æª”æ¡ˆè·¯å¾‘&quot;&quot;&quot;
        return self._excel_dir / self._site_id / f&quot;{self._site_id}.xlsx&quot;

    # åˆ»æ„ä¸æä¾› yaml_path å±¬æ€§
    # ä»»ä½•å˜—è©¦å­˜å– yaml è·¯å¾‘çš„ç¨‹å¼ç¢¼æœƒè§¸ç™¼ AttributeError

    def write_annotation(self, data: Dict[str, Any]) -&gt; ExcelWriteContract:
        &quot;&quot;&quot;
        å¯«å…¥æ¨™è¨»è³‡æ–™åˆ° Excelï¼ˆå”¯ä¸€åˆæ³•è¼¸å‡ºæ–¹å¼ï¼‰ã€‚

        Args:
            data: æ¨™è¨»è³‡æ–™å­—å…¸

        Returns:
            ExcelWriteContract: å¯«å…¥åˆç´„ï¼ˆä¾›å¾ŒçºŒè¿½è¹¤ï¼‰

        Raises:
            PermissionError: è‹¥å˜—è©¦å¯«å…¥é Excel è·¯å¾‘ï¼ˆE501ï¼‰
        &quot;&quot;&quot;
        # é©—è­‰è¼¸å‡ºè·¯å¾‘
        output_path = self.excel_path

        # ç¢ºä¿å‰¯æª”åæ­£ç¢ºï¼ˆæœ€å¾Œä¸€é“é˜²ç·šï¼‰
        if output_path.suffix != '.xlsx':
            raise PermissionError(f&quot;E501: å˜—è©¦å¯«å…¥é Excel æª”æ¡ˆ: {output_path}&quot;)

        # åŸ·è¡Œå¯«å…¥ï¼ˆä½¿ç”¨ openpyxl æˆ– pandasï¼Œç¦æ­¢ yamlï¼‰
        self._write_to_excel(output_path, data)

        # å¯©æ ¸æ—¥èªŒ
        contract = ExcelWriteContract(
            site_id=self._site_id,
            excel_path=output_path,
            template_version=self._template_version
        )
        self._audit_log.append({
            'timestamp': datetime.now().isoformat(),
            'action': 'write_excel',
            'path': str(output_path),
            'contract': contract
        })

        return contract

    def _write_to_excel(self, path: Path, data: Dict[str, Any]):
        &quot;&quot;&quot;å¯¦éš›å¯«å…¥ Excelï¼ˆä½¿ç”¨ pandasï¼Œç¦æ­¢ yamlï¼‰&quot;&quot;&quot;
        import pandas as pd
        import openpyxl

        # è½‰æ›è³‡æ–™ç‚º DataFrameï¼ˆèˆ‡ v1.2 é‚è¼¯ç›¸åŒï¼‰
        df = self._convert_to_dataframe(data)

        # å¯«å…¥ Excelï¼ˆä½¿ç”¨ openpyxl engineï¼‰
        with pd.ExcelWriter(path, engine='openpyxl') as writer:
            df.to_excel(writer, sheet_name='Features', index=False)

            # å¯«å…¥ System sheetï¼ˆå…ƒè³‡æ–™ï¼‰
            metadata_df = pd.DataFrame([
                ['schema_version', self._template_version],
                ['last_updated', datetime.now().isoformat()],
                ['generator', 'SecureFeatureWizard'],
                ['security_level', 'excel_only']
            ], columns=['key', 'value'])
            metadata_df.to_excel(writer, sheet_name='System', index=False)

    def get_audit_log(self) -&gt; list:
        &quot;&quot;&quot;å–å¾—å¯©æ ¸æ—¥èªŒï¼ˆç”¨æ–¼åˆè¦æª¢æŸ¥ï¼‰&quot;&quot;&quot;
        return self._audit_log.copy()

    # æ˜ç¢ºç¦æ­¢çš„æ–¹æ³•ï¼ˆå®šç¾©ä½†æ‹‹å‡ºéŒ¯èª¤ï¼Œé˜²æ­¢èª¤ç”¨ï¼‰
    def write_yaml(self, *args, **kwargs):
        &quot;&quot;&quot;E501: æ˜ç¢ºç¦æ­¢å¯«å…¥ YAML&quot;&quot;&quot;
        raise PermissionError(
            &quot;E501: Wizard ç¦æ­¢ç›´æ¥å¯«å…¥ YAMLã€‚ &quot;
            &quot;è«‹ä½¿ç”¨: python tools/features/excel_to_yaml.py &quot;
            &quot;å°‡ Excel è½‰æ›ç‚º YAMLã€‚&quot;
        )

    def _save_yaml(self, *args, **kwargs):
        &quot;&quot;&quot;å…§éƒ¨æ–¹æ³•åŒæ¨£ç¦æ­¢ï¼ˆé˜²æ­¢ç¹éï¼‰&quot;&quot;&quot;
        self.write_yaml()
</code></pre>
<h3 id="23-runtime-verification">2.3 åŸ·è¡ŒæœŸé©—è­‰ï¼ˆRuntime Verificationï¼‰</h3>
<p><strong>æª”æ¡ˆ</strong>: <code>src/security/runtime_verifier.py</code></p>
<pre><code class="language-python">import inspect
import sys

class WizardRuntimeVerifier:
    &quot;&quot;&quot;
    åœ¨ Wizard åŸ·è¡ŒæœŸé–“é©—è­‰å®‰å…¨æ€§ç´„æŸã€‚
    å¯é€éåå°„æª¢æŸ¥ Wizard å¯¦ä¾‹æ˜¯å¦å˜—è©¦ç¹éé™åˆ¶ã€‚
    &quot;&quot;&quot;

    @staticmethod
    def verify_wizard_instance(wizard_instance) -&gt; bool:
        &quot;&quot;&quot;
        é©—è­‰ Wizard å¯¦ä¾‹ç¬¦åˆå®‰å…¨è¦ç¯„ã€‚

        Returns:
            bool: True è¡¨ç¤ºå®‰å…¨

        Raises:
            SecurityError: ç™¼ç¾é•è¦è¡Œç‚º
        &quot;&quot;&quot;
        # æª¢æŸ¥æ˜¯å¦æœ‰ yaml ç›¸é—œå±¬æ€§
        forbidden_attrs = ['_yaml_path', 'yaml_writer', 'yaml_config']
        for attr in forbidden_attrs:
            if hasattr(wizard_instance, attr):
                raise SecurityError(
                    f&quot;E501: Wizard å¯¦ä¾‹åŒ…å«ç¦æ­¢çš„å±¬æ€§ '{attr}'ï¼Œ&quot;
                    f&quot;å¯èƒ½å˜—è©¦ç¹é Excel-Only é™åˆ¶ã€‚&quot;
                )

        # æª¢æŸ¥é¡åˆ¥ MROï¼ˆæ–¹æ³•è§£æé †åºï¼‰æ˜¯å¦æœ‰ yaml ç›¸é—œé¡åˆ¥
        mro = inspect.getmro(type(wizard_instance))
        forbidden_classes = ['YamlWriter', 'YAMLExporter', 'ConfigDumper']
        for cls in mro:
            if cls.__name__ in forbidden_classes:
                raise SecurityError(
                    f&quot;E501: Wizard ç¹¼æ‰¿äº†ç¦æ­¢çš„é¡åˆ¥ '{cls.__name__}'&quot;
                )

        return True

class SecurityError(Exception):
    &quot;&quot;&quot;å®‰å…¨æ€§é•åéŒ¯èª¤&quot;&quot;&quot;
    pass
</code></pre>
<hr />
<h2 id="3-layer-2-os">3. Layer 2: æª”æ¡ˆç³»çµ±é˜²è­·ï¼ˆOS å±¤ç´šé˜»æ“‹ï¼‰</h2>
<h3 id="31-yaml">3.1 YAML æª”æ¡ˆæ¬Šé™ç®¡ç†</h3>
<p><strong>æª”æ¡ˆ</strong>: <code>src/security/filesystem_guard.py</code></p>
<p><strong>æ©Ÿåˆ¶</strong>: ä½¿ç”¨ Linux filesystem permissions èˆ‡ optional immutable flagï¼Œç¢ºä¿ YAML æª”æ¡ˆç„¡æ³•è¢«ä¸€èˆ¬ä½¿ç”¨è€…ä¿®æ”¹ã€‚</p>
<pre><code class="language-python">import os
import stat
import subprocess
from pathlib import Path
from contextlib import contextmanager
from typing import Union

class FilesystemGuard:
    &quot;&quot;&quot;
    YAML æª”æ¡ˆç³»çµ±é˜²è­·ç®¡ç†å™¨ã€‚

    æä¾›å…©ç¨®é˜²è­·ç­‰ç´š:
    1. Standard (444): ç§»é™¤å¯«å…¥æ¬Šé™ï¼ˆå¯å¾©åŸï¼‰
    2. Immutable (+i): é€£ root éƒ½ç„¡æ³•ä¿®æ”¹ï¼ˆéœ€ç‰¹æ¬Šè§£é™¤ï¼‰
    &quot;&quot;&quot;

    def __init__(self, yaml_base_dir: Union[str, Path]):
        self.yaml_dir = Path(yaml_base_dir)
        self._immutable_available = self._check_chattr_support()

    def _check_chattr_support(self) -&gt; bool:
        &quot;&quot;&quot;æª¢æŸ¥æ˜¯å¦æ”¯æ´ chattrï¼ˆLinux ext4/xfsï¼‰&quot;&quot;&quot;
        try:
            result = subprocess.run(
                ['chattr', '--help'], 
                capture_output=True, 
                check=False
            )
            return result.returncode == 0
        except FileNotFoundError:
            return False

    def protect_yaml_file(self, site_id: str, level: str = 'standard') -&gt; Path:
        &quot;&quot;&quot;
        ä¿è­·ç‰¹å®šæ¡ˆå ´çš„ YAML æª”æ¡ˆã€‚

        Args:
            site_id: æ¡ˆå ´è­˜åˆ¥ç¢¼
            level: 'standard' (444) æˆ– 'immutable' (+i)

        Returns:
            Path: è¢«ä¿è­·çš„æª”æ¡ˆè·¯å¾‘
        &quot;&quot;&quot;
        yaml_path = self.yaml_dir / f&quot;{site_id}.yaml&quot;

        if not yaml_path.exists():
            raise FileNotFoundError(f&quot;YAML æª”æ¡ˆä¸å­˜åœ¨: {yaml_path}&quot;)

        if level == 'standard':
            # è¨­å®šç‚ºå”¯è®€ï¼ˆæ‰€æœ‰è€…ã€ç¾¤çµ„ã€å…¶ä»–äººéƒ½åªèƒ½è®€å–ï¼‰
            os.chmod(yaml_path, stat.S_IRUSR | stat.S_IRGRP | stat.S_IROTH)
            # 444 = r--r--r--

        elif level == 'immutable':
            if not self._immutable_available:
                raise RuntimeError(&quot;ç›®å‰ä½œæ¥­ç³»çµ±ä¸æ”¯æ´ chattr +i&quot;)

            # å…ˆè¨­å®šæ¬Šé™
            os.chmod(yaml_path, stat.S_IRUSR | stat.S_IRGRP | stat.S_IROTH)
            # å†è¨­å®š immutable flagï¼ˆéœ€è¦ rootï¼‰
            subprocess.run(
                ['sudo', 'chattr', '+i', str(yaml_path)],
                check=True,
                capture_output=True
            )

        return yaml_path

    def unprotect_yaml_file(self, site_id: str, level: str = 'standard') -&gt; Path:
        &quot;&quot;&quot;
        è§£é™¤ä¿è­·ï¼ˆåƒ…ä¾› excel_to_yaml.py ç‰¹æ¬Šä½¿ç”¨ï¼‰ã€‚

        Args:
            site_id: æ¡ˆå ´è­˜åˆ¥ç¢¼
            level: ä¿è­·ç­‰ç´šï¼ˆå¿…é ˆèˆ‡ protect æ™‚ä¸€è‡´ï¼‰
        &quot;&quot;&quot;
        yaml_path = self.yaml_dir / f&quot;{site_id}.yaml&quot;

        if level == 'immutable':
            if self._immutable_available:
                subprocess.run(
                    ['sudo', 'chattr', '-i', str(yaml_path)],
                    check=True,
                    capture_output=True
                )

        # æ¢å¾©ç‚ºå¯è®€å¯«ï¼ˆ664 = rw-rw-r--ï¼‰
        os.chmod(yaml_path, 
                stat.S_IRUSR | stat.S_IWUSR | 
                stat.S_IRGRP | stat.S_IWGRP | 
                stat.S_IROTH)

        return yaml_path

    @contextmanager
    def temporary_unprotect(self, site_id: str, level: str = 'standard'):
        &quot;&quot;&quot;
        ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼šæš«æ™‚è§£é™¤ä¿è­·ï¼Œå®Œæˆæ“ä½œå¾Œè‡ªå‹•æ¢å¾©ã€‚

        Usage:
            with guard.temporary_unprotect('cgmh_ty'):
                # æ­¤å€å¡Šå…§ YAML å¯å¯«å…¥
                yaml.safe_dump(data, open(yaml_path, 'w'))
        &quot;&quot;&quot;
        self.unprotect_yaml_file(site_id, level)
        try:
            yield
        finally:
            self.protect_yaml_file(site_id, level)

    def verify_protection(self, site_id: str) -&gt; dict:
        &quot;&quot;&quot;
        é©—è­‰æª”æ¡ˆä¿è­·ç‹€æ…‹ã€‚

        Returns:
            {
                'protected': bool,
                'permissions': str,
                'immutable': bool,
                'writable_by_wizard': bool  # æ‡‰è©²ç‚º False
            }
        &quot;&quot;&quot;
        yaml_path = self.yaml_dir / f&quot;{site_id}.yaml&quot;

        # å–å¾—æ¬Šé™
        file_stat = yaml_path.stat()
        mode = stat.filemode(file_stat.st_mode)

        # æª¢æŸ¥æ˜¯å¦å¯å¯«å…¥ï¼ˆå°æ–¼ç›®å‰ä½¿ç”¨è€…ï¼‰
        writable = os.access(yaml_path, os.W_OK)

        # æª¢æŸ¥ immutable flag
        immutable = False
        if self._immutable_available:
            result = subprocess.run(
                ['lsattr', str(yaml_path)],
                capture_output=True,
                text=True,
                check=False
            )
            if result.returncode == 0:
                # lsattr è¼¸å‡ºæ ¼å¼: ---- filename æˆ– -i--- filename
                attrs = result.stdout.split()[0]
                immutable = 'i' in attrs

        return {
            'protected': not writable or immutable,
            'permissions': mode,
            'immutable': immutable,
            'writable_by_wizard': writable and not immutable
        }
</code></pre>
<h3 id="32-excel_to_yamlpy">3.2 èˆ‡ excel_to_yaml.py æ•´åˆ</h3>
<p><strong>æª”æ¡ˆ</strong>: <code>tools/features/excel_to_yaml.py</code> (å®‰å…¨å¼·åŒ–ç‰ˆ)</p>
<pre><code class="language-python">#!/usr/bin/env python3
&quot;&quot;&quot;
Excel to YAML Converter - ç‰¹æ¬Šè½‰æ›å·¥å…·
å”¯ä¸€ç›´æ¥å¯«å…¥ YAML çš„åˆæ³•é€”å¾‘ã€‚
&quot;&quot;&quot;

import yaml
import argparse
from pathlib import Path
from src.security.filesystem_guard import FilesystemGuard
from src.utils.config_loader import ConfigLoader

def convert_excel_to_yaml(
    excel_path: Path, 
    output_path: Path,
    site_id: str,
    force: bool = False
) -&gt; dict:
    &quot;&quot;&quot;
    åŸ·è¡Œ Excel åˆ° YAML çš„ç‰¹æ¬Šè½‰æ›ã€‚

    æµç¨‹:
    1. é©—è­‰ Excel æ ¼å¼èˆ‡å…§å®¹
    2. æš«æ™‚è§£é™¤ YAML æª”æ¡ˆä¿è­·ï¼ˆè‹¥å­˜åœ¨ï¼‰
    3. å¯«å…¥ YAML
    4. é‡æ–°è¨­å®šä¿è­·ï¼ˆ444 æˆ– +iï¼‰
    5. è¨˜éŒ„ç¨½æ ¸æ—¥èªŒ
    &quot;&quot;&quot;
    guard = FilesystemGuard(output_path.parent)

    # é©—è­‰ Excelï¼ˆçœç•¥è©³ç´°é©—è­‰é‚è¼¯...ï¼‰
    validation_result = validate_excel(excel_path)

    # è½‰æ›ç‚º YAML è³‡æ–™
    yaml_data = convert_to_yaml_data(validation_result)

    # ä½¿ç”¨ç‰¹æ¬Šä¸Šä¸‹æ–‡å¯«å…¥ YAML
    try:
        with guard.temporary_unprotect(site_id, level='standard'):
            # å¯«å…¥ YAML
            with open(output_path, 'w', encoding='utf-8') as f:
                yaml.dump(yaml_data, f, default_flow_style=False, allow_unicode=True)

            # é©—è­‰å¯«å…¥æˆåŠŸ
            if not output_path.exists():
                raise RuntimeError(&quot;YAML å¯«å…¥å¤±æ•—&quot;)

        # é©—è­‰ä¿è­·å·²æ¢å¾©
        status = guard.verify_protection(site_id)
        if status['writable_by_wizard']:
            raise SecurityError(&quot;ä¿è­·æ¢å¾©å¤±æ•—ï¼ŒYAML ä»ç„¶å¯å¯«å…¥&quot;)

        return {
            'status': 'success',
            'yaml_path': str(output_path),
            'protection': status,
            'timestamp': datetime.now().isoformat()
        }

    except Exception as e:
        # ç¢ºä¿å³ä½¿å¤±æ•—ä¹Ÿå˜—è©¦æ¢å¾©ä¿è­·
        try:
            guard.protect_yaml_file(site_id, level='standard')
        except:
            pass
        raise

if __name__ == '__main__':
    parser = argparse.ArgumentParser(description='Excel to YAML Converter (Privileged)')
    parser.add_argument('--input', required=True, help='è¼¸å…¥ Excel è·¯å¾‘')
    parser.add_argument('--output', required=True, help='è¼¸å‡º YAML è·¯å¾‘')
    parser.add_argument('--site-id', required=True, help='æ¡ˆå ´ ID')
    parser.add_argument('--force', action='store_true', help='å¼·åˆ¶è¦†å¯«ï¼ˆéœ€ç®¡ç†å“¡æ¬Šé™ï¼‰')

    args = parser.parse_args()

    # é©—è­‰åŸ·è¡Œè€…èº«ä»½ï¼ˆå¯é¸ï¼šæª¢æŸ¥æ˜¯å¦ç‚º CI æˆ–ç‰¹å®šä½¿ç”¨è€…ï¼‰
    if not verify_privileged_user() and not args.force:
        print(&quot;âŒ éŒ¯èª¤ï¼šåƒ…å…è¨±ç‰¹æ¬Šä½¿ç”¨è€…æˆ– CI åŸ·è¡Œæ­¤å·¥å…·&quot;)
        print(&quot;   ä¸€èˆ¬ä½¿ç”¨è€…è«‹ä½¿ç”¨ Wizard ç·¨è¼¯ Excelï¼Œç„¶å¾Œæäº¤ PR&quot;)
        sys.exit(1)

    result = convert_excel_to_yaml(
        Path(args.input), 
        Path(args.output),
        args.site_id,
        args.force
    )

    print(f&quot;âœ… è½‰æ›æˆåŠŸ: {result['yaml_path']}&quot;)
    print(f&quot;ğŸ”’ ä¿è­·ç‹€æ…‹: {result['protection']}&quot;)
</code></pre>
<hr />
<h2 id="4-layer-3-cicd">4. Layer 3: CI/CD é˜²è­·é–˜é“</h2>
<h3 id="41-pre-commit-hook">4.1 Pre-commit Hookï¼ˆæœ¬åœ°æäº¤æª¢æŸ¥ï¼‰</h3>
<p><strong>æª”æ¡ˆ</strong>: <code>.pre-commit-hooks/check-yaml-modification.sh</code></p>
<pre><code class="language-bash">#!/bin/bash
# Pre-commit hook: é˜»æ“‹ç›´æ¥ä¿®æ”¹ YAML çš„æäº¤

# æª¢æŸ¥æ˜¯å¦æœ‰ YAML æª”æ¡ˆè¢«ä¿®æ”¹ï¼ˆé excel_to_yaml.py ç”Ÿæˆçš„è®Šæ›´ï¼‰
CHANGED_YAML=$(git diff --cached --name-only --diff-filter=M | grep -E 'config/features/sites/.*\.yaml$' || true)

if [ -n &quot;$CHANGED_YAML&quot; ]; then
    echo &quot;âŒ E501: æª¢æ¸¬åˆ°ç›´æ¥ä¿®æ”¹ YAML æª”æ¡ˆçš„å˜—è©¦ï¼&quot;
    echo &quot;&quot;
    echo &quot;å—å½±éŸ¿çš„æª”æ¡ˆ:&quot;
    echo &quot;$CHANGED_YAML&quot;
    echo &quot;&quot;
    echo &quot;æ”¿ç­–æé†’:&quot;
    echo &quot;  1. Wizard ç¦æ­¢ç›´æ¥å¯«å…¥ YAMLï¼ˆæŠ€è¡“é˜»æ“‹æ©Ÿåˆ¶ï¼‰&quot;
    echo &quot;  2. æ‰€æœ‰è®Šæ›´å¿…é ˆé€é Excel â†’ excel_to_yaml.py æµç¨‹&quot;
    echo &quot;  3. è‹¥æ‚¨ç¢ºå¯¦éœ€è¦ç·Šæ€¥ä¿®æ”¹ YAMLï¼Œè«‹ä½¿ç”¨ --no-verify ä¸¦è¯ç¹«ç®¡ç†å“¡&quot;
    echo &quot;&quot;
    echo &quot;æ­£ç¢ºæµç¨‹:&quot;
    echo &quot;  1. ç·¨è¼¯ data/features/{site}/{site}.xlsx&quot;
    echo &quot;  2. åŸ·è¡Œ: python tools/features/excel_to_yaml.py --input ... --output ...&quot;
    echo &quot;  3. æäº¤è®Šæ›´ï¼ˆåŒ…å« .xlsx èˆ‡ .yamlï¼‰&quot;

    exit 1
fi

# æª¢æŸ¥ Wizard ç¨‹å¼ç¢¼æ˜¯å¦å˜—è©¦å°å…¥ yaml
WIZARD_FILES=$(git diff --cached --name-only | grep -E 'src/features/wizard' || true)
if [ -n &quot;$WIZARD_FILES&quot; ]; then
    # æª¢æŸ¥æ˜¯å¦æ–°å¢ yaml å°å…¥
    if git diff --cached | grep -E '^\+.*import yaml|^\+.*from yaml' &gt; /dev/null; then
        echo &quot;âŒ E501: Wizard ç¨‹å¼ç¢¼ç¦æ­¢å°å…¥ yaml æ¨¡çµ„ï¼&quot;
        echo &quot;æª¢æ¸¬åˆ°ä»¥ä¸‹é•è¦:&quot;
        git diff --cached | grep -E '^\+.*import yaml|^\+.*from yaml'
        exit 1
    fi
fi

exit 0
</code></pre>
<h3 id="42-github-actions-workflowpr">4.2 GitHub Actions Workflowï¼ˆPR æª¢æŸ¥ï¼‰</h3>
<p><strong>æª”æ¡ˆ</strong>: <code>.github/workflows/yaml-protection.yml</code></p>
<pre><code class="language-yaml">name: YAML SSOT Protection

on:
  pull_request:
    paths:
      - 'config/features/sites/**.yaml'
      - 'src/features/wizard.py'
      - 'tools/features/excel_to_yaml.py'

jobs:
  verify-yaml-source:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0  # éœ€è¦å®Œæ•´æ­·å²è¨˜éŒ„æª¢æŸ¥

      - name: Check YAML Modification Source
        run: |
          echo &quot;ğŸ” æª¢æŸ¥ YAML æª”æ¡ˆè®Šæ›´ä¾†æº...&quot;

          # å–å¾—è®Šæ›´çš„ YAML æª”æ¡ˆ
          YAML_FILES=$(git diff --name-only origin/${{ github.base_ref }}...HEAD | grep -E 'config/features/sites/.*\.yaml$' || true)

          if [ -z &quot;$YAML_FILES&quot; ]; then
            echo &quot;âœ… ç„¡ YAML æª”æ¡ˆè®Šæ›´ï¼Œæª¢æŸ¥é€šé&quot;
            exit 0
          fi

          echo &quot;æª¢æ¸¬åˆ°ä»¥ä¸‹ YAML è®Šæ›´:&quot;
          echo &quot;$YAML_FILES&quot;

          # æª¢æŸ¥å°æ‡‰çš„ Excel æ˜¯å¦ä¹Ÿæœ‰è®Šæ›´
          for yaml_file in $YAML_FILES; do
            site_id=$(basename &quot;$yaml_file&quot; .yaml)
            excel_file=&quot;data/features/${site_id}/${site_id}.xlsx&quot;

            if ! git diff --name-only origin/${{ github.base_ref }}...HEAD | grep -q &quot;$excel_file&quot;; then
              echo &quot;âŒ éŒ¯èª¤: $yaml_file å·²è®Šæ›´ï¼Œä½†å°æ‡‰çš„ $excel_file æœªè®Šæ›´&quot;
              echo &quot;   é€™é•åäº† Excel-Centric SSOT æ”¿ç­–ï¼ˆE501ï¼‰&quot;
              exit 1
            fi

            # æª¢æŸ¥æ™‚é–“æˆ³ï¼šExcel å¿…é ˆæ¯” YAML æ–°
            yaml_mtime=$(git log -1 --format=%ct origin/${{ github.base_ref }}...HEAD -- &quot;$yaml_file&quot;)
            excel_mtime=$(git log -1 --format=%ct origin/${{ github.base_ref }}...HEAD -- &quot;$excel_file&quot;)

            if [ &quot;$excel_mtime&quot; -lt &quot;$yaml_mtime&quot; ]; then
              echo &quot;âŒ éŒ¯èª¤: $excel_file çš„æäº¤æ™‚é–“æ—©æ–¼ $yaml_file&quot;
              echo &quot;   é€™è¡¨ç¤º YAML å¯èƒ½æ˜¯æ‰‹å‹•ä¿®æ”¹è€Œéç”± Excel ç”Ÿæˆ&quot;
              exit 1
            fi
          done

          echo &quot;âœ… YAML è®Šæ›´ä¾†æºé©—è­‰é€šé&quot;

      - name: Verify Wizard Code Safety
        run: |
          echo &quot;ğŸ” é©—è­‰ Wizard ç¨‹å¼ç¢¼å®‰å…¨æ€§...&quot;

          # æª¢æŸ¥ Wizard æ˜¯å¦å°å…¥ yaml
          if grep -r &quot;import yaml\|from yaml&quot; src/features/wizard*.py; then
            echo &quot;âŒ E501: Wizard ç¨‹å¼ç¢¼åŒ…å« yaml å°å…¥&quot;
            exit 1
          fi

          # æª¢æŸ¥æ˜¯å¦æœ‰å¯«å…¥ YAML çš„æ–¹æ³•
          if grep -r &quot;def.*yaml\|write_yaml\|dump.*yaml&quot; src/features/wizard*.py; then
            echo &quot;âŒ E501: Wizard ç¨‹å¼ç¢¼åŒ…å« YAML å¯«å…¥ç›¸é—œæ–¹æ³•&quot;
            exit 1
          fi

          echo &quot;âœ… Wizard ç¨‹å¼ç¢¼å®‰å…¨æª¢æŸ¥é€šé&quot;

      - name: Check File Permissions
        run: |
          echo &quot;ğŸ” æª¢æŸ¥ YAML æª”æ¡ˆæ¬Šé™...&quot;

          for file in config/features/sites/*.yaml; do
            if [ -f &quot;$file&quot; ]; then
              perms=$(stat -c %a &quot;$file&quot;)
              if [ &quot;$perms&quot; != &quot;444&quot; ] &amp;&amp; [ &quot;$perms&quot; != &quot;644&quot; ]; then
                echo &quot;âš ï¸  è­¦å‘Š: $file æ¬Šé™ç‚º $permsï¼Œå»ºè­°è¨­å®šç‚º 444ï¼ˆå”¯è®€ï¼‰&quot;
              fi
            fi
          done

          echo &quot;âœ… æ¬Šé™æª¢æŸ¥å®Œæˆ&quot;
</code></pre>
<hr />
<h2 id="5">5. ä¾‹å¤–è™•ç†èˆ‡ç·Šæ€¥æµç¨‹</h2>
<h3 id="51-emergency-override">5.1 ç·Šæ€¥è¦†å¯«ç¨‹åºï¼ˆEmergency Overrideï¼‰</h3>
<p><strong>æª”æ¡ˆ</strong>: <code>src/security/emergency_access.py</code></p>
<p>åœ¨æ¥µç«¯æƒ…æ³ä¸‹ï¼ˆå¦‚ç”Ÿç”¢ç’°å¢ƒç·Šæ€¥ä¿®å¾©ä¸”ç„¡æ³•é‡æ–°åŸ·è¡Œ Excel æµç¨‹ï¼‰ï¼Œå…è¨±ç¶“éåš´æ ¼å¯©æ‰¹çš„æ‰‹å‹• YAML ä¿®æ”¹ã€‚</p>
<pre><code class="language-python">from datetime import datetime, timedelta
from typing import Optional
import hashlib
import getpass

class EmergencyAccess:
    &quot;&quot;&quot;
    ç·Šæ€¥å­˜å–ç®¡ç†å™¨ã€‚

    ä½¿ç”¨é›™äººé©—è­‰ï¼ˆTwo-person ruleï¼‰èˆ‡æ™‚é–“é™åˆ¶ï¼ˆ30 åˆ†é˜ï¼‰ç¢ºä¿å®‰å…¨æ€§ã€‚
    &quot;&quot;&quot;

    def __init__(self, site_id: str):
        self.site_id = site_id
        self._granted = False
        self._expiry: Optional[datetime] = None
        self._approvers = []
        self._audit_log = []

    def request_access(
        self, 
        requester: str, 
        approver1: str, 
        approver2: str,
        reason: str,
        duration_minutes: int = 30
    ) -&gt; bool:
        &quot;&quot;&quot;
        è«‹æ±‚ç·Šæ€¥å­˜å–æ¬Šé™ã€‚

        Args:
            requester: è«‹æ±‚è€…å¸³è™Ÿ
            approver1, approver2: å…©ä½å¯©æ‰¹è€…å¸³è™Ÿï¼ˆå¿…é ˆä¸åŒï¼‰
            reason: ç·Šæ€¥åŸå› èªªæ˜
            duration_minutes: æ¬Šé™æœ‰æ•ˆæœŸï¼ˆé è¨­ 30 åˆ†é˜ï¼‰

        Returns:
            bool: æ˜¯å¦æˆæ¬ŠæˆåŠŸ
        &quot;&quot;&quot;
        # é©—è­‰é›™äººè¦å‰‡
        if approver1 == approver2 or requester in [approver1, approver2]:
            raise ValueError(&quot;é•åé›™äººé©—è­‰è¦å‰‡ï¼šå¯©æ‰¹è€…å¿…é ˆèˆ‡è«‹æ±‚è€…ä¸åŒï¼Œä¸”å…©ä½å¯©æ‰¹è€…ä¸åŒ&quot;)

        # è¨˜éŒ„è«‹æ±‚
        self._audit_log.append({
            'timestamp': datetime.now().isoformat(),
            'action': 'request',
            'requester': requester,
            'approvers': [approver1, approver2],
            'reason': reason
        })

        # é©—è­‰å¯©æ‰¹è€…èº«ä»½ï¼ˆç°¡åŒ–ç‰ˆï¼Œå¯¦éš›æ‡‰ä¸²æ¥ LDAP æˆ– SSOï¼‰
        self._verify_approver(approver1)
        self._verify_approver(approver2)

        # æˆæ¬Š
        self._granted = True
        self._expiry = datetime.now() + timedelta(minutes=duration_minutes)
        self._approvers = [approver1, approver2]

        # ç”¢ç”Ÿä¸€æ¬¡æ€§ Token
        token = self._generate_token(requester, reason)

        print(f&quot;ğŸš¨ ç·Šæ€¥å­˜å–å·²æˆæ¬Šï¼ˆToken: {token}ï¼‰&quot;)
        print(f&quot;   æœ‰æ•ˆæœŸè‡³: {self._expiry.isoformat()}&quot;)
        print(f&quot;   æ¡ˆå ´: {self.site_id}&quot;)
        print(f&quot;   åŸå› : {reason}&quot;)
        print(f&quot;   å¯©æ‰¹è€…: {approver1}, {approver2}&quot;)

        return True

    def verify_access(self, token: str) -&gt; bool:
        &quot;&quot;&quot;é©—è­‰å­˜å–æ¬Šé™æ˜¯å¦æœ‰æ•ˆ&quot;&quot;&quot;
        if not self._granted:
            return False

        if datetime.now() &gt; self._expiry:
            self._granted = False
            return False

        # é©—è­‰ Tokenï¼ˆç°¡åŒ–é‚è¼¯ï¼‰
        expected_token = self._generate_token_from_current_state()
        return token == expected_token

    def _verify_approver(self, approver: str):
        &quot;&quot;&quot;é©—è­‰å¯©æ‰¹è€…èº«ä»½ï¼ˆå ä½ç¬¦ï¼Œå¯¦éš›éœ€æ•´åˆä¼æ¥­èº«ä»½é©—è­‰ï¼‰&quot;&quot;&quot;
        # å¯¦éš›æ‡‰æª¢æŸ¥æ˜¯å¦ç‚ºç®¡ç†å“¡ç¾¤çµ„æˆå“¡
        pass

    def _generate_token(self, requester: str, reason: str) -&gt; str:
        &quot;&quot;&quot;ç”¢ç”Ÿå®‰å…¨ Token&quot;&quot;&quot;
        data = f&quot;{self.site_id}:{requester}:{datetime.now().timestamp()}:{reason}&quot;
        return hashlib.sha256(data.encode()).hexdigest()[:16]

    def get_audit_log(self) -&gt; list:
        &quot;&quot;&quot;å–å¾—å®Œæ•´ç¨½æ ¸æ—¥èªŒï¼ˆç”¨æ–¼äº‹å¾Œå¯©æŸ¥ï¼‰&quot;&quot;&quot;
        return self._audit_log.copy()

# CLI ä»‹é¢
def emergency_cli():
    &quot;&quot;&quot;ç·Šæ€¥å­˜å– CLI&quot;&quot;&quot;
    import argparse
    parser = argparse.ArgumentParser(description='Emergency YAML Access (Two-person rule)')
    parser.add_argument('--site', required=True)
    parser.add_argument('--requester', default=getpass.getuser())
    parser.add_argument('--approver1', required=True)
    parser.add_argument('--approver2', required=True)
    parser.add_argument('--reason', required=True)

    args = parser.parse_args()

    access = EmergencyAccess(args.site)
    access.request_access(
        args.requester,
        args.approver1,
        args.approver2,
        args.reason
    )
</code></pre>
<h3 id="52">5.2 ä¾‹å¤–è™•ç†çŸ©é™£</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">æƒ…å¢ƒ</th>
<th style="text-align: left;">é˜»æ“‹æ©Ÿåˆ¶</th>
<th style="text-align: left;">ç·Šæ€¥æµç¨‹</th>
<th style="text-align: left;">ç¨½æ ¸è¦æ±‚</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>æ­£å¸¸é–‹ç™¼</strong></td>
<td style="text-align: left;">Wizard åƒ…å¯« Excelï¼ŒCI æª¢æŸ¥é€šé</td>
<td style="text-align: left;">ç„¡éœ€ç·Šæ€¥æµç¨‹</td>
<td style="text-align: left;">æ¨™æº–æäº¤è¨˜éŒ„</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Wizard å˜—è©¦å¯« YAML</strong></td>
<td style="text-align: left;">Runtime E501 éŒ¯èª¤</td>
<td style="text-align: left;">ç„¡æ³•ç¹éï¼Œå¿…é ˆä¿®æ­£ç¨‹å¼ç¢¼</td>
<td style="text-align: left;">éŒ¯èª¤æ—¥èªŒè¨˜éŒ„</td>
</tr>
<tr>
<td style="text-align: left;"><strong>æ‰‹å‹•ç·¨è¼¯ YAML</strong></td>
<td style="text-align: left;">æª”æ¡ˆæ¬Šé™æ‹’çµ•ï¼ˆPermission Deniedï¼‰</td>
<td style="text-align: left;">ä½¿ç”¨ <code>sudo</code> + ç·Šæ€¥ Token</td>
<td style="text-align: left;">é›™äººé©—è­‰ + åŸå› èªªæ˜</td>
</tr>
<tr>
<td style="text-align: left;"><strong>CI æª¢æŸ¥å¤±æ•—</strong></td>
<td style="text-align: left;">PR è¢«é˜»æ“‹åˆä½µ</td>
<td style="text-align: left;">ç®¡ç†å“¡è¦†å¯«ï¼ˆéœ€èªªæ˜åŸå› ï¼‰</td>
<td style="text-align: left;">PR è¨è«–è¨˜éŒ„</td>
</tr>
<tr>
<td style="text-align: left;"><strong>ç”Ÿç”¢ç’°å¢ƒç·Šæ€¥ä¿®å¾©</strong></td>
<td style="text-align: left;">æª”æ¡ˆ immutable</td>
<td style="text-align: left;">EmergencyAccess 30 åˆ†é˜æ¬Šé™</td>
<td style="text-align: left;">å®Œæ•´ç¨½æ ¸æ—¥èªŒ + äº‹å¾Œå ±å‘Š</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="6">6. é©—è­‰èˆ‡æ¸¬è©¦è¨ˆç•«</h2>
<h3 id="61">6.1 å®‰å…¨æ¸¬è©¦æ¡ˆä¾‹</h3>
<table>
<thead>
<tr>
<th style="text-align: left;">æ¸¬è©¦æ¡ˆä¾‹ ID</th>
<th style="text-align: left;">æè¿°</th>
<th style="text-align: left;">æ”»æ“Š/ç¹éå˜—è©¦</th>
<th style="text-align: left;">é æœŸçµæœ</th>
<th style="text-align: center;">é©—è­‰å±¤ç´š</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>SEC-001</strong></td>
<td style="text-align: left;">Wizard å°å…¥ yaml</td>
<td style="text-align: left;"><code>import yaml</code> in wizard.py</td>
<td style="text-align: left;">ImportError (E501)</td>
<td style="text-align: center;">L1</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SEC-002</strong></td>
<td style="text-align: left;">Wizard å‹•æ…‹è·¯å¾‘ä¿®æ”¹</td>
<td style="text-align: left;"><code>wizard._yaml_path = "..."</code></td>
<td style="text-align: left;">AttributeError</td>
<td style="text-align: center;">L1</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SEC-003</strong></td>
<td style="text-align: left;">Wizard å¯«å…¥ YAML å˜—è©¦</td>
<td style="text-align: left;"><code>open('config.yaml', 'w')</code></td>
<td style="text-align: left;">PermissionError (E501)</td>
<td style="text-align: center;">L2</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SEC-004</strong></td>
<td style="text-align: left;">ä¸€èˆ¬ä½¿ç”¨è€…ä¿®æ”¹ YAML</td>
<td style="text-align: left;"><code>echo "data" &gt; site.yaml</code></td>
<td style="text-align: left;">Permission Denied</td>
<td style="text-align: center;">L2</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SEC-005</strong></td>
<td style="text-align: left;">Git æäº¤ç›´æ¥ YAML</td>
<td style="text-align: left;"><code>git commit -m "update yaml"</code></td>
<td style="text-align: left;">Pre-commit é˜»æ“‹</td>
<td style="text-align: center;">L3</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SEC-006</strong></td>
<td style="text-align: left;">PR åƒ…å« YAML è®Šæ›´</td>
<td style="text-align: left;">Excel æœªè®Šæ›´ï¼ŒYAML è®Šæ›´</td>
<td style="text-align: left;">GitHub Action å¤±æ•—</td>
<td style="text-align: center;">L3</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SEC-007</strong></td>
<td style="text-align: left;">ç¹é pre-commit</td>
<td style="text-align: left;"><code>git commit --no-verify</code></td>
<td style="text-align: left;">PR éšæ®µä»è¢«é˜»æ“‹</td>
<td style="text-align: center;">L3</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SEC-008</strong></td>
<td style="text-align: left;">ç·Šæ€¥å­˜å–é©—è­‰</td>
<td style="text-align: left;">å–®äººå¯©æ‰¹è«‹æ±‚</td>
<td style="text-align: left;">ValueError (é›™äººè¦å‰‡)</td>
<td style="text-align: center;">Emergency</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SEC-009</strong></td>
<td style="text-align: left;">ç·Šæ€¥ Token æ™‚æ•ˆ</td>
<td style="text-align: left;">30 åˆ†é˜å¾Œä½¿ç”¨ Token</td>
<td style="text-align: left;">Access Denied</td>
<td style="text-align: center;">Emergency</td>
</tr>
<tr>
<td style="text-align: left;"><strong>SEC-010</strong></td>
<td style="text-align: left;">æª”æ¡ˆ immutable</td>
<td style="text-align: left;">root å˜—è©¦ <code>rm site.yaml</code></td>
<td style="text-align: left;">Operation not permitted</td>
<td style="text-align: center;">L2</td>
</tr>
</tbody>
</table>
<h3 id="62">6.2 æ»²é€æ¸¬è©¦è…³æœ¬</h3>
<p><strong>æª”æ¡ˆ</strong>: <code>tests/security/test_wizard_blockade.py</code></p>
<pre><code class="language-python">import pytest
import subprocess
import tempfile
from pathlib import Path

class TestWizardBlockade:
    &quot;&quot;&quot;æ¸¬è©¦ Wizard æŠ€è¡“é˜»æ“‹æ©Ÿåˆ¶&quot;&quot;&quot;

    def test_wizard_cannot_import_yaml(self):
        &quot;&quot;&quot;SEC-001: Wizard ç„¡æ³•å°å…¥ yaml&quot;&quot;&quot;
        code = &quot;&quot;&quot;
import sys
sys.path.insert(0, 'src')
from src.security.import_guard import WizardImportGuard
guard = WizardImportGuard()
guard.install()

# æ¨¡æ“¬åœ¨ Wizard æ¨¡çµ„ä¸­å°å…¥ yaml
import types
wizard_module = types.ModuleType('src.features.wizard')
wizard_module.__name__ = 'src.features.wizard'
sys.modules['src.features.wizard'] = wizard_module

# å˜—è©¦åœ¨ Wizard ä¸Šä¸‹æ–‡ä¸­å°å…¥ yaml
exec(&quot;import yaml&quot;, wizard_module.__dict__)
&quot;&quot;&quot;
        with pytest.raises(ImportError, match=&quot;E501&quot;):
            exec(code)

    def test_wizard_cannot_write_yaml_via_api(self):
        &quot;&quot;&quot;SEC-002: Wizard API å±¤ç´šé˜»æ“‹&quot;&quot;&quot;
        from src.features.wizard import SecureFeatureWizard

        wizard = SecureFeatureWizard(
            site_id=&quot;test&quot;,
            excel_base_dir=&quot;/tmp/test&quot;,
            template_version=&quot;1.2&quot;
        )

        with pytest.raises(PermissionError, match=&quot;E501&quot;):
            wizard.write_yaml({&quot;test&quot;: &quot;data&quot;})

    def test_yaml_file_permissions(self):
        &quot;&quot;&quot;SEC-003: æª”æ¡ˆç³»çµ±æ¬Šé™é˜»æ“‹&quot;&quot;&quot;
        with tempfile.TemporaryDirectory() as tmpdir:
            yaml_file = Path(tmpdir) / &quot;test.yaml&quot;
            yaml_file.write_text(&quot;test: data&quot;)

            # è¨­å®š 444 æ¬Šé™
            import stat
            yaml_file.chmod(stat.S_IRUSR | stat.S_IRGRP | stat.S_IROTH)

            # å˜—è©¦å¯«å…¥
            with pytest.raises(PermissionError):
                yaml_file.write_text(&quot;hacked&quot;)

    def test_pre_commit_hook_blocks_yaml(self):
        &quot;&quot;&quot;SEC-004: Pre-commit é˜»æ“‹&quot;&quot;&quot;
        # æ¨¡æ“¬è®Šæ›´ YAML çš„æäº¤
        result = subprocess.run(
            ['bash', '.pre-commit-hooks/check-yaml-modification.sh'],
            capture_output=True,
            text=True,
            cwd=tempfile.mkdtemp()  # ä½¿ç”¨è‡¨æ™‚ git repo
        )

        # åœ¨ç„¡ git repo ç’°å¢ƒä¸‹æ‡‰è¿”å› 0ï¼ˆç„¡è®Šæ›´ï¼‰
        # å¯¦éš›æ¸¬è©¦éœ€åœ¨çœŸå¯¦ git repo ä¸­é€²è¡Œ
        assert result.returncode in [0, 1]  # 0=ç„¡è®Šæ›´, 1=é˜»æ“‹

    def test_emergency_access_two_person_rule(self):
        &quot;&quot;&quot;SEC-008: é›™äººé©—è­‰&quot;&quot;&quot;
        from src.security.emergency_access import EmergencyAccess

        access = EmergencyAccess(&quot;test_site&quot;)

        # å˜—è©¦å–®äººå¯©æ‰¹ï¼ˆæ‡‰å¤±æ•—ï¼‰
        with pytest.raises(ValueError, match=&quot;é›™äººé©—è­‰&quot;):
            access.request_access(
                requester=&quot;user1&quot;,
                approver1=&quot;admin1&quot;,
                approver2=&quot;admin1&quot;,  # ç›¸åŒå¯©æ‰¹è€…
                reason=&quot;test&quot;
            )

        # å˜—è©¦è«‹æ±‚è€…ä½œç‚ºå¯©æ‰¹è€…ï¼ˆæ‡‰å¤±æ•—ï¼‰
        with pytest.raises(ValueError, match=&quot;é›™äººé©—è­‰&quot;):
            access.request_access(
                requester=&quot;user1&quot;,
                approver1=&quot;user1&quot;,  # è«‹æ±‚è€…å¯©æ‰¹
                approver2=&quot;admin2&quot;,
                reason=&quot;test&quot;
            )
</code></pre>
<hr />
<h2 id="7-deliverables">7. äº¤ä»˜ç‰©æ¸…å–® (Deliverables)</h2>
<h3 id="71">7.1 ç¨‹å¼ç¢¼æª”æ¡ˆ</h3>
<ol>
<li><code>src/security/import_guard.py</code> - Runtime å°å…¥æ””æˆªå™¨</li>
<li><code>src/security/filesystem_guard.py</code> - æª”æ¡ˆæ¬Šé™ç®¡ç†</li>
<li><code>src/security/runtime_verifier.py</code> - åŸ·è¡ŒæœŸé©—è­‰</li>
<li><code>src/security/emergency_access.py</code> - ç·Šæ€¥å­˜å–ç®¡ç†</li>
<li><code>src/features/wizard.py</code> - å®‰å…¨å¼·åŒ–ç‰ˆ Wizardï¼ˆç§»é™¤ yaml å°å…¥ï¼‰</li>
<li><code>tools/features/excel_to_yaml.py</code> - ç‰¹æ¬Šè½‰æ›å·¥å…·ï¼ˆæ•´åˆ FilesystemGuardï¼‰</li>
</ol>
<h3 id="72">7.2 é…ç½®èˆ‡è…³æœ¬</h3>
<ol start="7">
<li><code>.pre-commit-hooks/check-yaml-modification.sh</code> - Pre-commit æª¢æŸ¥è…³æœ¬</li>
<li><code>.github/workflows/yaml-protection.yml</code> - GitHub Actions CI æª¢æŸ¥</li>
<li><code>scripts/setup-yaml-protection.sh</code> - åˆå§‹åŒ–æª”æ¡ˆæ¬Šé™è…³æœ¬ï¼ˆè¨­å®š 444ï¼‰</li>
</ol>
<h3 id="73">7.3 æ¸¬è©¦æª”æ¡ˆ</h3>
<ol start="10">
<li><code>tests/security/test_wizard_blockade.py</code> - å®‰å…¨é˜»æ“‹æ¸¬è©¦</li>
<li><code>tests/security/test_filesystem_protection.py</code> - æª”æ¡ˆæ¬Šé™æ¸¬è©¦</li>
<li><code>tests/security/test_emergency_access.py</code> - ç·Šæ€¥æµç¨‹æ¸¬è©¦</li>
</ol>
<h3 id="74">7.4 æ–‡ä»¶æª”æ¡ˆ</h3>
<ol start="13">
<li><code>docs/security/WIZARD_BLOCKADE.md</code> - æ“ä½œæ‰‹å†Šèˆ‡æ•…éšœæ’é™¤</li>
<li><code>docs/security/EMERGENCY_PROCEDURES.md</code> - ç·Šæ€¥å­˜å– SOP</li>
</ol>
<hr />
<h2 id="8-action-items">8. åŸ·è¡Œæª¢æŸ¥æ¸…å–® (Action Items)</h2>
<h3 id="phase-1-runtime-day-1">Phase 1: Runtime é˜²è­·ï¼ˆDay 1ï¼‰</h3>
<ul>
<li>[ ] å»ºç«‹ <code>src/security/import_guard.py</code> ä¸¦æ•´åˆè‡³ Wizard åˆå§‹åŒ–</li>
<li>[ ] é‡æ§‹ <code>src/features/wizard.py</code>ï¼š</li>
<li>[ ] ç§»é™¤æ‰€æœ‰ yaml ç›¸é—œå°å…¥</li>
<li>[ ] æ–°å¢ <code>__slots__</code> é˜²æ­¢å‹•æ…‹å±¬æ€§</li>
<li>[ ] å¯¦ä½œ <code>write_yaml()</code> æ–¹æ³•æ‹‹å‡º E501</li>
<li>[ ] é©—è­‰æ¸¬è©¦ SEC-001, SEC-002 é€šé</li>
</ul>
<h3 id="phase-2-day-2">Phase 2: æª”æ¡ˆç³»çµ±é˜²è­·ï¼ˆDay 2ï¼‰</h3>
<ul>
<li>[ ] å»ºç«‹ <code>src/security/filesystem_guard.py</code></li>
<li>[ ] å»ºç«‹ <code>scripts/setup-yaml-protection.sh</code>ï¼š<br />
<code>bash
  #!/bin/bash
  # è¨­å®šæ‰€æœ‰ç¾æœ‰ YAML ç‚ºå”¯è®€
  find config/features/sites -name "*.yaml" -exec chmod 444 {} \;
  echo "âœ… æ‰€æœ‰ YAML æª”æ¡ˆå·²è¨­å®šç‚ºå”¯è®€ (444)"</code></li>
<li>[ ] æ›´æ–° <code>tools/features/excel_to_yaml.py</code> æ•´åˆ <code>FilesystemGuard.temporary_unprotect()</code></li>
<li>[ ] åŸ·è¡Œè…³æœ¬è¨­å®šç¾æœ‰æª”æ¡ˆæ¬Šé™</li>
<li>[ ] é©—è­‰æ¸¬è©¦ SEC-003, SEC-010 é€šé</li>
</ul>
<h3 id="phase-3-cicd-day-3">Phase 3: CI/CD é˜²è­·ï¼ˆDay 3ï¼‰</h3>
<ul>
<li>[ ] å»ºç«‹ <code>.pre-commit-hooks/</code> ç›®éŒ„èˆ‡æª¢æŸ¥è…³æœ¬</li>
<li>[ ] è¨­å®š pre-commit hookï¼š<br />
<code>bash
  # å®‰è£ hook
  ln -s ../../.pre-commit-hooks/check-yaml-modification.sh .git/hooks/pre-commit</code></li>
<li>[ ] å»ºç«‹ <code>.github/workflows/yaml-protection.yml</code></li>
<li>[ ] é©—è­‰æ¸¬è©¦ SEC-004, SEC-005, SEC-006 é€šé</li>
</ul>
<h3 id="phase-4-day-4">Phase 4: ç·Šæ€¥æµç¨‹ï¼ˆDay 4ï¼‰</h3>
<ul>
<li>[ ] å»ºç«‹ <code>src/security/emergency_access.py</code></li>
<li>[ ] å»ºç«‹ CLI æŒ‡ä»¤ <code>python -m src.security.emergency_access</code></li>
<li>[ ] å»ºç«‹æ–‡ä»¶ <code>docs/security/EMERGENCY_PROCEDURES.md</code></li>
<li>[ ] é©—è­‰æ¸¬è©¦ SEC-008, SEC-009 é€šé</li>
</ul>
<hr />
<h2 id="9-sign-off-criteria">9. é©—æ”¶æ¨™æº– (Sign-off Criteria)</h2>
<ul>
<li>[ ] <strong>æŠ€è¡“é˜»æ“‹æœ‰æ•ˆæ€§</strong>: Wizard ç„¡æ³•é€éä»»ä½•ç¨‹å¼ç¢¼è·¯å¾‘å¯«å…¥ YAMLï¼ˆæ¸¬è©¦ SEC-001~003ï¼‰</li>
<li>[ ] <strong>æª”æ¡ˆé˜²è­·æœ‰æ•ˆæ€§</strong>: ä¸€èˆ¬ä½¿ç”¨è€…ç„¡æ³•ä¿®æ”¹ YAMLï¼ˆæ¸¬è©¦ SEC-003, SEC-010ï¼‰</li>
<li>[ ] <strong>CI/CD æ””æˆªç‡</strong>: 100% çš„ç›´æ¥ YAML ä¿®æ”¹åœ¨ Pre-commit æˆ– PR éšæ®µè¢«æ””æˆª</li>
<li>[ ] <strong>ç·Šæ€¥æµç¨‹å¯ç”¨æ€§</strong>: ç·Šæ€¥å­˜å–å¯åœ¨ 5 åˆ†é˜å…§å®Œæˆç”³è«‹èˆ‡æˆæ¬Šï¼ˆé›™äººé©—è­‰ï¼‰</li>
<li>[ ] <strong>ç›¸å®¹æ€§</strong>: ç¾æœ‰ Excel-to-YAML æµç¨‹åŠŸèƒ½æ­£å¸¸ï¼Œç„¡è¿´æ­¸</li>
<li>[ ] <strong>æ•ˆèƒ½å½±éŸ¿</strong>: Wizard å•Ÿå‹•æ™‚é–“å¢åŠ  &lt; 100msï¼ˆImportGuard é–‹éŠ·ï¼‰</li>
</ul>
<hr />
<h2 id="_1">é™„éŒ„ï¼šéŒ¯èª¤ä»£ç¢¼åƒè€ƒ</h2>
<table>
<thead>
<tr>
<th style="text-align: left;">éŒ¯èª¤ä»£ç¢¼</th>
<th style="text-align: left;">å®šç¾©ä½ç½®</th>
<th style="text-align: left;">è§¸ç™¼æ¢ä»¶</th>
<th style="text-align: left;">ä½¿ç”¨è€…è¨Šæ¯</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>E501</strong></td>
<td style="text-align: left;">Interface Contract v1.1</td>
<td style="text-align: left;">Wizard å˜—è©¦å°å…¥ yaml æˆ–å¯«å…¥ YAML</td>
<td style="text-align: left;">"Direct YAML write attempt blocked (Wizard)"</td>
</tr>
<tr>
<td style="text-align: left;"><strong>E502</strong></td>
<td style="text-align: left;">Wizard Blockade v1.0</td>
<td style="text-align: left;">æª”æ¡ˆæ¬Šé™é˜»æ“‹ï¼ˆå˜—è©¦å¯«å…¥å”¯è®€ YAMLï¼‰</td>
<td style="text-align: left;">"YAML file is read-only. Use Excel workflow."</td>
</tr>
<tr>
<td style="text-align: left;"><strong>E503</strong></td>
<td style="text-align: left;">Wizard Blockade v1.0</td>
<td style="text-align: left;">ç·Šæ€¥å­˜å– Token ç„¡æ•ˆæˆ–éæœŸ</td>
<td style="text-align: left;">"Emergency access token invalid or expired"</td>
</tr>
<tr>
<td style="text-align: left;"><strong>E504</strong></td>
<td style="text-align: left;">Wizard Blockade v1.0</td>
<td style="text-align: left;">é›™äººé©—è­‰å¤±æ•—</td>
<td style="text-align: left;">"Two-person verification required for emergency access"</td>
</tr>
</tbody>
</table>
<hr />
<p><strong>æ–‡ä»¶ç°½æ ¸</strong></p>
<table>
<thead>
<tr>
<th style="text-align: left;">è§’è‰²</th>
<th style="text-align: left;">ç°½å</th>
<th style="text-align: left;">æ—¥æœŸ</th>
<th style="text-align: left;">å‚™è¨»</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">æ¶æ§‹å¸«</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ç¢ºèªä¸‰å±¤é˜²è­·æ¶æ§‹</td>
</tr>
<tr>
<td style="text-align: left;">å®‰å…¨å·¥ç¨‹å¸«</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ç¢ºèªæ»²é€æ¸¬è©¦è¦†è“‹ç‡</td>
</tr>
<tr>
<td style="text-align: left;">DevOps</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ç¢ºèª CI/CD æ•´åˆå¯è¡Œæ€§</td>
</tr>
<tr>
<td style="text-align: left;">å°ˆæ¡ˆç¶“ç†</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">ç¢ºèªå·¥æ™‚èˆ‡é¢¨éšªæ¥å—åº¦</td>
</tr>
<tr>
<td style="text-align: left;">```</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</body>
</html>