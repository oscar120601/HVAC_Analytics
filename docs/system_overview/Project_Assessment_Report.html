<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Project_Assessment_Report</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
    font-size: 16px;
    line-height: 1.5;
    word-wrap: break-word;
    color: #24292e;
    background-color: #fff;
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem;
}
h1, h2, h3, h4, h5, h6 {
    margin-top: 24px;
    margin-bottom: 16px;
    font-weight: 600;
    line-height: 1.25;
}
h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
h3 { font-size: 1.25em; }
code {
    padding: 0.2em 0.4em;
    margin: 0;
    font-size: 85%;
    background-color: #f6f8fa;
    border-radius: 6px;
    font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
}
pre {
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f6f8fa;
    border-radius: 6px;
}
pre code {
    display: inline;
    padding: 0;
    margin: 0;
    overflow: visible;
    line-height: inherit;
    word-wrap: normal;
    background-color: initial;
    border: 0;
}
blockquote {
    padding: 0 1em;
    color: #6a737d;
    border-left: 0.25em solid #dfe2e5;
    margin: 0;
}
table {
    display: block;
    width: 100%;
    margin-top: 0;
    margin-bottom: 16px;
    overflow: auto;
    border-spacing: 0;
    border-collapse: collapse;
}
table th, table td {
    padding: 6px 13px;
    border: 1px solid #dfe2e5;
}
table tr {
    background-color: #fff;
    border-top: 1px solid #c6cbd1;
}
table tr:nth-child(2n) {
    background-color: #f6f8fa;
}
a { color: #0366d6; text-decoration: none; }
a:hover { text-decoration: underline; }
hr {
    height: 0.25em;
    padding: 0;
    margin: 24px 0;
    background-color: #e1e4e8;
    border: 0;
}
</style>

</head>
<body>
<h1 id="hvac-1">HVAC-1 å°ˆæ¡ˆè©•ä¼°å ±å‘Š</h1>
<p><strong>å°ˆæ¡ˆå¯è¡Œæ€§åˆ†æèˆ‡æ¶æ§‹è©•ä¼°</strong></p>
<p><strong>æ–‡ä»¶ç‰ˆæœ¬:</strong> 1.0<br />
<strong>æ—¥æœŸ:</strong> 2026-02-14<br />
<strong>åˆ†æå¸«:</strong> Oscar Chang<br />
<strong>å¯©é–± PRD æ¨¡çµ„:</strong> 8 å€‹æ ¸å¿ƒæ¨¡çµ„<br />
<strong>è©•ä¼°åŸºç¤:</strong> Interface Contract v1.1 + Foundation First Policy (åŸºç¤å„ªå…ˆç­–ç•¥)</p>
<hr />
<h2 id="executive-summary">åŸ·è¡Œæ‘˜è¦ (Executive Summary)</h2>
<h3 id="_1">è©•ä¼°çµæœ: <strong>âœ… å¯è¡Œ (é ˆæ³¨æ„é—œéµä¾è³´)</strong></h3>
<p>HVAC-1 å°ˆæ¡ˆå±•ç¾äº†<strong>ç”Ÿç”¢å°±ç·’çš„æ¶æ§‹</strong>ï¼Œç‰¹åˆ¥è‘—é‡æ–¼è³‡æ–™ä¸€è‡´æ€§ã€æ™‚é–“æ­£ç¢ºæ€§å’Œæ¨¡çµ„åŒ–è¨­è¨ˆã€‚æ ¹æ“šå° 8 å€‹æ ¸å¿ƒ PRD æ–‡ä»¶çš„å…¨é¢å¯©é–±ï¼Œè©²å°ˆæ¡ˆåœ¨<strong>æŠ€è¡“ä¸Šæ˜¯å¯è¡Œçš„</strong>ï¼Œä½†å¿…é ˆåš´æ ¼éµå®ˆã€ŒåŸºç¤å„ªå…ˆç­–ç•¥ (Foundation First Policy)ã€é€²è¡Œ<strong>é †åºæ€§é–‹ç™¼</strong>ï¼Œä»¥é¿å…ä¾è³´æ­»é–ã€‚</p>
<h3 id="_2">ä¸»è¦å„ªå‹¢</h3>
<ol>
<li><strong>Interface Contract v1.1</strong>: çµ±ä¸€çš„éŒ¯èª¤ä»£ç¢¼é«”ç³» (E000-E904)ï¼Œè¨­æœ‰ 7 å€‹é—œéµæª¢æŸ¥é»ï¼Œç¢ºä¿é›¶èª¤å·®æ•´åˆã€‚</li>
<li><strong>æ™‚é–“åŸºæº–éš”é›¢ (Temporal Baseline Isolation)</strong>: ç³»çµ±ç´š <code>pipeline_origin_timestamp</code>ï¼Œé˜²æ­¢è·¨æ¨¡çµ„çš„æœªä¾†æ•¸æ“šæ¼‚ç§»ã€‚</li>
<li><strong>Excel ç‚ºæ ¸å¿ƒçš„ SSOT</strong>: Feature Annotation v1.2 å¼·åˆ¶åŸ·è¡Œå”¯è®€ YAML ç­–ç•¥ï¼Œé˜²æ­¢é…ç½®è¡çªã€‚</li>
<li><strong>è³‡æºç®¡ç†</strong>: å®Œæ•´çš„ Kubernetes/Docker è³‡æºé™åˆ¶ï¼Œå…·å‚™ OOM (è¨˜æ†¶é«”æº¢å‡º) é é˜²èˆ‡æª¢æŸ¥é»æ¢å¾©åŠŸèƒ½ (v1.3)ã€‚</li>
<li><strong>å¤šå±¤ç´šé™ç´šæ©Ÿåˆ¶ (Fallback)</strong>: Optimization Engine v1.2 å…·å‚™ä¸‰å±¤é™ç´šç­–ç•¥ï¼Œç¢ºä¿ç³»çµ±ç©©å¥æ€§ã€‚</li>
</ol>
<h3 id="_3">é—œéµé¢¨éšª</h3>
<ol>
<li><strong>ä¾è³´æ­»é– (Dependency Deadlock)</strong> (å„ªå…ˆç´š 1): Feature Annotation Manager å¿…é ˆåœ¨ Cleaner v2.2 ä¹‹å‰å¯¦ä½œï¼Œå¦å‰‡æœƒå°è‡´åˆå§‹åŒ–ç«¶çˆ­æ¢ä»¶ã€‚</li>
<li><strong>è¨­å‚™è§’è‰²æ´©æ¼ (Device Role Leakage)</strong> (E500): éœ€è¦åš´æ ¼çš„é—œæ³¨é»åˆ†é›¢ - <code>device_role</code> åƒ…ä¾›å…§éƒ¨ä½¿ç”¨ï¼Œçµ•ä¸å¯å¯«å…¥è¼¸å‡ºã€‚</li>
<li><strong>è¨»é‡‹åŒæ­¥å¼·åˆ¶ (Annotation Sync)</strong> (E406): Pipeline åŸ·è¡Œå‰å¿…é ˆå¼·åˆ¶æª¢æŸ¥ Excel-YAML çš„ä¸€è‡´æ€§ã€‚</li>
<li><strong>è³‡æºä¼°ç®—</strong>: Model Training v1.3 çš„å‹•æ…‹è¨˜æ†¶é«”ä¼°ç®—å°æ–¼é˜²æ­¢ K8s Pod è¢«é©…é€è‡³é—œé‡è¦ã€‚</li>
</ol>
<h3 id="sprint">å»ºè­° Sprint é †åº</h3>
<p><strong>Sprint 1 (åŸºç¤å»ºè¨­ - 6-7 å¤©):</strong> Feature Annotation v1.2 + System Integration v1.2<br />
<strong>Sprint 2 (æ ¸å¿ƒ ETL - 15-17 å¤©):</strong> Parser v2.1 â†’ Cleaner v2.2 â†’ Batch Processor v1.3<br />
<strong>Sprint 3 (ML æµç¨‹ - 20-22 å¤©):</strong> Feature Engineer v1.3 â†’ Model Training v1.3<br />
<strong>Sprint 4 (æœ€ä½³åŒ– - 8-9 å¤©):</strong> Optimization Engine v1.2</p>
<p><strong>ç¸½é ä¼°å·¥æœŸ:</strong> 49-55 å€‹é–‹ç™¼æ—¥ (å«ç·©è¡ç´„ 10-11 é€±)</p>
<hr />
<h2 id="1-architecture-overview">1. æ¶æ§‹ç¸½è¦½ (Architecture Overview)</h2>
<h3 id="11">1.1 ç³»çµ±ç´šè¨­è¨ˆç†å¿µ</h3>
<p>HVAC-1 å°ˆæ¡ˆæ¡ç”¨<strong>å¥‘ç´„é©…å‹•ã€æ™‚é–“ä¸€è‡´ã€è³‡æºæ„ŸçŸ¥</strong>çš„æ¶æ§‹ï¼Œæ ¸å¿ƒåŸå‰‡å¦‚ä¸‹ï¼š</p>
<pre><code class="language-mermaid">graph TB
    subgraph &quot;åŸºç¤å±¤ (Sprint 1)&quot;
        FA[Feature Annotation v1.2&lt;br/&gt;Excel æ ¸å¿ƒ SSOT]
        SI[System Integration v1.2&lt;br/&gt;PipelineContext + DI Container]
    end

    subgraph &quot;ETL æµç¨‹ (Sprint 2)&quot;
        Parser[Parser v2.1&lt;br/&gt;UTC å¼·åˆ¶]
        Cleaner[Cleaner v2.2&lt;br/&gt;èªæ„æ„ŸçŸ¥æ¸…æ´—]
        Batch[Batch Processor v1.3&lt;br/&gt;Manifest + ç¨½æ ¸è»Œè·¡]
    end

    subgraph &quot;ç‰¹å¾µå·¥ç¨‹ (Sprint 3)&quot;
        FE[Feature Engineer v1.3&lt;br/&gt;ç¾¤çµ„ç­–ç•¥ + æ»¯å¾Œç‰¹å¾µ]
        MT[Model Training v1.3&lt;br/&gt;è³‡æºæ„ŸçŸ¥è¨“ç·´]
    end

    subgraph &quot;æœ€ä½³åŒ– (Sprint 4)&quot;
        OPT[Optimization Engine v1.2&lt;br/&gt;Fallback + æ··åˆ MIP]
    end

    FA --&gt;|SSOT| SI
    SI --&gt;|æ™‚é–“åŸºæº–| Parser
    Parser --&gt;|æª¢æŸ¥é» #1| Cleaner
    Cleaner --&gt;|æª¢æŸ¥é» #2| Batch
    Batch --&gt;|æª¢æŸ¥é» #3| FE
    FE --&gt;|æª¢æŸ¥é» #4| MT
    MT --&gt;|æ¨¡å‹è¨»å†Šè¡¨| OPT
</code></pre>
<h3 id="12-interface-contract-v11">1.2 Interface Contract v1.1 åˆè¦æ€§</h3>
<p>æ‰€æœ‰ 8 å€‹æ¨¡çµ„å‡åš´æ ¼éµå®ˆ Interface Contract v1.1ï¼Œå®šç¾©å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align: center;">æª¢æŸ¥é»</th>
<th style="text-align: left;">ä¾†æº â†’ ç›®æ¨™</th>
<th style="text-align: left;">é©—è­‰é …ç›®</th>
<th style="text-align: center;">éŒ¯èª¤ä»£ç¢¼</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>#1</strong></td>
<td style="text-align: left;">Parser â†’ Cleaner</td>
<td style="text-align: left;">UTC æ™‚å€ã€æ¨™é ­æ¨™æº–åŒ–ã€BOM è™•ç†</td>
<td style="text-align: center;">E101-E105</td>
</tr>
<tr>
<td style="text-align: center;"><strong>#2</strong></td>
<td style="text-align: left;">Cleaner â†’ Batch</td>
<td style="text-align: left;">è¨­å‚™é©—è­‰ç¨½æ ¸ã€æ™‚é–“åŸºæº–åˆè¦æ€§</td>
<td style="text-align: center;">E201-E206, E350-E355</td>
</tr>
<tr>
<td style="text-align: center;"><strong>#3</strong></td>
<td style="text-align: left;">Batch â†’ Feature Engineer</td>
<td style="text-align: left;">Parquet schema INT64/UTCã€ç„¡ device_role (E500)</td>
<td style="text-align: center;">E301-E305</td>
</tr>
<tr>
<td style="text-align: center;"><strong>#4</strong></td>
<td style="text-align: left;">FE â†’ Model Training</td>
<td style="text-align: left;">ç‰¹å¾µé †åºæ¸…å–®ã€ç¸®æ”¾åƒæ•¸ã€è¨»é‡‹ç‰ˆæœ¬</td>
<td style="text-align: center;">E601-E604</td>
</tr>
<tr>
<td style="text-align: center;"><strong>#5</strong></td>
<td style="text-align: left;">Excel â†’ YAML</td>
<td style="text-align: left;">æ¨£æ¿ç‰ˆæœ¬ã€Schema é›œæ¹Šã€åŒæ­¥æ™‚é–“æˆ³è¨˜</td>
<td style="text-align: center;">E406</td>
</tr>
<tr>
<td style="text-align: center;"><strong>#6</strong></td>
<td style="text-align: left;">YAML â†’ Manager</td>
<td style="text-align: left;">Schema ç‰ˆæœ¬ç›¸å®¹æ€§ã€ç¹¼æ‰¿è§£æ</td>
<td style="text-align: center;">E400, E407</td>
</tr>
<tr>
<td style="text-align: center;"><strong>#7</strong></td>
<td style="text-align: left;">Training â†’ Registry</td>
<td style="text-align: left;">ç‰¹å¾µå°é½Šã€è¨­å‚™é™åˆ¶é›œæ¹Š</td>
<td style="text-align: center;">E901-E904</td>
</tr>
</tbody>
</table>
<h3 id="13-ssot">1.3 SSOT (å–®ä¸€çœŸç†ä¾†æº) å±¤ç´š</h3>
<pre><code class="language-yaml"># SSOT æ¶æ§‹ (åš´æ ¼åˆ†å±¤)
ç¬¬ä¸€å±¤ (ç¨‹å¼ç¢¼ SSOT):
  - src/etl/config_models.py::VALID_QUALITY_FLAGS (6 å€‹æ¨™è¨˜)
  - src/etl/config_models.py::TIMESTAMP_CONFIG (UTC/INT64)
  - src/etl/config_models.py::ERROR_CODE_REGISTRY (E000-E904)

ç¬¬äºŒå±¤ (ç‰¹å¾µ SSOT):
  - config/features/base.yaml (æ‰€æœ‰æ¡ˆå ´ç¹¼æ‰¿)
  - config/features/physical_types.yaml (å–®ä½å®šç¾©)
  - config/features/sites/{site_id}.yaml (ç”± Excel ç”¢ç”Ÿ)

ç¬¬ä¸‰å±¤ (åŸ·è¡Œæ™‚ SSOT):
  - ETLConfig å¯¦ä¾‹ (ç”± Container æ³¨å…¥)
  - PipelineContext (æ™‚é–“åŸºæº– + site_id)
  - FeatureAnnotationManager (åˆä½µå¾Œçš„ç¹¼æ‰¿éˆ)

ç¦æ­¢äº‹é …:
  - ç›´æ¥å¯«å…¥ YAML (E501: ç”± Import Guard é˜»æ“‹)
  - ç¡¬ç·¨ç¢¼ device_role é è¨­å€¼ (E500: åªèƒ½ä½¿ç”¨ Annotation)
  - æ¨¡çµ„ä¸­ä½¿ç”¨ `datetime.now()` (å¿…é ˆä½¿ç”¨ context.pipeline_timestamp)
</code></pre>
<hr />
<h2 id="2-module-by-module-analysis">2. æ¨¡çµ„åˆ†æ (Module-by-Module Analysis)</h2>
<h3 id="21-parser-v21">2.1 Parser v2.1 (ç©©å¥æ€§é‡æ§‹)</h3>
<p><strong>ç‹€æ…‹:</strong> âœ… å®šç¾©æ˜ç¢º | <strong>é ä¼°å·¥æ™‚:</strong> 4 å¤© | <strong>å„ªå…ˆç´š:</strong> Sprint 2</p>
<h4 id="_4">é—œéµåŠŸèƒ½</h4>
<ul>
<li><strong>ç·¨ç¢¼åµæ¸¬:</strong> UTF-8 BOM è™•ç† + Big5/UTF-16 å‚™æ´æ©Ÿåˆ¶</li>
<li><strong>æ™ºæ…§æ¨™é ­æœå°‹:</strong> å¤šè¡Œæƒæ (500 è¡Œ) èˆ‡é—œéµå­—åŒ¹é…</li>
<li><strong>æ™‚å€æ¨™æº–åŒ–:</strong> <strong>å¼·åˆ¶ UTC è¼¸å‡º</strong> (E102 åŸ·è¡Œ)</li>
<li><strong>å¥‘ç´„é©—è­‰:</strong> åœ¨äº¤æ¥çµ¦ Cleaner å‰åŸ·è¡Œ <code>_validate_output_contract()</code></li>
</ul>
<h4 id="_5">è¨­è¨ˆå„ªå‹¢</h4>
<p>âœ… æ˜ç¢ºçš„æ™‚å€è½‰æ›ï¼Œé˜²æ­¢ä¸‹æ¸¸æ™‚é–“æ¼‚ç§»<br />
âœ… BOM è™•ç†æ±ºå¸¸äº†è¦‹çš„ BAS å°å‡ºå•é¡Œ<br />
âœ… ç©ºå€¼æ¨™æº–åŒ– (8 ç¨®æ¨¡å¼: "", "NA", "---", "Error" ç­‰)</p>
<h4 id="_6">å¯¦ä½œé¢¨éšª</h4>
<p>âš ï¸ <strong>Unicode é‚Šç·£æ¡ˆä¾‹:</strong> ç½•è¦‹ç·¨ç¢¼ (GB2312, Shift-JIS) æœªé¡¯å¼è™•ç†<br />
âš ï¸ <strong>æ¨™é ­æ­§ç¾©:</strong> å¤šèªè¨€æ¨™é ­ (ä¸­è‹±æ··åˆ) å¯èƒ½éœ€è¦æ‰‹å‹•å°æ‡‰</p>
<hr />
<h3 id="22-cleaner-v22">2.2 Cleaner v2.2 (èªæ„æ„ŸçŸ¥ + è¨­å‚™é©—è­‰)</h3>
<p><strong>ç‹€æ…‹:</strong> âœ… å®šç¾©æ˜ç¢º | <strong>é ä¼°å·¥æ™‚:</strong> 6-7 å¤© | <strong>å„ªå…ˆç´š:</strong> Sprint 2</p>
<h4 id="v21">v2.1 çš„é—œéµæ›´æ–°</h4>
<ul>
<li><strong>è¨­å‚™é‚è¼¯é æª¢æŸ¥</strong> (E350): åœ¨è³‡æ–™é€²å…¥å‰é©—è­‰ <code>chiller_pump_mutex</code> (äº’æ–¥é‚è¼¯)</li>
<li><strong>æ™‚é–“åŸºæº–å¼·åˆ¶:</strong> ä½¿ç”¨ <code>pipeline_origin_timestamp</code> è€Œé <code>datetime.now()</code></li>
<li><strong>è¨­å‚™è§’è‰²æ„ŸçŸ¥:</strong> æ ¹æ“šè§’è‰²èª¿æ•´é–¥å€¼ (å‚™ç”¨è¨­å‚™æŠ‘åˆ¶ W403 è­¦å‘Š) <strong>ä½†ä¸å¯«å…¥è¼¸å‡º</strong></li>
<li><strong>åš´æ ¼é—œæ³¨é»åˆ†é›¢:</strong> å¾ Annotation è®€å– <code>device_role</code>ï¼Œä½† <strong>E500 é˜»æ“‹å…¶è¼¸å‡ºæ´©æ¼</strong></li>
</ul>
<h4 id="ssot">SSOT æ•´åˆ</h4>
<pre><code class="language-python"># Cleaner v2.2 å¾ FeatureAnnotationManager è®€å– device_role:
col_config = self.annotation_manager.get_column_config(&quot;chiller_2_temp&quot;)
if col_config.device_role == &quot;backup&quot;:
    # é‡å°å‚™ç”¨è¨­å‚™æŠ‘åˆ¶ W403 (é•·æœŸé–’ç½®é›¶å€¼)
    self._suppress_warning(&quot;W403&quot;, reason=&quot;Backup equipment long-term idle&quot;)

# è¼¸å‡ºé©—è­‰ (å®ˆé–€å“¡åŸå‰‡):
if &quot;device_role&quot; in clean_df.columns:
    raise DataLeakageError(&quot;E500: device_role must not pass to BatchProcessor&quot;)
</code></pre>
<h4 id="_7">è¨­è¨ˆå„ªå‹¢</h4>
<p>âœ… <strong>å®ˆé–€å“¡æ©Ÿåˆ¶:</strong> åœ¨å…¥å£è™•é˜»æ“‹éŒ¯èª¤è³‡æ–™ (é æª¢æŸ¥) vs å¾ŒæœŸæ¸…æ´—<br />
âœ… <strong>è¨­å‚™é©—è­‰ç¨½æ ¸:</strong> è¨˜éŒ„é•è¦äº‹é …ä¾› BatchProcessor Manifest ä½¿ç”¨<br />
âœ… <strong>Metadata æ·¨åŒ–:</strong> å¼·åˆ¶åŸ·è¡Œ <code>ALLOWED_METADATA_KEYS</code> é˜²æ­¢å±¬æ€§è†¨è„¹</p>
<h4 id="_8">é—œéµä¾è³´</h4>
<p>ğŸ”´ <strong>ä¾è³´æ­»é–é¢¨éšª:</strong> éœ€è¦ FeatureAnnotationManager v1.2 <strong>åœ¨ Cleaner å¯¦ä¾‹åŒ–ä¹‹å‰åˆå§‹åŒ–</strong><br />
ğŸŸ¡ <strong>è¨»é‡‹ç‰ˆæœ¬æª¢æŸ¥:</strong> Schema ä¸åŒ¹é…è§¸ç™¼ E400 (éœ€è¦ <code>migrate-excel</code> å·¥å…·)</p>
<hr />
<h3 id="23-feature-engineer-v13-fa">2.3 Feature Engineer v1.3-FA (ç‰¹å¾µè¨»é‡‹æ¶ˆè²»)</h3>
<p><strong>ç‹€æ…‹:</strong> âœ… å®šç¾©æ˜ç¢º | <strong>é ä¼°å·¥æ™‚:</strong> 5-6 å¤© | <strong>å„ªå…ˆç´š:</strong> Sprint 3</p>
<h4 id="_9">é—œéµå‰µæ–°</h4>
<ul>
<li><strong>Metadata åˆ†å±¤:</strong> ç‰©ç†å±¬æ€§ä¾†è‡ª Manifestï¼Œè§’è‰²/è­¦å‘Šä¾†è‡ª Annotation</li>
<li><strong>ç›´æ¥è¨»é‡‹æŸ¥è©¢:</strong> ç¹éä¸­é–“å¿«å–ï¼Œç›´æ¥ç²å–æœ€æ–° <code>device_role</code>/<code>ignore_warnings</code></li>
<li><strong>èªæ„ç¾¤çµ„ç­–ç•¥:</strong> æ ¹æ“š <code>device_role</code> èª¿æ•´æ»¯å¾Œ/æ»¾å‹•ç­–ç•¥ (ä¾‹å¦‚ï¼šå‚™ç”¨è¨­å‚™ä½¿ç”¨è¼ƒç°¡å–®çš„ç­–ç•¥)</li>
<li><strong>åš´æ ¼è³‡æ–™æ´©æ¼é é˜²:</strong> å¼·åˆ¶åŸ·è¡Œ <code>strict_past_only</code> æ™‚é–“åˆ‡å‰²</li>
</ul>
<h4 id="_10">å¯¦ä½œæ¨¡å¼</h4>
<pre><code class="language-python"># Step 3.1: å‹•æ…‹æŸ¥è©¢ device_role (éä¾†è‡ª Manifest)
col_config = self.annotation_manager.get_column_config(&quot;chiller_1_load&quot;)
device_role = col_config.device_role  # &quot;primary&quot; | &quot;backup&quot; | &quot;seasonal&quot;

# Step 3.2: èª¿æ•´ç¾¤çµ„ç­–ç•¥
if device_role == &quot;backup&quot; and policy.name == &quot;High_Freq&quot;:
    # å‚™ç”¨è¨­å‚™ä¸éœ€è¦é«˜é »æ¡æ¨£
    policy.lag_intervals = [1, 4]  # å¾ [1, 4, 15, 96] æ¸›å°‘
</code></pre>
<hr />
<h3 id="24-batch-processor-v13">2.4 Batch Processor v1.3 (å¥‘ç´„å°é½Š + è¨»é‡‹ç¨½æ ¸)</h3>
<p><strong>ç‹€æ…‹:</strong> âœ… å®šç¾©æ˜ç¢º | <strong>é ä¼°å·¥æ™‚:</strong> 6-7 å¤© | <strong>å„ªå…ˆç´š:</strong> Sprint 2</p>
<h4 id="interface-contract-v11">Interface Contract v1.1 é—œéµå°é½Š</h4>
<ul>
<li><strong>æª¢æŸ¥é» #3 åŸ·è¡Œ:</strong> é©—è­‰ Cleaner è¼¸å‡ºåŒ…å« <code>equipment_validation_audit</code></li>
<li><strong>æ™‚é–“åŸºæº–å‚³é:</strong> å°‡ <code>context.pipeline_timestamp</code> å¯«å…¥ Manifest ä¾›ä¸‹æ¸¸ä½¿ç”¨</li>
<li><strong>E408 SSOT é©—è­‰:</strong> æ¯”å°ç¨‹å¼ç¢¼ <code>VALID_QUALITY_FLAGS</code> èˆ‡ Manifest ç‰ˆæœ¬</li>
<li><strong>E500 æœ€çµ‚æª¢æŸ¥:</strong> è‹¥åµæ¸¬åˆ° <code>device_role</code> æ¬„ä½ï¼Œé˜»æ“‹ Parquet å¯«å…¥</li>
</ul>
<h4 id="manifest-v13">Manifest çµæ§‹ (v1.3 æ›´æ–°)</h4>
<pre><code class="language-json">{
  &quot;version&quot;: &quot;2.0-ALIGN&quot;,
  &quot;pipeline_origin_timestamp&quot;: &quot;2026-02-14T10:25:00Z&quot;,  // ä¾†è‡ª PipelineContext
  &quot;equipment_validation_audit&quot;: {  // ä¾†è‡ª Cleaner v2.2
    &quot;violations&quot;: [
      {
        &quot;constraint_id&quot;: &quot;chiller_pump_mutex&quot;,
        &quot;severity&quot;: &quot;critical&quot;,
        &quot;marked_as&quot;: &quot;PHYSICAL_IMPOSSIBLE&quot;
      }
    ]
  },
  &quot;temporal_baseline&quot;: {  // E000 å¼·åˆ¶åŸ·è¡Œ
    &quot;future_data_check&quot;: {
      &quot;enabled&quot;: true,
      &quot;violations_found&quot;: false
    }
  }
}
</code></pre>
<hr />
<h3 id="25-model-training-v13">2.5 Model Training v1.3 (è³‡æºæ„ŸçŸ¥ + ç”Ÿç”¢å°±ç·’)</h3>
<p><strong>ç‹€æ…‹:</strong> âœ… å®šç¾©æ˜ç¢º | <strong>é ä¼°å·¥æ™‚:</strong> 10-12 å¤© | <strong>å„ªå…ˆç´š:</strong> Sprint 3</p>
<h4 id="v12">v1.2 é‡å¤§å¢å¼·</h4>
<ol>
<li><strong>è³‡æºç®¡ç†ç³»çµ±:</strong> è¨“ç·´å‰è¨˜æ†¶é«”ä¼°ç®— + ç›£æ§ + OOM é é˜²</li>
<li><strong>Kubernetes æ•´åˆ:</strong> è³‡æºè«‹æ±‚/é™åˆ¶ï¼ŒpreStop hook ç”¨æ–¼ç·Šæ€¥æª¢æŸ¥é»</li>
<li><strong>Docker è³‡æºé™åˆ¶:</strong> åƒæ•¸åŒ– --memory, --cpus, --shm-size</li>
<li><strong>æª¢æŸ¥é»ç®¡ç†å™¨:</strong> è¨˜æ†¶é«”å£“åŠ›éå¤§ (&gt;85%) æ™‚è‡ªå‹•å„²å­˜</li>
<li><strong>æ··åˆä¸€è‡´æ€§æª¢æŸ¥:</strong> ç³»çµ± vs çµ„ä»¶æ¨¡å‹å·®ç•°åµæ¸¬ (E710 &gt;15%, W702 &gt;5%)</li>
</ol>
<h4 id="_11">è³‡æºä¼°ç®—å…¬å¼</h4>
<pre><code class="language-python">def estimate_resource_requirements(n_samples, n_features, model_types):
    base_memory_gb = 2.0  # Python runtime
    # ... è¨ˆç®—æ•¸æ“šè¨˜æ†¶é«” ...
    # ... æ ¹æ“šæ¨¡å‹é¡å‹ (XGBoost/LightGBM/RF) ä¹˜ä¸Šä¿‚æ•¸ ...
    # å®‰å…¨é‚Šéš›: 20%
    return estimated_memory_gb * 1.2
</code></pre>
<hr />
<h3 id="26-optimization-engine-v12-fallback">2.6 Optimization Engine v1.2 (ç©©å¥ + Fallback)</h3>
<p><strong>ç‹€æ…‹:</strong> âœ… å®šç¾©æ˜ç¢º | <strong>é ä¼°å·¥æ™‚:</strong> 8-9 å¤© | <strong>å„ªå…ˆç´š:</strong> Sprint 4</p>
<h4 id="_12">é˜²ç¦¦æ€§æœ€ä½³åŒ–å“²å­¸</h4>
<p><strong>ã€Œå¯§å¯æ¥å—æ¬¡ä½³çš„å¯è¡Œè§£ï¼Œä¹Ÿä¸è¦ç³»çµ±å´©æ½°ã€</strong></p>
<p>ä¸‰å±¤ç´š Fallback ç­–ç•¥ï¼š</p>
<pre><code>Level 0 (æ¨™æº–): differential_evolution + å®Œæ•´ç´„æŸ
  â†“ [ç„¡è§£/è¶…æ™‚]
Level 1 (æ”¾å¯¬): ç§»é™¤è»Ÿç´„æŸ (äº’æ–¥æ”¾å¯¬ 10%)
  â†“ [ä»ç„¡è§£]
Level 2 (å•Ÿç™¼å¼): GreedyHeuristicOptimizer (ä¾æ•ˆç‡æ’åºé¸æ“‡è¨­å‚™)
  â†“ [ä»ç„¡è§£]
Level 3 (ç•¶å‰é…ç½®): å›å‚³ç•¶å‰é…ç½®ä¸¦é™„å¸¶è¨ºæ–·å ±å‘Š
</code></pre>
<h4 id="_13">æ··åˆæ¨¡å‹ä¸€è‡´æ€§æª¢æŸ¥</h4>
<pre><code class="language-python"># E806 è­¦å‘Š (5-15% å·®ç•°)
# E810 åš´é‡éŒ¯èª¤ (&gt;15% å·®ç•°)

if discrepancy_pct &gt; 15:
    raise HybridInconsistencyError(f&quot;E810: æ¨¡å‹å·®ç•° {discrepancy_pct:.1f}% &gt; 15%. éœ€è¦é‡æ–°è¨“ç·´ã€‚&quot;)
</code></pre>
<hr />
<h3 id="27-feature-annotation-v12-excel-ssot">2.7 Feature Annotation v1.2 (Excel æ ¸å¿ƒ SSOT)</h3>
<p><strong>ç‹€æ…‹:</strong> âœ… å®šç¾©æ˜ç¢º | <strong>é ä¼°å·¥æ™‚:</strong> 6-7 å¤© | <strong>å„ªå…ˆç´š:</strong> Sprint 1 (åŸºç¤)</p>
<h4 id="excel-uiyaml">è¨­è¨ˆå“²å­¸: <strong>ã€ŒExcel ä½œç‚º UIï¼ŒYAML ä½œç‚ºè³‡æ–™åº«ã€</strong></h4>
<p><strong>é—œéµå·¥ä½œæµ:</strong></p>
<pre><code>äººå“¡ç·¨è¼¯ (Excel) â†’ é©—è­‰ (excel_to_yaml.py) â†’ YAML SSOT â†’ Git PR â†’ Container éƒ¨ç½²
         â†‘                                                                 â†“
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç½é›£æ¢å¾© (yaml_to_excel.py) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 id="yaml">é˜²æ­¢ç›´æ¥ä¿®æ”¹ YAML çš„ä¸‰å±¤ä¿è­·</h4>
<ol>
<li><strong>æª”æ¡ˆç³»çµ±ä¿è­·:</strong> éƒ¨ç½²æ™‚è¨­ç½®å”¯è®€èˆ‡ä¸å¯è®Šæ›´å±¬æ€§</li>
<li><strong>Import Guard (åŸ·è¡Œæ™‚):</strong> <code>yaml_write_guard.py</code> æ””æˆªå¯«å…¥æ“ä½œ</li>
<li><strong>Manager API é™åˆ¶:</strong> åƒ…æä¾›å”¯è®€ä»‹é¢</li>
</ol>
<hr />
<h3 id="28-system-integration-v12">2.8 System Integration v1.2 (æœ‰åºåˆå§‹åŒ– + æ™‚é–“ä¸€è‡´æ€§)</h3>
<p><strong>ç‹€æ…‹:</strong> âœ… å®šç¾©æ˜ç¢º | <strong>é ä¼°å·¥æ™‚:</strong> 6-7 å¤© | <strong>å„ªå…ˆç´š:</strong> Sprint 1 (åŸºç¤)</p>
<h4 id="pipelinecontext">PipelineContext: æ™‚é–“åŸºæº–è¼‰é«”</h4>
<p><strong>è¨­è¨ˆç›®çš„:</strong> æ¶ˆé™¤å„æ¨¡çµ„ä¸­çš„ <code>datetime.now()</code> å‘¼å«</p>
<pre><code class="language-python">@dataclass
class PipelineContext:
    pipeline_timestamp: datetime  # å…¨åŸŸçµ±ä¸€æ™‚é–“

    def is_future_timestamp(self, timestamp):
        # çµ±ä¸€çš„æœªä¾†æ•¸æ“šæª¢æŸ¥é‚è¼¯
        pass
</code></pre>
<h4 id="etlcontainer">åš´æ ¼åˆå§‹åŒ–é †åº (ETLContainer)</h4>
<p><strong>å„ªé»:</strong><br />
1. <strong>é˜²æ­¢ç«¶çˆ­æ¢ä»¶:</strong> Cleaner åœ¨ AnnotationManager ä¹‹å‰ç„¡æ³•åˆå§‹åŒ–<br />
2. <strong>æª”æ¡ˆé–æ•´åˆ:</strong> åœ¨ Container åˆå§‹åŒ–æ™‚æª¢æ¸¬ Excel-YAML è¡çª<br />
3. <strong>æ™‚é–“ä¸€è‡´æ€§:</strong> æ‰€æœ‰æ¨¡çµ„ä½¿ç”¨ç›¸åŒçš„ <code>pipeline_timestamp</code></p>
<hr />
<h2 id="3">3. é—œéµä¾è³´åˆ†æ</h2>
<h3 id="31">3.1 ä¾è³´åœ– (åŸºç¤å„ªå…ˆç­–ç•¥)</h3>
<pre><code class="language-mermaid">graph TD
    subgraph &quot;Sprint 1: åŸºç¤å»ºè¨­ (å¿…è¦å…ˆæ±ºæ¢ä»¶)&quot;
        FA[Feature Annotation v1.2&lt;br/&gt;6-7 å¤©]
        SI[System Integration v1.2&lt;br/&gt;6-7 å¤©]
        FA --&gt; SI
    end

    subgraph &quot;Sprint 2: ETL æµç¨‹&quot;
        Parser[Parser v2.1&lt;br/&gt;4 å¤©]
        Cleaner[Cleaner v2.2&lt;br/&gt;6-7 å¤©]
        Batch[Batch Processor v1.3&lt;br/&gt;6-7 å¤©]

        SI --&gt; Parser
        SI --&gt; Cleaner
        FA --&gt; Cleaner
        Parser --&gt; Cleaner
        Cleaner --&gt; Batch
    end

    subgraph &quot;Sprint 3: ML æµç¨‹&quot;
        FE[Feature Engineer v1.3&lt;br/&gt;5-6 å¤©]
        MT[Model Training v1.3&lt;br/&gt;10-12 å¤©]

        FA --&gt; FE
        Batch --&gt; FE
        FE --&gt; MT
    end

    subgraph &quot;Sprint 4: æœ€ä½³åŒ–&quot;
        OPT[Optimization Engine v1.2&lt;br/&gt;8-9 å¤©]

        MT --&gt; OPT
        FA --&gt; OPT
    end

    style FA fill:#f00,stroke:#333,color:#fff,stroke-width:4px
    style SI fill:#f00,stroke:#333,color:#fff,stroke-width:4px
</code></pre>
<h3 id="32">3.2 é˜»æ“‹æ€§ä¾è³´ (å¿…é ˆåœ¨ç·¨ç¢¼å‰è§£æ±º)</h3>
<table>
<thead>
<tr>
<th style="text-align: center;">é˜»æ“‹ ID</th>
<th style="text-align: left;">æ¨¡çµ„</th>
<th style="text-align: left;">ä¾è³´é …ç›®</th>
<th style="text-align: left;">é•è¦å½±éŸ¿</th>
<th style="text-align: left;">è§£æ±ºæ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><strong>BD-001</strong></td>
<td style="text-align: left;">Cleaner v2.2</td>
<td style="text-align: left;">FeatureAnnotationManager å·²åˆå§‹åŒ–</td>
<td style="text-align: left;">E901 åŸ·è¡Œæ™‚éŒ¯èª¤ (åˆå§‹åŒ–é †åºé•è¦)</td>
<td style="text-align: left;"><strong>å„ªå…ˆ</strong>å¯¦ä½œ Feature Annotation v1.2</td>
</tr>
<tr>
<td style="text-align: center;"><strong>BD-002</strong></td>
<td style="text-align: left;">Batch Processor v1.3</td>
<td style="text-align: left;">Context ä¹‹æ™‚é–“åŸºæº–</td>
<td style="text-align: left;">æœªä¾†æ•¸æ“šæª¢æŸ¥ä¸ä¸€è‡´</td>
<td style="text-align: left;"><strong>å„ªå…ˆ</strong>å¯¦ä½œ System Integration v1.2</td>
</tr>
<tr>
<td style="text-align: center;"><strong>BD-003</strong></td>
<td style="text-align: left;">Feature Engineer v1.3</td>
<td style="text-align: left;">Annotation <code>device_role</code></td>
<td style="text-align: left;">ç¾¤çµ„ç­–ç•¥é‚è¼¯å¤±æ•—</td>
<td style="text-align: left;">ç­‰å¾… Feature Annotation v1.2</td>
</tr>
<tr>
<td style="text-align: center;"><strong>BD-004</strong></td>
<td style="text-align: left;">Model Training v1.3</td>
<td style="text-align: left;">ç‰¹å¾µé †åº Manifest + ç¸®æ”¾åƒæ•¸</td>
<td style="text-align: left;">E901 ç‰¹å¾µå°é½ŠéŒ¯èª¤</td>
<td style="text-align: left;">ç¢ºä¿ FE v1.3 è¼¸å‡º <code>feature_order_manifest</code></td>
</tr>
<tr>
<td style="text-align: center;"><strong>BD-005</strong></td>
<td style="text-align: left;">Optimization v1.2</td>
<td style="text-align: left;">å«ç‰¹å¾µ Manifest çš„ Model Registry</td>
<td style="text-align: left;">E901/E903/E904 é©—è­‰å¤±æ•—</td>
<td style="text-align: left;">ç­‰å¾… Model Training v1.3</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="4">4. é¢¨éšªè©•ä¼°èˆ‡ç·©è§£</h2>
<h3 id="41">4.1 æŠ€è¡“é¢¨éšª (æŒ‰å„ªå…ˆç´šæ’åº)</h3>
<h4 id="t1">é¢¨éšª T1: ä¾è³´æ­»é– (åš´é‡)</h4>
<p><strong>æ©Ÿç‡:</strong> é«˜ (80%) | <strong>å½±éŸ¿:</strong> å°ˆæ¡ˆåœæ»¯<br />
<strong>ç·©è§£:</strong><br />
1. âœ… å¼·åˆ¶ Sprint 1 å®Œæˆå¾Œæ‰é–‹å§‹ Sprint 2<br />
2. âœ… åŠ å…¥ CI æª¢æŸ¥: <code>pytest tests/integration/test_init_order.py</code><br />
3. âœ… ä½¿ç”¨ DI Container æ¨¡å¼</p>
<h4 id="t2-e500">é¢¨éšª T2: è¨­å‚™è§’è‰²æ´©æ¼ (E500) (é«˜)</h4>
<p><strong>æ©Ÿç‡:</strong> ä¸­ (60%) | <strong>å½±éŸ¿:</strong> è³‡æ–™å®Œæ•´æ€§é•è¦<br />
<strong>ç·©è§£:</strong><br />
1. âœ… Cleaner è¼¸å‡ºå¥‘ç´„: <code>assert "device_role" not in clean_df.columns</code><br />
2. âœ… Batch Processor é æª¢æŸ¥èˆ‡ Model Training è¼¸å…¥é©—è­‰</p>
<h4 id="t3-e406">é¢¨éšª T3: è¨»é‡‹åŒæ­¥æ¼‚ç§» (E406) (é«˜)</h4>
<p><strong>æ©Ÿç‡:</strong> ä¸­ (50%) | <strong>å½±éŸ¿:</strong> é…ç½®ä¸ä¸€è‡´<br />
<strong>ç·©è§£:</strong><br />
1. âœ… åš´æ ¼åŒæ­¥æª¢æŸ¥: <code>fa_config.strict_sync_check = True</code><br />
2. âœ… CI Hook: é©—è­‰ Excel ä¿®æ”¹æ™‚é–“ &lt; YAML ä¿®æ”¹æ™‚é–“</p>
<hr />
<h2 id="5">5. å¯è¡Œæ€§è©•ä¼°</h2>
<h3 id="51">5.1 æŠ€è¡“å¯è¡Œæ€§: âœ… <strong>ç¢ºèªå¯è¡Œ</strong></h3>
<p><strong>å„ªå‹¢:</strong> å®šç¾©æ˜ç¢ºçš„å¥‘ç´„ã€æˆç†Ÿçš„æŠ€è¡“å †ç–Šã€æ·±åº¦é˜²ç¦¦é©—è­‰ã€ç”Ÿç”¢ç´šæ¨¡å¼ã€‚</p>
<h3 id="52">5.2 è³‡æºå¯è¡Œæ€§: âš ï¸ <strong>å¯è¡Œä½†æœ‰é™åˆ¶</strong></h3>
<p><strong>éœ€æ±‚:</strong> 1 ä½è³‡æ·±å¾Œç«¯ã€1 ä½ ML å·¥ç¨‹å¸«ã€1 ä½è³‡æ–™å·¥ç¨‹å¸«ã€0.5 ä½ DevOpsã€‚<br />
<strong>ç¡¬é«”:</strong> ç”Ÿç”¢ç’°å¢ƒ K8s éœ€è‡³å°‘ 2 ç¯€é» (å„ 16GB RAM)ã€‚</p>
<h3 id="53-10-11">5.3 æ™‚ç¨‹å¯è¡Œæ€§: âœ… <strong>10-11 é€±å…§å¯é”æˆ</strong></h3>
<p><strong>ç¸½é ä¼°:</strong> 49-55 å¤©ã€‚é—œéµè·¯å¾‘å› ä¾è³´é—œä¿‚å‘ˆç¾åš´æ ¼çš„é †åºæ€§ã€‚</p>
<hr />
<h2 id="6">6. å»ºè­°</h2>
<h3 id="61">6.1 ç«‹å³è¡Œå‹• (ç·¨ç¢¼é–‹å§‹å‰)</h3>
<h4 id="1-ci">è¡Œå‹• 1: å¯¦ä½œä¾è³´é©—è­‰ CI æª¢æŸ¥ (å„ªå…ˆç´š: ğŸ”´ åš´é‡)</h4>
<p>ç¢ºä¿åˆå§‹åŒ–é †åºç¬¦åˆè¦å®šã€‚</p>
<h4 id="2-contributingmd-excel">è¡Œå‹• 2: åœ¨ CONTRIBUTING.md è¨˜éŒ„ Excel å·¥ä½œæµ (å„ªå…ˆç´š: ğŸŸ¡ é«˜)</h4>
<p>æ˜ç¢ºè¦ç¯„ Excel æ˜¯å”¯ä¸€ç·¨è¼¯ä»‹é¢ï¼Œç¦æ­¢ç›´æ¥ä¿®æ”¹ YAMLã€‚</p>
<h4 id="3-sprint-1">è¡Œå‹• 3: å»ºç«‹ Sprint 1 åŸºç¤æª¢æ ¸è¡¨ (å„ªå…ˆç´š: ğŸŸ¡ é«˜)</h4>
<p>åŒ…å« Feature Annotation èˆ‡ System Integration çš„æ¯æ—¥ç´°é …ä»»å‹™ã€‚</p>
<hr />
<h2 id="7">7. çµè«–</h2>
<h3 id="71">7.1 æœ€çµ‚çµè«–</h3>
<p>HVAC-1 å°ˆæ¡ˆ<strong>æ¶æ§‹å¥å…¨ä¸”å·²æº–å‚™å¥½é–‹ç™¼</strong>ï¼Œå‰ææ˜¯ï¼š<br />
1. âœ… <strong>å¯ä»¥é–‹å§‹é–‹ç™¼</strong>ï¼šè‹¥åš´æ ¼åŸ·è¡Œã€ŒåŸºç¤å„ªå…ˆç­–ç•¥ã€(Sprint 1 åœ¨ Sprint 2 ä¹‹å‰å®Œæˆ)ã€‚<br />
2. âš ï¸ <strong>æš«ç·©é–‹ç™¼</strong>ï¼šè‹¥é—œéµåŸºç¤å»ºè¨­ (K8s, è³‡æ·±äººå“¡) å°šæœªåˆ°ä½ã€‚</p>
<p><strong>æ–‡ä»¶ç”¢ç”Ÿæ—¥æœŸ:</strong> 2026-02-14<br />
<strong>ä¸‹æ¬¡å¯©é–±:</strong> Sprint 1 å®Œæˆå¾Œ</p>
</body>
</html>