<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRD_Overview</title>

<style>
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
    font-size: 16px;
    line-height: 1.5;
    word-wrap: break-word;
    color: #24292e;
    background-color: #fff;
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem;
}
h1, h2, h3, h4, h5, h6 {
    margin-top: 24px;
    margin-bottom: 16px;
    font-weight: 600;
    line-height: 1.25;
}
h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
h3 { font-size: 1.25em; }
code {
    padding: 0.2em 0.4em;
    margin: 0;
    font-size: 85%;
    background-color: #f6f8fa;
    border-radius: 6px;
    font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
}
pre {
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f6f8fa;
    border-radius: 6px;
}
pre code {
    display: inline;
    padding: 0;
    margin: 0;
    overflow: visible;
    line-height: inherit;
    word-wrap: normal;
    background-color: initial;
    border: 0;
}
blockquote {
    padding: 0 1em;
    color: #6a737d;
    border-left: 0.25em solid #dfe2e5;
    margin: 0;
}
table {
    display: block;
    width: 100%;
    margin-top: 0;
    margin-bottom: 16px;
    overflow: auto;
    border-spacing: 0;
    border-collapse: collapse;
}
table th, table td {
    padding: 6px 13px;
    border: 1px solid #dfe2e5;
}
table tr {
    background-color: #fff;
    border-top: 1px solid #c6cbd1;
}
table tr:nth-child(2n) {
    background-color: #f6f8fa;
}
a { color: #0366d6; text-decoration: none; }
a:hover { text-decoration: underline; }
hr {
    height: 0.25em;
    padding: 0;
    margin: 24px 0;
    background-color: #e1e4e8;
    border: 0;
}
</style>

</head>
<body>
<h1 id="prd-prd-system-overview">PRD 系統總覽與導讀 (PRD System Overview)</h1>
<p>本文件旨在為開發者提供與專案 PRD 相關的導航地圖，說明各模組的功能、相依性以及執行順序。</p>
<h2 id="1">1. 系統架構與相依關係圖</h2>
<p>整個系統由底層往上層構建，呈現嚴格的單向依賴：</p>
<pre><code class="language-mermaid">graph TD
    A[Feature Annotation V1.2&lt;br/&gt;(Excel/YAML SSOT)] --&gt;|提供 Schema &amp; 物理限制| C[Cleaner V2.2]
    Z[Raw Files] --&gt;|解析| B[Parser V2.1]
    B --&gt;|UTC DataFrame| C
    C --&gt;|Cleaned DataFrame| D[Batch Processor V1.3]
    D --&gt;|Manifest + Parquet| E[Feature Engineer V1.3]
    A --&gt;|提供 device_role &amp; 規則| E
    E --&gt;|Feature Matrix| F[Model Training V1.2]
    F &lt;--&gt;|一致性驗證| G[Hybrid Consistency V1.0]
    F --&gt;|Model Registry| H[Optimization Engine V1.1]
    A --&gt;|提供限制條件| H

    style A fill:#f9f,stroke:#333,stroke-width:4px
    style B fill:#eef,stroke:#333,stroke-width:2px
    style C fill:#bbf,stroke:#333,stroke-width:2px
    style D fill:#ddf,stroke:#333,stroke-width:2px
    style E fill:#bfb,stroke:#333,stroke-width:2px
    style F fill:#fbb,stroke:#333,stroke-width:2px
    style G fill:#fdd,stroke:#333,stroke-width:2px
    style H fill:#eef,stroke:#333,stroke-width:2px
</code></pre>
<h2 id="2-prd">2. 各 PRD 功能詳解</h2>
<h3 id="21-feature-annotation-specification-v12">2.1 [基礎設施] Feature Annotation Specification (V1.2)</h3>
<ul>
<li><strong>功能</strong>: 作為整個系統的 <strong>Single Source of Truth (SSOT)</strong>。定義所有感測器點位、物理類型、單位、上下限範圍以及設備角色 (Primary/Backup)。</li>
<li><strong>相依性</strong>: 無 (這是最底層)。</li>
<li><strong>關鍵產出</strong>: <code>config/features/sites/*.yaml</code> (由 Excel 生成)。</li>
</ul>
<h3 id="22-interface-contract-v10">2.2 [介面規範] Interface Contract (V1.0)</h3>
<ul>
<li><strong>功能</strong>: 定義模組間的溝通語言與錯誤處理標準。包含錯誤代碼表 (E000-E999)、資料交換格式 (Checkpoint)、以及版本相容性矩陣。</li>
</ul>
<h3 id="23">2.3 [資料前處理]</h3>
<h4 id="parser-v21">Parser (V2.1)</h4>
<ul>
<li><strong>功能</strong>: 處理「髒」的原始檔案。負責編碼偵測 (BOM/Big5)、強制時區轉 UTC、與標頭正規化。</li>
<li><strong>相依性</strong>: <code>Interface Contract</code> (檢查點 #1)。</li>
<li><strong>關鍵產出</strong>: 標準化 DataFrame (UTC, UTF-8)。</li>
</ul>
<h4 id="cleaner-v22">Cleaner (V2.2)</h4>
<ul>
<li><strong>功能</strong>: 業務邏輯清洗。處理時間對齊、異常值過濾 (基於 Annotation)、冷凍數據檢測。</li>
<li><strong>相依性</strong>: <code>Parser</code> (輸入), <code>Feature Annotation</code> (規則)。</li>
<li><strong>關鍵產出</strong>: Cleaned DataFrame (無 <code>device_role</code> 欄位)。</li>
</ul>
<h4 id="batch-processor-v13">Batch Processor (V1.3)</h4>
<ul>
<li><strong>功能</strong>: ETL 流程編排與落地。生成 <code>Manifest</code> (含 Annotation 稽核軌跡) 與 <code>Parquet</code> 檔案。確保資料與 Metadata 的完整傳遞，但不處理業務邏輯。</li>
<li><strong>相依性</strong>: <code>Cleaner</code> (輸入)。</li>
<li><strong>關鍵產出</strong>: <code>manifest.json</code> + <code>data.parquet</code>。</li>
</ul>
<h3 id="24-feature-engineer-v13">2.4 [特徵工程] Feature Engineer (V1.3)</h3>
<ul>
<li><strong>功能</strong>: 讀取 Manifest，結合 <strong>Feature Annotation</strong> (直接讀取 YAML SSOT) 來產生模型特徵。處理 Lag、Rolling Window，並根據設備角色調整策略。</li>
<li><strong>相依性</strong>: <code>Batch Processor</code> (輸入), <code>Feature Annotation</code> (設備角色)。</li>
<li><strong>關鍵產出</strong>: Feature Matrix。</li>
</ul>
<h3 id="25">2.5 [模型訓練與驗證]</h3>
<h4 id="model-training-v12">Model Training (V1.2)</h4>
<ul>
<li><strong>功能</strong>: 訓練能耗預測模型 (System &amp; Component Level)。</li>
<li><strong>關鍵產出</strong>: <code>model_registry_index.json</code> + 模型檔案。</li>
</ul>
<h4 id="hybrid-model-consistency-v10">Hybrid Model Consistency (V1.0)</h4>
<ul>
<li><strong>功能</strong>: 驗證 System Model 與 Component Models 加總的一致性。處理耦合效應 (Copula Effect) 與動態容差。</li>
<li><strong>相依性</strong>: 被 <code>Model Training</code> (驗證階段) 與 <code>Optimization</code> (執行階段) 呼叫。</li>
</ul>
<h3 id="26-optimization-engine-v11">2.6 [最佳化] Optimization Engine (V1.1)</h3>
<ul>
<li><strong>功能</strong>: 離線建議。基於模型預測與物理限制，尋找最佳設備參數。</li>
<li><strong>相依性</strong>: <code>Model Training</code> (載入模型), <code>Feature Annotation</code> (物理限制)。</li>
</ul>
<h2 id="3">3. 開發建議順序 (更新版)</h2>
<ol>
<li><strong>Feature Annotation Manager</strong>: (最優先) 建立地基。</li>
<li><strong>Parser</strong>: 處理原始資料的入口。</li>
<li><strong>Cleaner</strong>: 實作資料清洗邏輯。</li>
<li><strong>Batch Processor</strong>: 串接資料流與落地。</li>
<li><strong>Feature Engineer</strong>: 產生特徵。</li>
<li><strong>Hybrid Consistency</strong>: 建立驗證標準。</li>
<li><strong>Model Training</strong>: 訓練模型。</li>
<li><strong>Optimization Engine</strong>: 實現業務價值。</li>
</ol>
</body>
</html>