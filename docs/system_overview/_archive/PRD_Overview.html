
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PRD_Overview</title>
    
<style>
    body { 
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; 
        line-height: 1.6; 
        max-width: 900px; 
        margin: 0 auto; 
        padding: 40px 20px; 
        color: #24292e; 
        background-color: #ffffff;
    }
    h1, h2, h3, h4, h5, h6 { 
        margin-top: 24px; 
        margin-bottom: 16px; 
        font-weight: 600; 
        color: #24292e;
    }
    h1 { font-size: 2em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
    h2 { font-size: 1.5em; border-bottom: 1px solid #eaecef; padding-bottom: 0.3em; }
    h3 { font-size: 1.25em; }
    p { margin-top: 0; margin-bottom: 16px; }
    a { color: #0366d6; text-decoration: none; }
    a:hover { text-decoration: underline; }
    table { 
        display: block; 
        width: 100%; 
        overflow: auto; 
        border-spacing: 0; 
        border-collapse: collapse; 
        margin-bottom: 16px; 
    }
    table th, table td { 
        padding: 6px 13px; 
        border: 1px solid #dfe2e5; 
    }
    table th { 
        font-weight: 600; 
        background-color: #f6f8fa; 
    }
    table tr:nth-child(2n) { 
        background-color: #f6f8fa; 
    }
    code { 
        font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace; 
        background-color: #f6f8fa; 
        padding: 0.2em 0.4em; 
        border-radius: 3px; 
        font-size: 85%; 
    }
    pre { 
        background-color: #f6f8fa; 
        padding: 16px; 
        overflow: auto; 
        border-radius: 3px; 
        line-height: 1.45; 
    }
    pre code { 
        background-color: transparent; 
        padding: 0; 
        border-radius: 0; 
    }
    blockquote { 
        border-left: 0.25em solid #dfe2e5; 
        color: #6a737d; 
        padding: 0 1em; 
        margin: 0 0 16px 0; 
    }
    hr {
        height: 0.25em;
        padding: 0;
        margin: 24px 0;
        background-color: #e1e4e8;
        border: 0;
    }
    .mermaid {
        display: flex;
        justify-content: center;
        margin: 20px 0;
    }
</style>

</head>
<body>
    <h1 id="prd-prd-system-overview">PRD 系統總覽與導讀 (PRD System Overview)</h1>
<p>本文件旨在為開發者提供與專案 PRD 相關的導航地圖，說明各模組的功能、相依性以及執行順序。</p>
<h2 id="1">1. 系統架構與相依關係圖</h2>
<p>整個系統由底層往上層構建，呈現嚴格的單向依賴：</p>
<div class="codehilite"><pre><span></span><code><span class="n">graph</span><span class="w"> </span><span class="n">TD</span>
<span class="w">    </span><span class="n">A</span><span class="p">[</span><span class="n">Feature</span><span class="w"> </span><span class="n">Annotation</span><span class="w"> </span><span class="n">V1</span><span class="mf">.2</span><span class="o">&lt;</span><span class="n">br</span><span class="o">/&gt;</span><span class="p">(</span><span class="n">Excel</span><span class="o">/</span><span class="n">YAML</span><span class="w"> </span><span class="n">SSOT</span><span class="p">)]</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">提供</span><span class="w"> </span><span class="n">Schema</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">物理限制</span><span class="o">|</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">Cleaner</span><span class="w"> </span><span class="n">V2</span><span class="mf">.2</span><span class="p">]</span>
<span class="w">    </span><span class="n">Z</span><span class="p">[</span><span class="n">Raw</span><span class="w"> </span><span class="n">Files</span><span class="p">]</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">解析</span><span class="o">|</span><span class="w"> </span><span class="n">B</span><span class="p">[</span><span class="n">Parser</span><span class="w"> </span><span class="n">V2</span><span class="mf">.1</span><span class="p">]</span>
<span class="w">    </span><span class="n">B</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">UTC</span><span class="w"> </span><span class="n">DataFrame</span><span class="o">|</span><span class="w"> </span><span class="n">C</span>
<span class="w">    </span><span class="n">C</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">Cleaned</span><span class="w"> </span><span class="n">DataFrame</span><span class="o">|</span><span class="w"> </span><span class="n">D</span><span class="p">[</span><span class="n">Batch</span><span class="w"> </span><span class="n">Processor</span><span class="w"> </span><span class="n">V1</span><span class="mf">.3</span><span class="p">]</span>
<span class="w">    </span><span class="n">D</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">Manifest</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Parquet</span><span class="o">|</span><span class="w"> </span><span class="n">E</span><span class="p">[</span><span class="n">Feature</span><span class="w"> </span><span class="n">Engineer</span><span class="w"> </span><span class="n">V1</span><span class="mf">.3</span><span class="p">]</span>
<span class="w">    </span><span class="n">A</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">提供</span><span class="w"> </span><span class="n">device_role</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">規則</span><span class="o">|</span><span class="w"> </span><span class="n">E</span>
<span class="w">    </span><span class="n">E</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">Feature</span><span class="w"> </span><span class="n">Matrix</span><span class="o">|</span><span class="w"> </span><span class="n">F</span><span class="p">[</span><span class="n">Model</span><span class="w"> </span><span class="n">Training</span><span class="w"> </span><span class="n">V1</span><span class="mf">.2</span><span class="p">]</span>
<span class="w">    </span><span class="n">F</span><span class="w"> </span><span class="o">&lt;--&gt;|</span><span class="n">一致性驗證</span><span class="o">|</span><span class="w"> </span><span class="n">G</span><span class="p">[</span><span class="n">Hybrid</span><span class="w"> </span><span class="n">Consistency</span><span class="w"> </span><span class="n">V1</span><span class="mf">.0</span><span class="p">]</span>
<span class="w">    </span><span class="n">F</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">Model</span><span class="w"> </span><span class="n">Registry</span><span class="o">|</span><span class="w"> </span><span class="n">H</span><span class="p">[</span><span class="n">Optimization</span><span class="w"> </span><span class="n">Engine</span><span class="w"> </span><span class="n">V1</span><span class="mf">.1</span><span class="p">]</span>
<span class="w">    </span><span class="n">A</span><span class="w"> </span><span class="o">--&gt;|</span><span class="n">提供限制條件</span><span class="o">|</span><span class="w"> </span><span class="n">H</span>

<span class="w">    </span><span class="n">style</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="n">fill</span><span class="o">:</span><span class="err">#</span><span class="n">f9f</span><span class="p">,</span><span class="n">stroke</span><span class="o">:</span><span class="err">#</span><span class="mi">333</span><span class="p">,</span><span class="n">stroke</span><span class="o">-</span><span class="n">width</span><span class="o">:</span><span class="mi">4</span><span class="n">px</span>
<span class="w">    </span><span class="n">style</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="n">fill</span><span class="o">:</span><span class="err">#</span><span class="n">eef</span><span class="p">,</span><span class="n">stroke</span><span class="o">:</span><span class="err">#</span><span class="mi">333</span><span class="p">,</span><span class="n">stroke</span><span class="o">-</span><span class="n">width</span><span class="o">:</span><span class="mi">2</span><span class="n">px</span>
<span class="w">    </span><span class="n">style</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="n">fill</span><span class="o">:</span><span class="err">#</span><span class="n">bbf</span><span class="p">,</span><span class="n">stroke</span><span class="o">:</span><span class="err">#</span><span class="mi">333</span><span class="p">,</span><span class="n">stroke</span><span class="o">-</span><span class="n">width</span><span class="o">:</span><span class="mi">2</span><span class="n">px</span>
<span class="w">    </span><span class="n">style</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="n">fill</span><span class="o">:</span><span class="err">#</span><span class="n">ddf</span><span class="p">,</span><span class="n">stroke</span><span class="o">:</span><span class="err">#</span><span class="mi">333</span><span class="p">,</span><span class="n">stroke</span><span class="o">-</span><span class="n">width</span><span class="o">:</span><span class="mi">2</span><span class="n">px</span>
<span class="w">    </span><span class="n">style</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="n">fill</span><span class="o">:</span><span class="err">#</span><span class="n">bfb</span><span class="p">,</span><span class="n">stroke</span><span class="o">:</span><span class="err">#</span><span class="mi">333</span><span class="p">,</span><span class="n">stroke</span><span class="o">-</span><span class="n">width</span><span class="o">:</span><span class="mi">2</span><span class="n">px</span>
<span class="w">    </span><span class="n">style</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="n">fill</span><span class="o">:</span><span class="err">#</span><span class="n">fbb</span><span class="p">,</span><span class="n">stroke</span><span class="o">:</span><span class="err">#</span><span class="mi">333</span><span class="p">,</span><span class="n">stroke</span><span class="o">-</span><span class="n">width</span><span class="o">:</span><span class="mi">2</span><span class="n">px</span>
<span class="w">    </span><span class="n">style</span><span class="w"> </span><span class="n">G</span><span class="w"> </span><span class="n">fill</span><span class="o">:</span><span class="err">#</span><span class="n">fdd</span><span class="p">,</span><span class="n">stroke</span><span class="o">:</span><span class="err">#</span><span class="mi">333</span><span class="p">,</span><span class="n">stroke</span><span class="o">-</span><span class="n">width</span><span class="o">:</span><span class="mi">2</span><span class="n">px</span>
<span class="w">    </span><span class="n">style</span><span class="w"> </span><span class="n">H</span><span class="w"> </span><span class="n">fill</span><span class="o">:</span><span class="err">#</span><span class="n">eef</span><span class="p">,</span><span class="n">stroke</span><span class="o">:</span><span class="err">#</span><span class="mi">333</span><span class="p">,</span><span class="n">stroke</span><span class="o">-</span><span class="n">width</span><span class="o">:</span><span class="mi">2</span><span class="n">px</span>
</code></pre></div>

<h2 id="2-prd">2. 各 PRD 功能詳解</h2>
<h3 id="21-feature-annotation-specification-v12">2.1 [基礎設施] Feature Annotation Specification (V1.2)</h3>
<ul>
<li><strong>功能</strong>: 作為整個系統的 <strong>Single Source of Truth (SSOT)</strong>。定義所有感測器點位、物理類型、單位、上下限範圍以及設備角色 (Primary/Backup)。</li>
<li><strong>相依性</strong>: 無 (這是最底層)。</li>
<li><strong>關鍵產出</strong>: <code>config/features/sites/*.yaml</code> (由 Excel 生成)。</li>
</ul>
<h3 id="22-interface-contract-v10">2.2 [介面規範] Interface Contract (V1.0)</h3>
<ul>
<li><strong>功能</strong>: 定義模組間的溝通語言與錯誤處理標準。包含錯誤代碼表 (E000-E999)、資料交換格式 (Checkpoint)、以及版本相容性矩陣。</li>
</ul>
<h3 id="23">2.3 [資料前處理]</h3>
<h4 id="parser-v21">Parser (V2.1)</h4>
<ul>
<li><strong>功能</strong>: 處理「髒」的原始檔案。負責編碼偵測 (BOM/Big5)、強制時區轉 UTC、與標頭正規化。</li>
<li><strong>相依性</strong>: <code>Interface Contract</code> (檢查點 #1)。</li>
<li><strong>關鍵產出</strong>: 標準化 DataFrame (UTC, UTF-8)。</li>
</ul>
<h4 id="cleaner-v22">Cleaner (V2.2)</h4>
<ul>
<li><strong>功能</strong>: 業務邏輯清洗。處理時間對齊、異常值過濾 (基於 Annotation)、冷凍數據檢測。</li>
<li><strong>相依性</strong>: <code>Parser</code> (輸入), <code>Feature Annotation</code> (規則)。</li>
<li><strong>關鍵產出</strong>: Cleaned DataFrame (無 <code>device_role</code> 欄位)。</li>
</ul>
<h4 id="batch-processor-v13">Batch Processor (V1.3)</h4>
<ul>
<li><strong>功能</strong>: ETL 流程編排與落地。生成 <code>Manifest</code> (含 Annotation 稽核軌跡) 與 <code>Parquet</code> 檔案。確保資料與 Metadata 的完整傳遞，但不處理業務邏輯。</li>
<li><strong>相依性</strong>: <code>Cleaner</code> (輸入)。</li>
<li><strong>關鍵產出</strong>: <code>manifest.json</code> + <code>data.parquet</code>。</li>
</ul>
<h3 id="24-feature-engineer-v13">2.4 [特徵工程] Feature Engineer (V1.3)</h3>
<ul>
<li><strong>功能</strong>: 讀取 Manifest，結合 <strong>Feature Annotation</strong> (直接讀取 YAML SSOT) 來產生模型特徵。處理 Lag、Rolling Window，並根據設備角色調整策略。</li>
<li><strong>相依性</strong>: <code>Batch Processor</code> (輸入), <code>Feature Annotation</code> (設備角色)。</li>
<li><strong>關鍵產出</strong>: Feature Matrix。</li>
</ul>
<h3 id="25">2.5 [模型訓練與驗證]</h3>
<h4 id="model-training-v12">Model Training (V1.2)</h4>
<ul>
<li><strong>功能</strong>: 訓練能耗預測模型 (System &amp; Component Level)。</li>
<li><strong>關鍵產出</strong>: <code>model_registry_index.json</code> + 模型檔案。</li>
</ul>
<h4 id="hybrid-model-consistency-v10">Hybrid Model Consistency (V1.0)</h4>
<ul>
<li><strong>功能</strong>: 驗證 System Model 與 Component Models 加總的一致性。處理耦合效應 (Copula Effect) 與動態容差。</li>
<li><strong>相依性</strong>: 被 <code>Model Training</code> (驗證階段) 與 <code>Optimization</code> (執行階段) 呼叫。</li>
</ul>
<h3 id="26-optimization-engine-v11">2.6 [最佳化] Optimization Engine (V1.1)</h3>
<ul>
<li><strong>功能</strong>: 離線建議。基於模型預測與物理限制，尋找最佳設備參數。</li>
<li><strong>相依性</strong>: <code>Model Training</code> (載入模型), <code>Feature Annotation</code> (物理限制)。</li>
</ul>
<h2 id="3">3. 開發建議順序 (更新版)</h2>
<ol>
<li><strong>Feature Annotation Manager</strong>: (最優先) 建立地基。</li>
<li><strong>Parser</strong>: 處理原始資料的入口。</li>
<li><strong>Cleaner</strong>: 實作資料清洗邏輯。</li>
<li><strong>Batch Processor</strong>: 串接資料流與落地。</li>
<li><strong>Feature Engineer</strong>: 產生特徵。</li>
<li><strong>Hybrid Consistency</strong>: 建立驗證標準。</li>
<li><strong>Model Training</strong>: 訓練模型。</li>
<li><strong>Optimization Engine</strong>: 實現業務價值。</li>
</ol>
    
<script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ startOnLoad: true });
</script>

</body>
</html>
